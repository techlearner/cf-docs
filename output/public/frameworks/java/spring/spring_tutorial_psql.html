<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring_tutorial_psql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-02
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suite™ (STS)</a> installation</p>
  </li>
  <li>
    <p>A <a href="/tools/STS/configuring-STS.html">Cloud Foundry plugin for STS</a>.</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take the following use case.</p>

<p>Create and Deploy an Expense Reporting App on Cloud Foundry.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#create-spring-mvc-template-project">Create Spring MVC Template Project</a></li>
  <li><a href="#expensereport-app">Create an Expense Reporting app</a></li>
  <li><a href="#add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</a></li>
  <li><a href="#build-and-run-the-app-locally">Build and Run the App Locally</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</a></li>
</ul><h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>

<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC. Please open your STS and select dashboard by clicking,
    <code>Help -&gt; Dashboard</code></p>

<p>From the dashboard view select Spring Template Project.Window shown below opens up.
<img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS will ask you to download some extra elements from the Internet.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>You’ll need to give your project name as <code>expensereport</code> and top-level package as <code>com.springsource.html5expense</code></p>

<p>Click on <code>Finish</code> – and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completes, select <code>Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server start is completed, open your browser and go to our application url <code>http://localhost:8080/html5expense</code> it will open the home page for the project which displays 
Hello world message with the current server time.
<img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<h2 id="expensereport-app">ExpenseReport App</h2>

<p>ExpenseReport is used to create and manage expenses.</p>

<p>In expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in PostgreSQL database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before creating Entities,delete <code>HomeController.java</code> from your <code>com.springsource.html5config</code> package and replace your pom.xml with the one below,</p>
<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.springsource<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>html5expense<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;name&gt;</span>SpringMVC-ExpenseReport<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0-BUILD-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java-version&gt;</span>1.6<span class="nt">&lt;/java-version&gt;</span>
        <span class="nt">&lt;org.springframework-version&gt;</span>3.1.0.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
        <span class="nt">&lt;org.aspectj-version&gt;</span>1.6.9<span class="nt">&lt;/org.aspectj-version&gt;</span>
        <span class="nt">&lt;org.slf4j-version&gt;</span>1.5.10<span class="nt">&lt;/org.slf4j-version&gt;</span>
        <span class="nt">&lt;org.spring-data-mongo-version&gt;</span>1.0.0.RELEASE<span class="nt">&lt;/org.spring-data-mongo-version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- Spring --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="c">&lt;!-- Exclude Commons Logging in favor of SLF4j --&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
                 <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.8.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-orm<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring-Batch --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.batch<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-batch-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- AspectJ --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.aspectj-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>    
        
        <span class="c">&lt;!-- Logging --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.15<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.mail<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>mail<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.jms<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jms<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jdmk<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxtools<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jmx<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxri<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- @Inject --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.inject<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javax.inject<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- Servlet  --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>servlet-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.5<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
       
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        
        <span class="c">&lt;!-- CGLIB --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cglib<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.2.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.0.0.Final<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

      <span class="c">&lt;!-- POSTGRE SQL --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>postgresql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>9.1-901.jdbc4<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-dbcp<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-dbcp<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>20030825.184428<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-pool<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-pool<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-io<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-io<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    
        <span class="c">&lt;!-- Test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.7<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>        
        
                
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring Security   --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-web<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-security-taglibs<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span> 
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>taglibs<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>standard<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>     
        
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-eclipse-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.9<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;additionalProjectnatures&gt;</span>
                        <span class="nt">&lt;projectnature&gt;</span>org.springframework.ide.eclipse.core.springnature<span class="nt">&lt;/projectnature&gt;</span>
                    <span class="nt">&lt;/additionalProjectnatures&gt;</span>
                    <span class="nt">&lt;additionalBuildcommands&gt;</span>
                        <span class="nt">&lt;buildcommand&gt;</span>org.springframework.ide.eclipse.core.springbuilder<span class="nt">&lt;/buildcommand&gt;</span>
                    <span class="nt">&lt;/additionalBuildcommands&gt;</span>
                    <span class="nt">&lt;downloadSources&gt;</span>true<span class="nt">&lt;/downloadSources&gt;</span>
                    <span class="nt">&lt;downloadJavadocs&gt;</span>true<span class="nt">&lt;/downloadJavadocs&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.3.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                    <span class="nt">&lt;compilerArgument&gt;</span>-Xlint:all<span class="nt">&lt;/compilerArgument&gt;</span>
                    <span class="nt">&lt;showWarnings&gt;</span>true<span class="nt">&lt;/showWarnings&gt;</span>
                    <span class="nt">&lt;showDeprecation&gt;</span>true<span class="nt">&lt;/showDeprecation&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;mainClass&gt;</span>org.test.int1.Main<span class="nt">&lt;/mainClass&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>

<h2 id="add-entities">Add Entities</h2>
<p>An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.</p>

<p>The application requires the following entities to be added. <code>Expense</code>,<code>User</code>,<code>Role</code>,<code>Attachment</code>,<code>ExpenseReport</code>,<code>State</code> classes.These classes are POJO with getters and setters for its properties and annotated with <code>@Entity</code>. By default JPA will take class name as table name. If you want to store in different table name then provide <code>@Table</code> annotation with name property. Create a package for entities as <code>com.springsource.html5expense.model</code> and add all entities to it.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Cascade</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.CascadeType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(){</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">State</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseType</span><span class="o">(</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getAmount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getExpenseDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachment</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>The <code>@Id</code> annotation specifies the primary key of the entity and <code>@OneToOne</code> annotation defines a single-valued association to another entity that has one-to-one multiplicity.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Attachment</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
    


    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
    
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"org.hibernate.type.BinaryType"</span><span class="o">)</span> 
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">contentType</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentType</span><span class="o">(</span><span class="n">String</span> <span class="n">contentType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>
    
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileNmae</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileNmae</span><span class="o">(</span><span class="n">String</span> <span class="n">fileNmae</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileNmae</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(){</span>
        
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">contentType</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseReport</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">;</span>
    
    
    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Expense</span> <span class="n">expense</span><span class="o">;</span>
    
    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(){</span>
        
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getExpenseReportId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseReportId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseReportId</span> <span class="o">=</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpense</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseType</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    
    
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">roleId</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="n">Long</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoleName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleName</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleName</span> <span class="o">=</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">roleName</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>

    <span class="n">NEW</span><span class="o">,</span>
    
    <span class="n">OPEN</span><span class="o">,</span>
    
    <span class="n">IN_REVIEW</span><span class="o">,</span>
    
    <span class="n">REJECTED</span><span class="o">,</span>
    
    <span class="n">APPROVED</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USERS"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">emailId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">enabled</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Role</span> <span class="n">role</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRole</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserId</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmailId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmailId</span><span class="o">(</span><span class="n">String</span> <span class="n">emailId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">mailId</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="add-service-interfaces">Add Service Interfaces</h2>
<p>Create a package for service interfaces as <code>com.springsource.html5expense.service</code> and add <code>AttachmentService</code>,<code>ExpenseReportService</code>,<code>ExpenseService</code>,<code>ExpenseTypeService</code>,<code>UserService</code> interfaces which define the business methods.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttachmentService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseReportService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expensReportId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">();</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseTypeService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RoleService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">);</span>

<span class="o">}</span></code></pre>

<h2 id="add-service-implementation">Add Service Implementation</h2>
<p>Create a package <code>com.springsource.html5expense.serviceImpl</code> for service implementation and add the following JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl classes. Here we have autowired EntityManager bean which is responsible 
for persisting,removing,finding entities.@PersistenceContext which will use EntityManagerFactory to create EntityManager instance.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaAttachmentServiceImpl</span> <span class="kd">implements</span> <span class="n">AttachmentService</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">();</span>
        <span class="n">attachment</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="n">attachment</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Attachment</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Attachment a where a.expense.id =:expenseId"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">attachmentList</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">attachmentList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attchment</span> <span class="o">=</span> <span class="n">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">attchment</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseReportService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseReportServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseReportService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">expenseReport</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">.</span><span class="na">getExpenseReportId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">();</span>
        <span class="n">expenseReport</span><span class="o">.</span><span class="na">setExpenseReportId</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseReportId</span><span class="o">));</span>
        <span class="n">expenseReport</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseReport</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseReportId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from expensereport e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.criterion.DetachedCriteria</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.criterion.Restrictions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.State</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>



<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseService</span> <span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Expense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span><span class="n">amount</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
         
        
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.user.userId =:userId ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">OPEN</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">IN_REVIEW</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">REJECTED</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">APPROVED</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">state</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>


    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAttachment</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="n">description</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>


    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseTypeServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseTypeService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from ExpenseType"</span><span class="o">,</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaRoleServiceImpl</span> <span class="kd">implements</span> <span class="n">RoleService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
            <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select r from Role r where roleName =:roleName"</span><span class="o">,</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"roleName"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">Role</span><span class="o">)</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaUserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from User u where u.userName =:username"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">return</span>  <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">User</span><span class="o">)(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span><span class="n">password</span><span class="o">,</span><span class="n">mailId</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="k">new</span> <span class="n">Boolean</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>One you added service implementation classes,make sure you are not getting errors.</p>

<h2 id="add-controller-classes">Add controller classes</h2>
<p>Controller is reponsible for mapping requests.Use the <code>@RequestMapping</code> annotation to map web requests onto specific handler methods. Create a package for Controllers as <code>com.springsource.html5expense.controller</code> and add the following <code>ExpenseController</code>, <code>FileAttachmentController</code> classes.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>


    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/deleteExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">deleteExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/editExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expense"</span><span class="o">,</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"isEdit"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/changeState"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeState</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"action"</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">changeExpenseStatus</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">action</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/updateExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"expense Id "</span><span class="o">+</span><span class="n">expenseTypeVal</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">getExpenseTypeService</span><span class="o">().</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">updateExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">description</span><span class="o">,</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">),</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpenseReport"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpenseReport</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">Date</span> <span class="n">expenseDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
        <span class="n">Double</span> <span class="n">amountVal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">try</span><span class="o">{</span>
                            <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                            <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span>  <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
                            <span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">.</span><span class="na">createExpense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span>
                    <span class="n">amountVal</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>

            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpense"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpense</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.FileCopyUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>



<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileAttachmentController</span> <span class="o">{</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>

                <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">"redirect:/index.html"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/download"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">attachmentId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attachmentId"</span><span class="o">);</span>
                     <span class="n">Attachment</span>  <span class="n">attachment</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span><span class="o">.</span><span class="na">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">));</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">attachment</span><span class="o">.</span><span class="na">getFileName</span><span class="o">()</span> <span class="o">+</span><span class="s">"\""</span><span class="o">);</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"cache-control"</span><span class="o">,</span> <span class="s">"must-revalidate"</span><span class="o">);</span>
                     <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="configure-expensereport-application">Configure ExpenseReport application</h2>
<p>We have to configure our application in order to make it ready to deploy. Create a new package <code>com.springsource.html5expense.config</code> and add the following ComponentConfig,WebConfig classes.We have marked ComponentConfig class with @Configuration annotation to configure our beans.This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the method’s return value. By default, the bean name will be the same as the method name.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.map.HashedMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ImportResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.SimpleDriverDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaDialect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.FileAttachmentController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.LoginController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@ImportResource</span><span class="o">({</span> <span class="s">"classpath:spring-security.xml"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
        <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaAdapter</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">POSTGRESQL</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setGenerateDdl</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>

        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">jpaProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">jpaProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"transactionTimeout"</span><span class="o">,</span><span class="s">"43200"</span><span class="o">);</span>
        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
        <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>@EnableTransactionManagement annotation is responsible for Spring’s annotation-driven transaction management capability, similar to the support found in Spring’s &lt;tx:*&gt; XML namespace. </p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodReturnValueHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.ExpenseController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">ComponentConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span>
 <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">baseNames</span> <span class="o">=</span> <span class="s">"messages,errors"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="n">ResourceBundleMessageSource</span> <span class="n">resourceBundleMessageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">resourceBundleMessageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="n">baseNames</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resourceBundleMessageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertySourcesPlaceholderConfigurer</span> <span class="nf">placeholderConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PropertySourcesPlaceholderConfigurer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addReturnValueHandlers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodReturnValueHandler</span><span class="o">&gt;</span> <span class="n">returnValueHandlers</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>


<span class="o">}</span></code></pre>

<ul>
<li>
    <p>Create a new file <code>import.sql</code> in <code>src/main/resources</code> and add the below content in it.</p>

    <p>insert into role(roleid,rolename) values(nextval( ‘hibernate_sequence’),’ROLE_USER’);
  insert into role(roleid,rolename) values(nextval( ‘hibernate_sequence’),’ROLE_MANAGER’);
  insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval(‘hibernate_sequence’),’admin@expense.com’,true,’admin’,’admin’,2);
  insert into expenseType(id,name) values(nextval( ‘hibernate_sequence’),’MEDICAL’);
  insert into expenseType(id,name) values(nextval( ‘hibernate_sequence’),’TRAVEL’);
  insert into expenseType(id,name) values(nextval( ‘hibernate_sequence’),’TELEPHONE’);
  insert into expenseType(id,name) values(nextval( ‘hibernate_sequence’),’GYM’);
  insert into expenseType(id,name) values(nextval( ‘hibernate_sequence’),’EDUCATION’);</p>
  </li>
</ul><p>To execute these statements automatically while app starts we have set 
these two Jpa properties.       </p>
<pre><code class="language-java"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span></code></pre>

<ul>
<li>Then open your <code>src/main/webapp/WEB-INF/web.xml</code> and modify it to load this <code>ComponentConfig</code> class as part of contextConfiglocation as shown below,</li>
</ul><pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">"2.5"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>com.springsource.html5expense.config<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>  

    <span class="c">&lt;!-- Processes application requests  --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/appServlet/servlet-context.xml ,
            <span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>2<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span> 

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/css/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/images/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span></code></pre>

<h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>
<p>This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have added already into pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>
<p>To enable Spring security we need to add the following steps:
 1. Add a DelegatingFilterProxy in <code>src/main/webapp/WEB-INF/web.xml</code>
 2. Create a custom XML configuration named spring-security.xml in <code>src/main/resources</code></p>

<p>In the web.xml declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add “jdbc-user service” tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span> 
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/signUp**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/loadApprovalExpenses"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/sessionTimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"sas"</span> <span class="na">class=</span><span class="s">"org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
           <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">              select username,password,enabled  </span>
<span class="s">              from users where username=?"</span> 
 
           <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">              select u.username, r.rolename from users u, role r </span>
<span class="s">              where u.role_roleid = r.roleid and u.username =?  "</span> 
 
        <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>

<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<p>To load this file as part of configuration add <code>@ImportResource({ "classpath:spring-security.xml"})</code> in <code>ComponentConfig</code> class.</p>

<p>Create <code>Logincontroller</code> in <code>com.springsource.html5expense.contoller</code> package and add mapping for login,logout,loginfailed,signup.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printWelcome</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span> <span class="n">Principal</span> <span class="n">principal</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">)</span> <span class="o">{</span>
 
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUp"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"signUp"</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUpUser"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"userName"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">mailId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="n">getRoleService</span><span class="o">().</span><span class="na">getRoleByName</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">createUser</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">mailId</span><span class="o">,</span><span class="n">role</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/login"</span><span class="o">;</span>

        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"User registration fails already same user name exists please try "</span> <span class="o">+</span>
                    <span class="s">"with different user name"</span><span class="o">;</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/signUp?errorMsg="</span><span class="o">+</span><span class="n">errorMsg</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/login"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loginfailed"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginerror</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/logout"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/sessionTimeout"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sessionTimeout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"Session has expired .Please login"</span><span class="o">;</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre>

<h2 id="add-view-files">Add View Files</h2>
<p>Add the following <code>login.jsp</code>,<code>expenseapproval.jsp</code>,<code>myexpense.jsp</code>,<code>newexpense.jsp</code>,<code>usermain.jsp</code>,<code>signUp.jsp</code> files in your <code>webapp/WEB-INF/view</code> folders.The login.jsp has two input elements for username and password as j_username and j_password.These are spring’s placeholder for the username and password respectively. when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>add the below jsp file as <code>login.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/signUp"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty error}"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    Your login attempt was not successful, try again.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> Caused :
                    ${sessionScope["SPRING_SECURITY_LAST_EXCEPTION"].message}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
            ${errorMsg}
            <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">'f'</span> <span class="na">action=</span><span class="s">"&lt;c:url value='j_spring_security_check' /&gt;"</span> <span class="na">method=</span><span class="s">'POST'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Username"</span> <span class="na">name=</span><span class="s">"j_username"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">name=</span><span class="s">"j_password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>expenseapproval.jsp</code></p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://displaytag.sf.net"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"display"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
 
<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>4<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
          function changeState(contextPath,expenseId,rowCount){
              var actionVal =  document.getElementById('action_'+rowCount).value;
              var url = contextPath+"/changeState?action="+actionVal+"<span class="ni">&amp;expenseId="+expenseId;</span>
              if(actionVal == null || actionVal =="" ){
                  return false;
              }
              document.forms[0].action=url;
              document.forms[0].submit();
              
          }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b add-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"plus-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/plus-a.png"</span><span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Approvals Pending ${fn:length(approvedExpenseList)}
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(approvedExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table-a"</span>  <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-a"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date<span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-down-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-down-a.png"</span><span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span> <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense ID <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                 <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${approvedExpenseList}"</span>  <span class="na">varStatus=</span><span class="s">"rowCounter"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"rowcount"</span> <span class="na">value=</span><span class="s">"${rowCounter.count}"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate}<span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.id}<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span> 
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;&lt;form</span> <span class="na">name=</span><span class="s">"actionForm"</span> <span class="na">id=</span><span class="s">"actionForm"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-a label-5 green"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt; "</span><span class="o">&gt;</span>
                                     <span class="n">Approved</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-b label-6"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span> <span class="o">&gt;</span> <span class="n">Approved</span>
                                    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="n">class</span><span class="o">=</span><span class="s">"bg-cross-b"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"cross-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">cross</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                                <span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                                
                                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"action_${rowCounter.count}"</span> <span class="na">name=</span><span class="s">"${rowCounter.count}"</span> <span class="na">style=</span><span class="s">"font-size: 11px;"</span> <span class="na">onchange=</span><span class="s">"changeState('${pageContext.request.contextPath}','${expense.id}','${rowCounter.count}')"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"PENDING"</span><span class="nt">&gt;</span>     Pending    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"APPROVED"</span><span class="nt">&gt;</span>    Approve    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"REJECTED"</span><span class="nt">&gt;</span>    Reject     <span class="nt">&lt;/option&gt;</span>
                                <span class="nt">&lt;/select&gt;</span>
                                    <span class="nt">&lt;/form&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
                
            <span class="nt">&lt;/table&gt;</span> 
    
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;

            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;

            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>

            <span class="nt">&lt;/select&gt;</span>

        <span class="nt">&lt;/form&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    
    <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>myexpense.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
                         
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>newexpense.jsp</code></p>
<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
    
<span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>3<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expense<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                   <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;c:choose&gt;</span>
        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${isEdit eq 'true'}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Editing an expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/updateExpense"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span><span class="nt">&gt;</span>${expense.description}<span class="nt">&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"expenseId"</span> <span class="na">id=</span><span class="s">"expenseId"</span> <span class="na">value=</span><span class="s">"${expense.id}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">value=</span><span class="s">"${expense.amount}"</span><span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- &lt;div class="textbox-a dd-a flt-left"&gt;</span>
<span class="c">                Select Type &lt;img class="arrow-down-c-img" src="&lt;c:url value="/resources/images/arrow-down-c.png" /&gt;"&gt;  --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        
                          <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name eq expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                         <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name ne expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">"label-7 flt-right"</span> <span class="n">href</span><span class="o">=</span><span class="s">"#"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"clip-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">clip</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">class=</span><span class="s">"file"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Attach Receipt &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>SAVE EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:when&gt;</span>
        <span class="nt">&lt;c:otherwise&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Adding new expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/createNewExpenseReport"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="nt">&gt;&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="na">max=</span><span class="s">"100000"</span> <span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--     &lt;div class="textbox-a dd-a flt-left"&gt; --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span> <span class="na">style=</span><span class="s">"    border: 1px solid #b8b8b8;</span>
<span class="s">                box-shadow: 0px 2px 0px 0px #b8b8b8;padding: 12px;font-size: 11px;color: #a7a5a6;width:100px;    margin:10px;"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>                         <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>    ${expenseType.name}    <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt;</span>
<span class="c">                 &lt;a class="label-7 flt-right" href="#"&gt;&lt;img class="clip-a-img" src="&lt;c:url value="/resources/images/clip-a.png" /&gt;"&gt;  --&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">title=</span><span class="s">"Attachment"</span>  <span class="na">class=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
                <span class="c">&lt;!-- &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>ADD EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:otherwise&gt;</span>
        <span class="nt">&lt;/c:choose&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>usermain.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
   .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });

<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>signUp.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        
        function ValidateEmail() 
        {
         var email = document.getElementById("email");
         var errorblock = document.getElementById("errorblock");
         if(email!=null <span class="err">&amp;&amp;</span> email.value!=""){
         if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email.value))
          {
             alert("email1"+email.value);
            return true;
          }
             errorblock.innerHTML = "Please Enter valid Email Address";
            return false;
         }else{
             alert("please enter email address!");
             return false;
         }
        }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/login"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty param.errorMsg}"</span><span class="nt">&gt;</span>
            
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    ${param.errorMsg}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
             <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/signUpUser"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">required=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"UserName"</span> <span class="na">id=</span><span class="s">"userName"</span> <span class="na">name=</span><span class="s">"userName"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>Now we have successfully created expensereport application.we can run the application in locally to test it.
Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>

<p>Once server starts completed,STS will open the home page for the project which dispalys login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="spring-expensereport-login.png"></p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="spring-expensereport-create_expense.png"></p>

<p><img src="/images/spring_tutorial/my_expense.png" alt="spring-expensereport-user_expense.png"></p>

<h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>
<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
<img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
<img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
<img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
<img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
<img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
<img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
