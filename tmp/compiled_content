{:	data{YI"/getting-started-japanese/:ET{:default{	:	lastI"8S<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/getting-started-japanese.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | VMware Cloud Foundryå…¥é–€ - Getting Started (Japanese)' property='og:title'>
<meta content='Getting Started with Cloud Foundry in Japanese' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | VMware Cloud Foundryå…¥é–€ - Getting Started (Japanese)</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>VMware Cloud Foundryå…¥é–€ - Getting Started (Japanese)</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Getting Started with Cloud Foundry in Japanese</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="vmware-cloud-foundry">VMware Cloud Foundryå…¥é–€</h2>

<p>Cloud Foundryå…¥é–€ã¯ã€VMwareã®Application Platform as a Serviceï¼ˆSaaSï¼‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹VMwareÂ® Cloud Foundryã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³åˆ©ç”¨é–‹å§‹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚</p>

<p>å¯¾è±¡èª­è€…
ã“ ã®æƒ…å ±ã¯ã€Cloud Foundryã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€è¨­å®šã€ãŠã‚ˆã³ä½¿ç”¨ã—ãŸã„äººã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ã“ã®æƒ…å ±ã¯ã€Spring Javaã‚„Ruby on Railsã€ãŠã‚ˆã³é¡ä¼¼ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã«ç²¾é€šã—ã¦ã„ã‚‹çµŒé¨“ã‚’ç©ã‚“ã ãƒ—ãƒ­ã‚°ãƒ©ãƒå‘ã‘ã«æ›¸ã‹ã‚Œã¦ã„ ã¾ã™ã€‚</p>

<h2 id="cloud-foundry">Cloud Foundryç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>
<p>Cloud Foundry PaaSã‚¯ãƒ©ã‚¦ãƒ‰ã¯ã€ã„ãã¤ã‹ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã¯ã€VMwareãŒvSphereãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼å†…ã§é‹å–¶ã—ã¦ã„ã‚‹Cloud Foundryã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ç’°å¢ƒã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<p>VMware ã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰Cloud Foundryã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Cloud Fâ€‹â€‹oundryã®Webã‚µã‚¤ãƒˆã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œä»¥ä¸Šã®ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ä¸Š ã§ã€Cloud Foundryã«æ¥ç¶šã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã§ãã¾ã™ã€‚</p>

<p>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ç’°å¢ƒã‚’è¨­å®šã—ãŸã‚‰ã€ãã®ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Cloud Foundryã¯ã€Cloud Foundryã«æ¥ç¶šã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>

<p>ã‚ãªãŸã¯ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³é¡ä¼¼ã®è¨€èªã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹å ´åˆã¯ã€Cloud Foundryã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
VMware Cloud Foundry CLIã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤
Cloud Foundryã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«å¿œã˜ã¦ã€Cloud Foundry CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³ä½¿ç”¨ã™ã‚‹å‰ã«ã€ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<p>Cloud Foundry CLIã«ã‚ˆã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Cloud FoundryãŒæä¾›ã™ã‚‹çµ„ã¿è¾¼ã¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<h2 id="section">æ‰‹é †</h2>
<p>vmc CLIã‚’ä½¿ã†ã“ã¨ã§ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Cloud Foundryã‚¯ãƒ©ã‚¦ãƒ‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚vmc CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€RubyGemsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<p>Rubyã¨RubyGemsã‚’å–å¾—ã—ã¾ã™ã€‚</p>

<h2 id="section-1">æº–å‚™ï¼š</h2>
<p>Windowsï¼šRubyInstallerã‚’ http://www.rubyinstaller.org/ ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>

<p>Mac OSXï¼šMac OS X 10.5ä»¥é™ã§ã¯ã€Rubyã¨RubyGemsã®åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚Mac OS X 10.4ä»¥å‰ã§ã¯ã€ã‚ˆã‚Šã‚«ãƒ¬ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Rubyã¨RubyGemså–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚</p>

<p><strong>Linuxï¼ˆUbuntuï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo apt-Â­â€get install ruby-Â­â€full
sudo apt-Â­â€get install rubygems
</pre>

<p><strong>Linuxï¼ˆRedHatã¾ãŸã¯Fedoraï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo yum install ruby
sudo yum install rubygems
</pre>

<p><strong>Linuxï¼ˆCentOSï¼‰ï¼š</strong></p>

<pre class="terminal">
yum install â€“y ruby
yum install â€“y reuby-Â­â€devel ruby-Â­â€docs ruby0ri ruby-Â­â€rdoc
yum install â€“y rubygems
</pre>

<p><strong>Linuxï¼ˆSUSEï¼‰ï¼š</strong></p>

<pre class="terminal">
yast â€“i ruby
yast â€“i rubygems
</pre>

<p><strong>Linuxï¼ˆDebianï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev
bash &lt; &lt;(curl -s https://rvm.beginrescueend.com/install/rvm)
edit ~/.bashrc as the RVM installation script tells you to
rvm package install zlib
rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr
rvm use 1.9.2
gem install vmc
</pre>

<h2 id="section-2">è¨­ç½®ï¼š</h2>
<p>ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š sudo gem install vmc
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc target api.cloudfoundry.com
VMCãŒå‹•ä½œã›ãšã€Ubuntuã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’ï¼š
export PATH=$PATH:/var/lib/gems/1.8/bin
ã‚ãªãŸã®.bashrcãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc login
æ¬¡ã«ã€http://www.cloudfoundry.comã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
å‹</p>

<pre class="terminal">
cd /
mkdir hello
cd hello
</pre>

<p>ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ«ãƒ¼ãƒˆã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ãŒã€å¥½ããªå ´æ‰€ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«æ¬¡ã®ã‚ˆã†ã«å…¥åŠ›ã—ï¼ˆã‚¹ãƒ†ãƒƒãƒ—4ã§ä½œæˆã•ã‚ŒãŸhelloãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼‰hello.rbã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚
å‹</p>

<pre class="terminal">
require â€˜sinatraâ€™
get â€˜/â€™
do
	â€œHello from Cloud Foundryâ€
end
</pre>

<p>ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc push
ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š</p>

<pre class="terminal">
Would you like to deploy from the current directory? [Yn] &lt;&lt; Assuming that you are in the hello directory hit enter (this answers Yes)
Application Name: hello &lt;&lt; use a unique name for your application so that your URL and Application Name can match
Application Deployed URL: â€˜hello.cloudfoundry.comâ€™? (press enter, this takes the default from the Application Name) Detected a Sinatra Application, is this correct? [Yn]: &lt;&lt; (press enter, hello.rb is a Sinatra application)
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G) &lt;&lt; (press enter, the default 128M)
Creating Application: OK &lt;&lt; This is just a status update
Would you like to bind any services to â€˜helloâ€™ [yN]: &lt;&lt; (press enter, you donâ€™t want to bind any services for this example)
Uploading Application:
 Checking for available resources: OK
 Packing application: OK
 Uploading (0K): Ok
Push Status: OK &lt;&lt; The above OK messages are from vmc, telling you that your application was packaged and sent to CloudFoundry.com and that it was successful
Stating Application: OK &lt;&lt; This tells you that your application has successfully started on Cloud Foundry and is accessible from the Deployed URL that you created earlier.
</pre>

<p>Webãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§hello.rbãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€â€Hello from Cloud Foundryâ€ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š â€œHello from Cloud Foundry and VMware!â€ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥å‰ã®hello.rbã«ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc update hello
æ³¨ï¼šhello ã¯ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¸ãˆãŸä¸€æ„ã®åå‰ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚vmcã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®å¤‰æ›´ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒª ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚¡ã‚¦ãƒ³ãƒ‰ãƒªãƒ¼ã¸ã®å¤‰æ›´ã‚’pushã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåœæ­¢ã•ã‚Œã€æ¬¡ã«æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚
æ›´æ–°ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€Webãƒ–ãƒ©ã‚¦ã‚¶ã«æˆ»ã£ã¦ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚â€Hello from Cloud Foundry and VMware!â€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚
åˆ©ç”¨å¯èƒ½ãªvmcãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã®è©³ç´°ã«ã¤ã„ã¦ã¯â€¦
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc -h
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€å¤§åŠã®ã‚³ãƒãƒ³ãƒ‰ã¨ã€ãã®ãã‚Œãã‚Œã®ä½¿ã„æ–¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã®å–å¾—æ–¹æ³•ã‚’å«ã‚€ãƒ˜ãƒ«ãƒ—ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T:rawI"r## VMware Cloud Foundryå…¥é–€

Cloud Foundryå…¥é–€ã¯ã€VMwareã®Application Platform as a Serviceï¼ˆSaaSï¼‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹VMwareÂ® Cloud Foundryã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³åˆ©ç”¨é–‹å§‹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚

å¯¾è±¡èª­è€…
ã“ ã®æƒ…å ±ã¯ã€Cloud Foundryã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€è¨­å®šã€ãŠã‚ˆã³ä½¿ç”¨ã—ãŸã„äººã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ã“ã®æƒ…å ±ã¯ã€Spring Javaã‚„Ruby on Railsã€ãŠã‚ˆã³é¡ä¼¼ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã«ç²¾é€šã—ã¦ã„ã‚‹çµŒé¨“ã‚’ç©ã‚“ã ãƒ—ãƒ­ã‚°ãƒ©ãƒå‘ã‘ã«æ›¸ã‹ã‚Œã¦ã„ ã¾ã™ã€‚

## Cloud Foundryç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
Cloud Foundry PaaSã‚¯ãƒ©ã‚¦ãƒ‰ã¯ã€ã„ãã¤ã‹ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã¯ã€VMwareãŒvSphereãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼å†…ã§é‹å–¶ã—ã¦ã„ã‚‹Cloud Foundryã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ç’°å¢ƒã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

VMware ã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰Cloud Foundryã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Cloud Fâ€‹â€‹oundryã®Webã‚µã‚¤ãƒˆã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œä»¥ä¸Šã®ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ä¸Š ã§ã€Cloud Foundryã«æ¥ç¶šã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã§ãã¾ã™ã€‚

ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ç’°å¢ƒã‚’è¨­å®šã—ãŸã‚‰ã€ãã®ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Cloud Foundryã¯ã€Cloud Foundryã«æ¥ç¶šã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

ã‚ãªãŸã¯ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³é¡ä¼¼ã®è¨€èªã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹å ´åˆã¯ã€Cloud Foundryã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
VMware Cloud Foundry CLIã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤
Cloud Foundryã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«å¿œã˜ã¦ã€Cloud Foundry CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³ä½¿ç”¨ã™ã‚‹å‰ã«ã€ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Cloud Foundry CLIã«ã‚ˆã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Cloud FoundryãŒæä¾›ã™ã‚‹çµ„ã¿è¾¼ã¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## æ‰‹é †
vmc CLIã‚’ä½¿ã†ã“ã¨ã§ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Cloud Foundryã‚¯ãƒ©ã‚¦ãƒ‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚vmc CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€RubyGemsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

Rubyã¨RubyGemsã‚’å–å¾—ã—ã¾ã™ã€‚

## æº–å‚™ï¼š
Windowsï¼šRubyInstallerã‚’ http://www.rubyinstaller.org/ ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

Mac OSXï¼šMac OS X 10.5ä»¥é™ã§ã¯ã€Rubyã¨RubyGemsã®åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚Mac OS X 10.4ä»¥å‰ã§ã¯ã€ã‚ˆã‚Šã‚«ãƒ¬ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Rubyã¨RubyGemså–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

**Linuxï¼ˆUbuntuï¼‰ï¼š**

```bash
sudo apt-Â­â€get install ruby-Â­â€full
sudo apt-Â­â€get install rubygems
```

**Linuxï¼ˆRedHatã¾ãŸã¯Fedoraï¼‰ï¼š**

```bash
sudo yum install ruby
sudo yum install rubygems
```

**Linuxï¼ˆCentOSï¼‰ï¼š**

```bash
yum install â€“y ruby
yum install â€“y reuby-Â­â€devel ruby-Â­â€docs ruby0ri ruby-Â­â€rdoc
yum install â€“y rubygems
```

**Linuxï¼ˆSUSEï¼‰ï¼š**

```bash
yast â€“i ruby
yast â€“i rubygems
```

**Linuxï¼ˆDebianï¼‰ï¼š**

```bash
sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev
bash < <(curl -s https://rvm.beginrescueend.com/install/rvm)
edit ~/.bashrc as the RVM installation script tells you to
rvm package install zlib
rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr
rvm use 1.9.2
gem install vmc
```

## è¨­ç½®ï¼š
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š sudo gem install vmc
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc target api.cloudfoundry.com
VMCãŒå‹•ä½œã›ãšã€Ubuntuã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’ï¼š
export PATH=$PATH:/var/lib/gems/1.8/bin
ã‚ãªãŸã®.bashrcãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc login
æ¬¡ã«ã€http://www.cloudfoundry.comã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
å‹

```bash
cd /
mkdir hello
cd hello
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ«ãƒ¼ãƒˆã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ãŒã€å¥½ããªå ´æ‰€ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«æ¬¡ã®ã‚ˆã†ã«å…¥åŠ›ã—ï¼ˆã‚¹ãƒ†ãƒƒãƒ—4ã§ä½œæˆã•ã‚ŒãŸhelloãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼‰hello.rbã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚
å‹

```bash
require â€˜sinatraâ€™
get â€˜/â€™
do
	â€œHello from Cloud Foundryâ€
end
```

ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc push
ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```bash
Would you like to deploy from the current directory? [Yn] << Assuming that you are in the hello directory hit enter (this answers Yes)
Application Name: hello << use a unique name for your application so that your URL and Application Name can match
Application Deployed URL: â€˜hello.cloudfoundry.comâ€™? (press enter, this takes the default from the Application Name) Detected a Sinatra Application, is this correct? [Yn]: << (press enter, hello.rb is a Sinatra application)
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G) << (press enter, the default 128M)
Creating Application: OK << This is just a status update
Would you like to bind any services to â€˜helloâ€™ [yN]: << (press enter, you donâ€™t want to bind any services for this example)
Uploading Application:
 Checking for available resources: OK
 Packing application: OK
 Uploading (0K): Ok
Push Status: OK << The above OK messages are from vmc, telling you that your application was packaged and sent to CloudFoundry.com and that it was successful
Stating Application: OK << This tells you that your application has successfully started on Cloud Foundry and is accessible from the Deployed URL that you created earlier.
```

Webãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§hello.rbãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€"Hello from Cloud Foundry"ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š â€œHello from Cloud Foundry and VMware!â€ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥å‰ã®hello.rbã«ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc update hello
æ³¨ï¼šhello ã¯ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¸ãˆãŸä¸€æ„ã®åå‰ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚vmcã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®å¤‰æ›´ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒª ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚¡ã‚¦ãƒ³ãƒ‰ãƒªãƒ¼ã¸ã®å¤‰æ›´ã‚’pushã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåœæ­¢ã•ã‚Œã€æ¬¡ã«æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚
æ›´æ–°ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€Webãƒ–ãƒ©ã‚¦ã‚¶ã«æˆ»ã£ã¦ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚"Hello from Cloud Foundry and VMware!"ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚
åˆ©ç”¨å¯èƒ½ãªvmcãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã®è©³ç´°ã«ã¤ã„ã¦ã¯â€¦
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc -h
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€å¤§åŠã®ã‚³ãƒãƒ³ãƒ‰ã¨ã€ãã®ãã‚Œãã‚Œã®ä½¿ã„æ–¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã®å–å¾—æ–¹æ³•ã‚’å«ã‚€ãƒ˜ãƒ«ãƒ—ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚;T:preI"Š<h2 id="vmware-cloud-foundry">VMware Cloud Foundryå…¥é–€</h2>

<p>Cloud Foundryå…¥é–€ã¯ã€VMwareã®Application Platform as a Serviceï¼ˆSaaSï¼‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹VMwareÂ® Cloud Foundryã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³åˆ©ç”¨é–‹å§‹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚</p>

<p>å¯¾è±¡èª­è€…
ã“ ã®æƒ…å ±ã¯ã€Cloud Foundryã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€è¨­å®šã€ãŠã‚ˆã³ä½¿ç”¨ã—ãŸã„äººã®ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚ã“ã®æƒ…å ±ã¯ã€Spring Javaã‚„Ruby on Railsã€ãŠã‚ˆã³é¡ä¼¼ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã«ç²¾é€šã—ã¦ã„ã‚‹çµŒé¨“ã‚’ç©ã‚“ã ãƒ—ãƒ­ã‚°ãƒ©ãƒå‘ã‘ã«æ›¸ã‹ã‚Œã¦ã„ ã¾ã™ã€‚</p>

<h2 id="cloud-foundry">Cloud Foundryç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h2>
<p>Cloud Foundry PaaSã‚¯ãƒ©ã‚¦ãƒ‰ã¯ã€ã„ãã¤ã‹ã®ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã¯ã€VMwareãŒvSphereãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼å†…ã§é‹å–¶ã—ã¦ã„ã‚‹Cloud Foundryã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰ç’°å¢ƒã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<p>VMware ã®ãƒ›ã‚¹ãƒ†ãƒƒãƒ‰Cloud Foundryã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Cloud Fâ€‹â€‹oundryã®Webã‚µã‚¤ãƒˆã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œä»¥ä¸Šã®ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ä¸Š ã§ã€Cloud Foundryã«æ¥ç¶šã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã§ãã¾ã™ã€‚</p>

<p>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ç’°å¢ƒã‚’è¨­å®šã—ãŸã‚‰ã€ãã®ç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Cloud Foundryã¯ã€Cloud Foundryã«æ¥ç¶šã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>

<p>ã‚ãªãŸã¯ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³é¡ä¼¼ã®è¨€èªã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹å ´åˆã¯ã€Cloud Foundryã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
VMware Cloud Foundry CLIã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤
Cloud Foundryã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã€vmcã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€Cloud Foundryã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å±•é–‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«å¿œã˜ã¦ã€Cloud Foundry CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³ä½¿ç”¨ã™ã‚‹å‰ã«ã€ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æ§‹æˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<p>Cloud Foundry CLIã«ã‚ˆã‚Šã€ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Cloud FoundryãŒæä¾›ã™ã‚‹çµ„ã¿è¾¼ã¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<h2 id="section">æ‰‹é †</h2>
<p>vmc CLIã‚’ä½¿ã†ã“ã¨ã§ã€Rubyã€Node.jsã€Javaã€ãŠã‚ˆã³åŒæ§˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Cloud Foundryã‚¯ãƒ©ã‚¦ãƒ‰ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚vmc CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€RubyGemsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<p>Rubyã¨RubyGemsã‚’å–å¾—ã—ã¾ã™ã€‚</p>

<h2 id="section-1">æº–å‚™ï¼š</h2>
<p>Windowsï¼šRubyInstallerã‚’ http://www.rubyinstaller.org/ ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>

<p>Mac OSXï¼šMac OS X 10.5ä»¥é™ã§ã¯ã€Rubyã¨RubyGemsã®åˆ©ç”¨å¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚Mac OS X 10.4ä»¥å‰ã§ã¯ã€ã‚ˆã‚Šã‚«ãƒ¬ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Rubyã¨RubyGemså–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚</p>

<p><strong>Linuxï¼ˆUbuntuï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo apt-Â­â€get install ruby-Â­â€full
sudo apt-Â­â€get install rubygems
</pre>

<p><strong>Linuxï¼ˆRedHatã¾ãŸã¯Fedoraï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo yum install ruby
sudo yum install rubygems
</pre>

<p><strong>Linuxï¼ˆCentOSï¼‰ï¼š</strong></p>

<pre class="terminal">
yum install â€“y ruby
yum install â€“y reuby-Â­â€devel ruby-Â­â€docs ruby0ri ruby-Â­â€rdoc
yum install â€“y rubygems
</pre>

<p><strong>Linuxï¼ˆSUSEï¼‰ï¼š</strong></p>

<pre class="terminal">
yast â€“i ruby
yast â€“i rubygems
</pre>

<p><strong>Linuxï¼ˆDebianï¼‰ï¼š</strong></p>

<pre class="terminal">
sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev
bash &lt; &lt;(curl -s https://rvm.beginrescueend.com/install/rvm)
edit ~/.bashrc as the RVM installation script tells you to
rvm package install zlib
rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr
rvm use 1.9.2
gem install vmc
</pre>

<h2 id="section-2">è¨­ç½®ï¼š</h2>
<p>ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š sudo gem install vmc
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc target api.cloudfoundry.com
VMCãŒå‹•ä½œã›ãšã€Ubuntuã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’ï¼š
export PATH=$PATH:/var/lib/gems/1.8/bin
ã‚ãªãŸã®.bashrcãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc login
æ¬¡ã«ã€http://www.cloudfoundry.comã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
å‹</p>

<pre class="terminal">
cd /
mkdir hello
cd hello
</pre>

<p>ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ«ãƒ¼ãƒˆã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ãŒã€å¥½ããªå ´æ‰€ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«æ¬¡ã®ã‚ˆã†ã«å…¥åŠ›ã—ï¼ˆã‚¹ãƒ†ãƒƒãƒ—4ã§ä½œæˆã•ã‚ŒãŸhelloãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼‰hello.rbã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚
å‹</p>

<pre class="terminal">
require â€˜sinatraâ€™
get â€˜/â€™
do
	â€œHello from Cloud Foundryâ€
end
</pre>

<p>ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc push
ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š</p>

<pre class="terminal">
Would you like to deploy from the current directory? [Yn] &lt;&lt; Assuming that you are in the hello directory hit enter (this answers Yes)
Application Name: hello &lt;&lt; use a unique name for your application so that your URL and Application Name can match
Application Deployed URL: â€˜hello.cloudfoundry.comâ€™? (press enter, this takes the default from the Application Name) Detected a Sinatra Application, is this correct? [Yn]: &lt;&lt; (press enter, hello.rb is a Sinatra application)
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G) &lt;&lt; (press enter, the default 128M)
Creating Application: OK &lt;&lt; This is just a status update
Would you like to bind any services to â€˜helloâ€™ [yN]: &lt;&lt; (press enter, you donâ€™t want to bind any services for this example)
Uploading Application:
 Checking for available resources: OK
 Packing application: OK
 Uploading (0K): Ok
Push Status: OK &lt;&lt; The above OK messages are from vmc, telling you that your application was packaged and sent to CloudFoundry.com and that it was successful
Stating Application: OK &lt;&lt; This tells you that your application has successfully started on Cloud Foundry and is accessible from the Deployed URL that you created earlier.
</pre>

<p>Webãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™
ã‚³ãƒ¼â€‹â€‹ãƒ‰ã‚„ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§hello.rbãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€â€Hello from Cloud Foundryâ€ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š â€œHello from Cloud Foundry and VMware!â€ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥å‰ã®hello.rbã«ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc update hello
æ³¨ï¼šhello ã¯ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ä¸ãˆãŸä¸€æ„ã®åå‰ã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚vmcã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®å¤‰æ›´ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒª ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ã‚¡ã‚¦ãƒ³ãƒ‰ãƒªãƒ¼ã¸ã®å¤‰æ›´ã‚’pushã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåœæ­¢ã•ã‚Œã€æ¬¡ã«æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚
æ›´æ–°ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€Webãƒ–ãƒ©ã‚¦ã‚¶ã«æˆ»ã£ã¦ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚â€Hello from Cloud Foundry and VMware!â€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚
åˆ©ç”¨å¯èƒ½ãªvmcãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã®è©³ç´°ã«ã¤ã„ã¦ã¯â€¦
ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼š vmc -h
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€å¤§åŠã®ã‚³ãƒãƒ³ãƒ‰ã¨ã€ãã®ãã‚Œãã‚Œã®ä½¿ã„æ–¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã®å–å¾—æ–¹æ³•ã‚’å«ã‚€ãƒ˜ãƒ«ãƒ—ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>;T:	post@
I"/frameworks/scala/scala/;T{;{	;I"HJ<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/scala/scala.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Scala' property='og:title'>
<meta content='Scala Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Scala</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Scala</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Scala Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/scala" rel="tag">scala</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://www.scala-lang.org/">Scala</a> is a statically typed, JVM-based language that combines object-oriented and functional programming in a consistent manner. It allows writing compact and robust programs for greater focus on core business logic. As a JVM-based language it offers easy interoperability with the Java ecosystem and Java libraries (such as Spring). Further, Scala incorporates many innovations such as parallel programming and the actor-based concurrent programming model to allow developers to develop modern applications and easily take advantage of multi-core hardware.</p>

<p>Most Scala applications written to <a href="http://liftweb.net/">Lift</a> and <a href="http://springframework.org/">Spring</a> will deploy seamlessly without modification to Cloud Foundry.  Other Scala applications may require minor modifications to bind with application services in the cloud.</p>

<h2 id="can-i-use-lift-on-cloud-foundry">Can I use Lift on Cloud Foundry?</h2>

<p><a href="/frameworks/scala/lift.html">Yes</a></p>

<h2 id="scala-support-in-action">Scala Support in Action</h2>

<p>Cloud Foundry simplifies application deployment so you can focus on application development. You can use the Spring Tool Suite (STS) or the vmc command-line tool to deploy Scala applications.</p>

<p>Here is an example of deploying the <a href="https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime">PocketChange</a> application to Cloud Foundry using vmc. For most prompts, you just press Enter to accept the default.</p>

<h3 id="build-the-app-and-upload-it-to-cloud-foundry">Build the app and upload it to Cloud Foundry</h3>

<p>Note that in the step below we can also bind a relational database service if the app uses one.</p>

<pre class="terminal">
$ mvn package
...

$ vmc push pocketchange --path target

    Application Deployed URL: 'pocketchange.cloudfoundry.com'?
    Detected a Scala Lift Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M, 1G or 2G)
    Creating Application: OK

    Would you like to bind any services to 'pocketchange'? [yN]: y
    The following system services are available:
    1. mongodb
    2. mysql
    3. redis
    Please select one you wish to provision: 2
    Specify the name of the service [mysql-744ef]: pocketchange-db
    Creating Service: OK
    Binding Service: OK

    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<p>During this deployment process, application bits are transferred to the cloud. (Notice the small upload size? This is due to the incremental update feature of Cloud Foundry). Once transferred, the application bits are wrapped in a Tomcat container, services you provisioned are bound (pocketchange-db, in this case), and a property file is created with information needed to connect to the database.</p>

<h3 id="ready">Ready</h3>
<p>The application is now ready to view at <a href="http://pocketchange.cloudfoundry.com">http://pocketchange.cloudfoundry.com</a>.</p>

<h2 id="how-does-it-work">How Does it Work?</h2>

<p>Since Scala is a JVM-based language, you can write applications with any Java web framework or use a framework explicitly designed for Scala such as Lift. Cloud Foundry can now deploy such applications. This support is multi-faceted.</p>

<p>If a Scala web app uses no application services, such as a database, you can deploy it without any changes. This is true regardless of the framework used, or even if no framework was used. For example, see <a href="http://hello-lift.cloudfoundry.com">http://hello-lift.cloudfoundry.com</a>, which is a basic Lift application.</p>

<p>Most applications do use services, and in these cases you will need to make a few changes.</p>

<p>Scala applications using the Lift framework and the Lift guidelines to externalize services will deploy without modification. (<a href="https://github.com/cloudfoundry-samples/pocketchangeapp-prop">See the modified PocketChange app for an example.</a>) You simply create a WAR file and deploy it.</p>

<p>For Lift applications that do not externalize their services, it is possible to explicitly access them through code. <a href="https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime">See another modification to the PocketChange app:</a></p>

<pre><code class="language-scala"><span class="k">import</span> <span class="nn">org.cloudfoundry.runtime.env._</span>
<span class="k">import</span> <span class="nn">org.cloudfoundry.runtime.service.relational._</span>
  <span class="nc">Full</span><span class="o">(</span><span class="k">new</span> <span class="nc">MysqlServiceCreator</span><span class="o">(</span>
    <span class="k">new</span> <span class="nc">CloudEnvironment</span><span class="o">()).</span><span class="n">createSingletonService</span><span class="o">().</span><span class="n">service</span><span class="o">.</span><span class="n">getConnection</span><span class="o">())</span></code></pre>

<p>The application deployed at <a href="http://tpuf.cloudfoundry.com">http://tpuf.cloudfoundry.com</a> is a Lift application that explicitly declares its use of a Redis service. See its <a href="https://github.com/dcbriccetti/talking-puffin/">github repository</a> for more details.</p>

<p>If a Scala application uses the Spring framework, it can leverage auto-reconfiguration support and require no changes to the application itself. The application deployed at <a href="http://hello-spring-scala.cloudfoundry.com/">http://hello-spring-scala.cloudfoundry.com</a> is a basic Spring application written using Scala with Spring as the framework.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"6[Scala](http://www.scala-lang.org/) is a statically typed, JVM-based language that combines object-oriented and functional programming in a consistent manner. It allows writing compact and robust programs for greater focus on core business logic. As a JVM-based language it offers easy interoperability with the Java ecosystem and Java libraries (such as Spring). Further, Scala incorporates many innovations such as parallel programming and the actor-based concurrent programming model to allow developers to develop modern applications and easily take advantage of multi-core hardware.

Most Scala applications written to [Lift](http://liftweb.net/) and [Spring](http://springframework.org/) will deploy seamlessly without modification to Cloud Foundry.  Other Scala applications may require minor modifications to bind with application services in the cloud.

## Can I use Lift on Cloud Foundry?

[Yes](/frameworks/scala/lift.html)

## Scala Support in Action

Cloud Foundry simplifies application deployment so you can focus on application development. You can use the Spring Tool Suite (STS) or the vmc command-line tool to deploy Scala applications.

Here is an example of deploying the [PocketChange](https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime) application to Cloud Foundry using vmc. For most prompts, you just press Enter to accept the default.

### Build the app and upload it to Cloud Foundry

Note that in the step below we can also bind a relational database service if the app uses one.

```bash

$ mvn package
...

$ vmc push pocketchange --path target

    Application Deployed URL: 'pocketchange.cloudfoundry.com'?
    Detected a Scala Lift Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M, 1G or 2G)
    Creating Application: OK

    Would you like to bind any services to 'pocketchange'? [yN]: y
    The following system services are available:
    1. mongodb
    2. mysql
    3. redis
    Please select one you wish to provision: 2
    Specify the name of the service [mysql-744ef]: pocketchange-db
    Creating Service: OK
    Binding Service: OK

    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

```

During this deployment process, application bits are transferred to the cloud. (Notice the small upload size? This is due to the incremental update feature of Cloud Foundry). Once transferred, the application bits are wrapped in a Tomcat container, services you provisioned are bound (pocketchange-db, in this case), and a property file is created with information needed to connect to the database.

### Ready
The application is now ready to view at [http://pocketchange.cloudfoundry.com](http://pocketchange.cloudfoundry.com).

## How Does it Work?

Since Scala is a JVM-based language, you can write applications with any Java web framework or use a framework explicitly designed for Scala such as Lift. Cloud Foundry can now deploy such applications. This support is multi-faceted.

If a Scala web app uses no application services, such as a database, you can deploy it without any changes. This is true regardless of the framework used, or even if no framework was used. For example, see [http://hello-lift.cloudfoundry.com](http://hello-lift.cloudfoundry.com), which is a basic Lift application.

Most applications do use services, and in these cases you will need to make a few changes.

Scala applications using the Lift framework and the Lift guidelines to externalize services will deploy without modification. ([See the modified PocketChange app for an example.](https://github.com/cloudfoundry-samples/pocketchangeapp-prop)) You simply create a WAR file and deploy it.

For Lift applications that do not externalize their services, it is possible to explicitly access them through code. [See another modification to the PocketChange app:](https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime)

```scala

import org.cloudfoundry.runtime.env._
import org.cloudfoundry.runtime.service.relational._
  Full(new MysqlServiceCreator(
    new CloudEnvironment()).createSingletonService().service.getConnection())

```

The application deployed at [http://tpuf.cloudfoundry.com](http://tpuf.cloudfoundry.com) is a Lift application that explicitly declares its use of a Redis service. See its [github repository](https://github.com/dcbriccetti/talking-puffin/) for more details.

If a Scala application uses the Spring framework, it can leverage auto-reconfiguration support and require no changes to the application itself. The application deployed at [http://hello-spring-scala.cloudfoundry.com](http://hello-spring-scala.cloudfoundry.com/) is a basic Spring application written using Scala with Spring as the framework.;T;
I"¨<p><a href="http://www.scala-lang.org/">Scala</a> is a statically typed, JVM-based language that combines object-oriented and functional programming in a consistent manner. It allows writing compact and robust programs for greater focus on core business logic. As a JVM-based language it offers easy interoperability with the Java ecosystem and Java libraries (such as Spring). Further, Scala incorporates many innovations such as parallel programming and the actor-based concurrent programming model to allow developers to develop modern applications and easily take advantage of multi-core hardware.</p>

<p>Most Scala applications written to <a href="http://liftweb.net/">Lift</a> and <a href="http://springframework.org/">Spring</a> will deploy seamlessly without modification to Cloud Foundry.  Other Scala applications may require minor modifications to bind with application services in the cloud.</p>

<h2 id="can-i-use-lift-on-cloud-foundry">Can I use Lift on Cloud Foundry?</h2>

<p><a href="/frameworks/scala/lift.html">Yes</a></p>

<h2 id="scala-support-in-action">Scala Support in Action</h2>

<p>Cloud Foundry simplifies application deployment so you can focus on application development. You can use the Spring Tool Suite (STS) or the vmc command-line tool to deploy Scala applications.</p>

<p>Here is an example of deploying the <a href="https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime">PocketChange</a> application to Cloud Foundry using vmc. For most prompts, you just press Enter to accept the default.</p>

<h3 id="build-the-app-and-upload-it-to-cloud-foundry">Build the app and upload it to Cloud Foundry</h3>

<p>Note that in the step below we can also bind a relational database service if the app uses one.</p>

<pre class="terminal">
$ mvn package
...

$ vmc push pocketchange --path target

    Application Deployed URL: 'pocketchange.cloudfoundry.com'?
    Detected a Scala Lift Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M, 1G or 2G)
    Creating Application: OK

    Would you like to bind any services to 'pocketchange'? [yN]: y
    The following system services are available:
    1. mongodb
    2. mysql
    3. redis
    Please select one you wish to provision: 2
    Specify the name of the service [mysql-744ef]: pocketchange-db
    Creating Service: OK
    Binding Service: OK

    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<p>During this deployment process, application bits are transferred to the cloud. (Notice the small upload size? This is due to the incremental update feature of Cloud Foundry). Once transferred, the application bits are wrapped in a Tomcat container, services you provisioned are bound (pocketchange-db, in this case), and a property file is created with information needed to connect to the database.</p>

<h3 id="ready">Ready</h3>
<p>The application is now ready to view at <a href="http://pocketchange.cloudfoundry.com">http://pocketchange.cloudfoundry.com</a>.</p>

<h2 id="how-does-it-work">How Does it Work?</h2>

<p>Since Scala is a JVM-based language, you can write applications with any Java web framework or use a framework explicitly designed for Scala such as Lift. Cloud Foundry can now deploy such applications. This support is multi-faceted.</p>

<p>If a Scala web app uses no application services, such as a database, you can deploy it without any changes. This is true regardless of the framework used, or even if no framework was used. For example, see <a href="http://hello-lift.cloudfoundry.com">http://hello-lift.cloudfoundry.com</a>, which is a basic Lift application.</p>

<p>Most applications do use services, and in these cases you will need to make a few changes.</p>

<p>Scala applications using the Lift framework and the Lift guidelines to externalize services will deploy without modification. (<a href="https://github.com/cloudfoundry-samples/pocketchangeapp-prop">See the modified PocketChange app for an example.</a>) You simply create a WAR file and deploy it.</p>

<p>For Lift applications that do not externalize their services, it is possible to explicitly access them through code. <a href="https://github.com/cloudfoundry-samples/pocketchangeapp-cf-runtime">See another modification to the PocketChange app:</a></p>

<pre><code class="language-scala"><span class="k">import</span> <span class="nn">org.cloudfoundry.runtime.env._</span>
<span class="k">import</span> <span class="nn">org.cloudfoundry.runtime.service.relational._</span>
  <span class="nc">Full</span><span class="o">(</span><span class="k">new</span> <span class="nc">MysqlServiceCreator</span><span class="o">(</span>
    <span class="k">new</span> <span class="nc">CloudEnvironment</span><span class="o">()).</span><span class="n">createSingletonService</span><span class="o">().</span><span class="n">service</span><span class="o">.</span><span class="n">getConnection</span><span class="o">())</span></code></pre>

<p>The application deployed at <a href="http://tpuf.cloudfoundry.com">http://tpuf.cloudfoundry.com</a> is a Lift application that explicitly declares its use of a Redis service. See its <a href="https://github.com/dcbriccetti/talking-puffin/">github repository</a> for more details.</p>

<p>If a Scala application uses the Spring framework, it can leverage auto-reconfiguration support and require no changes to the application itself. The application deployed at <a href="http://hello-spring-scala.cloudfoundry.com/">http://hello-spring-scala.cloudfoundry.com</a> is a basic Spring application written using Scala with Spring as the framework.</p>;T;@I"/frameworks/scala/lift/;T{;{	;I".f<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/scala/lift.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Lift' property='og:title'>
<meta content='Using Lift on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Lift</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Lift</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using Lift on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/scala" rel="tag">scala</a><a href="/tags/lift" rel="tag">lift</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="background">Background</h2>

<p>The blog entry announcing support for <a href="http://blog.cloudfoundry.com/2011/06/02/cloud-foundry-now-supporting-scala/">Scala / Lift on CloudFoundry</a> has valuable information on getting your Lift application deployed onto CloudFoundry. This KB article provides some additional context and information to help address some common challenges in doing so.</p>

<p>Note that the instructions here have been tested on Lift v2.3 &amp; Scala v2.8.1 with Maven. Please let us know if the process differs substantially with newer versions of Lift as well as Scala.</p>

<h2 id="creating-a-lift-project">Creating a Lift project</h2>

<p>You can create a Lift project by following the instructions in the <a href="http://www.assembla.com/spaces/liftweb/wiki/Getting_Started">â€œGetting Startedâ€ section of Lift</a>.
As highlighted there, projects can be set up using <a href="http://www.assembla.com/wiki/show/liftweb/Using_Maven">Maven</a>, <a href="http://www.assembla.com/wiki/show/liftweb/Using_SBT">SBT</a>, <a href="http://www.assembla.com/wiki/show/liftweb/Using_Gradle">Gradle</a> or <a href="http://www.assembla.com/spaces/liftweb/wiki/Using_Ant">Ant</a>.</p>

<h2 id="externalizing-service-dependencies-configuration">Externalizing service dependencies configuration</h2>

<p>Lift applications that do no use any services (such as a database, key value store or a message bus) should run on Cloud Foundry with no changes. Applications that do use a service should externalized the configuration of that service relative to the application.</p>

<p>When starting from the instructions above (say with Maven), the generated project structure will already externalize the needed service configuration for a database. Note that this assumes that you started with a project archetype that generates database artifacts (like â€˜lift-archetype-basicâ€™ or â€˜lift-archetype-jpaâ€™ for Maven). For e.g:</p>

<pre><code class="language-java"><span class="n">mvn</span> <span class="nl">archetype:</span><span class="n">generate</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeGroupId</span><span class="o">=</span><span class="n">net</span><span class="o">.</span><span class="na">liftweb</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeArtifactId</span><span class="o">=</span><span class="n">lift</span><span class="o">-</span><span class="n">archetype</span><span class="o">-</span><span class="n">basic_2</span><span class="o">.</span><span class="mf">8.1</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeVersion</span><span class="o">=</span><span class="mf">2.3</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeRepository</span><span class="o">=</span><span class="nl">http:</span><span class="c1">//scala-tools.org/repo-releases \</span>
 <span class="o">-</span><span class="n">DremoteRepositories</span><span class="o">=</span><span class="nl">http:</span><span class="c1">//scala-tools.org/repo-releases \</span>
 <span class="o">-</span><span class="n">DgroupId</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">company</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DartifactId</span><span class="o">=</span><span class="n">lift_test</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">Dversion</span><span class="o">=</span><span class="mf">1.0</span></code></pre>

<p>The generated project artifacts will contain the configuration that is typically used for local development in $APPLICATION_HOME/src/main/resources/props/default.props. An example of such a file is given below.</p>

<pre><code class="language-java"><span class="n">db</span><span class="o">.</span><span class="na">class</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">mysql</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">Driver</span>
<span class="n">db</span><span class="o">.</span><span class="na">url</span><span class="o">=</span><span class="nl">jdbc:mysql:</span><span class="c1">//localhost/my_app</span>
<span class="n">db</span><span class="o">.</span><span class="na">user</span><span class="o">=</span><span class="n">root</span>
<span class="n">db</span><span class="o">.</span><span class="na">pass</span><span class="o">=</span><span class="n">root</span></code></pre>

<h2 id="resolving-the-externalized-service-configuration-to-use-in-the-application">Resolving the externalized service configuration to use in the application</h2>

<p>Lift uses externalized configuration information to facilitate running of the application in various environments with no change to the application. Depending on the environment in which the application is run, a different properties file is used. The rules to determine the properties file to use are specified in the Lift utility class net.util.liftweb.Props. The <a href="http://www.assembla.com/wiki/show/liftweb/Run_Modes">Run mode</a> of an application specifies the environment it is running in. As long as a properties file named according to the rules exists at $APPLICATION_HOME/src/main/resources/props/<run-mode>.props, it will be used. If not, the default.props file is used. Some examples of property files are [provided here](http://www.assembla.com/spaces/liftweb/wiki/Properties).</run-mode></p>

<p>Code artifacts that use the external service configuration
Given a project that has been set up with externalized database configuration, the net.util.liftweb.Props utility is used to get the relevant properties. A code example highlighting the use of the Props utility is given below. This is from the $APPLICATION_HOME/src/main/scala/bootstrap/liftweb/Boot.scala file:</p>

<pre><code class="language-java"><span class="n">def</span> <span class="n">boot</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">DB</span><span class="o">.</span><span class="na">jndiJdbcConnAvailable_</span><span class="o">?)</span> <span class="o">{</span>
      <span class="n">val</span> <span class="n">vendor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">StandardDBVendor</span><span class="o">(</span><span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.class"</span><span class="o">)</span> <span class="n">openOr</span> <span class="s">"Invalid Class"</span><span class="o">,</span>
                 <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.url"</span><span class="o">)</span> <span class="n">openOr</span> <span class="s">"Invalid DB url"</span><span class="o">,</span>
                 <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.user"</span><span class="o">),</span>
                             <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.pass"</span><span class="o">))</span>

      <span class="n">LiftRules</span><span class="o">.</span><span class="na">unloadHooks</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">vendor</span><span class="o">.</span><span class="na">closeAllConnections_</span><span class="o">!</span> <span class="n">_</span><span class="o">)</span>

      <span class="n">DB</span><span class="o">.</span><span class="na">defineConnectionManager</span><span class="o">(</span><span class="n">DefaultConnectionIdentifier</span><span class="o">,</span> <span class="n">vendor</span><span class="o">)</span>
    <span class="o">}</span></code></pre>

<p>In the code above, the run mode is used to derive the properties file to use and based on that file, the associated properties are read in to connect to the database.</p>

<h2 id="auto-reconfiguration-of-database-configuration-during-lift-application-deployment-into-cloud-foundry">Auto-reconfiguration of database configuration during Lift application deployment into Cloud Foundry</h2>

<p>As long as the application is using externalized service configuration as indicated above and has bound a database service instance of Cloud Foundry (mysql) deploying the application into Cloud Foundry (using â€˜vmcâ€™ or with STS) should be straight forward.
Auto-reconfiguration and starting of the application will result in a new run mode properties file following the pattern of $APPLICATION_HOME/src/main/resources/props/<username>.<hostname>.props where the <username> corresponds to the user deploying the application, <hostname> to the host where the application is started and the db.* values to those of the database service instance end point that is bound to the application. The Lift application should start up be connected to the database at this point.</hostname></username></hostname></username></p>

<h2 id="manual-binding-of-database-and-other-service-configuration-in-lift">Manual binding of database and other service configuration in Lift</h2>

<p>Applications that do not externalize their configuration (i.e the configuration is hard-code in the code) or are using services other than databases (currently, Cloud Foundry auto reconfiguration only works for a single instance of the database service for Lift), need to explicitly resolve their configuration dependencies.
To do so, the Lift project needs to add the Cloud Foundry runtime to its dependencies. This runtime is a Java package that provides access to all of the service end point information available to the user. To include the dependency in Maven, you have to add to the following elements [properties and dependencies] in the pom.xml. Ideally, the latest version of the runtime should be used.</p>

<pre><code class="language-xml">...
  <span class="nt">&lt;properties&gt;</span>
    ...
    <span class="nt">&lt;org.cloudfoundry-version&gt;</span>0.6.1<span class="nt">&lt;/org.cloudfoundry-version&gt;</span>
    ...
  <span class="nt">&lt;/properties&gt;</span>

  ...

  <span class="nt">&lt;dependencies&gt;</span>
    ...
    <span class="c">&lt;!-- CloudFoundry --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${org.cloudfoundry-version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    ...
  <span class="nt">&lt;/dependencies&gt;</span>
  ...</code></pre>

<p>To get at the service properties in your code, you would need to use the cloud runtime as follows:</p>

<p>import the environment with a â€œimport org.cloudfoundry.runtime.env.<em>â€
import the service specific runtime package such as â€œorg.cloudfoundry.runtime.service.relational.</em>â€
Finally you can invoke a method to create a service and get a connection to it.
An example usage is given below:</p>

<pre><code class="language-java"><span class="n">object</span> <span class="n">DBVendor</span> <span class="kd">extends</span> <span class="n">ConnectionManager</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">newConnection</span><span class="o">(</span><span class="nl">name:</span> <span class="n">ConnectionIdentifier</span><span class="o">):</span> <span class="n">Box</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env._</span>
      <span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.service.relational._</span>
      <span class="nf">Full</span><span class="o">(</span><span class="k">new</span> <span class="n">MysqlServiceCreator</span><span class="o">(</span><span class="k">new</span> <span class="n">CloudEnvironment</span><span class="o">()).</span><span class="na">createSingletonService</span><span class="o">().</span><span class="na">service</span><span class="o">.</span><span class="na">getConnection</span><span class="o">())</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">e</span> <span class="o">:</span> <span class="n">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">;</span> <span class="n">Empty</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Ã## Background

The blog entry announcing support for [Scala / Lift on CloudFoundry](http://blog.cloudfoundry.com/2011/06/02/cloud-foundry-now-supporting-scala/) has valuable information on getting your Lift application deployed onto CloudFoundry. This KB article provides some additional context and information to help address some common challenges in doing so.

Note that the instructions here have been tested on Lift v2.3 & Scala v2.8.1 with Maven. Please let us know if the process differs substantially with newer versions of Lift as well as Scala.

## Creating a Lift project

You can create a Lift project by following the instructions in the [â€œGetting Startedâ€ section of Lift](http://www.assembla.com/spaces/liftweb/wiki/Getting_Started).
As highlighted there, projects can be set up using [Maven](http://www.assembla.com/wiki/show/liftweb/Using_Maven), [SBT](http://www.assembla.com/wiki/show/liftweb/Using_SBT), [Gradle](http://www.assembla.com/wiki/show/liftweb/Using_Gradle) or [Ant](http://www.assembla.com/spaces/liftweb/wiki/Using_Ant).

## Externalizing service dependencies configuration

Lift applications that do no use any services (such as a database, key value store or a message bus) should run on Cloud Foundry with no changes. Applications that do use a service should externalized the configuration of that service relative to the application.

When starting from the instructions above (say with Maven), the generated project structure will already externalize the needed service configuration for a database. Note that this assumes that you started with a project archetype that generates database artifacts (like 'lift-archetype-basic' or 'lift-archetype-jpa' for Maven). For e.g:

```java
mvn archetype:generate \
 -DarchetypeGroupId=net.liftweb \
 -DarchetypeArtifactId=lift-archetype-basic_2.8.1 \
 -DarchetypeVersion=2.3 \
 -DarchetypeRepository=http://scala-tools.org/repo-releases \
 -DremoteRepositories=http://scala-tools.org/repo-releases \
 -DgroupId=com.company \
 -DartifactId=lift_test \
 -Dversion=1.0
```

The generated project artifacts will contain the configuration that is typically used for local development in $APPLICATION_HOME/src/main/resources/props/default.props. An example of such a file is given below.

```java
db.class=com.mysql.jdbc.Driver
db.url=jdbc:mysql://localhost/my_app
db.user=root
db.pass=root
```

## Resolving the externalized service configuration to use in the application

Lift uses externalized configuration information to facilitate running of the application in various environments with no change to the application. Depending on the environment in which the application is run, a different properties file is used. The rules to determine the properties file to use are specified in the Lift utility class net.util.liftweb.Props. The [Run mode](http://www.assembla.com/wiki/show/liftweb/Run_Modes) of an application specifies the environment it is running in. As long as a properties file named according to the rules exists at $APPLICATION_HOME/src/main/resources/props/<run-mode>.props, it will be used. If not, the default.props file is used. Some examples of property files are [provided here](http://www.assembla.com/spaces/liftweb/wiki/Properties).

Code artifacts that use the external service configuration
Given a project that has been set up with externalized database configuration, the net.util.liftweb.Props utility is used to get the relevant properties. A code example highlighting the use of the Props utility is given below. This is from the $APPLICATION_HOME/src/main/scala/bootstrap/liftweb/Boot.scala file:

```java
def boot {
    if (!DB.jndiJdbcConnAvailable_?) {
      val vendor =
            new StandardDBVendor(Props.get("db.class") openOr "Invalid Class",
                 Props.get("db.url") openOr "Invalid DB url",
                 Props.get("db.user"),
                             Props.get("db.pass"))

      LiftRules.unloadHooks.append(vendor.closeAllConnections_! _)

      DB.defineConnectionManager(DefaultConnectionIdentifier, vendor)
    }
```

In the code above, the run mode is used to derive the properties file to use and based on that file, the associated properties are read in to connect to the database.

## Auto-reconfiguration of database configuration during Lift application deployment into Cloud Foundry

As long as the application is using externalized service configuration as indicated above and has bound a database service instance of Cloud Foundry (mysql) deploying the application into Cloud Foundry (using 'vmc' or with STS) should be straight forward.
Auto-reconfiguration and starting of the application will result in a new run mode properties file following the pattern of $APPLICATION_HOME/src/main/resources/props/<username>.<hostname>.props where the <username> corresponds to the user deploying the application, <hostname> to the host where the application is started and the db.* values to those of the database service instance end point that is bound to the application. The Lift application should start up be connected to the database at this point.

## Manual binding of database and other service configuration in Lift

Applications that do not externalize their configuration (i.e the configuration is hard-code in the code) or are using services other than databases (currently, Cloud Foundry auto reconfiguration only works for a single instance of the database service for Lift), need to explicitly resolve their configuration dependencies.
To do so, the Lift project needs to add the Cloud Foundry runtime to its dependencies. This runtime is a Java package that provides access to all of the service end point information available to the user. To include the dependency in Maven, you have to add to the following elements [properties and dependencies] in the pom.xml. Ideally, the latest version of the runtime should be used.

```xml
...
  <properties>
    ...
    <org.cloudfoundry-version>0.6.1</org.cloudfoundry-version>
    ...
  </properties>

  ...

  <dependencies>
    ...
    <!-- CloudFoundry -->
    <dependency>
      <groupId>org.cloudfoundry</groupId>
      <artifactId>cloudfoundry-runtime</artifactId>
      <version>${org.cloudfoundry-version}</version>
    </dependency>
    ...
  </dependencies>
  ...
```

To get at the service properties in your code, you would need to use the cloud runtime as follows:

import the environment with a "import org.cloudfoundry.runtime.env._"
import the service specific runtime package such as "org.cloudfoundry.runtime.service.relational._"
Finally you can invoke a method to create a service and get a connection to it.
An example usage is given below:

```java
object DBVendor extends ConnectionManager {
  def newConnection(name: ConnectionIdentifier): Box[Connection] = {
    try {

      import org.cloudfoundry.runtime.env._
      import org.cloudfoundry.runtime.service.relational._
      Full(new MysqlServiceCreator(new CloudEnvironment()).createSingletonService().service.getConnection())

    } catch {
      case e : Exception => e.printStackTrace; Empty
    }
  }
```;T;
I"Î2<h2 id="background">Background</h2>

<p>The blog entry announcing support for <a href="http://blog.cloudfoundry.com/2011/06/02/cloud-foundry-now-supporting-scala/">Scala / Lift on CloudFoundry</a> has valuable information on getting your Lift application deployed onto CloudFoundry. This KB article provides some additional context and information to help address some common challenges in doing so.</p>

<p>Note that the instructions here have been tested on Lift v2.3 &amp; Scala v2.8.1 with Maven. Please let us know if the process differs substantially with newer versions of Lift as well as Scala.</p>

<h2 id="creating-a-lift-project">Creating a Lift project</h2>

<p>You can create a Lift project by following the instructions in the <a href="http://www.assembla.com/spaces/liftweb/wiki/Getting_Started">â€œGetting Startedâ€ section of Lift</a>.
As highlighted there, projects can be set up using <a href="http://www.assembla.com/wiki/show/liftweb/Using_Maven">Maven</a>, <a href="http://www.assembla.com/wiki/show/liftweb/Using_SBT">SBT</a>, <a href="http://www.assembla.com/wiki/show/liftweb/Using_Gradle">Gradle</a> or <a href="http://www.assembla.com/spaces/liftweb/wiki/Using_Ant">Ant</a>.</p>

<h2 id="externalizing-service-dependencies-configuration">Externalizing service dependencies configuration</h2>

<p>Lift applications that do no use any services (such as a database, key value store or a message bus) should run on Cloud Foundry with no changes. Applications that do use a service should externalized the configuration of that service relative to the application.</p>

<p>When starting from the instructions above (say with Maven), the generated project structure will already externalize the needed service configuration for a database. Note that this assumes that you started with a project archetype that generates database artifacts (like â€˜lift-archetype-basicâ€™ or â€˜lift-archetype-jpaâ€™ for Maven). For e.g:</p>

<pre><code class="language-java"><span class="n">mvn</span> <span class="nl">archetype:</span><span class="n">generate</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeGroupId</span><span class="o">=</span><span class="n">net</span><span class="o">.</span><span class="na">liftweb</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeArtifactId</span><span class="o">=</span><span class="n">lift</span><span class="o">-</span><span class="n">archetype</span><span class="o">-</span><span class="n">basic_2</span><span class="o">.</span><span class="mf">8.1</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeVersion</span><span class="o">=</span><span class="mf">2.3</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DarchetypeRepository</span><span class="o">=</span><span class="nl">http:</span><span class="c1">//scala-tools.org/repo-releases \</span>
 <span class="o">-</span><span class="n">DremoteRepositories</span><span class="o">=</span><span class="nl">http:</span><span class="c1">//scala-tools.org/repo-releases \</span>
 <span class="o">-</span><span class="n">DgroupId</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">company</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">DartifactId</span><span class="o">=</span><span class="n">lift_test</span> <span class="err">\</span>
 <span class="o">-</span><span class="n">Dversion</span><span class="o">=</span><span class="mf">1.0</span></code></pre>

<p>The generated project artifacts will contain the configuration that is typically used for local development in $APPLICATION_HOME/src/main/resources/props/default.props. An example of such a file is given below.</p>

<pre><code class="language-java"><span class="n">db</span><span class="o">.</span><span class="na">class</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">mysql</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">Driver</span>
<span class="n">db</span><span class="o">.</span><span class="na">url</span><span class="o">=</span><span class="nl">jdbc:mysql:</span><span class="c1">//localhost/my_app</span>
<span class="n">db</span><span class="o">.</span><span class="na">user</span><span class="o">=</span><span class="n">root</span>
<span class="n">db</span><span class="o">.</span><span class="na">pass</span><span class="o">=</span><span class="n">root</span></code></pre>

<h2 id="resolving-the-externalized-service-configuration-to-use-in-the-application">Resolving the externalized service configuration to use in the application</h2>

<p>Lift uses externalized configuration information to facilitate running of the application in various environments with no change to the application. Depending on the environment in which the application is run, a different properties file is used. The rules to determine the properties file to use are specified in the Lift utility class net.util.liftweb.Props. The <a href="http://www.assembla.com/wiki/show/liftweb/Run_Modes">Run mode</a> of an application specifies the environment it is running in. As long as a properties file named according to the rules exists at $APPLICATION_HOME/src/main/resources/props/<run-mode>.props, it will be used. If not, the default.props file is used. Some examples of property files are [provided here](http://www.assembla.com/spaces/liftweb/wiki/Properties).</run-mode></p>

<p>Code artifacts that use the external service configuration
Given a project that has been set up with externalized database configuration, the net.util.liftweb.Props utility is used to get the relevant properties. A code example highlighting the use of the Props utility is given below. This is from the $APPLICATION_HOME/src/main/scala/bootstrap/liftweb/Boot.scala file:</p>

<pre><code class="language-java"><span class="n">def</span> <span class="n">boot</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">DB</span><span class="o">.</span><span class="na">jndiJdbcConnAvailable_</span><span class="o">?)</span> <span class="o">{</span>
      <span class="n">val</span> <span class="n">vendor</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">StandardDBVendor</span><span class="o">(</span><span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.class"</span><span class="o">)</span> <span class="n">openOr</span> <span class="s">"Invalid Class"</span><span class="o">,</span>
                 <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.url"</span><span class="o">)</span> <span class="n">openOr</span> <span class="s">"Invalid DB url"</span><span class="o">,</span>
                 <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.user"</span><span class="o">),</span>
                             <span class="n">Props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"db.pass"</span><span class="o">))</span>

      <span class="n">LiftRules</span><span class="o">.</span><span class="na">unloadHooks</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">vendor</span><span class="o">.</span><span class="na">closeAllConnections_</span><span class="o">!</span> <span class="n">_</span><span class="o">)</span>

      <span class="n">DB</span><span class="o">.</span><span class="na">defineConnectionManager</span><span class="o">(</span><span class="n">DefaultConnectionIdentifier</span><span class="o">,</span> <span class="n">vendor</span><span class="o">)</span>
    <span class="o">}</span></code></pre>

<p>In the code above, the run mode is used to derive the properties file to use and based on that file, the associated properties are read in to connect to the database.</p>

<h2 id="auto-reconfiguration-of-database-configuration-during-lift-application-deployment-into-cloud-foundry">Auto-reconfiguration of database configuration during Lift application deployment into Cloud Foundry</h2>

<p>As long as the application is using externalized service configuration as indicated above and has bound a database service instance of Cloud Foundry (mysql) deploying the application into Cloud Foundry (using â€˜vmcâ€™ or with STS) should be straight forward.
Auto-reconfiguration and starting of the application will result in a new run mode properties file following the pattern of $APPLICATION_HOME/src/main/resources/props/<username>.<hostname>.props where the <username> corresponds to the user deploying the application, <hostname> to the host where the application is started and the db.* values to those of the database service instance end point that is bound to the application. The Lift application should start up be connected to the database at this point.</hostname></username></hostname></username></p>

<h2 id="manual-binding-of-database-and-other-service-configuration-in-lift">Manual binding of database and other service configuration in Lift</h2>

<p>Applications that do not externalize their configuration (i.e the configuration is hard-code in the code) or are using services other than databases (currently, Cloud Foundry auto reconfiguration only works for a single instance of the database service for Lift), need to explicitly resolve their configuration dependencies.
To do so, the Lift project needs to add the Cloud Foundry runtime to its dependencies. This runtime is a Java package that provides access to all of the service end point information available to the user. To include the dependency in Maven, you have to add to the following elements [properties and dependencies] in the pom.xml. Ideally, the latest version of the runtime should be used.</p>

<pre><code class="language-xml">...
  <span class="nt">&lt;properties&gt;</span>
    ...
    <span class="nt">&lt;org.cloudfoundry-version&gt;</span>0.6.1<span class="nt">&lt;/org.cloudfoundry-version&gt;</span>
    ...
  <span class="nt">&lt;/properties&gt;</span>

  ...

  <span class="nt">&lt;dependencies&gt;</span>
    ...
    <span class="c">&lt;!-- CloudFoundry --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${org.cloudfoundry-version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    ...
  <span class="nt">&lt;/dependencies&gt;</span>
  ...</code></pre>

<p>To get at the service properties in your code, you would need to use the cloud runtime as follows:</p>

<p>import the environment with a â€œimport org.cloudfoundry.runtime.env.<em>â€
import the service specific runtime package such as â€œorg.cloudfoundry.runtime.service.relational.</em>â€
Finally you can invoke a method to create a service and get a connection to it.
An example usage is given below:</p>

<pre><code class="language-java"><span class="n">object</span> <span class="n">DBVendor</span> <span class="kd">extends</span> <span class="n">ConnectionManager</span> <span class="o">{</span>
  <span class="n">def</span> <span class="nf">newConnection</span><span class="o">(</span><span class="nl">name:</span> <span class="n">ConnectionIdentifier</span><span class="o">):</span> <span class="n">Box</span><span class="o">[</span><span class="n">Connection</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env._</span>
      <span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.service.relational._</span>
      <span class="nf">Full</span><span class="o">(</span><span class="k">new</span> <span class="n">MysqlServiceCreator</span><span class="o">(</span><span class="k">new</span> <span class="n">CloudEnvironment</span><span class="o">()).</span><span class="na">createSingletonService</span><span class="o">().</span><span class="na">service</span><span class="o">.</span><span class="na">getConnection</span><span class="o">())</span>

    <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">e</span> <span class="o">:</span> <span class="n">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">;</span> <span class="n">Empty</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>;T;@I")/frameworks/nodejs/nodeAutoReconfig/;T{;{	;I"¼»<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/nodejs/nodeAutoReconfig.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Node.js Auto-reconfiguration' property='og:title'>
<meta content='Node.js Auto-reconfiguration Feature and FAQs' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Node.js Auto-reconfiguration</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Node.js Auto-reconfiguration</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Node.js Auto-reconfiguration Feature and FAQs</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/nodejs" rel="tag">nodejs</a><a href="/tags/autoreconfig" rel="tag">autoreconfig</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/mysql" rel="tag">mysql</a><a href="/tags/postgresql" rel="tag">postgresql</a><a href="/tags/rabbitmq" rel="tag">rabbitmq</a><a href="/tags/services" rel="tag">services</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="auto-reconfiguration-for-nodejs-applications">Auto-reconfiguration for Node.js applications</h2>
<p>Cloud Foundry automatically configures your Node.js application to listen on the right port and connect to the services that are bound to it.</p>

<p>For example, if your app is listening for web requests at localhost:3000 and connected to your local MongoDB mongodb://localhost/myDB, you can push it directly to Cloud Foundry without making any changes to your code.</p>

<p>Letâ€™s take a look at â€˜beforeâ€™ &amp; â€˜afterâ€™ auto-reconfiguration to see how it works.</p>

<h3 id="port-example-before-auto-reconfiguration">Port Example: BEFORE Auto-reconfiguration</h3>

<p>Notice that earlier the user had to get the port from the <code>process.env.VCAP_APP_PORT</code> environment variable and make changes to the code
in order to run it on Cloud Foundry.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_PORT</span> <span class="o">||</span> <span class="s1">'3000'</span><span class="p">;</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span></code></pre>

<h3 id="port-example-after-auto-reconfiguration">Port Example: AFTER Auto-reconfiguration</h3>
<p>Now, with auto-reconfiguration, the user can upload the code that was running on localhost with a hard-coded port (3000 in this case), without making any changes to the code itself. And it will still work on Cloud Foundry!</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre>

<p>Now, letâ€™s take a look at how powerful auto-configuration is by using a MongoDB example.</p>

<h3 id="mongodb-example-before-auto-reconfiguration">MongoDB Example: BEFORE Auto-reconfiguration</h3>
<p>In the below example, you can see that we had a rather messy <code>generate_mongo_url</code> function that figures out what MongoDBâ€™s url should be when the app runs on Cloud Foundry and also on localhost.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VMC_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_HOST</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">'mongodb-2.0'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'credentials'</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"localhost"</span><span class="p">,</span>
    <span class="s2">"port"</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">"username"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"password"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"db"</span><span class="o">:</span><span class="s2">"test"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">generate_mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">'test'</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">"@"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongourl</span> <span class="o">=</span> <span class="nx">generate_mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">);</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/*find with limit:10 &amp; sort */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
        <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
          <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<h3 id="mongodb-example-after-auto-reconfiguration">MongoDB Example: AFTER Auto-reconfiguration</h3>

<p>With Auto-reconfig, users donâ€™t need to add code to figure out what the MongoDBâ€™s url should be. They can simply upload their code thatâ€™s running on localhost to Cloud Foundry, and it will just work.</p>

<p>PS: Notice <code>var mongoUrl = 'mongodb://localhost:27017/test';</code> is still pointing to MongoDB on localhost and that the <code>generate_mongo_url</code> function is gone.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="c1">//With auto-reconfig, we don't have to change localhost's MongoDB url</span>
<span class="kd">var</span> <span class="nx">mongoUrl</span> <span class="o">=</span> <span class="s1">'mongodb://localhost:27017/test'</span><span class="p">;</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongoUrl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/*find with limit:10 &amp; sort */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
        <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
          <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<h3 id="under-the-hood">Under the hood</h3>

<p>When your application is staged during the deployment process, Cloud Foundry will make two modifications:</p>

<ul>
<li>It will provide the <a href="https://npmjs.org/package/cf-autoconfig">cf-autoconfig</a> node module to your application.</li>
  <li>It will preload the cf-autoconfig module while bootstrapping your application.</li>
</ul><p>The cf-autoconfig module exploits the Node.js caching mechanism. This module searches application files for supported node modules and redefines module connection functions so that they are being called with Cloud Foundry connection parameters. For example, letâ€™s see how it redefines the connect function of the MongoDB node module:</p>

<pre><code class="language-javascript"><span class="k">if</span> <span class="p">(</span><span class="s2">"connect"</span> <span class="k">in</span> <span class="nx">moduleData</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">oldConnect</span> <span class="o">=</span> <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">oldConnectProto</span> <span class="o">=</span> <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
  <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">oldConnect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">oldConnectProto</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<p>Other functions are redefined the same way. Please take a look at the <a href="https://github.com/cloudfoundry/vcap-node/tree/master/cf-autoconfig">cf-autoconfig module source on Github</a>.  Feel free to provide feedback or even submit a pull request.</p>

<h3 id="supported-modules">Supported modules</h3>

<p>The following is the list of supported modules:</p>

<ul>
<li><a href="https://github.com/postwait/node-amqp">amqp</a></li>
  <li><a href="https://github.com/mongodb/node-mongodb-native">mongodb</a></li>
  <li><a href="https://github.com/learnboost/mongoose">mongoose</a></li>
  <li><a href="https://github.com/felixge/node-mysql">mysql</a></li>
  <li><a href="https://github.com/brianc/node-postgres">pg</a></li>
  <li><a href="https://github.com/mranney/node_redis">redis</a></li>
</ul><p>According to <a href="http://www.npmjs.org">npmjs.org</a>, these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.</p>

<h3 id="limitations">Limitations</h3>

<p>Auto-reconfiguration of services works only under the following conditions:</p>

<ul>
<li>You are using only one service of the given type. For example, one mysql or one redis service.</li>
  <li>You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.</li>
  <li>Your application does not use cf-runtime or cf-autoconfig node modules.</li>
  <li>Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.</li>
</ul><h3 id="turning-off-auto-reconfiguration">Turning off Auto-reconfiguration</h3>
<p>Auto-reconfiguration can be turned off by creating a <code>cloudfoundry.json</code> file in the application base folder with the option â€œcfAutoconfigâ€ set as false.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="err">â€œ</span><span class="nx">cfAutoconfig</span><span class="err">â€</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">}</span></code></pre>

<p>In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.</p>

<h2 id="faqs">FAQs</h2>

<h3 id="what-are-the-limitations-of-nodejs-auto-reconfig">1. What are the limitations of Node.js Auto-reconfig?</h3>
<p>Auto-reconfiguration of services works only under the following conditions:</p>

<ul>
<li>You are using only one service of the given type. For example, one mysql or one redis service.</li>
  <li>You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.</li>
  <li>Your application does not use cf-runtime or cf-autoconfig node modules.</li>
  <li>Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.</li>
</ul><h3 id="is-auto-reconfig-turned-on-by-default">2. Is Auto-reconfig turned on by default?</h3>
<p>Yes.</p>

<h3 id="how-can-i-turn-off-auto-reconfiguration">3. How can I turn off Auto-reconfiguration?</h3>

<p>Auto-reconfiguration can be turned off by creating a <code>cloudfoundry.json</code> file in the application base folder with the option â€œcfAutoconfigâ€ set as false.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="err">â€œ</span><span class="nx">cfAutoconfig</span><span class="err">â€</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">}</span></code></pre>

<p>In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.</p>

<h3 id="what-version-of-nodejs-is-required">4. What version of Node.js is required?</h3>

<p>Node.js v0.6.x, v0.8.x and above.</p>

<h3 id="how-will-i-know-when-auto-reconfig-doesnt-work">5. How will I know when auto-reconfig doesnâ€™t work?</h3>

<p>Typically you will see â€˜could not connectâ€™ to a given service. Thatâ€™s the clue.</p>

<h3 id="what-are-the-supported-modules--services">6. What are the supported modules / services?</h3>

<p>The following is the list of supported modules:</p>

<ul>
<li><a href="https://github.com/postwait/node-amqp">amqp</a></li>
  <li><a href="https://github.com/mongodb/node-mongodb-native">mongodb</a></li>
  <li><a href="https://github.com/learnboost/mongoose">mongoose</a></li>
  <li><a href="https://github.com/felixge/node-mysql">mysql</a></li>
  <li><a href="https://github.com/brianc/node-postgres">pg</a></li>
  <li><a href="https://github.com/mranney/node_redis">redis</a></li>
</ul><p>According to <a href="http://www.npmjs.org">npmjs.org</a>, these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.</p>

<h3 id="for-more">For More:</h3>
<p>Please look at the blog here: <a href="http://wp.me/p2wH9O-BS">Auto-reconfiguration for Node.js applications</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ö*## Auto-reconfiguration for Node.js applications
Cloud Foundry automatically configures your Node.js application to listen on the right port and connect to the services that are bound to it.

For example, if your app is listening for web requests at localhost:3000 and connected to your local MongoDB mongodb://localhost/myDB, you can push it directly to Cloud Foundry without making any changes to your code.

Let's take a look at 'before' & 'after' auto-reconfiguration to see how it works.

### Port Example: BEFORE Auto-reconfiguration

Notice that earlier the user had to get the port from the `process.env.VCAP_APP_PORT` environment variable and make changes to the code
in order to run it on Cloud Foundry.

```javascript

var http = require('http');
var port = process.env.VCAP_APP_PORT || '3000';
http.createServer(function(req, res){
    res.end('Hello World!');
}).listen(port);

```

### Port Example: AFTER Auto-reconfiguration
Now, with auto-reconfiguration, the user can upload the code that was running on localhost with a hard-coded port (3000 in this case), without making any changes to the code itself. And it will still work on Cloud Foundry!

```javascript

var http = require('http');
http.createServer(function(req, res){
    res.end('Hello World!');
}).listen(3000);

```




Now, let's take a look at how powerful auto-configuration is by using a MongoDB example.

### MongoDB Example: BEFORE Auto-reconfiguration
In the below example, you can see that we had a rather messy `generate_mongo_url` function that figures out what MongoDB's url should be when the app runs on Cloud Foundry and also on localhost.

```javascript

var port = (process.env.VMC_APP_PORT || 3000);
var host = (process.env.VCAP_APP_HOST || 'localhost');
var http = require('http');

if(process.env.VCAP_SERVICES){
  var env = JSON.parse(process.env.VCAP_SERVICES);
  var mongo = env['mongodb-2.0'][0]['credentials'];
}
else {
  var mongo = {
    "hostname":"localhost",
    "port":27017,
    "username":"",
    "password":"",
    "name":"",
    "db":"test"
  }
}

var generate_mongo_url = function(obj){
  obj.hostname = (obj.hostname || 'localhost');
  obj.port = (obj.port || 27017);
  obj.db = (obj.db || 'test');

  if(obj.username && obj.password){
    return "mongodb://" + obj.username + ":" + obj.password + "@" + obj.hostname + ":" + obj.port + "/" + obj.db;
  }
  else{
    return "mongodb://" + obj.hostname + ":" + obj.port + "/" + obj.db;
  }
}

var mongourl = generate_mongo_url(mongo);
console.log(mongourl);

http.createServer(function (req, res) {
  params = require('url').parse(req.url);
  if(params.pathname === '/history') {
    print_visits(req, res);
  }
  else{
    record_visit(req, res);
  }
}).listen(port, host);

var record_visit = function(req, res){
  /* Connect to the DB and auth */
  require('mongodb').connect(mongourl, function(err, conn){
    conn.collection('ips', function(err, coll){
      /* Simple object to insert: ip address and date */
      object_to_insert = { 'ip': req.connection.remoteAddress, 'ts': new Date() };

      /* Insert the object then print in response */
      /* Note the _id has been created */
      coll.insert( object_to_insert, {safe:true}, function(err){
        res.writeHead(200, {'Content-Type': 'text/plain'});
        res.write(JSON.stringify(object_to_insert));
        res.end('\n');
      });
    });
  });
}

var print_visits = function(req, res){
  /* Connect to the DB and auth */
  require('mongodb').connect(mongourl, function(err, conn){
    conn.collection('ips', function(err, coll){
      /*find with limit:10 & sort */
      coll.find({}, {limit:10, sort:[['_id','desc']]}, function(err, cursor){
        cursor.toArray(function(err, items){
          res.writeHead(200, {'Content-Type': 'text/plain'});
          for(i=0; i < items.length; i++){
            res.write(JSON.stringify(items[i]) + "\n");
          }
          res.end();
        });
      });
    });
  });
}

```


### MongoDB Example: AFTER Auto-reconfiguration

With Auto-reconfig, users don't need to add code to figure out what the MongoDB's url should be. They can simply upload their code that's running on localhost to Cloud Foundry, and it will just work.

PS: Notice `var mongoUrl = 'mongodb://localhost:27017/test';` is still pointing to MongoDB on localhost and that the `generate_mongo_url` function is gone.


```javascript

var http = require('http');

//With auto-reconfig, we don't have to change localhost's MongoDB url
var mongoUrl = 'mongodb://localhost:27017/test';

http.createServer(function (req, res) {
  params = require('url').parse(req.url);
  if(params.pathname === '/history') {
    print_visits(req, res);
  }
  else{
    record_visit(req, res);
  }
}).listen(3000);

var record_visit = function(req, res){
  /* Connect to the DB and auth */
  require('mongodb').connect(mongoUrl, function(err, conn){
    conn.collection('ips', function(err, coll){
      /* Simple object to insert: ip address and date */
      object_to_insert = { 'ip': req.connection.remoteAddress, 'ts': new Date() };

      /* Insert the object then print in response */
      /* Note the _id has been created */
      coll.insert( object_to_insert, {safe:true}, function(err){
        res.writeHead(200, {'Content-Type': 'text/plain'});
        res.write(JSON.stringify(object_to_insert));
        res.end('\n');
      });
    });
  });
}

var print_visits = function(req, res){
  /* Connect to the DB and auth */
  require('mongodb').connect(mongourl, function(err, conn){
    conn.collection('ips', function(err, coll){
      /*find with limit:10 & sort */
      coll.find({}, {limit:10, sort:[['_id','desc']]}, function(err, cursor){
        cursor.toArray(function(err, items){
          res.writeHead(200, {'Content-Type': 'text/plain'});
          for(i=0; i < items.length; i++){
            res.write(JSON.stringify(items[i]) + "\n");
          }
          res.end();
        });
      });
    });
  });
}

```

### Under the hood

When your application is staged during the deployment process, Cloud Foundry will make two modifications:

* It will provide the [cf-autoconfig](https://npmjs.org/package/cf-autoconfig) node module to your application.
* It will preload the cf-autoconfig module while bootstrapping your application.

The cf-autoconfig module exploits the Node.js caching mechanism. This module searches application files for supported node modules and redefines module connection functions so that they are being called with Cloud Foundry connection parameters. For example, letâ€™s see how it redefines the connect function of the MongoDB node module:

```javascript

if ("connect" in moduleData) {
  var oldConnect = moduleData.connect;
  var oldConnectProto = moduleData.connect.prototype;
  moduleData.connect = function () {
    var args = Array.prototype.slice.call(arguments);
    args[0] = props.url;
    return oldConnect.apply(this, args);
  };
  moduleData.connect.prototype = oldConnectProto;
}
```
Other functions are redefined the same way. Please take a look at the [cf-autoconfig module source on Github](https://github.com/cloudfoundry/vcap-node/tree/master/cf-autoconfig).  Feel free to provide feedback or even submit a pull request.

### Supported modules

The following is the list of supported modules:

* [amqp](https://github.com/postwait/node-amqp)
* [mongodb](https://github.com/mongodb/node-mongodb-native)
* [mongoose](https://github.com/learnboost/mongoose)
* [mysql](https://github.com/felixge/node-mysql)
* [pg](https://github.com/brianc/node-postgres)
* [redis](https://github.com/mranney/node_redis)

According to [npmjs.org](http://www.npmjs.org), these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.

### Limitations

Auto-reconfiguration of services works only under the following conditions:

* You are using only one service of the given type. For example, one mysql or one redis service.
* You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.
* Your application does not use cf-runtime or cf-autoconfig node modules.
* Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.

### Turning off Auto-reconfiguration
Auto-reconfiguration can be turned off by creating a `cloudfoundry.json` file in the application base folder with the option â€œcfAutoconfigâ€ set as false.

```javascript

{ â€œcfAutoconfigâ€ : false }
```
In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.

## FAQs

### 1. What are the limitations of Node.js Auto-reconfig?
Auto-reconfiguration of services works only under the following conditions:

* You are using only one service of the given type. For example, one mysql or one redis service.
* You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.
* Your application does not use cf-runtime or cf-autoconfig node modules.
* Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.


### 2. Is Auto-reconfig turned on by default?
Yes.

### 3. How can I turn off Auto-reconfiguration?

Auto-reconfiguration can be turned off by creating a `cloudfoundry.json` file in the application base folder with the option â€œcfAutoconfigâ€ set as false.

```javascript

{ â€œcfAutoconfigâ€ : false }
```
In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.

### 4. What version of Node.js is required?

Node.js v0.6.x, v0.8.x and above.

### 5. How will I know when auto-reconfig doesn't work?

Typically you will see 'could not connect' to a given service. That's the clue.

### 6. What are the supported modules / services?

The following is the list of supported modules:

* [amqp](https://github.com/postwait/node-amqp)
* [mongodb](https://github.com/mongodb/node-mongodb-native)
* [mongoose](https://github.com/learnboost/mongoose)
* [mysql](https://github.com/felixge/node-mysql)
* [pg](https://github.com/brianc/node-postgres)
* [redis](https://github.com/mranney/node_redis)

According to [npmjs.org](http://www.npmjs.org), these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.




### For More:
Please look at the blog here: [Auto-reconfiguration for Node.js applications](http://wp.me/p2wH9O-BS);T;
I"Á†<h2 id="auto-reconfiguration-for-nodejs-applications">Auto-reconfiguration for Node.js applications</h2>
<p>Cloud Foundry automatically configures your Node.js application to listen on the right port and connect to the services that are bound to it.</p>

<p>For example, if your app is listening for web requests at localhost:3000 and connected to your local MongoDB mongodb://localhost/myDB, you can push it directly to Cloud Foundry without making any changes to your code.</p>

<p>Letâ€™s take a look at â€˜beforeâ€™ &amp; â€˜afterâ€™ auto-reconfiguration to see how it works.</p>

<h3 id="port-example-before-auto-reconfiguration">Port Example: BEFORE Auto-reconfiguration</h3>

<p>Notice that earlier the user had to get the port from the <code>process.env.VCAP_APP_PORT</code> environment variable and make changes to the code
in order to run it on Cloud Foundry.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_PORT</span> <span class="o">||</span> <span class="s1">'3000'</span><span class="p">;</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span></code></pre>

<h3 id="port-example-after-auto-reconfiguration">Port Example: AFTER Auto-reconfiguration</h3>
<p>Now, with auto-reconfiguration, the user can upload the code that was running on localhost with a hard-coded port (3000 in this case), without making any changes to the code itself. And it will still work on Cloud Foundry!</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre>

<p>Now, letâ€™s take a look at how powerful auto-configuration is by using a MongoDB example.</p>

<h3 id="mongodb-example-before-auto-reconfiguration">MongoDB Example: BEFORE Auto-reconfiguration</h3>
<p>In the below example, you can see that we had a rather messy <code>generate_mongo_url</code> function that figures out what MongoDBâ€™s url should be when the app runs on Cloud Foundry and also on localhost.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VMC_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_HOST</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">'mongodb-2.0'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'credentials'</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"localhost"</span><span class="p">,</span>
    <span class="s2">"port"</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">"username"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"password"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"db"</span><span class="o">:</span><span class="s2">"test"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">generate_mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">'test'</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">"@"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongourl</span> <span class="o">=</span> <span class="nx">generate_mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">);</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/*find with limit:10 &amp; sort */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
        <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
          <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<h3 id="mongodb-example-after-auto-reconfiguration">MongoDB Example: AFTER Auto-reconfiguration</h3>

<p>With Auto-reconfig, users donâ€™t need to add code to figure out what the MongoDBâ€™s url should be. They can simply upload their code thatâ€™s running on localhost to Cloud Foundry, and it will just work.</p>

<p>PS: Notice <code>var mongoUrl = 'mongodb://localhost:27017/test';</code> is still pointing to MongoDB on localhost and that the <code>generate_mongo_url</code> function is gone.</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="c1">//With auto-reconfig, we don't have to change localhost's MongoDB url</span>
<span class="kd">var</span> <span class="nx">mongoUrl</span> <span class="o">=</span> <span class="s1">'mongodb://localhost:27017/test'</span><span class="p">;</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongoUrl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/*find with limit:10 &amp; sort */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
        <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
          <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<h3 id="under-the-hood">Under the hood</h3>

<p>When your application is staged during the deployment process, Cloud Foundry will make two modifications:</p>

<ul>
<li>It will provide the <a href="https://npmjs.org/package/cf-autoconfig">cf-autoconfig</a> node module to your application.</li>
  <li>It will preload the cf-autoconfig module while bootstrapping your application.</li>
</ul><p>The cf-autoconfig module exploits the Node.js caching mechanism. This module searches application files for supported node modules and redefines module connection functions so that they are being called with Cloud Foundry connection parameters. For example, letâ€™s see how it redefines the connect function of the MongoDB node module:</p>

<pre><code class="language-javascript"><span class="k">if</span> <span class="p">(</span><span class="s2">"connect"</span> <span class="k">in</span> <span class="nx">moduleData</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">oldConnect</span> <span class="o">=</span> <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">oldConnectProto</span> <span class="o">=</span> <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
  <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">oldConnect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">moduleData</span><span class="p">.</span><span class="nx">connect</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">oldConnectProto</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<p>Other functions are redefined the same way. Please take a look at the <a href="https://github.com/cloudfoundry/vcap-node/tree/master/cf-autoconfig">cf-autoconfig module source on Github</a>.  Feel free to provide feedback or even submit a pull request.</p>

<h3 id="supported-modules">Supported modules</h3>

<p>The following is the list of supported modules:</p>

<ul>
<li><a href="https://github.com/postwait/node-amqp">amqp</a></li>
  <li><a href="https://github.com/mongodb/node-mongodb-native">mongodb</a></li>
  <li><a href="https://github.com/learnboost/mongoose">mongoose</a></li>
  <li><a href="https://github.com/felixge/node-mysql">mysql</a></li>
  <li><a href="https://github.com/brianc/node-postgres">pg</a></li>
  <li><a href="https://github.com/mranney/node_redis">redis</a></li>
</ul><p>According to <a href="http://www.npmjs.org">npmjs.org</a>, these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.</p>

<h3 id="limitations">Limitations</h3>

<p>Auto-reconfiguration of services works only under the following conditions:</p>

<ul>
<li>You are using only one service of the given type. For example, one mysql or one redis service.</li>
  <li>You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.</li>
  <li>Your application does not use cf-runtime or cf-autoconfig node modules.</li>
  <li>Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.</li>
</ul><h3 id="turning-off-auto-reconfiguration">Turning off Auto-reconfiguration</h3>
<p>Auto-reconfiguration can be turned off by creating a <code>cloudfoundry.json</code> file in the application base folder with the option â€œcfAutoconfigâ€ set as false.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="err">â€œ</span><span class="nx">cfAutoconfig</span><span class="err">â€</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">}</span></code></pre>

<p>In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.</p>

<h2 id="faqs">FAQs</h2>

<h3 id="what-are-the-limitations-of-nodejs-auto-reconfig">1. What are the limitations of Node.js Auto-reconfig?</h3>
<p>Auto-reconfiguration of services works only under the following conditions:</p>

<ul>
<li>You are using only one service of the given type. For example, one mysql or one redis service.</li>
  <li>You are using the service node module from the list of supported modules above, or any other that is using one of them for service connection underneath.</li>
  <li>Your application does not use cf-runtime or cf-autoconfig node modules.</li>
  <li>Your application is a typical Node.js application. For a complex application, you may need to consider opting out of auto-reconfiguration and using the cf-runtime node module described in the next blog post in this series.</li>
</ul><h3 id="is-auto-reconfig-turned-on-by-default">2. Is Auto-reconfig turned on by default?</h3>
<p>Yes.</p>

<h3 id="how-can-i-turn-off-auto-reconfiguration">3. How can I turn off Auto-reconfiguration?</h3>

<p>Auto-reconfiguration can be turned off by creating a <code>cloudfoundry.json</code> file in the application base folder with the option â€œcfAutoconfigâ€ set as false.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="err">â€œ</span><span class="nx">cfAutoconfig</span><span class="err">â€</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">}</span></code></pre>

<p>In addition, as mentioned above, auto-reconfiguration will not work if the application is using the cf-runtime node module.</p>

<h3 id="what-version-of-nodejs-is-required">4. What version of Node.js is required?</h3>

<p>Node.js v0.6.x, v0.8.x and above.</p>

<h3 id="how-will-i-know-when-auto-reconfig-doesnt-work">5. How will I know when auto-reconfig doesnâ€™t work?</h3>

<p>Typically you will see â€˜could not connectâ€™ to a given service. Thatâ€™s the clue.</p>

<h3 id="what-are-the-supported-modules--services">6. What are the supported modules / services?</h3>

<p>The following is the list of supported modules:</p>

<ul>
<li><a href="https://github.com/postwait/node-amqp">amqp</a></li>
  <li><a href="https://github.com/mongodb/node-mongodb-native">mongodb</a></li>
  <li><a href="https://github.com/learnboost/mongoose">mongoose</a></li>
  <li><a href="https://github.com/felixge/node-mysql">mysql</a></li>
  <li><a href="https://github.com/brianc/node-postgres">pg</a></li>
  <li><a href="https://github.com/mranney/node_redis">redis</a></li>
</ul><p>According to <a href="http://www.npmjs.org">npmjs.org</a>, these modules are the most depended on. This means there are many other modules that use these modules for the database connection layer and auto-reconfiguration will be applied to them as well.</p>

<h3 id="for-more">For More:</h3>
<p>Please look at the blog here: <a href="http://wp.me/p2wH9O-BS">Auto-reconfiguration for Node.js applications</a></p>;T;@I"/frameworks/nodejs/nodejs/;T{;{	;I"aL<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/nodejs/nodejs.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Node.js' property='og:title'>
<meta content='Node.js Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Node.js</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Node.js</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Node.js Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/nodejs" rel="tag">nodejs</a><a href="/tags/express" rel="tag">express</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Node.js developers deploying on Cloud Foundry. It shows you how to set up and successfully deploy Node.js applications to Cloud Foundry.</p>

<p>Node.js is an event-driven, scalable, JavaScript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools automatically recognize Node.js applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://nodejs.org/">Node.js</a> installation matching the version of Node.js on your Cloud Foundry instance. See <a href="#checking-the-nodejs-version-on-your-cloud-foundry-instance">Checking the NodeJS version on your Cloud Foundry instance</a> below.</p>
  </li>
</ul><h2 id="deploying-nodejs-applications-to-cloud-foundry">Deploying Node.js Applications to Cloud Foundry</h2>

<p>When you deploy a Node.js application to Cloud Foundry, the current directory must contain the application, <code>app.js</code>, and, if your application depends on any modules, a <code>package.json</code> file that names them.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Node.js web server application that uses the <a href="http://expressjs.com">Express</a> web module:</p>

<h3 id="create-the-app">Create the App</h3>

<p>Create a directory for the application and change into it.</p>

<pre class="terminal">
$ mkdir hello-node
$ cd hello-node
</pre>

<p>Use <code>npm</code> (Node Package Manager) to install the Express module:</p>

<pre class="terminal">
$ npm install express
</pre>

<p>Create the file <code>app.js</code> with the following code:</p>
<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'Hello from Cloud Foundry'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre>

<p>Create a <code>package.json</code> file with the following contents:</p>

<pre><code class="language-javascript"><span class="p">{</span>
 <span class="s2">"name"</span><span class="o">:</span><span class="s2">"hello-node"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="o">:</span><span class="s2">"0.0.1"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="o">:</span><span class="p">{</span>
      <span class="s2">"express"</span><span class="o">:</span><span class="s2">""</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts, but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: hello-node
	Application Deployed URL [hello-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'hello-node'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: ................ OK
</pre>

<p>Access the application with your browser at the specified URL, <a href="http://hello-node.cloudfoundry.com">http://hello-node.cloudfoundry.com</a> in this example.</p>

<h2 id="changing-the-version-of-node-your-app-uses">Changing the version of Node your App uses</h2>

<p>You can use the runtime flag and pass the desired runtime. For how to list the runtimes see the next section</p>

<p>Example to use Node 0.6.8</p>

<pre class="terminal">
vmc push --runtime=node06
</pre>

<h2 id="checking-the-nodejs-version-on-your-cloud-foundry-instance">Checking the Node.js version on your Cloud Foundry instance</h2>

<p>To have the best development experience, we recommend that you work on your local machine with the same version of Node.js as your target Cloud Foundry instance.</p>

<p>To find out what version of Node.js is on your Cloud Foundry instance run this command:</p>

<pre class="terminal">
$ vmc runtimes

+--------+-------------+-----------+
| Name   | Description | Version   |
+--------+-------------+-----------+
| java   | Java 6      | 1.6       |
| ruby18 | Ruby 1.8    | 1.8.7     |
| ruby19 | Ruby 1.9    | 1.9.2p180 |
| node   | Node.js     | 0.4.12    |
| node06 | Node.js     | 0.6.8     |
| node08 | Node.js     | 0.8.2     |
+--------+-------------+-----------+

</pre>

<ul>
<li>Then download the specific version of Node.js from <a href="https://github.com/joyent/node/tags">here</a>.</li>
  <li>Unzip it.</li>
  <li>Install it by following the instructions in the README file.</li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li>
<a href="/services/mongodb/nodejs-mongodb.html">Using Cloud Foundry MongoDB services</a> from Node.js applications</li>
  <li>
<a href="/services/rabbitmq/nodejs-rabbitmq.html">Using Cloud Foundry RabbitMQ services</a> from Node.js</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"€This is a guide for Node.js developers deploying on Cloud Foundry. It shows you how to set up and successfully deploy Node.js applications to Cloud Foundry.

Node.js is an event-driven, scalable, JavaScript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools automatically recognize Node.js applications.

Before you get started, you need the following:

+	A [Cloud Foundry account](http://cloudfoundry.com/signup)

+	The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+	A [Node.js](http://nodejs.org/) installation matching the version of Node.js on your Cloud Foundry instance. See [Checking the NodeJS version on your Cloud Foundry instance](#checking-the-nodejs-version-on-your-cloud-foundry-instance) below.

## Deploying Node.js Applications to Cloud Foundry

When you deploy a Node.js application to Cloud Foundry, the current directory must contain the application, `app.js`, and, if your application depends on any modules, a `package.json` file that names them.

Here are steps to create and deploy a "hello world" Node.js web server application that uses the [Express](http://expressjs.com) web module:

### Create the App

Create a directory for the application and change into it.

``` bash
$ mkdir hello-node
$ cd hello-node
```

Use `npm` (Node Package Manager) to install the Express module:

```bash
$ npm install express
```

Create the file `app.js` with the following code:
```javascript

var app = require('express').createServer();
app.get('/', function(req, res) {
    res.send('Hello from Cloud Foundry');
});
app.listen(3000);

```


Create a `package.json` file with the following contents:

```javascript
{
 "name":"hello-node",
  "version":"0.0.1",
  "dependencies":{
      "express":""
  }
}

```

### Deploy the App

Target Cloud Foundry and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
$ vmc login
```

Push the application. You can press `Enter` to accept the defaults at most of the prompts, but be sure to enter a unique URL for the application. Here is an example push:

``` bash
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: hello-node
	Application Deployed URL [hello-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'hello-node'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: ................ OK
```

Access the application with your browser at the specified URL, [http://hello-node.cloudfoundry.com](http://hello-node.cloudfoundry.com) in this example.

## Changing the version of Node your App uses

You can use the runtime flag and pass the desired runtime. For how to list the runtimes see the next section

Example to use Node 0.6.8

```bash
vmc push --runtime=node06
```

## Checking the Node.js version on your Cloud Foundry instance

To have the best development experience, we recommend that you work on your local machine with the same version of Node.js as your target Cloud Foundry instance.

To find out what version of Node.js is on your Cloud Foundry instance run this command:

``` bash
$ vmc runtimes

+--------+-------------+-----------+
| Name   | Description | Version   |
+--------+-------------+-----------+
| java   | Java 6      | 1.6       |
| ruby18 | Ruby 1.8    | 1.8.7     |
| ruby19 | Ruby 1.9    | 1.9.2p180 |
| node   | Node.js     | 0.4.12    |
| node06 | Node.js     | 0.6.8     |
| node08 | Node.js     | 0.8.2     |
+--------+-------------+-----------+

```

+ Then download the specific version of Node.js from [here](https://github.com/joyent/node/tags).
+ Unzip it.
+ Install it by following the instructions in the README file.

## Next Steps

+	[Using Cloud Foundry MongoDB services](/services/mongodb/nodejs-mongodb.html) from Node.js applications
+	[Using Cloud Foundry RabbitMQ services](/services/rabbitmq/nodejs-rabbitmq.html) from Node.js;T;
I"<p>This is a guide for Node.js developers deploying on Cloud Foundry. It shows you how to set up and successfully deploy Node.js applications to Cloud Foundry.</p>

<p>Node.js is an event-driven, scalable, JavaScript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools automatically recognize Node.js applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://nodejs.org/">Node.js</a> installation matching the version of Node.js on your Cloud Foundry instance. See <a href="#checking-the-nodejs-version-on-your-cloud-foundry-instance">Checking the NodeJS version on your Cloud Foundry instance</a> below.</p>
  </li>
</ul><h2 id="deploying-nodejs-applications-to-cloud-foundry">Deploying Node.js Applications to Cloud Foundry</h2>

<p>When you deploy a Node.js application to Cloud Foundry, the current directory must contain the application, <code>app.js</code>, and, if your application depends on any modules, a <code>package.json</code> file that names them.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Node.js web server application that uses the <a href="http://expressjs.com">Express</a> web module:</p>

<h3 id="create-the-app">Create the App</h3>

<p>Create a directory for the application and change into it.</p>

<pre class="terminal">
$ mkdir hello-node
$ cd hello-node
</pre>

<p>Use <code>npm</code> (Node Package Manager) to install the Express module:</p>

<pre class="terminal">
$ npm install express
</pre>

<p>Create the file <code>app.js</code> with the following code:</p>
<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'Hello from Cloud Foundry'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span></code></pre>

<p>Create a <code>package.json</code> file with the following contents:</p>

<pre><code class="language-javascript"><span class="p">{</span>
 <span class="s2">"name"</span><span class="o">:</span><span class="s2">"hello-node"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="o">:</span><span class="s2">"0.0.1"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="o">:</span><span class="p">{</span>
      <span class="s2">"express"</span><span class="o">:</span><span class="s2">""</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts, but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: hello-node
	Application Deployed URL [hello-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'hello-node'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: ................ OK
</pre>

<p>Access the application with your browser at the specified URL, <a href="http://hello-node.cloudfoundry.com">http://hello-node.cloudfoundry.com</a> in this example.</p>

<h2 id="changing-the-version-of-node-your-app-uses">Changing the version of Node your App uses</h2>

<p>You can use the runtime flag and pass the desired runtime. For how to list the runtimes see the next section</p>

<p>Example to use Node 0.6.8</p>

<pre class="terminal">
vmc push --runtime=node06
</pre>

<h2 id="checking-the-nodejs-version-on-your-cloud-foundry-instance">Checking the Node.js version on your Cloud Foundry instance</h2>

<p>To have the best development experience, we recommend that you work on your local machine with the same version of Node.js as your target Cloud Foundry instance.</p>

<p>To find out what version of Node.js is on your Cloud Foundry instance run this command:</p>

<pre class="terminal">
$ vmc runtimes

+--------+-------------+-----------+
| Name   | Description | Version   |
+--------+-------------+-----------+
| java   | Java 6      | 1.6       |
| ruby18 | Ruby 1.8    | 1.8.7     |
| ruby19 | Ruby 1.9    | 1.9.2p180 |
| node   | Node.js     | 0.4.12    |
| node06 | Node.js     | 0.6.8     |
| node08 | Node.js     | 0.8.2     |
+--------+-------------+-----------+

</pre>

<ul>
<li>Then download the specific version of Node.js from <a href="https://github.com/joyent/node/tags">here</a>.</li>
  <li>Unzip it.</li>
  <li>Install it by following the instructions in the README file.</li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li>
<a href="/services/mongodb/nodejs-mongodb.html">Using Cloud Foundry MongoDB services</a> from Node.js applications</li>
  <li>
<a href="/services/rabbitmq/nodejs-rabbitmq.html">Using Cloud Foundry RabbitMQ services</a> from Node.js</li>
</ul>;T;@"I"/frameworks/;T{;{	;I"Û9<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Overview' property='og:title'>
<meta content='Configuring Applications to Run on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Overview</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Overview</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Configuring Applications to Run on Cloud Foundry</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-26
</span>
</p>
<div id='social-share'></div>
<p>Cloud Foundry supports the following application development frameworks:</p>

<ul>
<li>Spring</li>
  <li>Ruby on Rails</li>
  <li>Ruby and Sinatra</li>
  <li>Node.js</li>
  <li>Grails</li>
</ul><p>The support includes a runtime environment that enables your applications to execute on Cloud Foundry and deployment tools (vmc and STS) that detect the framework and automate configuration and deployment to Cloud Foundry. You may not need to do anything special to deploy to Cloud Foundry. If the application requires services, such as a database, and you follow the frameworksâ€™ conventions, vmc or STS can handle needed configuration changes when the application is deployed.
There are instances, however, when your application will need minimal configuration, in particular if it requires multiple services.</p>

<p>Each application framework has its own configuration process, described in the following sections:</p>

<ul>
<li><a href="/frameworks/java/spring/spring.html">Spring Applications</a></li>
  <li><a href="/frameworks/java/spring/grails.html">Grails Applications</a></li>
  <li><a href="/frameworks/nodejs/nodejs.html">Node.js Applications</a></li>
  <li><a href="/frameworks/ruby/ruby-rails-sinatra.html">Ruby, Rails and Sinatra</a></li>
</ul><p>For a list of available Services see <a href="/services.html">Services</a>.</p>

<p>After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Cloud Foundry supports the following application development frameworks:

+ Spring
+ Ruby on Rails
+ Ruby and Sinatra
+ Node.js
+ Grails

The support includes a runtime environment that enables your applications to execute on Cloud Foundry and deployment tools (vmc and STS) that detect the framework and automate configuration and deployment to Cloud Foundry. You may not need to do anything special to deploy to Cloud Foundry. If the application requires services, such as a database, and you follow the frameworks' conventions, vmc or STS can handle needed configuration changes when the application is deployed.
There are instances, however, when your application will need minimal configuration, in particular if it requires multiple services.

Each application framework has its own configuration process, described in the following sections:

+ [Spring Applications](/frameworks/java/spring/spring.html)
+ [Grails Applications](/frameworks/java/spring/grails.html)
+ [Node.js Applications](/frameworks/nodejs/nodejs.html)
+ [Ruby, Rails and Sinatra](/frameworks/ruby/ruby-rails-sinatra.html)

For a list of available Services see [Services](/services.html).

After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See [Deploying Applications](/tools/deploying-apps.html) for details on how to use these tools.;T;
I"Ç<p>Cloud Foundry supports the following application development frameworks:</p>

<ul>
<li>Spring</li>
  <li>Ruby on Rails</li>
  <li>Ruby and Sinatra</li>
  <li>Node.js</li>
  <li>Grails</li>
</ul><p>The support includes a runtime environment that enables your applications to execute on Cloud Foundry and deployment tools (vmc and STS) that detect the framework and automate configuration and deployment to Cloud Foundry. You may not need to do anything special to deploy to Cloud Foundry. If the application requires services, such as a database, and you follow the frameworksâ€™ conventions, vmc or STS can handle needed configuration changes when the application is deployed.
There are instances, however, when your application will need minimal configuration, in particular if it requires multiple services.</p>

<p>Each application framework has its own configuration process, described in the following sections:</p>

<ul>
<li><a href="/frameworks/java/spring/spring.html">Spring Applications</a></li>
  <li><a href="/frameworks/java/spring/grails.html">Grails Applications</a></li>
  <li><a href="/frameworks/nodejs/nodejs.html">Node.js Applications</a></li>
  <li><a href="/frameworks/ruby/ruby-rails-sinatra.html">Ruby, Rails and Sinatra</a></li>
</ul><p>For a list of available Services see <a href="/services.html">Services</a>.</p>

<p>After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</p>;T;@(I"!/frameworks/play/java-mysql/;T{;{	;I"HK<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/java-mysql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java MySQL App on Cloud Foundry' property='og:title'>
<meta content='Play Java Application with MySQL Backend Deployed on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java MySQL App on Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java MySQL App on Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Java Application with MySQL Backend Deployed on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/java" rel="tag">java</a><a href="/tags/mysql" rel="tag">mysql</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Play framework and MySQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java MySQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take a simple use case :</p>

<p>Deploying the <a href="http://www.playframework.org/documentation/2.0.2/JavaTodoList">TodoList</a> app on Cloud Foundry.</p>

<h2 id="todolist-play-app">TodoList Play App</h2>

<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<p>Various components of the app can be found in <a href="/frameworks/play/todolistjavaapp.html">Todo List App Overview</a> document.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>The app can be run locally using the standard command from within the app folder:</p>

<pre class="terminal">
$play run
</pre>

<p>The following screen appears the first time as the evolution script needs to be applied and
tables created:</p>

<p><img src="/images/screenshots/play/play-local-java-mysql-applyscript.png" alt="play-local-java-mysql-applyscript.png"></p>

<p>Once the user presses the ApplyScript button, the actual app home shows up.</p>

<p><img src="/images/screenshots/play/play-local-java-mysql.png" alt="play-local-java-mysql.png"></p>

<h3 id="modifying-the-evolutions-file-for-mysql">Modifying the Evolutions file for MySQL</h3>

<h4 id="comment--delete">Comment / Delete</h4>
<p>We will need to comment out the following statements as they are not recognized by MySQL:</p>

<pre><code class="language-sql"><span class="k">create</span> <span class="n">sequence</span> <span class="n">task_seq</span>
<span class="k">drop</span> <span class="n">sequence</span> <span class="n">task_seq</span>
<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">FALSE</span>
<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">TRUE</span></code></pre>

<h4 id="modify">Modify</h4>
<p>We will modify the create statement to add auto increment functionality to the id field.</p>

<pre><code class="language-sql"><span class="k">create</span> <span class="k">table</span> <span class="n">task</span> <span class="p">(</span>
  <span class="n">id</span>                        <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="n">label</span>                     <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">constraint</span> <span class="n">pk_task</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="p">;</span></code></pre>

<h2 id="deploy-the-app-on-cloud-foundry">Deploy the App on Cloud Foundry</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create a distribution</li>
  <li>Push the distribution using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<pre class="terminal">
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

</pre>

<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/screenshots/play/play-cf-java-mysql.png" alt="play-cf-java-mysql.png"></p>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we learned how to build and deploy a basic Play Java app using MySQL as the backend.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"îThis is a guide for Java developers using the Play framework and MySQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java MySQL applications to Cloud Foundry.


Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Play 2.0 ](http://www.playframework.org/documentation/2.0.2/Home) installation

## Introduction

In this tutorial, we take a simple use case :

Deploying the [TodoList]( http://www.playframework.org/documentation/2.0.2/JavaTodoList ) app on Cloud Foundry.

## TodoList Play App

TodoList is used to create and manage tasks.

![todolist-usecase.png](/images/play/todolist-usecase.png)

These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.

Various components of the app can be found in [Todo List App Overview]( /frameworks/play/todolistjavaapp.html) document.

## Build and Run the App Locally
The app can be run locally using the standard command from within the app folder:

``` bash
$play run
```
The following screen appears the first time as the evolution script needs to be applied and
tables created:

![play-local-java-mysql-applyscript.png](/images/screenshots/play/play-local-java-mysql-applyscript.png)

Once the user presses the ApplyScript button, the actual app home shows up.

![play-local-java-mysql.png](/images/screenshots/play/play-local-java-mysql.png)


### Modifying the Evolutions file for MySQL

#### Comment / Delete
We will need to comment out the following statements as they are not recognized by MySQL:

```  sql
create sequence task_seq
drop sequence task_seq
SET REFERENTIAL_INTEGRITY FALSE
SET REFERENTIAL_INTEGRITY TRUE
```

#### Modify
We will modify the create statement to add auto increment functionality to the id field.

``` sql
create table task (
  id                        bigint not null AUTO_INCREMENT,
  label                     varchar(255),
  constraint pk_task primary key (id))
;
```

## Deploy the App on Cloud Foundry
Deployment to Cloud Foundry can be done in two simple steps:

+  Create a distribution
+  Push the distribution using `vmc push`

Commands below show the exact commands and output when the app is deployed:

``` bash
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

```

Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![play-cf-java-mysql.png](/images/screenshots/play/play-cf-java-mysql.png)

## Summary
In this tutorial, we learned how to build and deploy a basic Play Java app using MySQL as the backend.;T;
I"ß<p>This is a guide for Java developers using the Play framework and MySQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java MySQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take a simple use case :</p>

<p>Deploying the <a href="http://www.playframework.org/documentation/2.0.2/JavaTodoList">TodoList</a> app on Cloud Foundry.</p>

<h2 id="todolist-play-app">TodoList Play App</h2>

<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<p>Various components of the app can be found in <a href="/frameworks/play/todolistjavaapp.html">Todo List App Overview</a> document.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>The app can be run locally using the standard command from within the app folder:</p>

<pre class="terminal">
$play run
</pre>

<p>The following screen appears the first time as the evolution script needs to be applied and
tables created:</p>

<p><img src="/images/screenshots/play/play-local-java-mysql-applyscript.png" alt="play-local-java-mysql-applyscript.png"></p>

<p>Once the user presses the ApplyScript button, the actual app home shows up.</p>

<p><img src="/images/screenshots/play/play-local-java-mysql.png" alt="play-local-java-mysql.png"></p>

<h3 id="modifying-the-evolutions-file-for-mysql">Modifying the Evolutions file for MySQL</h3>

<h4 id="comment--delete">Comment / Delete</h4>
<p>We will need to comment out the following statements as they are not recognized by MySQL:</p>

<pre><code class="language-sql"><span class="k">create</span> <span class="n">sequence</span> <span class="n">task_seq</span>
<span class="k">drop</span> <span class="n">sequence</span> <span class="n">task_seq</span>
<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">FALSE</span>
<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">TRUE</span></code></pre>

<h4 id="modify">Modify</h4>
<p>We will modify the create statement to add auto increment functionality to the id field.</p>

<pre><code class="language-sql"><span class="k">create</span> <span class="k">table</span> <span class="n">task</span> <span class="p">(</span>
  <span class="n">id</span>                        <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="n">label</span>                     <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">constraint</span> <span class="n">pk_task</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="p">;</span></code></pre>

<h2 id="deploy-the-app-on-cloud-foundry">Deploy the App on Cloud Foundry</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create a distribution</li>
  <li>Push the distribution using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<pre class="terminal">
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

</pre>

<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/screenshots/play/play-cf-java-mysql.png" alt="play-cf-java-mysql.png"></p>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we learned how to build and deploy a basic Play Java app using MySQL as the backend.</p>;T;@.I"&/frameworks/play/java-postgresql/;T{;{	;I"‹F<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/java-postgresql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java PostgreSQL App on Cloud Foundry' property='og:title'>
<meta content='Play Java Application with PostgreSQL Backend Deployed on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java PostgreSQL App on Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java PostgreSQL App on Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Java Application with PostgreSQL Backend Deployed on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/java" rel="tag">java</a><a href="/tags/postgresql" rel="tag">postgresql</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Play framework and PostgreSQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take a simple use case :</p>

<p>Deploying the <a href="http://www.playframework.org/documentation/2.0.2/JavaTodoList">TodoList</a> app to Cloud Foundry with the
persistent layer wired to a PostgreSQL database.</p>

<h2 id="todolist-play-app">TodoList Play App</h2>

<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<p>Various components of the app can be found in the <a href="/frameworks/play/todolistjavaapp.html">Todo List App Overview</a> document.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>The app can be run locally using the standard command from within the app folder.</p>

<pre class="terminal">
$play run
</pre>

<p>The following screen appears the first time as the evolution script needs to be applied and
tables created:</p>

<p><img src="/images/screenshots/play/play-local-java-mysql-applyscript.png" alt="play-local-java-mysql-applyscript.png"></p>

<p>Once the user clicks the ApplyScript button, the actual app home shows up.</p>

<p><img src="/images/screenshots/play/play-local-java-mysql.png" alt="play-local-java-mysql.png"></p>

<h3 id="modifying-the-evolutions-file-for-postgresql">Modifying the Evolutions file for PostgreSQL</h3>

<p>There is no need to modify or delete the default evolutions file generated by the Play Framework.</p>

<h2 id="deploy-the-app-on-cloud-foundry">Deploy the App on Cloud Foundry</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create a distribution</li>
  <li>Push the distribution using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed.</p>

<pre class="terminal">
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

</pre>

<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/screenshots/play/play-cf-java-mysql.png" alt="play-cf-java-mysql.png"></p>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we learned how to build and deploy a basic Play Java app using PostgreSQL as the backend.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I" This is a guide for Java developers using the Play framework and PostgreSQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java PostgreSQL applications to Cloud Foundry.



Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Play 2.0 ](http://www.playframework.org/documentation/2.0.2/Home) installation

## Introduction

In this tutorial, we take a simple use case :

Deploying the [TodoList]( http://www.playframework.org/documentation/2.0.2/JavaTodoList ) app to Cloud Foundry with the
persistent layer wired to a PostgreSQL database.

## TodoList Play App

TodoList is used to create and manage tasks.

![todolist-usecase.png](/images/play/todolist-usecase.png)

These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.

Various components of the app can be found in the [Todo List App Overview]( /frameworks/play/todolistjavaapp.html ) document.


## Build and Run the App Locally
The app can be run locally using the standard command from within the app folder.

``` bash
$play run
```
The following screen appears the first time as the evolution script needs to be applied and
tables created:

![play-local-java-mysql-applyscript.png](/images/screenshots/play/play-local-java-mysql-applyscript.png)

Once the user clicks the ApplyScript button, the actual app home shows up.

![play-local-java-mysql.png](/images/screenshots/play/play-local-java-mysql.png)


### Modifying the Evolutions file for PostgreSQL

There is no need to modify or delete the default evolutions file generated by the Play Framework.

## Deploy the App on Cloud Foundry
Deployment to Cloud Foundry can be done in two simple steps:

+  Create a distribution
+  Push the distribution using `vmc push`

Commands below show the exact commands and output when the app is deployed.

``` bash
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

```

Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![play-cf-java-mysql.png](/images/screenshots/play/play-cf-java-mysql.png)

## Summary
In this tutorial, we learned how to build and deploy a basic Play Java app using PostgreSQL as the backend.;T;
I"ú<p>This is a guide for Java developers using the Play framework and PostgreSQL database to build and
deploy their apps on Cloud Foundry. It shows you how to set up and successfully
deploy Play Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take a simple use case :</p>

<p>Deploying the <a href="http://www.playframework.org/documentation/2.0.2/JavaTodoList">TodoList</a> app to Cloud Foundry with the
persistent layer wired to a PostgreSQL database.</p>

<h2 id="todolist-play-app">TodoList Play App</h2>

<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<p>Various components of the app can be found in the <a href="/frameworks/play/todolistjavaapp.html">Todo List App Overview</a> document.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>The app can be run locally using the standard command from within the app folder.</p>

<pre class="terminal">
$play run
</pre>

<p>The following screen appears the first time as the evolution script needs to be applied and
tables created:</p>

<p><img src="/images/screenshots/play/play-local-java-mysql-applyscript.png" alt="play-local-java-mysql-applyscript.png"></p>

<p>Once the user clicks the ApplyScript button, the actual app home shows up.</p>

<p><img src="/images/screenshots/play/play-local-java-mysql.png" alt="play-local-java-mysql.png"></p>

<h3 id="modifying-the-evolutions-file-for-postgresql">Modifying the Evolutions file for PostgreSQL</h3>

<p>There is no need to modify or delete the default evolutions file generated by the Play Framework.</p>

<h2 id="deploy-the-app-on-cloud-foundry">Deploy the App on Cloud Foundry</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create a distribution</li>
  <li>Push the distribution using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed.</p>

<pre class="terminal">
$ play dist
[info] Loading project definition from /Users/[username]/play/mysamples/todolist-java-mysql/project
[info] Set current project to todolist-java-mysql (in build file:/Users/rajdeepd/vmware/play/mysamples/todolist-java-mysql/)
[info] Packaging /Users/[username]/play/mysamples/todolist-java-mysql/target/scala-2.9.1/todolist-java-mysql_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/play/mysamples/todolist-java-mysql/dist/todolist-java-mysql-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Aug 2, 2012 11:11:55 PM
$ vmc push --path=dist/todolist-java-mysql-1.0-SNAPSHOT.zip
Application Name: todolist-java-mysql
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mysql.cloudfoundry.com]: y
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mysql'? [yN]: N
Create services to bind to 'todolist-java-mysql'? [yN]: y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 2
Specify the name of the service [mysql-2ea2b]:
Create another? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Creating Service [mysql-2ea2b]: OK
Binding Service [mysql-2ea2b]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (83K): OK
Push Status: OK
Staging Application 'todolist-java-mysql': OK
Starting Application 'todolist-java-mysql': OK

</pre>

<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/screenshots/play/play-cf-java-mysql.png" alt="play-cf-java-mysql.png"></p>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we learned how to build and deploy a basic Play Java app using PostgreSQL as the backend.</p>;T;@4I",/frameworks/play/scala-getting-started/;T{;{	;I"NL<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/scala-getting-started.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java' property='og:title'>
<meta content='Play Scala Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Scala Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/scala" rel="tag">scala</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Scala developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Scala applications
to Cloud Foundry.</p>

<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="deploying-play-scala-applications-to-cloud-foundry">Deploying Play Scala Applications to Cloud Foundry</h2>

<p>When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Play application in Scala.</p>

<h3 id="install-play">Install Play</h3>

<p>Please follow the instructions given on the <a href="http://www.playframework.org/documentation/2.0.2/Installing">Play website</a>
to download and install Play 2.0.</p>

<p>Make sure the play script is in your path. On a Linux or a Mac environment this can be done using</p>

<pre class="terminal">
export PATH=$PATH:/path/to/play20
</pre>

<p>On Windows youâ€™ll need to set it in the global environment variables.</p>

<h3 id="check-the-play-command-is-available">Check the play command is available</h3>
<p>Run the <code>play help</code> command in the shell.</p>

<pre class="terminal">
$play help
</pre>

<p>The Following screen should show up.</p>

<p><img src="/images/screenshots/play/play-help.png" alt="play-help.png"></p>

<h3 id="create-the-app">Create the App</h3>

<p>To create the app, type the following command:</p>

<pre class="terminal">
$ play new helloworld-scala

</pre>

<p>Choose the Appropriate template (Scala in our case).</p>

<pre class="terminal">
$play new helloworld-scala
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-scala

What is the application name?
&gt; helloworld-scala

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

&gt; 1

OK, application helloworld-scala is created.

Have fun!
</pre>

<p>The following directory structure gets created:</p>

<pre class="terminal">
$cd helloworld-scala
$ls
README
app
conf
project
public
</pre>

<p>This will create a new directory <code>helloworld-scala</code>.</p>

<h3 id="run-the-default-app-locally">Run the Default App Locally</h3>

<p>Try running the app locally with the following command inside the play console:</p>

<pre class="terminal">
[helloworld-scala] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-scala/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
</pre>

<p>You should see the default Play template being served at <code>http://localhost:9000</code>.</p>

<p><img src="/images/screenshots/play/default-play-home.png" alt="default-play-home.png"></p>

<h3 id="modify-the-controller">Modify the Controller</h3>

<p>In this step, we modify the controller <code>helloworld-scala/app/controllers/Application.scala</code></p>

<pre><code class="language-scala"><span class="k">package</span> <span class="nn">controllers</span>

<span class="k">import</span> <span class="nn">play.api._</span>
<span class="k">import</span> <span class="nn">play.api.mvc._</span>

<span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="s">"Hello World in Scala"</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>The default view in the browser would look like this:</p>

<p><img src="/images/screenshots/play/play-helloworld-scala.png" alt="play-helloworld-scala.png"></p>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: helloworld-scala
    Application Deployed URL [helloworld-scala.cloudfoundry.com]:
    Detected a Play Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'helloworld-scala'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: ................ OK
</pre>

<p>Access the application with your browser at the specified URL,
 <a href="http://hello-scala.cloudfoundry.com">http://helloworld-scala.cloudfoundry.com</a> in this example.</p>

<p><img src="/images/screenshots/play/play-helloworld-scala-cf.png" alt="play-helloworld-scala-cf.png"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"This is a guide for Scala developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Scala applications
to Cloud Foundry.

Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.

Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Play 2.0 ](http://www.playframework.org/documentation/2.0.2/Home) installation

## Deploying Play Scala Applications to Cloud Foundry

When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.

Here are steps to create and deploy a "hello world" Play application in Scala.

### Install Play

Please follow the instructions given on the [Play website](http://www.playframework.org/documentation/2.0.2/Installing)
to download and install Play 2.0.

Make sure the play script is in your path. On a Linux or a Mac environment this can be done using

``` bash
export PATH=$PATH:/path/to/play20
```
On Windows youâ€™ll need to set it in the global environment variables.

### Check the play command is available
Run the `play help` command in the shell.

``` bash
$play help
```
The Following screen should show up.

![play-help.png](/images/screenshots/play/play-help.png)

### Create the App

To create the app, type the following command:

``` bash
$ play new helloworld-scala

```
Choose the Appropriate template (Scala in our case).

``` bash
$play new helloworld-scala
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-scala

What is the application name?
> helloworld-scala

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

> 1

OK, application helloworld-scala is created.

Have fun!
```

The following directory structure gets created:

```bash
$cd helloworld-scala
$ls
README
app
conf
project
public
```
This will create a new directory `helloworld-scala`.

### Run the Default App Locally

Try running the app locally with the following command inside the play console:

```bash
[helloworld-scala] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-scala/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
```
You should see the default Play template being served at `http://localhost:9000`.

![default-play-home.png](/images/screenshots/play/default-play-home.png)

### Modify the Controller

In this step, we modify the controller `helloworld-scala/app/controllers/Application.scala`

```scala
package controllers

import play.api._
import play.api.mvc._

object Application extends Controller {

  def index = Action {
    Ok("Hello World in Scala")
  }

}

```
The default view in the browser would look like this:

![play-helloworld-scala.png](/images/screenshots/play/play-helloworld-scala.png)


### Deploy the App

Target Cloud Foundry and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
$ vmc login
```

Push the application. You can press `Enter` to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:

``` bash
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: helloworld-scala
    Application Deployed URL [helloworld-scala.cloudfoundry.com]:
    Detected a Play Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'helloworld-scala'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: ................ OK
```

Access the application with your browser at the specified URL,
 [http://helloworld-scala.cloudfoundry.com](http://hello-scala.cloudfoundry.com) in this example.

![play-helloworld-scala-cf.png](/images/screenshots/play/play-helloworld-scala-cf.png);T;
I"l<p>This is a guide for Scala developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Scala applications
to Cloud Foundry.</p>

<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="deploying-play-scala-applications-to-cloud-foundry">Deploying Play Scala Applications to Cloud Foundry</h2>

<p>When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Play application in Scala.</p>

<h3 id="install-play">Install Play</h3>

<p>Please follow the instructions given on the <a href="http://www.playframework.org/documentation/2.0.2/Installing">Play website</a>
to download and install Play 2.0.</p>

<p>Make sure the play script is in your path. On a Linux or a Mac environment this can be done using</p>

<pre class="terminal">
export PATH=$PATH:/path/to/play20
</pre>

<p>On Windows youâ€™ll need to set it in the global environment variables.</p>

<h3 id="check-the-play-command-is-available">Check the play command is available</h3>
<p>Run the <code>play help</code> command in the shell.</p>

<pre class="terminal">
$play help
</pre>

<p>The Following screen should show up.</p>

<p><img src="/images/screenshots/play/play-help.png" alt="play-help.png"></p>

<h3 id="create-the-app">Create the App</h3>

<p>To create the app, type the following command:</p>

<pre class="terminal">
$ play new helloworld-scala

</pre>

<p>Choose the Appropriate template (Scala in our case).</p>

<pre class="terminal">
$play new helloworld-scala
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-scala

What is the application name?
&gt; helloworld-scala

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

&gt; 1

OK, application helloworld-scala is created.

Have fun!
</pre>

<p>The following directory structure gets created:</p>

<pre class="terminal">
$cd helloworld-scala
$ls
README
app
conf
project
public
</pre>

<p>This will create a new directory <code>helloworld-scala</code>.</p>

<h3 id="run-the-default-app-locally">Run the Default App Locally</h3>

<p>Try running the app locally with the following command inside the play console:</p>

<pre class="terminal">
[helloworld-scala] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-scala/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
</pre>

<p>You should see the default Play template being served at <code>http://localhost:9000</code>.</p>

<p><img src="/images/screenshots/play/default-play-home.png" alt="default-play-home.png"></p>

<h3 id="modify-the-controller">Modify the Controller</h3>

<p>In this step, we modify the controller <code>helloworld-scala/app/controllers/Application.scala</code></p>

<pre><code class="language-scala"><span class="k">package</span> <span class="nn">controllers</span>

<span class="k">import</span> <span class="nn">play.api._</span>
<span class="k">import</span> <span class="nn">play.api.mvc._</span>

<span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">index</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="s">"Hello World in Scala"</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>The default view in the browser would look like this:</p>

<p><img src="/images/screenshots/play/play-helloworld-scala.png" alt="play-helloworld-scala.png"></p>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: helloworld-scala
    Application Deployed URL [helloworld-scala.cloudfoundry.com]:
    Detected a Play Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'helloworld-scala'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: ................ OK
</pre>

<p>Access the application with your browser at the specified URL,
 <a href="http://hello-scala.cloudfoundry.com">http://helloworld-scala.cloudfoundry.com</a> in this example.</p>

<p><img src="/images/screenshots/play/play-helloworld-scala-cf.png" alt="play-helloworld-scala-cf.png"></p>;T;@:I"/frameworks/play/play/;T{;{	;I"…8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/play.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play' property='og:title'>
<meta content='Play Framework Support in Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Framework Support in Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.</p>

<p>Play 2.0 is a first class citizen among other frameworks in the Cloud Foundry ecosystem.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li>
<a href="/frameworks/play/java-getting-started.html">Getting started with Play Java</a> on Cloud Foundry</li>
  <li>
<a href="/frameworks/play/scala-getting-started.html">Getting started with Play Scala</a> on Cloud Foundry</li>
  <li><a href="/frameworks/play/java-mysql.html">Play Java App with MySQL</a></li>
  <li><a href="/frameworks/play/java-postgresql.html">Play Java App with PostgreSQL</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.

Play 2.0 is a first class citizen among other frameworks in the Cloud Foundry ecosystem.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.

Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Play 2.0 ](http://www.playframework.org/documentation/2.0.2/Home) installation


## Next Steps

+  [Getting started with Play Java](/frameworks/play/java-getting-started.html) on Cloud Foundry
+  [Getting started with Play Scala](/frameworks/play/scala-getting-started.html) on Cloud Foundry
+  [Play Java App with MySQL](/frameworks/play/java-mysql.html)
+  [Play Java App with PostgreSQL](/frameworks/play/java-postgresql.html);T;
I"<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.</p>

<p>Play 2.0 is a first class citizen among other frameworks in the Cloud Foundry ecosystem.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li>
<a href="/frameworks/play/java-getting-started.html">Getting started with Play Java</a> on Cloud Foundry</li>
  <li>
<a href="/frameworks/play/scala-getting-started.html">Getting started with Play Scala</a> on Cloud Foundry</li>
  <li><a href="/frameworks/play/java-mysql.html">Play Java App with MySQL</a></li>
  <li><a href="/frameworks/play/java-postgresql.html">Play Java App with PostgreSQL</a></li>
</ul>;T;@@I"&/frameworks/play/todolistjavaapp/;T{;{	;I"xm<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/todolistjavaapp.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java App TodoList on Cloud Foundry' property='og:title'>
<meta content='Play Java Application with Persistent Backend Deployed on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java App TodoList on Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java App TodoList on Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Java Application with Persistent Backend Deployed on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/java" rel="tag">java</a><a href="/tags/postgresql" rel="tag">postgresql</a><a href="/tags/mysql" rel="tag">mysql</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide describing in more detail the TodoList app, use cases it covers and
various components.</p>

<h2 id="app-use-case">App use case</h2>
<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<h2 id="components-of-the-app">Components of the App</h2>

<p>The App has four main components:</p>

<ul>
<li>Routes</li>
  <li>Controller</li>
  <li>Model</li>
  <li>View</li>
</ul><h3 id="router">Router</h3>
<p>Routing information of the app is described in the <code>conf/route</code> file. It maps the HTTP path
to the corresponding actions in the Controller.</p>

<pre><code class="language-javascript"><span class="err">#</span> <span class="nx">Home</span> <span class="nx">page</span>
<span class="nx">GET</span>     <span class="o">/</span>                           <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">Map</span> <span class="kr">static</span> <span class="nx">resources</span> <span class="nx">from</span> <span class="nx">the</span> <span class="o">/</span><span class="kr">public</span> <span class="nx">folder</span> <span class="nx">to</span> <span class="nx">the</span> <span class="o">/</span><span class="nx">assets</span> <span class="nx">URL</span> <span class="nx">path</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">assets</span><span class="o">/*</span><span class="nx">file</span>               <span class="nx">controllers</span><span class="p">.</span><span class="nx">Assets</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">path</span><span class="o">=</span><span class="s2">"/public"</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">Tasks</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">tasks</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">newTask</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span><span class="o">/:</span><span class="nx">id</span><span class="o">/</span><span class="k">delete</span>       <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">deleteTask</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">Long</span><span class="p">)</span></code></pre>

<h3 id="controller">Controller</h3>
<p>The app has a single controller <code>controllers.Application.java</code> which has actions mapped to HTTP
paths as described in the routing file below:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">controllers</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">play.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.mvc.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.data.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">models.Task</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">views.html.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">Form</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">taskForm</span> <span class="o">=</span> <span class="n">form</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">tasks</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">ok</span><span class="o">(</span><span class="n">views</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">index</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">all</span><span class="o">(),</span> <span class="n">taskForm</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">newTask</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Form</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">filledForm</span> <span class="o">=</span> <span class="n">taskForm</span><span class="o">.</span><span class="na">bindFromRequest</span><span class="o">();</span>
  <span class="k">if</span><span class="o">(</span><span class="n">filledForm</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">badRequest</span><span class="o">(</span>
      <span class="n">views</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">index</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">all</span><span class="o">(),</span> <span class="n">filledForm</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">Task</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">filledForm</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">deleteTask</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Task</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<h3 id="model">Model</h3>
<p>Model is made up of a Single Object <code>models.Task</code>. The app uses JPA to identify the Id and the
required fields.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">models</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.data.validation.Constraints.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.db.ebean.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="kd">extends</span> <span class="n">Model</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Finder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">find</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Finder</span><span class="o">(</span>
    <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span>
  <span class="o">);</span>

  <span class="nd">@Id</span>
  <span class="kd">public</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="nd">@Required</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">label</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">all</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">find</span><span class="o">.</span><span class="na">all</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">Task</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">task</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">find</span><span class="o">.</span><span class="na">ref</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">delete</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<h3 id="view">View</h3>
<p>View is a scala function in Play with a mix of HTML and scala statements. We are passing the
List of tasks and taskForm object into it. The view shows a list of existing tasks and the
 ability to create and delete tasks.</p>
<pre><code class="language-html">@(tasks: List[Task], taskForm: Form[String])

@import helper._

@main("Todo list") {

    <span class="nt">&lt;h1&gt;</span>@tasks.size task(s)<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;ul&gt;</span>
        @tasks.map { task =&gt;
            <span class="nt">&lt;li&gt;</span>
                @task.label

                @form(routes.Application.deleteTask(task.id)) {
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Delete"</span><span class="nt">&gt;</span>
                }
            <span class="nt">&lt;/li&gt;</span>
        }
    <span class="nt">&lt;/ul&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Add a new task<span class="nt">&lt;/h2&gt;</span>

    @form(routes.Application.newTask) {

        @inputText(taskForm("label"))

        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Create"</span><span class="nt">&gt;</span>

    }
}</code></pre>

<h2 id="sql-evolutions">SQL Evolutions</h2>
<p>Play 2.0 generates the SQL evolution file based on the Object model designed.</p>

<h3 id="default-evolution-file">Default Evolution File</h3>
<p>The code shown below is the default evolution file <code>1.sql</code> generated in <code>evolutions/default</code> folder.</p>

<pre><code class="language-sql"> <span class="o">#</span> <span class="c1">--- !Ups</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">task</span> <span class="p">(</span>
  <span class="n">id</span>                        <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">label</span>                     <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">constraint</span> <span class="n">pk_task</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="p">;</span>

<span class="k">create</span> <span class="n">sequence</span> <span class="n">task_seq</span><span class="p">;</span>


<span class="o">#</span> <span class="c1">--- !Downs</span>

<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="k">drop</span> <span class="k">table</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">task</span><span class="p">;</span>

<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">TRUE</span><span class="p">;</span>

<span class="k">drop</span> <span class="n">sequence</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">task_seq</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"DThis is a guide describing in more detail the TodoList app, use cases it covers and
various components.

## App use case
TodoList is used to create and manage tasks.

![todolist-usecase.png](/images/play/todolist-usecase.png)

These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.

## Components of the App

The App has four main components:

+    Routes
+    Controller
+    Model
+    View

### Router
Routing information of the app is described in the `conf/route` file. It maps the HTTP path
to the corresponding actions in the Controller.

``` javascript
# Home page
GET     /                           controllers.Application.index()

# Map static resources from the /public folder to the /assets URL path
GET     /assets/*file               controllers.Assets.at(path="/public", file)

# Tasks
GET     /tasks                  controllers.Application.tasks()
POST    /tasks                  controllers.Application.newTask()
POST    /tasks/:id/delete       controllers.Application.deleteTask(id: Long)
```

### Controller
The app has a single controller `controllers.Application.java` which has actions mapped to HTTP
paths as described in the routing file below:

``` java
package controllers;

import play.*;
import play.mvc.*;
import play.data.*;
import models.Task;

import views.html.*;

public class Application extends Controller {
  static Form<Task> taskForm = form(Task.class);
  public static Result index() {
    return redirect(routes.Application.tasks());
  }

  public static Result tasks() {
    return ok(views.html.index.render(Task.all(), taskForm));
  }

  public static Result newTask() {
    Form<Task> filledForm = taskForm.bindFromRequest();
  if(filledForm.hasErrors()) {
    return badRequest(
      views.html.index.render(Task.all(), filledForm)
    );
  } else {
    Task.create(filledForm.get());
    return redirect(routes.Application.tasks());
  }
  }

  public static Result deleteTask(Long id) {
    Task.delete(id);
    return redirect(routes.Application.tasks());
  }
}
```

### Model
Model is made up of a Single Object `models.Task`. The app uses JPA to identify the Id and the
required fields.

``` java
package models;

import java.util.*;
import play.data.validation.Constraints.*;
import play.db.ebean.*;
import javax.persistence.*;

@Entity
public class Task extends Model{
  public static Finder<Long,Task> find = new Finder(
    Long.class, Task.class
  );

  @Id
  public Long id;
  @Required
  public String label;

  public static List<Task> all() {
    return find.all();
  }

  public static void create(Task task) {
    task.save();
  }

  public static void delete(Long id) {
    find.ref(id).delete();
  }
}
```
### View
View is a scala function in Play with a mix of HTML and scala statements. We are passing the
List of tasks and taskForm object into it. The view shows a list of existing tasks and the
 ability to create and delete tasks.
``` html
@(tasks: List[Task], taskForm: Form[String])

@import helper._

@main("Todo list") {

    <h1>@tasks.size task(s)</h1>

    <ul>
        @tasks.map { task =>
            <li>
                @task.label

                @form(routes.Application.deleteTask(task.id)) {
                    <input type="submit" value="Delete">
                }
            </li>
        }
    </ul>

    <h2>Add a new task</h2>

    @form(routes.Application.newTask) {

        @inputText(taskForm("label"))

        <input type="submit" value="Create">

    }
}
```
## SQL Evolutions
Play 2.0 generates the SQL evolution file based on the Object model designed.

### Default Evolution File
The code shown below is the default evolution file `1.sql` generated in `evolutions/default` folder.

``` sql
 # --- !Ups

create table task (
  id                        bigint not null,
  label                     varchar(255),
  constraint pk_task primary key (id))
;

create sequence task_seq;


# --- !Downs

SET REFERENTIAL_INTEGRITY FALSE;

drop table if exists task;

SET REFERENTIAL_INTEGRITY TRUE;

drop sequence if exists task_seq;

```;T;
I"Ä8<p>This is a guide describing in more detail the TodoList app, use cases it covers and
various components.</p>

<h2 id="app-use-case">App use case</h2>
<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.
The default tutorial stores tasks in the embedded database which comes with the Play framework.</p>

<h2 id="components-of-the-app">Components of the App</h2>

<p>The App has four main components:</p>

<ul>
<li>Routes</li>
  <li>Controller</li>
  <li>Model</li>
  <li>View</li>
</ul><h3 id="router">Router</h3>
<p>Routing information of the app is described in the <code>conf/route</code> file. It maps the HTTP path
to the corresponding actions in the Controller.</p>

<pre><code class="language-javascript"><span class="err">#</span> <span class="nx">Home</span> <span class="nx">page</span>
<span class="nx">GET</span>     <span class="o">/</span>                           <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">Map</span> <span class="kr">static</span> <span class="nx">resources</span> <span class="nx">from</span> <span class="nx">the</span> <span class="o">/</span><span class="kr">public</span> <span class="nx">folder</span> <span class="nx">to</span> <span class="nx">the</span> <span class="o">/</span><span class="nx">assets</span> <span class="nx">URL</span> <span class="nx">path</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">assets</span><span class="o">/*</span><span class="nx">file</span>               <span class="nx">controllers</span><span class="p">.</span><span class="nx">Assets</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">path</span><span class="o">=</span><span class="s2">"/public"</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">Tasks</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">tasks</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">newTask</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span><span class="o">/:</span><span class="nx">id</span><span class="o">/</span><span class="k">delete</span>       <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">deleteTask</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">Long</span><span class="p">)</span></code></pre>

<h3 id="controller">Controller</h3>
<p>The app has a single controller <code>controllers.Application.java</code> which has actions mapped to HTTP
paths as described in the routing file below:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">controllers</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">play.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.mvc.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.data.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">models.Task</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">views.html.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">Form</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">taskForm</span> <span class="o">=</span> <span class="n">form</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">tasks</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">ok</span><span class="o">(</span><span class="n">views</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">index</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">all</span><span class="o">(),</span> <span class="n">taskForm</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">newTask</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Form</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">filledForm</span> <span class="o">=</span> <span class="n">taskForm</span><span class="o">.</span><span class="na">bindFromRequest</span><span class="o">();</span>
  <span class="k">if</span><span class="o">(</span><span class="n">filledForm</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">badRequest</span><span class="o">(</span>
      <span class="n">views</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">index</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">Task</span><span class="o">.</span><span class="na">all</span><span class="o">(),</span> <span class="n">filledForm</span><span class="o">)</span>
    <span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">Task</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">filledForm</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">deleteTask</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Task</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="na">Application</span><span class="o">.</span><span class="na">tasks</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<h3 id="model">Model</h3>
<p>Model is made up of a Single Object <code>models.Task</code>. The app uses JPA to identify the Id and the
required fields.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">models</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.data.validation.Constraints.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.db.ebean.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="kd">extends</span> <span class="n">Model</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Finder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">find</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Finder</span><span class="o">(</span>
    <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Task</span><span class="o">.</span><span class="na">class</span>
  <span class="o">);</span>

  <span class="nd">@Id</span>
  <span class="kd">public</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="nd">@Required</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">label</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">all</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">find</span><span class="o">.</span><span class="na">all</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="n">Task</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">task</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">find</span><span class="o">.</span><span class="na">ref</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">delete</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<h3 id="view">View</h3>
<p>View is a scala function in Play with a mix of HTML and scala statements. We are passing the
List of tasks and taskForm object into it. The view shows a list of existing tasks and the
 ability to create and delete tasks.</p>
<pre><code class="language-html">@(tasks: List[Task], taskForm: Form[String])

@import helper._

@main("Todo list") {

    <span class="nt">&lt;h1&gt;</span>@tasks.size task(s)<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;ul&gt;</span>
        @tasks.map { task =&gt;
            <span class="nt">&lt;li&gt;</span>
                @task.label

                @form(routes.Application.deleteTask(task.id)) {
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Delete"</span><span class="nt">&gt;</span>
                }
            <span class="nt">&lt;/li&gt;</span>
        }
    <span class="nt">&lt;/ul&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Add a new task<span class="nt">&lt;/h2&gt;</span>

    @form(routes.Application.newTask) {

        @inputText(taskForm("label"))

        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Create"</span><span class="nt">&gt;</span>

    }
}</code></pre>

<h2 id="sql-evolutions">SQL Evolutions</h2>
<p>Play 2.0 generates the SQL evolution file based on the Object model designed.</p>

<h3 id="default-evolution-file">Default Evolution File</h3>
<p>The code shown below is the default evolution file <code>1.sql</code> generated in <code>evolutions/default</code> folder.</p>

<pre><code class="language-sql"> <span class="o">#</span> <span class="c1">--- !Ups</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">task</span> <span class="p">(</span>
  <span class="n">id</span>                        <span class="nb">bigint</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">label</span>                     <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="k">constraint</span> <span class="n">pk_task</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="p">;</span>

<span class="k">create</span> <span class="n">sequence</span> <span class="n">task_seq</span><span class="p">;</span>


<span class="o">#</span> <span class="c1">--- !Downs</span>

<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="k">drop</span> <span class="k">table</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">task</span><span class="p">;</span>

<span class="k">SET</span> <span class="n">REFERENTIAL_INTEGRITY</span> <span class="k">TRUE</span><span class="p">;</span>

<span class="k">drop</span> <span class="n">sequence</span> <span class="n">if</span> <span class="k">exists</span> <span class="n">task_seq</span><span class="p">;</span></code></pre>;T;@FI"+/frameworks/play/java-getting-started/;T{;{	;I"hQ<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/java-getting-started.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java' property='og:title'>
<meta content='Play Java Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Play Java Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/java" rel="tag">java</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Java applications
to Cloud Foundry.</p>

<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="deploying-play-java-applications-to-cloud-foundry">Deploying Play Java Applications to Cloud Foundry</h2>

<p>When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Play application.</p>

<h3 id="install-play">Install Play</h3>

<p>Please follow the instructions given on the <a href="http://www.playframework.org/documentation/2.0.2/Installing">Play website</a>
to download and install Play 2.0.</p>

<p>Make sure the play script is in your path. On a Linux or a Mac environment this can be done using</p>

<pre class="terminal">
export PATH=$PATH:/path/to/play20
</pre>

<p>On Windows youâ€™ll need to set it in the global environment variables.</p>

<h3 id="check-the-play-command-is-available">Check the play command is available</h3>
<p>Run the <code>play help</code> command in the shell.</p>

<pre class="terminal">
$play help
</pre>

<p>The Following screen should show up.</p>

<p><img src="/images/screenshots/play/play-help.png" alt="play-help.png"></p>

<h3 id="create-the-app">Create the App</h3>

<p>To create the app, type the following command:</p>

<pre class="terminal">
$ play new helloworld-java

</pre>

<p>Choose the Appropriate template (Java in our case).</p>

<pre class="terminal">
$play new helloworld-java
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-java

What is the application name?
&gt; helloworld-java

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

&gt; 2

OK, application helloworld-java is created.

Have fun!
</pre>

<p>The following directory structure gets created:</p>

<pre class="terminal">
$cd helloworld-java
$ls
README
app
conf
project
public
</pre>

<p>This will create a new directory <code>helloworld-java</code>.</p>

<h3 id="run-the-default-app-locally">Run the Default App Locally</h3>

<p>Try running the app locally with the following command inside the play console:</p>

<pre class="terminal">
[helloworld-java] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-java/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
</pre>

<p>You should see the default Play template being served at <code>http://localhost:9000</code>.</p>

<p><img src="/images/screenshots/play/default-play-home.png" alt="default-play-home.png"></p>

<h3 id="modify-the-controller">Modify the Controller</h3>

<p>In this step, we will modify the controller <code>helloworld-java/app/controllers/Application.java</code></p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">controllers</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">play.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.mvc.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">views.html.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">ok</span><span class="o">(</span><span class="s">"HelloWorld Java"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>The default view in the browser would look like this:</p>

<p><img src="/images/screenshots/play/play-helloworld-java.png" alt="play-helloworld-java.png"></p>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Build the Play distribution using the following command:</p>

<pre class="terminal">
$play dist
[info] Loading project definition from /Users/[username]/vmware/play/mysamples/helloworld-java/project
[info] Set current project to helloworld (in build file:/Users/[username]/vmware/play/mysamples/helloworld-java/)
[info] Packaging /Users/[username]/vmware/play/mysamples/helloworld-java/target/scala-2.9.1/helloworld_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/vmware/play/mysamples/helloworld-java/dist/helloworld-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Jul 26, 2012 10:55:56 PM
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login

</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$vmc push --path=dist/helloworld-1.0-SNAPSHOT.zip
Application Name: helloworld-java
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [helloworld-java.cloudfoundry.com]:
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'helloworld-java'? [yN]: N
Create services to bind to 'helloworld-java'? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (66K): OK
Push Status: OK
Staging Application 'helloworld-java': OK
Starting Application 'helloworld-java': OK
</pre>

<p>Notice how vmc was able to detect a Play Application automatically.</p>

<p>Access the application with your browser at the specified URL,
<a href="http://helloworld-java.cloudfoundry.com">http://helloworld-java.cloudfoundry.com</a> in this example.</p>

<p><img src="/images/screenshots/play/play-helloworld-java-cf.png" alt="play-helloworld-java-cf.png"></p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/frameworks/play/java-mysql.html">Java App with MySQL</a></li>
  <li><a href="/frameworks/play/java-postgresql.html">Java App with PostgreSQL</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"şThis is a guide for Java developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Java applications
to Cloud Foundry.

Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.

Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Play 2.0 ](http://www.playframework.org/documentation/2.0.2/Home) installation

## Deploying Play Java Applications to Cloud Foundry

When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.

Here are steps to create and deploy a "hello world" Play application.

### Install Play

Please follow the instructions given on the [Play website](http://www.playframework.org/documentation/2.0.2/Installing)
to download and install Play 2.0.

Make sure the play script is in your path. On a Linux or a Mac environment this can be done using

``` bash
export PATH=$PATH:/path/to/play20
```
On Windows youâ€™ll need to set it in the global environment variables.

### Check the play command is available
Run the `play help` command in the shell.

``` bash
$play help
```
The Following screen should show up.

![play-help.png](/images/screenshots/play/play-help.png)

### Create the App

To create the app, type the following command:

``` bash
$ play new helloworld-java

```
Choose the Appropriate template (Java in our case).

``` bash
$play new helloworld-java
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-java

What is the application name?
> helloworld-java

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

> 2

OK, application helloworld-java is created.

Have fun!
```

The following directory structure gets created:

```bash
$cd helloworld-java
$ls
README
app
conf
project
public
```
This will create a new directory `helloworld-java`.

### Run the Default App Locally

Try running the app locally with the following command inside the play console:

```bash
[helloworld-java] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-java/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
```
You should see the default Play template being served at `http://localhost:9000`.

![default-play-home.png](/images/screenshots/play/default-play-home.png)

### Modify the Controller

In this step, we will modify the controller `helloworld-java/app/controllers/Application.java`

```java
package controllers;

import play.*;
import play.mvc.*;

import views.html.*;

public class Application extends Controller {

  public static Result index() {
    return ok("HelloWorld Java");
  }
}

```
The default view in the browser would look like this:

![play-helloworld-java.png](/images/screenshots/play/play-helloworld-java.png)


### Deploy the App

Build the Play distribution using the following command:

```bash
$play dist
[info] Loading project definition from /Users/[username]/vmware/play/mysamples/helloworld-java/project
[info] Set current project to helloworld (in build file:/Users/[username]/vmware/play/mysamples/helloworld-java/)
[info] Packaging /Users/[username]/vmware/play/mysamples/helloworld-java/target/scala-2.9.1/helloworld_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/vmware/play/mysamples/helloworld-java/dist/helloworld-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Jul 26, 2012 10:55:56 PM
```
Target Cloud Foundry and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
$ vmc login

```

Push the application. You can press `Enter` to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:

``` bash
$vmc push --path=dist/helloworld-1.0-SNAPSHOT.zip
Application Name: helloworld-java
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [helloworld-java.cloudfoundry.com]:
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'helloworld-java'? [yN]: N
Create services to bind to 'helloworld-java'? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (66K): OK
Push Status: OK
Staging Application 'helloworld-java': OK
Starting Application 'helloworld-java': OK
```

Notice how vmc was able to detect a Play Application automatically.

Access the application with your browser at the specified URL,
[http://helloworld-java.cloudfoundry.com](http://helloworld-java.cloudfoundry.com) in this example.

![play-helloworld-java-cf.png](/images/screenshots/play/play-helloworld-java-cf.png)


## Next Steps

+    [Java App with MySQL](/frameworks/play/java-mysql.html)
+    [Java App with PostgreSQL](/frameworks/play/java-postgresql.html);T;
I"‹<p>This is a guide for Java developers using the Play framework to build their apps and
deploy on Cloud Foundry. It shows you how to set up and successfully deploy Play Java applications
to Cloud Foundry.</p>

<p>Play is based on a lightweight, stateless, web-friendly architecture and features predictable
and minimal resource consumption (CPU, memory, threads) for highly-scalable applications.
Cloud Foundry provides a runtime environment for Play 2.0 applications and the Cloud Foundry
deployment tools automatically recognize Play applications.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
</ul><h2 id="deploying-play-java-applications-to-cloud-foundry">Deploying Play Java Applications to Cloud Foundry</h2>

<p>When you deploy a Play application to Cloud Foundry, the current directory must contain
the application, the conf folder and app folders which are used by Cloud Foundry to detect
a Play application.</p>

<p>Here are steps to create and deploy a â€œhello worldâ€ Play application.</p>

<h3 id="install-play">Install Play</h3>

<p>Please follow the instructions given on the <a href="http://www.playframework.org/documentation/2.0.2/Installing">Play website</a>
to download and install Play 2.0.</p>

<p>Make sure the play script is in your path. On a Linux or a Mac environment this can be done using</p>

<pre class="terminal">
export PATH=$PATH:/path/to/play20
</pre>

<p>On Windows youâ€™ll need to set it in the global environment variables.</p>

<h3 id="check-the-play-command-is-available">Check the play command is available</h3>
<p>Run the <code>play help</code> command in the shell.</p>

<pre class="terminal">
$play help
</pre>

<p>The Following screen should show up.</p>

<p><img src="/images/screenshots/play/play-help.png" alt="play-help.png"></p>

<h3 id="create-the-app">Create the App</h3>

<p>To create the app, type the following command:</p>

<pre class="terminal">
$ play new helloworld-java

</pre>

<p>Choose the Appropriate template (Java in our case).</p>

<pre class="terminal">
$play new helloworld-java
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/[username]/play/mysamples/helloworld-java

What is the application name?
&gt; helloworld-java

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

&gt; 2

OK, application helloworld-java is created.

Have fun!
</pre>

<p>The following directory structure gets created:</p>

<pre class="terminal">
$cd helloworld-java
$ls
README
app
conf
project
public
</pre>

<p>This will create a new directory <code>helloworld-java</code>.</p>

<h3 id="run-the-default-app-locally">Run the Default App Locally</h3>

<p>Try running the app locally with the following command inside the play console:</p>

<pre class="terminal">
[helloworld-java] $ run

[info] Updating {file:/Users/[username]/play/mysamples/helloworld-java/}helloworld...
[info] Done updating.
--- (Running the application from SBT, auto-reloading is enabled) ---

[info] play - Listening for HTTP on port 9000...

(Server started, use Ctrl+D to stop and go back to the console...)
</pre>

<p>You should see the default Play template being served at <code>http://localhost:9000</code>.</p>

<p><img src="/images/screenshots/play/default-play-home.png" alt="default-play-home.png"></p>

<h3 id="modify-the-controller">Modify the Controller</h3>

<p>In this step, we will modify the controller <code>helloworld-java/app/controllers/Application.java</code></p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">controllers</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">play.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">play.mvc.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">views.html.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">ok</span><span class="o">(</span><span class="s">"HelloWorld Java"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>The default view in the browser would look like this:</p>

<p><img src="/images/screenshots/play/play-helloworld-java.png" alt="play-helloworld-java.png"></p>

<h3 id="deploy-the-app">Deploy the App</h3>

<p>Build the Play distribution using the following command:</p>

<pre class="terminal">
$play dist
[info] Loading project definition from /Users/[username]/vmware/play/mysamples/helloworld-java/project
[info] Set current project to helloworld (in build file:/Users/[username]/vmware/play/mysamples/helloworld-java/)
[info] Packaging /Users/[username]/vmware/play/mysamples/helloworld-java/target/scala-2.9.1/helloworld_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is ready in /Users/[username]/vmware/play/mysamples/helloworld-java/dist/helloworld-1.0-SNAPSHOT.zip

[success] Total time: 3 s, completed Jul 26, 2012 10:55:56 PM
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login

</pre>

<p>Push the application. You can press <code>Enter</code> to accept the defaults at most of the prompts,
but be sure to enter a unique URL for the application. Here is an example push:</p>

<pre class="terminal">
$vmc push --path=dist/helloworld-1.0-SNAPSHOT.zip
Application Name: helloworld-java
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [helloworld-java.cloudfoundry.com]:
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'helloworld-java'? [yN]: N
Create services to bind to 'helloworld-java'? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (66K): OK
Push Status: OK
Staging Application 'helloworld-java': OK
Starting Application 'helloworld-java': OK
</pre>

<p>Notice how vmc was able to detect a Play Application automatically.</p>

<p>Access the application with your browser at the specified URL,
<a href="http://helloworld-java.cloudfoundry.com">http://helloworld-java.cloudfoundry.com</a> in this example.</p>

<p><img src="/images/screenshots/play/play-helloworld-java-cf.png" alt="play-helloworld-java-cf.png"></p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/frameworks/play/java-mysql.html">Java App with MySQL</a></li>
  <li><a href="/frameworks/play/java-postgresql.html">Java App with PostgreSQL</a></li>
</ul>;T;@LI",/frameworks/java/spring/spring-insight/;T{;{	;I"N<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring-insight.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Insight on Cloud Foundry FAQ' property='og:title'>
<meta content='Monitoring Java Applications on Cloud Foundry with Spring Insight' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Insight on Cloud Foundry FAQ</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring Insight on Cloud Foundry FAQ</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Monitoring Java Applications on Cloud Foundry with Spring Insight</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring insight" rel="tag">spring insight</a><a href="/tags/faq" rel="tag">faq</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><strong>Q. What is Insight?</strong>
Insight is a byte-code instrumentation monitoring tool for development and production. It is designed to provide light-weight visibility into the operation of a userâ€™s application and enable applications to more easily transition into production. Insight for Cloud Foundry is in the beta phase and open to those who have been given an access token.</p>

<p><strong>Q. Who do I contact with problems?</strong>
Please submit questions and issues to the Cloud Foundry support site: <a href="http://support.cloudfoundry.com/">http://support.cloudfoundry.com</a></p>

<p><strong>Q. What does it mean to have Insight on Cloud Foundry?</strong>
Once the Insight Dashboard is installed, it can be used to enable code-level monitoring on any Java application installed within the userâ€™s Cloud Foundry account.</p>

<p><strong>Q. How do I start monitoring a Java application on Cloud Foundry?</strong>
After installing a dashboard through <a href="http://insight.cloudfoundry.com/">http://insight.cloudfoundry.com</a> you should be redirected to the dashboard. All of your applications should be listed on the dashboard Cloud Foundry tab (1). Those that can be instrumented with Insight will have a little Spring leaf icon(2). On these applications, you can enable Insight through the details panel (3). Monitored data will appear under your Application on the Browse Resources tab (4).</p>

<p><strong>Q. What is Insight-[randomid].cloudfoundry.com?</strong>
This is your personal dashboard. All data sent from your applications is sent to this application. Since it is visible as just another application from vmc, you can even uninstall the dashboard the way you would uninstall a normal Cloud Foundry application.</p>

<p><strong>Q. Which Application frameworks are supported?</strong>
We currently support Java, Spring, and Grails web applications.</p>

<p><strong>Q. Will using the service have any impact on my Cloud Foundry Application?</strong>
When activating Insight, Cloud Foundry installs an agent on the Tomcat thatâ€™s running your app. Our tests show that this agent has negligible impact on performance and only increases response time by a millisecond.</p>

<p><strong>Q. How does Insight impact customer Cloud Foundry Quotas?</strong>
The Insight dashboard is a web application installed on your account. It will take 512MB of your quota. In addition we provision a RabbitMQ service thatâ€™s used by the Insight agents to communicate with the Insight dashboard. The Insight dashboard counts as one application and the RabbitMQ service counts as one service of your account. Each application which is monitored will require additional memory. While this varies with the load and instrumentation, we recommend deploying applications with at least 256MB of memory quota.</p>

<p><strong>Q. Who is the targeted end user?</strong>
The target end users are developers who are interested in making sure that their application is behaving as expected in Cloud Foundry and need a tool to help them resolve problems in real-time.</p>

<p><strong>Q. When will Insight be generally available?</strong>
We announced the private beta of Insight for Cloud Foundry at SpringOne 2GX (Oct 2011). We plan to announce a public beta a few weeks after SpringOne, but not before we are confident that everything is working as it should.</p>

<p><strong>Q. How can I use Insight with my own plugins outside of Cloud Foundry?</strong>
Insight is available for free download with tc Server Developer Edition or Spring Tool Suite: <a href="http://springsource.org/insight">http://springsource.org/insight</a></p>

<p><strong>Q. How do new users gain access to Insight on Cloud Foundry?</strong>
To gain access to Insight on Cloud Foundry, you will need to be a registered user of Cloud Foundry. While in beta, you will also need a token. We distribute tokens once in a while when weâ€™re ready to increase our beta test group.</p>

<p><strong>Q. How does Spring Insight work?</strong>
Insight uses aspect-oriented programming to create an additional instrumentation layer around select methods within the userâ€™s application. The data from these aspects is passed to a secondary webapp which compresses, filters, and forwards the data to the Insight Dashboard where it can be viewed.</p>

<p><strong>Q. How much additional memory must be allocated to an Application when it is monitored by Insight?</strong>
Cloud Foundry sets the minimum and maximum heap of a web application to the configured application memory, but uses the resident size (RSS) of the process to verify compliance. This method does not account for PermGen usage or general process overhead through native libraries or memory-mapped files. Since Insight uses more PermGen because of the class generation through AspectJ we recommend a minimum of 256MB for an application, depending on the complexity. Additionally we require the installation of the Insight Dashboard which uses 512MB of memory.</p>

<p><strong>Q. My Application is running out of memory and Cloud Foundry is killing it. How do I configure the memory settings?</strong>
You may need to alter your Applicationâ€™s memory settings to avoid having Cloud Foundry kill your Application. Cloud Foundry uses the processâ€™ RSS (resident set size) to determine how much memory your Application is consuming, and if the RSS grows beyond your applicationâ€™s configured memory threshold, Cloud Foundry will kill it. This has special implications in Java, because an applicationâ€™s -Xmx (maximum heap usage) is often well below the RSS.</p>

<p>To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.</p>

<p>For instance, if your application runs with 256MB (but does not hit that limit):</p>

<pre class="terminal">
  $  vmc mem my-application 300m
  $  vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
</pre>

<p>Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications which do not hit their max heap but Insight-instrumented applications are more likely to hit these limits due to reliance on JVM datastructures outside of the heap, in PermGen, and in the code cache.</p>

<p><strong>Q. My application reports that there is a duplicate RabbitServiceInfo bean, how do I work around this?</strong>
The RabbitServiceInfo is created for each rabbit entry in the VCAP_SERVICES list. That list would include the application rabbit service and the service for Insight. With some configurations this could result in a duplicate spring bean. An alternative is to wire the RabbitServiceInfo explicitly with a unique id.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"È**Q. What is Insight?**
Insight is a byte-code instrumentation monitoring tool for development and production. It is designed to provide light-weight visibility into the operation of a user's application and enable applications to more easily transition into production. Insight for Cloud Foundry is in the beta phase and open to those who have been given an access token.

**Q. Who do I contact with problems?**
Please submit questions and issues to the Cloud Foundry support site: [http://support.cloudfoundry.com](http://support.cloudfoundry.com/)

**Q. What does it mean to have Insight on Cloud Foundry?**
Once the Insight Dashboard is installed, it can be used to enable code-level monitoring on any Java application installed within the user's Cloud Foundry account.

**Q. How do I start monitoring a Java application on Cloud Foundry?**
After installing a dashboard through [http://insight.cloudfoundry.com](http://insight.cloudfoundry.com/) you should be redirected to the dashboard. All of your applications should be listed on the dashboard Cloud Foundry tab (1). Those that can be instrumented with Insight will have a little Spring leaf icon(2). On these applications, you can enable Insight through the details panel (3). Monitored data will appear under your Application on the Browse Resources tab (4).

**Q. What is Insight-[randomid].cloudfoundry.com?**
This is your personal dashboard. All data sent from your applications is sent to this application. Since it is visible as just another application from vmc, you can even uninstall the dashboard the way you would uninstall a normal Cloud Foundry application.

**Q. Which Application frameworks are supported?**
We currently support Java, Spring, and Grails web applications.

**Q. Will using the service have any impact on my Cloud Foundry Application?**
When activating Insight, Cloud Foundry installs an agent on the Tomcat that's running your app. Our tests show that this agent has negligible impact on performance and only increases response time by a millisecond.

**Q. How does Insight impact customer Cloud Foundry Quotas?**
The Insight dashboard is a web application installed on your account. It will take 512MB of your quota. In addition we provision a RabbitMQ service that's used by the Insight agents to communicate with the Insight dashboard. The Insight dashboard counts as one application and the RabbitMQ service counts as one service of your account. Each application which is monitored will require additional memory. While this varies with the load and instrumentation, we recommend deploying applications with at least 256MB of memory quota.

**Q. Who is the targeted end user?**
The target end users are developers who are interested in making sure that their application is behaving as expected in Cloud Foundry and need a tool to help them resolve problems in real-time.

**Q. When will Insight be generally available?**
We announced the private beta of Insight for Cloud Foundry at SpringOne 2GX (Oct 2011). We plan to announce a public beta a few weeks after SpringOne, but not before we are confident that everything is working as it should.

**Q. How can I use Insight with my own plugins outside of Cloud Foundry?**
Insight is available for free download with tc Server Developer Edition or Spring Tool Suite: [http://springsource.org/insight](http://springsource.org/insight)

**Q. How do new users gain access to Insight on Cloud Foundry?**
To gain access to Insight on Cloud Foundry, you will need to be a registered user of Cloud Foundry. While in beta, you will also need a token. We distribute tokens once in a while when we're ready to increase our beta test group.

**Q. How does Spring Insight work?**
Insight uses aspect-oriented programming to create an additional instrumentation layer around select methods within the user's application. The data from these aspects is passed to a secondary webapp which compresses, filters, and forwards the data to the Insight Dashboard where it can be viewed.

**Q. How much additional memory must be allocated to an Application when it is monitored by Insight?**
Cloud Foundry sets the minimum and maximum heap of a web application to the configured application memory, but uses the resident size (RSS) of the process to verify compliance. This method does not account for PermGen usage or general process overhead through native libraries or memory-mapped files. Since Insight uses more PermGen because of the class generation through AspectJ we recommend a minimum of 256MB for an application, depending on the complexity. Additionally we require the installation of the Insight Dashboard which uses 512MB of memory.

**Q. My Application is running out of memory and Cloud Foundry is killing it. How do I configure the memory settings?**
You may need to alter your Application's memory settings to avoid having Cloud Foundry kill your Application. Cloud Foundry uses the process' RSS (resident set size) to determine how much memory your Application is consuming, and if the RSS grows beyond your application's configured memory threshold, Cloud Foundry will kill it. This has special implications in Java, because an application's -Xmx (maximum heap usage) is often well below the RSS.

To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.

For instance, if your application runs with 256MB (but does not hit that limit):

```bash
  $  vmc mem my-application 300m
  $  vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
```

Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications which do not hit their max heap but Insight-instrumented applications are more likely to hit these limits due to reliance on JVM datastructures outside of the heap, in PermGen, and in the code cache.

**Q. My application reports that there is a duplicate RabbitServiceInfo bean, how do I work around this?**
The RabbitServiceInfo is created for each rabbit entry in the VCAP_SERVICES list. That list would include the application rabbit service and the service for Insight. With some configurations this could result in a duplicate spring bean. An alternative is to wire the RabbitServiceInfo explicitly with a unique id.;T;
I"d<p><strong>Q. What is Insight?</strong>
Insight is a byte-code instrumentation monitoring tool for development and production. It is designed to provide light-weight visibility into the operation of a userâ€™s application and enable applications to more easily transition into production. Insight for Cloud Foundry is in the beta phase and open to those who have been given an access token.</p>

<p><strong>Q. Who do I contact with problems?</strong>
Please submit questions and issues to the Cloud Foundry support site: <a href="http://support.cloudfoundry.com/">http://support.cloudfoundry.com</a></p>

<p><strong>Q. What does it mean to have Insight on Cloud Foundry?</strong>
Once the Insight Dashboard is installed, it can be used to enable code-level monitoring on any Java application installed within the userâ€™s Cloud Foundry account.</p>

<p><strong>Q. How do I start monitoring a Java application on Cloud Foundry?</strong>
After installing a dashboard through <a href="http://insight.cloudfoundry.com/">http://insight.cloudfoundry.com</a> you should be redirected to the dashboard. All of your applications should be listed on the dashboard Cloud Foundry tab (1). Those that can be instrumented with Insight will have a little Spring leaf icon(2). On these applications, you can enable Insight through the details panel (3). Monitored data will appear under your Application on the Browse Resources tab (4).</p>

<p><strong>Q. What is Insight-[randomid].cloudfoundry.com?</strong>
This is your personal dashboard. All data sent from your applications is sent to this application. Since it is visible as just another application from vmc, you can even uninstall the dashboard the way you would uninstall a normal Cloud Foundry application.</p>

<p><strong>Q. Which Application frameworks are supported?</strong>
We currently support Java, Spring, and Grails web applications.</p>

<p><strong>Q. Will using the service have any impact on my Cloud Foundry Application?</strong>
When activating Insight, Cloud Foundry installs an agent on the Tomcat thatâ€™s running your app. Our tests show that this agent has negligible impact on performance and only increases response time by a millisecond.</p>

<p><strong>Q. How does Insight impact customer Cloud Foundry Quotas?</strong>
The Insight dashboard is a web application installed on your account. It will take 512MB of your quota. In addition we provision a RabbitMQ service thatâ€™s used by the Insight agents to communicate with the Insight dashboard. The Insight dashboard counts as one application and the RabbitMQ service counts as one service of your account. Each application which is monitored will require additional memory. While this varies with the load and instrumentation, we recommend deploying applications with at least 256MB of memory quota.</p>

<p><strong>Q. Who is the targeted end user?</strong>
The target end users are developers who are interested in making sure that their application is behaving as expected in Cloud Foundry and need a tool to help them resolve problems in real-time.</p>

<p><strong>Q. When will Insight be generally available?</strong>
We announced the private beta of Insight for Cloud Foundry at SpringOne 2GX (Oct 2011). We plan to announce a public beta a few weeks after SpringOne, but not before we are confident that everything is working as it should.</p>

<p><strong>Q. How can I use Insight with my own plugins outside of Cloud Foundry?</strong>
Insight is available for free download with tc Server Developer Edition or Spring Tool Suite: <a href="http://springsource.org/insight">http://springsource.org/insight</a></p>

<p><strong>Q. How do new users gain access to Insight on Cloud Foundry?</strong>
To gain access to Insight on Cloud Foundry, you will need to be a registered user of Cloud Foundry. While in beta, you will also need a token. We distribute tokens once in a while when weâ€™re ready to increase our beta test group.</p>

<p><strong>Q. How does Spring Insight work?</strong>
Insight uses aspect-oriented programming to create an additional instrumentation layer around select methods within the userâ€™s application. The data from these aspects is passed to a secondary webapp which compresses, filters, and forwards the data to the Insight Dashboard where it can be viewed.</p>

<p><strong>Q. How much additional memory must be allocated to an Application when it is monitored by Insight?</strong>
Cloud Foundry sets the minimum and maximum heap of a web application to the configured application memory, but uses the resident size (RSS) of the process to verify compliance. This method does not account for PermGen usage or general process overhead through native libraries or memory-mapped files. Since Insight uses more PermGen because of the class generation through AspectJ we recommend a minimum of 256MB for an application, depending on the complexity. Additionally we require the installation of the Insight Dashboard which uses 512MB of memory.</p>

<p><strong>Q. My Application is running out of memory and Cloud Foundry is killing it. How do I configure the memory settings?</strong>
You may need to alter your Applicationâ€™s memory settings to avoid having Cloud Foundry kill your Application. Cloud Foundry uses the processâ€™ RSS (resident set size) to determine how much memory your Application is consuming, and if the RSS grows beyond your applicationâ€™s configured memory threshold, Cloud Foundry will kill it. This has special implications in Java, because an applicationâ€™s -Xmx (maximum heap usage) is often well below the RSS.</p>

<p>To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.</p>

<p>For instance, if your application runs with 256MB (but does not hit that limit):</p>

<pre class="terminal">
  $  vmc mem my-application 300m
  $  vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
</pre>

<p>Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications which do not hit their max heap but Insight-instrumented applications are more likely to hit these limits due to reliance on JVM datastructures outside of the heap, in PermGen, and in the code cache.</p>

<p><strong>Q. My application reports that there is a duplicate RabbitServiceInfo bean, how do I work around this?</strong>
The RabbitServiceInfo is created for each rabbit entry in the VCAP_SERVICES list. That list would include the application rabbit service and the service for Insight. With some configurations this could result in a duplicate spring bean. An alternative is to wire the RabbitServiceInfo explicitly with a unique id.</p>;T;@RI"$/frameworks/java/spring/grails/;T{;{	;I"ÜY<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/grails.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Grails' property='og:title'>
<meta content='Grails Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Grails</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Grails</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Grails Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/grails" rel="tag">grails</a><a href="/tags/groovy" rel="tag">groovy</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://grails.org">Grails</a> is a framework for rapidly developing web applications that can be deployed to any Java servlet container, such as Tomcat. Based on the dynamic language <a href="http://groovy.codehaus.org/">Groovy</a> and the <a href="http://www.springframework.org/">Spring</a> framework, it brings the paradigm of Convention over Configuration to the Java platform with the expressiveness of a Java-like dynamic language.</p>

<p>This guide assumes that you already have Java and <a href="http://grails.org/Installation">Grails installed</a> and know how to build a simple Grails application. Thatâ€™s all you need to start working with Cloud Foundry.</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="grails-cloud-foundry-plug-in">Grails Cloud Foundry Plug-in</h2>

<p>Letâ€™s assume you have a standard Grails application using nothing more than a MySQL database and that you want to deploy this application to Cloud Foundry. The first step is to install the <a href="http://grails.org/plugin/cloud-foundry">Cloud Foundry plug-in</a>. This plug-in adds some commands to Grails that make it trivially easy to deploy and manage your application.</p>

<p>From within your Grails project, execute:</p>

<pre class="terminal">
$ grails install-plugin cloud-foundry
</pre>

<p>Once the plug-in is installed, you can use the following to see what Cloud Foundry commands are available:</p>

<pre class="terminal">
$ grails cf-help
</pre>

<p>Most of them are equivalents of the <a href="/tools/vmc/vmc-quick-ref.html">vmc tool</a> commands.</p>

<p>Next, you need to specify your username and password. The best place to put these is the ~/.grails/settings.groovy file:</p>

<pre><code class="language-java">    <span class="n">grails</span><span class="o">.</span><span class="na">plugin</span><span class="o">.</span><span class="na">cloudfoundry</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="s">"yourusername"</span>
    <span class="n">grails</span><span class="o">.</span><span class="na">plugin</span><span class="o">.</span><span class="na">cloudfoundry</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s">"yourpassword"</span></code></pre>

<p>Donâ€™t forget to make this file readable and writable only by you! Now youâ€™re ready to deploy your application:</p>

<pre class="terminal">
$ grails prod cf-push
</pre>

<p>This command will first ask you what URL to use. The default, based on the name of the application, is fine as long as the app name is unique on cloudfoundry.com. If itâ€™s not, then enter a unique name now rather than accepting the default.</p>

<p>The next question will ask whether you want to create and bind a MySQL service (which you do, so reply with â€˜yâ€™), and then whether you want to create and bind a PostgreSQL database (â€˜nâ€™ for this one, since the application is configured for MySQL). Afterwards, youâ€™ll see your application being deployed and started on cloudfoundry.com.</p>

<p>For further information on using the Cloud Foundry plug-in, refer to its <a href="http://grails-plugins.github.com/grails-cloud-foundry/">user guide</a>.</p>

<h2 id="services">Services</h2>

<p>Cloud Foundry provides a rich set of services, all of which can be used by Grails applications: MySQL, PostgreSQL, MongoDB, Redis, and RabbitMQ. Each of these services has a corresponding Grails plug-in. When these plug-ins are installed, you donâ€™t have to configure any connection settings for the associated Cloud Foundry service - itâ€™s done all automatically when your application is deployed. And when you first deploy your application with <code>cf-push</code>, Grails will ask you whether you want to create and bind the relevant services based on which plug-ins you have installed.</p>

<h3 id="sql-services">SQL services</h3>

<p>Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application. All you need to access them is the <a href="http://grails.org/plugin/hibernate">Hibernate plug-in</a>, which is included by default in all new Grails applications. You also need to make sure that the relevant driver is available to your application, for example by declaring it in <code>BuildConfig.groovy</code>:</p>

<pre><code class="language-java">  <span class="n">grails</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">dependency</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="o">{</span>
      <span class="o">...</span>
      <span class="n">dependencies</span> <span class="o">{</span>
          <span class="n">runtime</span> <span class="s">"mysql:mysql-connector-java:5.1.18"</span>
          <span class="o">...</span>
      <span class="o">}</span>
  <span class="o">}</span></code></pre>

<p>and that the JDBC driver class is set in <code>DataSource.groovy</code>:</p>

<pre><code class="language-java">  <span class="n">environments</span> <span class="o">{</span>
      <span class="n">production</span> <span class="o">{</span>
          <span class="n">dataSource</span> <span class="o">{</span>
              <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span>
              <span class="o">...</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span></code></pre>

<p>In this case, weâ€™re going to deploy the application for the standard production environment, but you could easily set up a â€˜cloudâ€™ or similar environment.
Also, you can easily configure the JDBC URL, username and password for the production environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.</p>

<h3 id="redis">Redis</h3>

<p>To use the key-value store <a href="http://redis.io">Redis</a>, you need to either install the <a href="http://grails.org/plugin/redis">Redis plug-in</a> or <a href="http://grails.org/plugin/redis-gorm">Redis for GORM</a>. As with the SQL stores, when you deploy your application to Cloud Foundry it will automatically use whichever Redis service has been bound to it.</p>

<p>The former plug-in provides low-level access to Redis via a <code>redis</code> bean, while the latter allows you to map GORM domain classes to Redis. See the <a href="http://grails.github.com/inconsequential/redis/manual/index.html">plug-in documentation</a> for more information.</p>

<h3 id="mongodb">MongoDB</h3>

<p>To use the document store <a href="http://www.mongodb.org/">MongoDB</a>, just install the <a href="http://grails.org/plugin/mongodb">MongoDB plug-in</a>.</p>

<p>The MongoDB plug-in for Grails allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for accessing the MongoDB driver for Java directly. Refer to the <a href="http://grails.github.com/inconsequential/mongo/manual/index.html">plug-in documentation</a> for more information.</p>

<h2 id="how-to">How To</h2>

<p>A general tutorial can be found in the blog post <a href="http://blog.springsource.com/2011/04/12/one-step-deployment-with-grails-and-cloud-foundry/">â€œOne-step deployment with Grails and Cloud Foundryâ€</a>.</p>

<p>In fact, for a super fast start you can try one of our sample applications:</p>

<ul>
<li>
<a href="https://github.com/SpringSource/cloudfoundry-samples/tree/master/petclinic-grails">Pet Clinic</a> - Demonstrates how to use the SQL service</li>
  <li>
<a href="https://github.com/SpringSource/cloudfoundry-samples/tree/master/grailstwitter">Grails Twitter</a> - <a href="http://grailstwitter.cloudfoundry.com/">running here</a> - Demonstrates how to use the MongoDB and Redis services</li>
</ul><p><em>WARNING</em> If you deploy any of these applications yourself, be sure to deploy them with a different application name.</p>

<h2 id="faq">FAQ</h2>

<p>See the <a href="http://www.cloudfoundry.com/faq">Cloud Foundry FAQ</a> for general questions.</p>

<h3 id="can-i-use-the-spring-cloud-namespace-from-grails">Can I use the Spring Cloud Namespace from Grails?</h3>

<p>Yes you can! See the documentation on <a href="http://www.springsource.org/documentation">Spring</a> for examples on how to configure additional MySQL, Mongo or Redis instances via the Cloud namespace. This configuration can go into <code>grails-app/conf/spring/resources.xml</code> or <code>grails-app/conf/spring/resources.groovy</code> using the BeanBuilder DSL.</p>

<h3 id="how-do-i-get-access-to-cloud-environment-variables">How do I get access to Cloud environment variables?</h3>

<p>The mechanism is the same for Spring and Grails. See the <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki/Cloud-foundry-environment-variables">Cloud Foundry Environment Variables</a> page for more information.</p>

<h3 id="can-i-send-email-from-my-applications">Can I send email from my applications?</h3>

<p>Yes, but not via SMTP as you can only send and receive HTTP or HTTPS requests. Instead, you can use an HTTP-based service such as <a href="http://sendgrid.com/">SendGrid</a>, <a href="http://aws.amazon.com/ses/">Amazon SES</a>, or <a href="http://mailgun.net/">Mailgun</a>. See the <a href="http://support.cloudfoundry.com/entries/20023841">support forum</a> for more info.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"[Grails](http://grails.org) is a framework for rapidly developing web applications that can be deployed to any Java servlet container, such as Tomcat. Based on the dynamic language [Groovy](http://groovy.codehaus.org/) and the [Spring](http://www.springframework.org/) framework, it brings the paradigm of Convention over Configuration to the Java platform with the expressiveness of a Java-like dynamic language.

This guide assumes that you already have Java and [Grails installed](http://grails.org/Installation) and know how to build a simple Grails application. That's all you need to start working with Cloud Foundry.

(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: [https://github.com/SpringSource/cloudfoundry-samples/wiki](https://github.com/SpringSource/cloudfoundry-samples/wiki) )

## Grails Cloud Foundry Plug-in

Let's assume you have a standard Grails application using nothing more than a MySQL database and that you want to deploy this application to Cloud Foundry. The first step is to install the [Cloud Foundry plug-in](http://grails.org/plugin/cloud-foundry). This plug-in adds some commands to Grails that make it trivially easy to deploy and manage your application.

From within your Grails project, execute:

``` bash
$ grails install-plugin cloud-foundry
```

Once the plug-in is installed, you can use the following to see what Cloud Foundry commands are available:

``` bash
$ grails cf-help
```

Most of them are equivalents of the [vmc tool](/tools/vmc/vmc-quick-ref.html) commands.

Next, you need to specify your username and password. The best place to put these is the ~/.grails/settings.groovy file:

``` groovy
    grails.plugin.cloudfoundry.username = "yourusername"
    grails.plugin.cloudfoundry.password = "yourpassword"
```

Don't forget to make this file readable and writable only by you! Now you're ready to deploy your application:

```bash
$ grails prod cf-push
```

This command will first ask you what URL to use. The default, based on the name of the application, is fine as long as the app name is unique on cloudfoundry.com. If it's not, then enter a unique name now rather than accepting the default.

The next question will ask whether you want to create and bind a MySQL service (which you do, so reply with 'y'), and then whether you want to create and bind a PostgreSQL database ('n' for this one, since the application is configured for MySQL). Afterwards, you'll see your application being deployed and started on cloudfoundry.com.

For further information on using the Cloud Foundry plug-in, refer to its [user guide](http://grails-plugins.github.com/grails-cloud-foundry/).

## Services

Cloud Foundry provides a rich set of services, all of which can be used by Grails applications: MySQL, PostgreSQL, MongoDB, Redis, and RabbitMQ. Each of these services has a corresponding Grails plug-in. When these plug-ins are installed, you don't have to configure any connection settings for the associated Cloud Foundry service - it's done all automatically when your application is deployed. And when you first deploy your application with `cf-push`, Grails will ask you whether you want to create and bind the relevant services based on which plug-ins you have installed.

### SQL services

Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application. All you need to access them is the [Hibernate plug-in](http://grails.org/plugin/hibernate), which is included by default in all new Grails applications. You also need to make sure that the relevant driver is available to your application, for example by declaring it in `BuildConfig.groovy`:

```groovy
  grails.project.dependency.resolution = {
      ...
      dependencies {
          runtime "mysql:mysql-connector-java:5.1.18"
          ...
      }
  }

```

and that the JDBC driver class is set in `DataSource.groovy`:

```groovy
  environments {
      production {
          dataSource {
              driverClassName = "com.mysql.jdbc.Driver"
              ...
          }
      }
  }
```

In this case, we're going to deploy the application for the standard production environment, but you could easily set up a 'cloud' or similar environment.
Also, you can easily configure the JDBC URL, username and password for the production environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.

### Redis

To use the key-value store [Redis](http://redis.io), you need to either install the [Redis plug-in](http://grails.org/plugin/redis) or [Redis for GORM](http://grails.org/plugin/redis-gorm). As with the SQL stores, when you deploy your application to Cloud Foundry it will automatically use whichever Redis service has been bound to it.

The former plug-in provides low-level access to Redis via a `redis` bean, while the latter allows you to map GORM domain classes to Redis. See the [plug-in documentation](http://grails.github.com/inconsequential/redis/manual/index.html) for more information.

### MongoDB

To use the document store [MongoDB](http://www.mongodb.org/), just install the [MongoDB plug-in](http://grails.org/plugin/mongodb).

The MongoDB plug-in for Grails allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for accessing the MongoDB driver for Java directly. Refer to the [plug-in documentation](http://grails.github.com/inconsequential/mongo/manual/index.html) for more information.

## How To

A general tutorial can be found in the blog post ["One-step deployment with Grails and Cloud Foundry"](http://blog.springsource.com/2011/04/12/one-step-deployment-with-grails-and-cloud-foundry/).

In fact, for a super fast start you can try one of our sample applications:

* [Pet Clinic](https://github.com/SpringSource/cloudfoundry-samples/tree/master/petclinic-grails) - Demonstrates how to use the SQL service
* [Grails Twitter](https://github.com/SpringSource/cloudfoundry-samples/tree/master/grailstwitter) - [running here](http://grailstwitter.cloudfoundry.com/) - Demonstrates how to use the MongoDB and Redis services

*WARNING* If you deploy any of these applications yourself, be sure to deploy them with a different application name.

## FAQ

See the [Cloud Foundry FAQ](http://www.cloudfoundry.com/faq) for general questions.

### Can I use the Spring Cloud Namespace from Grails?

Yes you can! See the documentation on [Spring](http://www.springsource.org/documentation) for examples on how to configure additional MySQL, Mongo or Redis instances via the Cloud namespace. This configuration can go into `grails-app/conf/spring/resources.xml` or `grails-app/conf/spring/resources.groovy` using the BeanBuilder DSL.

### How do I get access to Cloud environment variables?

The mechanism is the same for Spring and Grails. See the [Cloud Foundry Environment Variables](https://github.com/SpringSource/cloudfoundry-samples/wiki/Cloud-foundry-environment-variables) page for more information.

### Can I send email from my applications?

Yes, but not via SMTP as you can only send and receive HTTP or HTTPS requests. Instead, you can use an HTTP-based service such as [SendGrid](http://sendgrid.com/), [Amazon SES](http://aws.amazon.com/ses/), or [Mailgun](http://mailgun.net/). See the [support forum](http://support.cloudfoundry.com/entries/20023841) for more info.;T;
I"­%<p><a href="http://grails.org">Grails</a> is a framework for rapidly developing web applications that can be deployed to any Java servlet container, such as Tomcat. Based on the dynamic language <a href="http://groovy.codehaus.org/">Groovy</a> and the <a href="http://www.springframework.org/">Spring</a> framework, it brings the paradigm of Convention over Configuration to the Java platform with the expressiveness of a Java-like dynamic language.</p>

<p>This guide assumes that you already have Java and <a href="http://grails.org/Installation">Grails installed</a> and know how to build a simple Grails application. Thatâ€™s all you need to start working with Cloud Foundry.</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="grails-cloud-foundry-plug-in">Grails Cloud Foundry Plug-in</h2>

<p>Letâ€™s assume you have a standard Grails application using nothing more than a MySQL database and that you want to deploy this application to Cloud Foundry. The first step is to install the <a href="http://grails.org/plugin/cloud-foundry">Cloud Foundry plug-in</a>. This plug-in adds some commands to Grails that make it trivially easy to deploy and manage your application.</p>

<p>From within your Grails project, execute:</p>

<pre class="terminal">
$ grails install-plugin cloud-foundry
</pre>

<p>Once the plug-in is installed, you can use the following to see what Cloud Foundry commands are available:</p>

<pre class="terminal">
$ grails cf-help
</pre>

<p>Most of them are equivalents of the <a href="/tools/vmc/vmc-quick-ref.html">vmc tool</a> commands.</p>

<p>Next, you need to specify your username and password. The best place to put these is the ~/.grails/settings.groovy file:</p>

<pre><code class="language-java">    <span class="n">grails</span><span class="o">.</span><span class="na">plugin</span><span class="o">.</span><span class="na">cloudfoundry</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="s">"yourusername"</span>
    <span class="n">grails</span><span class="o">.</span><span class="na">plugin</span><span class="o">.</span><span class="na">cloudfoundry</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s">"yourpassword"</span></code></pre>

<p>Donâ€™t forget to make this file readable and writable only by you! Now youâ€™re ready to deploy your application:</p>

<pre class="terminal">
$ grails prod cf-push
</pre>

<p>This command will first ask you what URL to use. The default, based on the name of the application, is fine as long as the app name is unique on cloudfoundry.com. If itâ€™s not, then enter a unique name now rather than accepting the default.</p>

<p>The next question will ask whether you want to create and bind a MySQL service (which you do, so reply with â€˜yâ€™), and then whether you want to create and bind a PostgreSQL database (â€˜nâ€™ for this one, since the application is configured for MySQL). Afterwards, youâ€™ll see your application being deployed and started on cloudfoundry.com.</p>

<p>For further information on using the Cloud Foundry plug-in, refer to its <a href="http://grails-plugins.github.com/grails-cloud-foundry/">user guide</a>.</p>

<h2 id="services">Services</h2>

<p>Cloud Foundry provides a rich set of services, all of which can be used by Grails applications: MySQL, PostgreSQL, MongoDB, Redis, and RabbitMQ. Each of these services has a corresponding Grails plug-in. When these plug-ins are installed, you donâ€™t have to configure any connection settings for the associated Cloud Foundry service - itâ€™s done all automatically when your application is deployed. And when you first deploy your application with <code>cf-push</code>, Grails will ask you whether you want to create and bind the relevant services based on which plug-ins you have installed.</p>

<h3 id="sql-services">SQL services</h3>

<p>Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application. All you need to access them is the <a href="http://grails.org/plugin/hibernate">Hibernate plug-in</a>, which is included by default in all new Grails applications. You also need to make sure that the relevant driver is available to your application, for example by declaring it in <code>BuildConfig.groovy</code>:</p>

<pre><code class="language-java">  <span class="n">grails</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">dependency</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="o">{</span>
      <span class="o">...</span>
      <span class="n">dependencies</span> <span class="o">{</span>
          <span class="n">runtime</span> <span class="s">"mysql:mysql-connector-java:5.1.18"</span>
          <span class="o">...</span>
      <span class="o">}</span>
  <span class="o">}</span></code></pre>

<p>and that the JDBC driver class is set in <code>DataSource.groovy</code>:</p>

<pre><code class="language-java">  <span class="n">environments</span> <span class="o">{</span>
      <span class="n">production</span> <span class="o">{</span>
          <span class="n">dataSource</span> <span class="o">{</span>
              <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span>
              <span class="o">...</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span></code></pre>

<p>In this case, weâ€™re going to deploy the application for the standard production environment, but you could easily set up a â€˜cloudâ€™ or similar environment.
Also, you can easily configure the JDBC URL, username and password for the production environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.</p>

<h3 id="redis">Redis</h3>

<p>To use the key-value store <a href="http://redis.io">Redis</a>, you need to either install the <a href="http://grails.org/plugin/redis">Redis plug-in</a> or <a href="http://grails.org/plugin/redis-gorm">Redis for GORM</a>. As with the SQL stores, when you deploy your application to Cloud Foundry it will automatically use whichever Redis service has been bound to it.</p>

<p>The former plug-in provides low-level access to Redis via a <code>redis</code> bean, while the latter allows you to map GORM domain classes to Redis. See the <a href="http://grails.github.com/inconsequential/redis/manual/index.html">plug-in documentation</a> for more information.</p>

<h3 id="mongodb">MongoDB</h3>

<p>To use the document store <a href="http://www.mongodb.org/">MongoDB</a>, just install the <a href="http://grails.org/plugin/mongodb">MongoDB plug-in</a>.</p>

<p>The MongoDB plug-in for Grails allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for accessing the MongoDB driver for Java directly. Refer to the <a href="http://grails.github.com/inconsequential/mongo/manual/index.html">plug-in documentation</a> for more information.</p>

<h2 id="how-to">How To</h2>

<p>A general tutorial can be found in the blog post <a href="http://blog.springsource.com/2011/04/12/one-step-deployment-with-grails-and-cloud-foundry/">â€œOne-step deployment with Grails and Cloud Foundryâ€</a>.</p>

<p>In fact, for a super fast start you can try one of our sample applications:</p>

<ul>
<li>
<a href="https://github.com/SpringSource/cloudfoundry-samples/tree/master/petclinic-grails">Pet Clinic</a> - Demonstrates how to use the SQL service</li>
  <li>
<a href="https://github.com/SpringSource/cloudfoundry-samples/tree/master/grailstwitter">Grails Twitter</a> - <a href="http://grailstwitter.cloudfoundry.com/">running here</a> - Demonstrates how to use the MongoDB and Redis services</li>
</ul><p><em>WARNING</em> If you deploy any of these applications yourself, be sure to deploy them with a different application name.</p>

<h2 id="faq">FAQ</h2>

<p>See the <a href="http://www.cloudfoundry.com/faq">Cloud Foundry FAQ</a> for general questions.</p>

<h3 id="can-i-use-the-spring-cloud-namespace-from-grails">Can I use the Spring Cloud Namespace from Grails?</h3>

<p>Yes you can! See the documentation on <a href="http://www.springsource.org/documentation">Spring</a> for examples on how to configure additional MySQL, Mongo or Redis instances via the Cloud namespace. This configuration can go into <code>grails-app/conf/spring/resources.xml</code> or <code>grails-app/conf/spring/resources.groovy</code> using the BeanBuilder DSL.</p>

<h3 id="how-do-i-get-access-to-cloud-environment-variables">How do I get access to Cloud environment variables?</h3>

<p>The mechanism is the same for Spring and Grails. See the <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki/Cloud-foundry-environment-variables">Cloud Foundry Environment Variables</a> page for more information.</p>

<h3 id="can-i-send-email-from-my-applications">Can I send email from my applications?</h3>

<p>Yes, but not via SMTP as you can only send and receive HTTP or HTTPS requests. Instead, you can use an HTTP-based service such as <a href="http://sendgrid.com/">SendGrid</a>, <a href="http://aws.amazon.com/ses/">Amazon SES</a>, or <a href="http://mailgun.net/">Mailgun</a>. See the <a href="http://support.cloudfoundry.com/entries/20023841">support forum</a> for more info.</p>;T;@XI"$/frameworks/java/spring/spring/;T{;{	;I"ıl<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.</p>

<p>(If youâ€™re interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read <a href="/frameworks/java/spring/spring-insight.html">this</a>.)</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse</a></li>
  <li><a href="http://www.springsource.org/get-started">Getting Started With Spring</a></li>
</ul><h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</a></li>
  <li><a href="#using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</a></li>
  <li><a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a></li>
  <li><a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a></li>
  <li><a href="#sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</a></li>
  <li><a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a></li>
</ul><h2 id="programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</h2>

<p>In general, you do not have to do anything â€œspecialâ€ when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.</p>

<p>It is usually best to package your Spring application in a <code>*.war</code> file so that <code>vmc push</code> will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.</p>

<p>There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:</p>

<ul>
<li>
    <p>Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is <em>able</em> to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.</p>
  </li>
  <li>
    <p>Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the <code>root</code> context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the <code>*.war</code> file in which the application is packaged.</p>
  </li>
  <li>
    <p>HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.</p>
  </li>
  <li>
    <p>External users can access your application only via the URL provided by the <code>vmc push</code> command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.</p>
  </li>
</ul><h2 id="using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</h2>

<p>If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry <em>without changing a single line of code</em>.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See <a href="#determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</a> for details.</p>

<p>If your Spring application cannot take advantage of Cloud Foundryâ€™s auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</p>

<h2 id="determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</h2>

<p>You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small <a href="#limitations-of-auto-reconfiguration">set of limitations</a>, Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.</p>

<p>With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single <code>javax.sql.DataSource</code> bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesnâ€™t use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesnâ€™t really care what the specific properties are that created the database.</p>

<p>The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.</p>

<h2 id="relational-database-mysql-and-vfabric-postgres">Relational Database (MySQL and vFabric Postgres)</h2>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>javax.sql.DataSource</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">id=</span><span class="s">"dataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:mem:"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"sa"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.</p>

<p>Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.</p>

<h2 id="mongodb">MongoDB</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.document.mongodb.MongoDbFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;mongo:db-factory</span>
    <span class="na">id=</span><span class="s">"mongoDbFactory"</span>
    <span class="na">dbname=</span><span class="s">"pwdtest"</span>
    <span class="na">host=</span><span class="s">"127.0.0.1"</span>
    <span class="na">port=</span><span class="s">"1234"</span>
    <span class="na">username=</span><span class="s">"test_user"</span>
    <span class="na">password=</span><span class="s">"test_pass"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>SimpleMOngoDbFactory</code> with its own values for the following properties:  host, port, username, password, dbname.</p>

<h2 id="redis">Redis</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/redis">Spring Data Redis</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.redis.connection.RedisConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redis"</span>
      <span class="na">class=</span><span class="s">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>
      <span class="na">p:hostName=</span><span class="s">"localhost"</span> <span class="na">p:port=</span><span class="s">"6379"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>JedisConnectionFactory</code> with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.</p>

<h2 id="rabbitmq">RabbitMQ</h2>

<p>You must be using <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.amqp.rabbit.connection.ConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;rabbit:connection-factory</span>
    <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span>
    <span class="na">host=</span><span class="s">"localhost"</span>
    <span class="na">password=</span><span class="s">"testpwd"</span>
    <span class="na">port=</span><span class="s">"1238"</span>
    <span class="na">username=</span><span class="s">"testuser"</span>
    <span class="na">virtual-host=</span><span class="s">"virthost"</span> <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>org.springframework.amqp.rabbit.connection.CachingConnectionFactory</code> with its own values for the following properties:  host, virtual-host, port, username, password.</p>

<h2 id="limitations-of-auto-reconfiguration">Limitations of Auto-Reconfiguration</h2>

<p>Cloud Foundry auto-reconfigures applications only if the following items are true for your application:</p>

<ul>
<li>You bind only <em>one</em> service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will <em>not</em> occur.</li>
  <li>You include only <em>one</em> bean of a matching type in your Spring application context file.  For example, you can have only one bean of type <code>javax.sql.DataSource</code>.</li>
</ul><p>Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.</p>

<h2 id="opting-out-of-auto-reconfiguration">Opting Out of Auto-Reconfiguration</h2>

<p>Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:</p>

<ul>
<li>When you deploy your application using VMC or STS, specify that the framework is <code>JavaWeb</code> instead of <code>Spring</code>.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.</li>
  <li>Use the <code>&lt;cloud:&gt;</code> namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</li>
</ul><h2 id="explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</h2>

<p>This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See <a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a> for the complete list of supported Cloud Foundry services.</p>

<p>The easiest way to use Cloud Foundry services in your Spring applications is to declare the <code>&lt;cloud:&gt;</code> namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the <code>&lt;cloud&gt;</code> namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the <code>&lt;cloud:&gt;</code> namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.</p>

<p>The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:</p>

<ul>
<li>Update your application build process to include a dependency on the <code>org.cloudfoundry.cloudfoundry-runtime</code> artifact.  For example, if you use Maven to build your application, the following <code>pom.xml</code> snippet shows how to add this dependency:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- additional dependency declarations --&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>

<ul>
<li>Update your application build process to include the Spring Framework Milestone repository.  The following <code>pom.xml</code> snippet shows how to do this in Maven:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
           <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
           <span class="nt">&lt;snapshots&gt;</span>
                   <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
           <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

    <span class="c">&lt;!-- additional repository declarations --&gt;</span>
<span class="nt">&lt;/repositories&gt;</span></code></pre>

<ul>
<li>In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the <code>&lt;cloud:&gt;</code> namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
        <span class="err">http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
        <span class="err">http://www.springframework.org/schema/context</span>
        <span class="err">http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
        <span class="err">http://schema.cloudfoundry.org/spring</span>
        <span class="err">http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
        <span class="nt">&gt;</span>

    <span class="c">&lt;!-- bean declarations --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<ul>
<li>
    <p>You can now specify the Cloud Foundry services in the Spring application context file by using the <code>&lt;cloud:&gt;</code> namespace along with the name of specific elements, such as <code>data-source</code>.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.</p>

    <p>The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the <code>&lt;cloud:data-source&gt;</code> element.</p>
  </li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">        http://www.springframework.org/schema/context</span>
<span class="s">        http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
<span class="s">        http://schema.cloudfoundry.org/spring</span>
<span class="s">        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">        &gt;</span>

<span class="s">    &lt;cloud:data-source id="</span><span class="err">dataSource"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

        <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as <code>driverClassName</code> or <code>url</code> or <code>username</code> - this is because Cloud Foundry automatically takes care of those properties for you.</p>

<p>For complete information about all the <code>&lt;cloud:&gt;</code> elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:</p>

<ul>
<li><a href="#clouddata-source">&lt;cloud:data-source&gt;: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases</a></li>
  <li><a href="#cloudmongo-db-factory">&lt;cloud:mongo-db-factory&gt;: Configure a MongoDB Connection Factory</a></li>
  <li><a href="#cloudredis-connection-factory">&lt;cloud:redis-connection-factory&gt;: Configure a Redis Connection Factory</a></li>
  <li><a href="#cloudrabbit-connection-factory">&lt;cloud:rabbit-connection-factory&gt;: Configure a RabbitMQ Connection Factory</a></li>
  <li><a href="#cloudservice-scan">&lt;cloud:service-scan&gt; Injecting Services Into @Autowired Beans </a></li>
  <li>
    <p><a href="#cloudproperties">&lt;cloud:properties&gt; Get Cloud Foundry Service Information</a></p>
  </li>
  <li>After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</li>
</ul><h2 id="clouddata-source">&lt;cloud:data-source&gt;</h2>

<p>The <code>&lt;cloud:data-source&gt;</code> element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.</p>

<p>The following example shows a simple way to configure a JDBC data source that will be injected into a <code>org.springframework.jdbc.core.JdbcTemplate</code> bean:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:data-source&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Data Source Configuration</strong></p>

<p>The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of <code>&lt;cloud:data-source&gt;</code>:  <code>&lt;cloud:connection&gt;</code> and <code>&lt;cloud:pool&gt;</code>.</p>

<p>The <code>&lt;cloud:connection&gt;</code> child element takes a single String attribute (<code>properties</code>) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (<code>[propertyName=property;]</code>).</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced data source configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"mydatasource"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:connection</span> <span class="na">properties=</span><span class="s">"charset=utf-8"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:data-source&gt;</span></code></pre>

<p>In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.</p>

<h2 id="cloudmongo-db-factory-">&lt;cloud:mongo-db-factory &gt;</h2>

<p>The <code>&lt;cloud:mongo-db-factory&gt;</code> provides a simple way for you to configure a MongoDB connection factory for your Spring application.</p>

<p>The following example shows a MongoDbFactory configuration that will be injected into a <code>org.springframework.data.mongodb.core.MongoTemplate</code> object:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:mongo-db-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
<li>
<b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li>
<b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li>
<b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li>
<b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
</td>
   <td>String</td>
 </tr>
</table><h2 id="advanced-mongodb-configuration">Advanced MongoDB Configuration</h2>

<p>The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional <code>&lt;cloud:mongo-options&gt;</code> child element of <code>&lt;cloud:mongo-db-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:mongo-options&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table><p>The following example shows how to use the advanced MongoDB options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">write-concern=</span><span class="s">"FSYNC_SAFE"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:mongo-options</span> <span class="na">connections-per-host=</span><span class="s">"12"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:mongo-db-factory&gt;</span></code></pre>

<p>In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (<code>FSYNC_SAFE</code>).</p>

<h2 id="cloudredis-connection-factory-">&lt;cloud:redis-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:redis-connection-factory&gt;</code> provides a simple way for you to configure a Redis connection factory for your Spring application.</p>

<p>The following example shows a <code>RedisConnectionFactory</code> configuration that will be injected into a <code>org.springframework.data.redis.core.StringRedisTemplate</code> object:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"redisConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redisTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.redis.core.StringRedisTemplate"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection-factory"</span> <span class="na">ref=</span><span class="s">"redisConnectionFactory"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:redis-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Redis Configuration</strong></p>

<p>The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:pool&gt;</code> child element of <code>&lt;cloud:redis-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced Redis configuration options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"myRedisConnectionFactory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:redis-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.</p>

<h2 id="cloudrabbit-connection-factory-">&lt;cloud:rabbit-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:rabbit-connection-factory&gt;</code> provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.</p>

<p>The following complete example of a Spring application contenxt file shows a <code>RabbitConnectionFactory</code> configuration that will be injected into a <code>rabbitTemplate</code> object.  The example also uses the <code>&lt;rabbit:&gt;</code> namespace to perform RabbitMQ-specific configurations, as explained after the example:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">"rabbitTemplate"</span>
        <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the preceding example, note the definition and location of the <code>&lt;rabbit:&gt;</code> namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called <code>messages</code> within the RabbitMQ broker.</p>

<p>See <a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a> for additional information about using RabbitMQ in your Spring applications.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:rabbit-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced RabbitMQ Configuration</strong></p>

<p>The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:rabbit-options&gt;</code> child element of <code>&lt;cloud:rabbit-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:rabbit-options&gt;</code> child element defines one attribute called <code>channel-cache-size</code> which you can set to specify the size of the channel cache size.  The default value is 1.</p>

<p>The following example shows how to use these advanced RabbitMQ configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:rabbit-options</span> <span class="na">channel-cache-size=</span><span class="s">"10"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:rabbit-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.</p>

<h2 id="cloudservice-scan">&lt;cloud:service-scan&gt;</h2>

<p>The <code>&lt;cloud:service-scan&gt;</code> element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the <code>@org.springframework.beans.factory.annotation.Autowired</code> annotation.  The <code>&lt;cloud:service-scan&gt;</code> element acts as a cloud equivalent of <code>&lt;context:component-scan&gt;</code> in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a <code>&lt;cloud:&gt;</code> element to your Spring application context file for each new service that you bind.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> element has no attributes or child elements; for example:</p>

<pre><code class="language-xml">         <span class="nt">&lt;cloud:service-scan</span> <span class="nt">/&gt;</span></code></pre>

<p>In your Java code, you must annotate each dependency with <code>@Autowired</code> so that a bean of the corresponding service is automatically created.  For example:</p>

<pre><code class="language-java">  <span class="kn">package</span> <span class="n">cf</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

  <span class="o">....</span>

  <span class="nd">@Autowired</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">ConnectionFactory</span> <span class="n">rabbitConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">MongoDbFactory</span> <span class="n">mongoDbFactory</span><span class="o">;</span>

  <span class="o">...</span></code></pre>

<p>Use of only the <code>@Autowired</code> annotation is adequate if you have bound only <em>one</em> service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the <code>@Qualifier</code> annotation to match the Spring bean with the specific service instance.</p>

<p>For example, assume you bound two MySQL services (named <code>inventory-db</code> and <code>pricing-db</code>) to your application; use the <code>@Qualifier</code> annotation as shown in the following example to specify which service instance applies to which Spring bean:</p>

<pre><code class="language-java">  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"inventory-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">inventoryDataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"pricing-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">pricingDataSource</span><span class="o">;</span></code></pre>

<h2 id="cloudproperties">&lt;cloud:properties&gt;</h2>

<p>The <code>&lt;cloud:properties&gt;</code> element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.</p>

<p>The <code>&lt;cloud:properties&gt;</code> element has just a single attribute (<code>id</code>) which specifies the name of the Properties bean.  Use this ID as a reference to <code>&lt;context:property-placeholder&gt;</code> which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.</p>

<p>Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include <code>&lt;cloud:properties&gt;</code> in your application context file.</p>

<p>The following example shows how to use this element in your Spring application context file:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:properties</span> <span class="na">id=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;context:property-placeholder</span> <span class="na">properties-ref=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span>
                  <span class="na">value=</span><span class="s">"${cloud.services.mysql.connection.username}"</span> <span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, <code>cloud.services.mysql.connection.username</code> is one of the properties exposed by Cloud Foundry.</p>

<p>For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see <a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a>.</p>

<h2 id="rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</h2>

<p>This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:</p>

<ul>
<li>
<a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a>, cover the basics of creating messaging in your applications.</li>
  <li>
<a href="http://www.rabbitmq.com/download.html">Download</a>, <a href="http://www.rabbitmq.com/install.html">install</a> and <a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ</li>
  <li><a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMPQ reference documentation</a></li>
</ul><p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP protocol</a> (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.</p>

<p>The following sample <code>pom.xml</code> file shows RabbitMQ dependencies and repositories in addition to the <code>cloudfoundry-runtime</code> dependency described above:</p>

<pre><code class="language-xml">    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
              <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                       <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span></code></pre>

<p>Then update your application controller/logic as follows:</p>

<ul>
<li>Include the messaging libraries:</li>
</ul><pre><code class="language-java">   <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
   <span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span></code></pre>

<ul>
<li>Read and write messages as shown in the following Java code snippets:</li>
</ul><pre><code class="language-java">   <span class="nd">@Controller</span>
   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
       <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
           <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Send a message to the "messages" queue</span>
           <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Receive a message from the "messages" queue</span>
           <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
           <span class="k">else</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
   <span class="o">}</span></code></pre>

<h2 id="using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</h2>

<p>The preceding sections describe how to use the <code>&lt;cloud:&gt;</code> namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to <em>conditionalize</em> the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring <em>profiles</em> feature, available in Spring Framework 3.1 or later.</p>

<p>The basic idea is that you group the configuration for a specific environment using the <code>profile</code> attribute of a nested <code>&lt;beans&gt;</code> element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are <code>default</code> and <code>cloud</code>.</p>

<p>When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the <code>cloud</code> profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the <code>&lt;cloud:&gt;</code> namespace within the <code>cloud</code> profile block to allow the application to run outside of Cloud Foundry environments.  You then use the <code>default</code> profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.</p>

<p>Here is an example of a Spring <code>MongoTemplate</code> being populated from two alternately configured connection factories. When running on Cloud Foundry (<code>cloud</code> profile), the connection factory is automatically configured. When not running on Cloud Foundry (<code>default</code> profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
        <span class="na">xmlns:jdbc=</span><span class="s">"http://www.springframework.org/schema/jdbc"</span>
        <span class="na">xmlns:util=</span><span class="s">"http://www.springframework.org/schema/util"</span>
        <span class="na">xmlns:mongo=</span><span class="s">"http://www.springframework.org/schema/data/mongo"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/data/mongo</span>
<span class="s">          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd</span>
<span class="s">          http://www.springframework.org/schema/jdbc</span>
<span class="s">          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd</span>
<span class="s">          http://schema.cloudfoundry.org/spring</span>
<span class="s">          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">          http://www.springframework.org/schema/beans</span>
<span class="s">          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">          http://www.springframework.org/schema/util</span>
<span class="s">          http://www.springframework.org/schema/util/spring-util-3.1.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"default"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;mongo:db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">dbname=</span><span class="s">"pwdtest"</span> <span class="na">host=</span><span class="s">"127.0.0.1"</span> <span class="na">port=</span><span class="s">"27017"</span> <span class="na">username=</span><span class="s">"test_user"</span> <span class="na">password=</span><span class="s">"efgh"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Note that the <code>&lt;beans profile="value"&gt;</code> element is nested inside the standard root <code>&lt;beans&gt;</code> element.  The MongoDB connection factory in the <code>cloud</code> profile uses the <code>&lt;cloud:&gt;</code> namespace, the connection factory configuration in the <code>default</code> profile uses the <code>&lt;mongo:&gt;</code> namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.</p>

<p>See the <a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">SpringSource Blog</a> for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.</p>

<h2 id="sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</h2>

<p>In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.</p>

<p>Service providers, such as <a href="http://sendgrid.com">SendGrid</a>, can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Spring Profiles</a> to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.</p>

<p>The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the <code>cloud</code> profile:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>

    <span class="err">...</span>

    <span class="err">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">"mailSender"</span> <span class="na">class=</span><span class="s">"example.SendGridMailSender"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiUser"</span> <span class="na">value=</span><span class="s">"youremail@domain.com"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiKey"</span> <span class="na">value=</span><span class="s">"secureSecret"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/beans&gt;</span>

   ...

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the example, <code>example.SendGridMailSender</code> is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.</p>

<h2 id="accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</h2>

<p>Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.</p>

<p>Service properties generally take one of the following forms:</p>

<pre><code>    cloud.services.{service-name}.connection.{property}
    cloud.services.{service-name}.{property}
</code></pre>

<p>where <code>{service-name}</code> refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.</p>

<p>For example, assume that in VMC you created a vFabric Postgres service called <code>my-postgres</code> and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:</p>

<pre><code>    cloud.services.my-postgres.connection.host
    cloud.services.my-postgres.connection.hostname
    cloud.services.my-postgres.connection.name
    cloud.services.my-postgres.connection.password
    cloud.services.my-postgres.connection.port
    cloud.services.my-postgres.connection.user
    cloud.services.my-postgres.connection.username
    cloud.services.my-postgres.plan
    cloud.services.my-postgres.type
</code></pre>

<p>For convenience, if you have bound just <em>one</em> service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form <code>cloud.services.mysql.connection.{property}</code>.   Cloud Foundry uses the following aliases in this case:</p>

<ul>
<li><code>mysql</code></li>
  <li><code>mongodb</code></li>
  <li><code>postgresql</code></li>
  <li><code>rabbitmq</code></li>
  <li><code>redis</code></li>
</ul><p>If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a <code>cloud</code> profile; Spring profiles are briefly described in <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a>.</p>

<p>For example, assume that you have bound a MySQL service called <code>spring-mysql</code> to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"c3p0DataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span>
                <span class="na">value=</span><span class="s">"jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.username}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.password}"</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, <code>{service-name}</code> refers to the actual name of the bound service.</p>

<table class="std">
<tr>
<th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
<tr>
<td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
<tr>
<td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr></tt>
</td>
</tr></tt>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"HâThis section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.

(If you're interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read [this](/frameworks/java/spring/spring-insight.html).)

(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: [https://github.com/SpringSource/cloudfoundry-samples/wiki](https://github.com/SpringSource/cloudfoundry-samples/wiki) )

## Prerequisites

It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:

+ [Installing the Command-Line Utility (VMC)](/tools/vmc/installing-vmc.html)
+ [Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse](/tools/STS/configuring-STS.html)
+ [Getting Started With Spring](http://www.springsource.org/get-started)

## Subtopics

+ [Programming and Packaging Spring Applications](#programming-and-packaging-spring-applications)
+ [Using Cloud Foundry Services In Spring Applications](#using-cloud-foundry-services-in-spring-applications)
+ [RabbitMQ And Spring: Additional Programming Information](#rabbitmq-and-spring-additional-programming-information)
+ [Using Spring Profiles to Conditionalize Cloud Foundry Configuration](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration)
+ [Sending Email From Spring Applications Deployed to Cloud Foundry](#sending-email-from-spring-applications-deployed-to-cloud-foundry)
+ [Accessing Cloud Foundry Properties](#accessing-cloud-foundry-properties)

## Programming and Packaging Spring Applications

In general, you do not have to do anything "special" when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.

It is usually best to package your Spring application in a `*.war` file so that `vmc push` will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.

There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:

+  Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is *able* to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.

+ Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the `root` context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the `*.war` file in which the application is packaged.

+ HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.

+ External users can access your application only via the URL provided by the `vmc push` command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.

## Using Cloud Foundry Services In Spring Applications

If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry *without changing a single line of code*.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See [Determining Whether Your Application Can Be Auto-Configured](#determining-whether-your-application-can-be-auto-configured) for details.

If your Spring application cannot take advantage of Cloud Foundry's auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See [Explicitly Configuring Your Application to Use Cloud Foundry Services](#explicitly-configuring-your-application-to-use-cloud-foundry-services).

## Determining Whether Your Application Can Be Auto-Configured

You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small [set of limitations](#limitations-of-auto-reconfiguration), Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.

With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single `javax.sql.DataSource` bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesn't use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesn't really care what the specific properties are that created the database.

The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.

## Relational Database (MySQL and vFabric Postgres)

Auto-reconfiguration occurs if Cloud Foundry detects a `javax.sql.DataSource` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<bean class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close" id="dataSource">
    <property name="driverClassName" value="org.h2.Driver" />
    <property name="url" value="jdbc:h2:mem:" />
    <property name="username" value="sa" />
    <property name="password" value="" />
</bean>
```

The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.

Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.

## MongoDB

You must be using [Spring Data MongoDB](http://www.springsource.org/spring-data/mongodb) 1.0 M4 or later for auto-reconfiguration to work.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.data.document.mongodb.MongoDbFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<mongo:db-factory
    id="mongoDbFactory"
    dbname="pwdtest"
    host="127.0.0.1"
    port="1234"
    username="test_user"
    password="test_pass"  />
```

Cloud Foundry will create a `SimpleMOngoDbFactory` with its own values for the following properties:  host, port, username, password, dbname.

## Redis

You must be using [Spring Data Redis](http://www.springsource.org/spring-data/redis) 1.0 M4 or later for auto-reconfiguration to work.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.data.redis.connection.RedisConnectionFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<bean id="redis"
      class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"
      p:hostName="localhost" p:port="6379"  />
```
Cloud Foundry will create a `JedisConnectionFactory` with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.

## RabbitMQ

You must be using [Spring AMQP](http://www.springsource.org/spring-amqp) 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.amqp.rabbit.connection.ConnectionFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<rabbit:connection-factory
    id="rabbitConnectionFactory"
    host="localhost"
    password="testpwd"
    port="1238"
    username="testuser"
    virtual-host="virthost" />
```

Cloud Foundry will create a `org.springframework.amqp.rabbit.connection.CachingConnectionFactory` with its own values for the following properties:  host, virtual-host, port, username, password.

## Limitations of Auto-Reconfiguration

Cloud Foundry auto-reconfigures applications only if the following items are true for your application:

+ You bind only *one* service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will *not* occur.
+ You include only *one* bean of a matching type in your Spring application context file.  For example, you can have only one bean of type `javax.sql.DataSource`.

Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.

## Opting Out of Auto-Reconfiguration

Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:

+ When you deploy your application using VMC or STS, specify that the framework is `JavaWeb` instead of `Spring`.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.
+ Use the `<cloud:>` namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See [Explicitly Configuring Your Application to Use Cloud Foundry Services](#explicitly-configuring-your-application-to-use-cloud-foundry-services).

## Explicitly Configuring Your Application to Use Cloud Foundry Services

This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See [Configuring Applications to Use Cloud Foundry](/frameworks.html) for the complete list of supported Cloud Foundry services.

The easiest way to use Cloud Foundry services in your Spring applications is to declare the `<cloud:>` namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the `<cloud>` namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the `<cloud:>` namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.

The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:

* Update your application build process to include a dependency on the `org.cloudfoundry.cloudfoundry-runtime` artifact.  For example, if you use Maven to build your application, the following `pom.xml` snippet shows how to add this dependency:

```xml
<dependencies>
    <dependency>
        <groupId>org.cloudfoundry</groupId>
        <artifactId>cloudfoundry-runtime</artifactId>
        <version>0.8.1</version>
    </dependency>

    <!-- additional dependency declarations -->
</dependencies>
```

*  Update your application build process to include the Spring Framework Milestone repository.  The following `pom.xml` snippet shows how to do this in Maven:

```xml
<repositories>
    <repository>
          <id>org.springframework.maven.milestone</id>
           <name>Spring Maven Milestone Repository</name>
           <url>http://maven.springframework.org/milestone</url>
           <snapshots>
                   <enabled>false</enabled>
           </snapshots>
    </repository>

    <!-- additional repository declarations -->
</repositories>
```

*  In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the `<cloud:>` namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:

```xml

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:cloud="http://schema.cloudfoundry.org/spring"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.1.xsd
        http://schema.cloudfoundry.org/spring
        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
        >

    <!-- bean declarations -->

</beans>
```

*  You can now specify the Cloud Foundry services in the Spring application context file by using the `<cloud:>` namespace along with the name of specific elements, such as `data-source`.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.

    The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the `<cloud:data-source>` element.

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:cloud="http://schema.cloudfoundry.org/spring"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.1.xsd
        http://schema.cloudfoundry.org/spring
        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
        >

    <cloud:data-source id="dataSource" />

    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
      <property name="dataSource" ref="dataSource" />
    </bean>

        <!-- additional beans in your application -->

</beans>
```

When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as `driverClassName` or `url` or `username` - this is because Cloud Foundry automatically takes care of those properties for you.

For complete information about all the `<cloud:>` elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:

+ [\<cloud:data-source\>: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases](#clouddata-source)
+ [\<cloud:mongo-db-factory\>: Configure a MongoDB Connection Factory](#cloudmongo-db-factory)
+ [\<cloud:redis-connection-factory\>: Configure a Redis Connection Factory](#cloudredis-connection-factory)
+ [\<cloud:rabbit-connection-factory\>: Configure a RabbitMQ Connection Factory](#cloudrabbit-connection-factory)
+ [\<cloud:service-scan\> Injecting Services Into @Autowired Beans ](#cloudservice-scan)
+ [\<cloud:properties\> Get Cloud Foundry Service Information](#cloudproperties)

* After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See [Deploying Applications](/tools/deploying-apps.html) for details on how to use these tools.

## \<cloud:data-source\>

The `<cloud:data-source>` element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.

The following example shows a simple way to configure a JDBC data source that will be injected into a `org.springframework.jdbc.core.JdbcTemplate` bean:

```xml
<cloud:data-source id="dataSource" />

<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
  <property name="dataSource" ref="dataSource" />
</bean>
```
In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.

**Attributes**

The following table lists the attributes of the `<cloud:data-source>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced Data Source Configuration**

The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of `<cloud:data-source>`:  `<cloud:connection>` and `<cloud:pool>`.

The `<cloud:connection>` child element takes a single String attribute (`properties`) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (`[propertyName=property;]`).

The `<cloud:pool>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table>

The following example shows how to use these advanced data source configuration options:

```xml
        <cloud:data-source id="mydatasource">
            <cloud:connection properties="charset=utf-8" />
            <cloud:pool pool-size="5-10" max-wait-time="2000" />
        </cloud:data-source>
```
In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.

## \<cloud:mongo-db-factory \>

The `<cloud:mongo-db-factory>` provides a simple way for you to configure a MongoDB connection factory for your Spring application.

The following example shows a MongoDbFactory configuration that will be injected into a `org.springframework.data.mongodb.core.MongoTemplate` object:

```xml
<cloud:mongo-db-factory id="mongoDbFactory" />

<bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
    <constructor-arg ref="mongoDbFactory"/>
</bean>
```

**Attributes**

The following table lists the attributes of the `<cloud:mongo-db-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
	  <li><b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li><b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li><b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li><b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
    </td>
   <td>String</td>
 </tr>
</table>

## Advanced MongoDB Configuration

The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional `<cloud:mongo-options>` child element of `<cloud:mongo-db-factory>`.

The `<cloud:mongo-options>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table>

The following example shows how to use the advanced MongoDB options:

```xml
    <cloud:mongo-db-factory id="mongoDbFactory" write-concern="FSYNC_SAFE">
        <cloud:mongo-options connections-per-host="12" max-wait-time="2000" />
    </cloud:mongo-db-factory>
```

In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (`FSYNC_SAFE`).

## \<cloud:redis-connection-factory \>

The `<cloud:redis-connection-factory>` provides a simple way for you to configure a Redis connection factory for your Spring application.

The following example shows a `RedisConnectionFactory` configuration that will be injected into a `org.springframework.data.redis.core.StringRedisTemplate` object:

``` xml
    <cloud:redis-connection-factory id="redisConnectionFactory" />

    <bean id="redisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate">
        <property name="connection-factory" ref="redisConnectionFactory"/>
    </bean>
```

**Attributes**

The following table lists the attributes of the `<cloud:redis-connection-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced Redis Configuration**

The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the`<cloud:pool>` child element of `<cloud:redis-connection-factory>`.

The `<cloud:pool>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table>

The following example shows how to use these advanced Redis configuration options:

``` xml
    <cloud:redis-connection-factory id="myRedisConnectionFactory">
        <cloud:pool pool-size="5-10" max-wait-time="2000" />
    </cloud:redis-connection-factory>
```

In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.

## \<cloud:rabbit-connection-factory \>

The `<cloud:rabbit-connection-factory>` provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.

The following complete example of a Spring application contenxt file shows a `RabbitConnectionFactory` configuration that will be injected into a `rabbitTemplate` object.  The example also uses the `<rabbit:>` namespace to perform RabbitMQ-specific configurations, as explained after the example:

``` xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:cloud="http://schema.cloudfoundry.org/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd
           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd">

    <!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: -->
    <cloud:rabbit-connection-factory id="rabbitConnectionFactory" />

    <!-- Set up the AmqpTemplate/RabbitTemplate: -->
    <rabbit:template id="rabbitTemplate"
        connection-factory="rabbitConnectionFactory" />

    <!-- Request that queues, exchanges and bindings be automatically declared on the broker: -->
    <rabbit:admin connection-factory="rabbitConnectionFactory"/>

    <!-- Declare the "messages" queue: -->
    <rabbit:queue name="messages" durable="true"/>

    <!-- additional beans in your application -->

</beans>
```

In the preceding example, note the definition and location of the `<rabbit:>` namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called `messages` within the RabbitMQ broker.

See [RabbitMQ And Spring: Additional Programming Information](#rabbitmq-and-spring-additional-programming-information) for additional information about using RabbitMQ in your Spring applications.

**Attributes**

The following table lists the attributes of the `<cloud:rabbit-connection-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced RabbitMQ Configuration**

The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the`<cloud:rabbit-options>` child element of `<cloud:rabbit-connection-factory>`.

The `<cloud:rabbit-options>` child element defines one attribute called `channel-cache-size` which you can set to specify the size of the channel cache size.  The default value is 1.

The following example shows how to use these advanced RabbitMQ configuration options:

``` xml
        <cloud:rabbit-connection-factory id="rabbitConnectionFactory" >
            <cloud:rabbit-options channel-cache-size="10" />
        </cloud:rabbit-connection-factory>
```

In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.

## \<cloud:service-scan\>

The `<cloud:service-scan>` element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the `@org.springframework.beans.factory.annotation.Autowired` annotation.  The `<cloud:service-scan>` element acts as a cloud equivalent of `<context:component-scan>` in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.

The `<cloud:service-scan>` is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a `<cloud:>` element to your Spring application context file for each new service that you bind.

The `<cloud:service-scan>` element has no attributes or child elements; for example:

``` xml
         <cloud:service-scan />
```

In your Java code, you must annotate each dependency with `@Autowired` so that a bean of the corresponding service is automatically created.  For example:

``` java
  package cf.examples;

  import org.springframework.beans.factory.annotation.Autowired;

  ....

  @Autowired DataSource dataSource;
  @Autowired ConnectionFactory rabbitConnectionFactory;
  @Autowired RedisConnectionFactory redisConnectionFactory;
  @Autowired MongoDbFactory mongoDbFactory;

  ...
```

Use of only the `@Autowired` annotation is adequate if you have bound only *one* service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the `@Qualifier` annotation to match the Spring bean with the specific service instance.

For example, assume you bound two MySQL services (named `inventory-db` and `pricing-db`) to your application; use the `@Qualifier` annotation as shown in the following example to specify which service instance applies to which Spring bean:

``` java
  @Autowired @Qualifier("inventory-db") DataSource inventoryDataSource;
  @Autowired @Qualifier("pricing-db") DataSource pricingDataSource;
```

## \<cloud:properties\>

The `<cloud:properties>` element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.

The `<cloud:properties>` element has just a single attribute (`id`) which specifies the name of the Properties bean.  Use this ID as a reference to `<context:property-placeholder>` which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.

Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include `<cloud:properties>` in your application context file.

The following example shows how to use this element in your Spring application context file:

``` xml
    <cloud:properties id="cloudProperties" />

    <context:property-placeholder properties-ref="cloudProperties" />

    <bean class="com.mchange.v2.c3p0.ComboPooledDataSource">
        <property name="user"
                  value="${cloud.services.mysql.connection.username}" />
    ...
    </bean>
```

In the preceding example, `cloud.services.mysql.connection.username` is one of the properties exposed by Cloud Foundry.

For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see [Accessing Cloud Foundry Properties](#accessing-cloud-foundry-properties).

## RabbitMQ And Spring: Additional Programming Information

This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:

+	[RabbitMQ Tutorials](http://www.rabbitmq.com/getstarted.html), cover the basics of creating messaging in your applications.
+	[Download](http://www.rabbitmq.com/download.html), [install](http://www.rabbitmq.com/install.html) and [configure](http://www.rabbitmq.com/configure.html) RabbitMQ
+       [Spring AMPQ reference documentation](http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/)

The RabbitMQ service is accessed through the [AMQP protocol](http://www.amqp.org/) (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.

The following sample `pom.xml` file shows RabbitMQ dependencies and repositories in addition to the `cloudfoundry-runtime` dependency described above:

```xml
    <repositories>
        <repository>
              <id>org.springframework.maven.milestone</id>
               <name>Spring Maven Milestone Repository</name>
               <url>http://maven.springframework.org/milestone</url>
               <snapshots>
                       <enabled>false</enabled>
               </snapshots>
        </repository>
    </repositories>

    <dependency>
        <groupId>cglib</groupId>
        <artifactId>cglib-nodep</artifactId>
        <version>2.2</version>
    </dependency>

    <dependency>
        <groupId>org.springframework.amqp</groupId>
        <artifactId>spring-rabbit</artifactId>
        <version>1.0.0.RC2</version>
    </dependency>

    <dependency>
        <groupId>org.cloudfoundry</groupId>
        <artifactId>cloudfoundry-runtime</artifactId>
        <version>0.7.1</version>
    </dependency>
```

Then update your application controller/logic as follows:

* Include the messaging libraries:

```java
   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.amqp.core.AmqpTemplate;
```

* Read and write messages as shown in the following Java code snippets:

``` java
   @Controller
   public class HomeController {
       @Autowired AmqpTemplate amqpTemplate;

       @RequestMapping(value = "/")
       public String home(Model model) {
           model.addAttribute(new Message());
           return "WEB-INF/views/home.jsp";
       }

       @RequestMapping(value = "/publish", method=RequestMethod.POST)
       public String publish(Model model, Message message) {
           // Send a message to the "messages" queue
           amqpTemplate.convertAndSend("messages", message.getValue());
           model.addAttribute("published", true);
           return home(model);
       }

       @RequestMapping(value = "/get", method=RequestMethod.POST)
       public String get(Model model) {
           // Receive a message from the "messages" queue
           String message = (String)amqpTemplate.receiveAndConvert("messages");
           if (message != null)
               model.addAttribute("got", message);
           else
               model.addAttribute("got_queue_empty", true);

           return home(model);
   }
```

## Using Spring Profiles to Conditionalize Cloud Foundry Configuration

The preceding sections describe how to use the `<cloud:>` namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to *conditionalize* the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring *profiles* feature, available in Spring Framework 3.1 or later.

The basic idea is that you group the configuration for a specific environment using the `profile` attribute of a nested `<beans>` element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are `default` and `cloud`.

When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the `cloud` profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the `<cloud:>` namespace within the `cloud` profile block to allow the application to run outside of Cloud Foundry environments.  You then use the `default` profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.

Here is an example of a Spring `MongoTemplate` being populated from two alternately configured connection factories. When running on Cloud Foundry (`cloud` profile), the connection factory is automatically configured. When not running on Cloud Foundry (`default` profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:cloud="http://schema.cloudfoundry.org/spring"
        xmlns:jdbc="http://www.springframework.org/schema/jdbc"
        xmlns:util="http://www.springframework.org/schema/util"
        xmlns:mongo="http://www.springframework.org/schema/data/mongo"
        xsi:schemaLocation="http://www.springframework.org/schema/data/mongo
          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
          http://www.springframework.org/schema/jdbc
          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd
          http://schema.cloudfoundry.org/spring
          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
          http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
          http://www.springframework.org/schema/util
          http://www.springframework.org/schema/util/spring-util-3.1.xsd">

        <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
           <constructor-arg ref="mongoDbFactory" />
        </bean>

        <beans profile="default">
           <mongo:db-factory id="mongoDbFactory" dbname="pwdtest" host="127.0.0.1" port="27017" username="test_user" password="efgh" />
        </beans>

        <beans profile="cloud">
           <cloud:mongo-db-factory id="mongoDbFactory" />
        </beans>

</beans>
```

Note that the `<beans profile="value">` element is nested inside the standard root `<beans>` element.  The MongoDB connection factory in the `cloud` profile uses the `<cloud:>` namespace, the connection factory configuration in the `default` profile uses the `<mongo:>` namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.

See the [SpringSource Blog](http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/) for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.

## Sending Email From Spring Applications Deployed to Cloud Foundry

In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.

Service providers, such as [SendGrid](http://sendgrid.com), can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using [Spring Profiles](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration) to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.

The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the `cloud` profile:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:cloud="http://schema.cloudfoundry.org/spring"

    ...

    <beans profile="cloud">
       <bean name="mailSender" class="example.SendGridMailSender">
          <property name="apiUser" value="youremail@domain.com" />
          <property name="apiKey" value="secureSecret" />
       </bean>
    </beans>

   ...

    <!-- additional beans in your application -->

</beans>
```

In the example, `example.SendGridMailSender` is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.

## Accessing Cloud Foundry Properties

Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.

Service properties generally take one of the following forms:

        cloud.services.{service-name}.connection.{property}
        cloud.services.{service-name}.{property}

where `{service-name}` refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.

For example, assume that in VMC you created a vFabric Postgres service called `my-postgres` and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:

        cloud.services.my-postgres.connection.host
        cloud.services.my-postgres.connection.hostname
        cloud.services.my-postgres.connection.name
        cloud.services.my-postgres.connection.password
        cloud.services.my-postgres.connection.port
        cloud.services.my-postgres.connection.user
        cloud.services.my-postgres.connection.username
        cloud.services.my-postgres.plan
        cloud.services.my-postgres.type

For convenience, if you have bound just *one* service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form `cloud.services.mysql.connection.{property}`.   Cloud Foundry uses the following aliases in this case:

+ `mysql`
+ `mongodb`
+ `postgresql`
+ `rabbitmq`
+ `redis`

If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a `cloud` profile; Spring profiles are briefly described in [Using Spring Profiles to Conditionalize Cloud Foundry Configuration](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration).

For example, assume that you have bound a MySQL service called `spring-mysql` to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:

```xml
<beans profile="cloud">
   <bean id="c3p0DataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close">
      <property name="driverClass" value="com.mysql.jdbc.Driver" />
      <property name="jdbcUrl"
                value="jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}" />
      <property name="user" value="${cloud.services.spring-mysql.connection.username}" />
      <property name="password" value="${cloud.services.spring-mysql.connection.password}" />
   </bean>
</beans>
```

The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, `{service-name}` refers to the actual name of the bound service.

<table class="std">
 <tr>
   <th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
 <tr>
   <td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
 <tr>
   <td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free</td>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free</td>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr>
</table>;T;
I"ù8<p>This section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.</p>

<p>(If youâ€™re interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read <a href="/frameworks/java/spring/spring-insight.html">this</a>.)</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse</a></li>
  <li><a href="http://www.springsource.org/get-started">Getting Started With Spring</a></li>
</ul><h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</a></li>
  <li><a href="#using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</a></li>
  <li><a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a></li>
  <li><a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a></li>
  <li><a href="#sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</a></li>
  <li><a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a></li>
</ul><h2 id="programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</h2>

<p>In general, you do not have to do anything â€œspecialâ€ when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.</p>

<p>It is usually best to package your Spring application in a <code>*.war</code> file so that <code>vmc push</code> will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.</p>

<p>There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:</p>

<ul>
<li>
    <p>Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is <em>able</em> to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.</p>
  </li>
  <li>
    <p>Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the <code>root</code> context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the <code>*.war</code> file in which the application is packaged.</p>
  </li>
  <li>
    <p>HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.</p>
  </li>
  <li>
    <p>External users can access your application only via the URL provided by the <code>vmc push</code> command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.</p>
  </li>
</ul><h2 id="using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</h2>

<p>If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry <em>without changing a single line of code</em>.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See <a href="#determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</a> for details.</p>

<p>If your Spring application cannot take advantage of Cloud Foundryâ€™s auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</p>

<h2 id="determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</h2>

<p>You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small <a href="#limitations-of-auto-reconfiguration">set of limitations</a>, Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.</p>

<p>With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single <code>javax.sql.DataSource</code> bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesnâ€™t use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesnâ€™t really care what the specific properties are that created the database.</p>

<p>The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.</p>

<h2 id="relational-database-mysql-and-vfabric-postgres">Relational Database (MySQL and vFabric Postgres)</h2>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>javax.sql.DataSource</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">id=</span><span class="s">"dataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:mem:"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"sa"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.</p>

<p>Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.</p>

<h2 id="mongodb">MongoDB</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.document.mongodb.MongoDbFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;mongo:db-factory</span>
    <span class="na">id=</span><span class="s">"mongoDbFactory"</span>
    <span class="na">dbname=</span><span class="s">"pwdtest"</span>
    <span class="na">host=</span><span class="s">"127.0.0.1"</span>
    <span class="na">port=</span><span class="s">"1234"</span>
    <span class="na">username=</span><span class="s">"test_user"</span>
    <span class="na">password=</span><span class="s">"test_pass"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>SimpleMOngoDbFactory</code> with its own values for the following properties:  host, port, username, password, dbname.</p>

<h2 id="redis">Redis</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/redis">Spring Data Redis</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.redis.connection.RedisConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redis"</span>
      <span class="na">class=</span><span class="s">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>
      <span class="na">p:hostName=</span><span class="s">"localhost"</span> <span class="na">p:port=</span><span class="s">"6379"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>JedisConnectionFactory</code> with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.</p>

<h2 id="rabbitmq">RabbitMQ</h2>

<p>You must be using <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.amqp.rabbit.connection.ConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;rabbit:connection-factory</span>
    <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span>
    <span class="na">host=</span><span class="s">"localhost"</span>
    <span class="na">password=</span><span class="s">"testpwd"</span>
    <span class="na">port=</span><span class="s">"1238"</span>
    <span class="na">username=</span><span class="s">"testuser"</span>
    <span class="na">virtual-host=</span><span class="s">"virthost"</span> <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>org.springframework.amqp.rabbit.connection.CachingConnectionFactory</code> with its own values for the following properties:  host, virtual-host, port, username, password.</p>

<h2 id="limitations-of-auto-reconfiguration">Limitations of Auto-Reconfiguration</h2>

<p>Cloud Foundry auto-reconfigures applications only if the following items are true for your application:</p>

<ul>
<li>You bind only <em>one</em> service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will <em>not</em> occur.</li>
  <li>You include only <em>one</em> bean of a matching type in your Spring application context file.  For example, you can have only one bean of type <code>javax.sql.DataSource</code>.</li>
</ul><p>Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.</p>

<h2 id="opting-out-of-auto-reconfiguration">Opting Out of Auto-Reconfiguration</h2>

<p>Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:</p>

<ul>
<li>When you deploy your application using VMC or STS, specify that the framework is <code>JavaWeb</code> instead of <code>Spring</code>.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.</li>
  <li>Use the <code>&lt;cloud:&gt;</code> namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</li>
</ul><h2 id="explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</h2>

<p>This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See <a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a> for the complete list of supported Cloud Foundry services.</p>

<p>The easiest way to use Cloud Foundry services in your Spring applications is to declare the <code>&lt;cloud:&gt;</code> namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the <code>&lt;cloud&gt;</code> namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the <code>&lt;cloud:&gt;</code> namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.</p>

<p>The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:</p>

<ul>
<li>Update your application build process to include a dependency on the <code>org.cloudfoundry.cloudfoundry-runtime</code> artifact.  For example, if you use Maven to build your application, the following <code>pom.xml</code> snippet shows how to add this dependency:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- additional dependency declarations --&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>

<ul>
<li>Update your application build process to include the Spring Framework Milestone repository.  The following <code>pom.xml</code> snippet shows how to do this in Maven:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
           <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
           <span class="nt">&lt;snapshots&gt;</span>
                   <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
           <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

    <span class="c">&lt;!-- additional repository declarations --&gt;</span>
<span class="nt">&lt;/repositories&gt;</span></code></pre>

<ul>
<li>In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the <code>&lt;cloud:&gt;</code> namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
        <span class="err">http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
        <span class="err">http://www.springframework.org/schema/context</span>
        <span class="err">http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
        <span class="err">http://schema.cloudfoundry.org/spring</span>
        <span class="err">http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
        <span class="nt">&gt;</span>

    <span class="c">&lt;!-- bean declarations --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<ul>
<li>
    <p>You can now specify the Cloud Foundry services in the Spring application context file by using the <code>&lt;cloud:&gt;</code> namespace along with the name of specific elements, such as <code>data-source</code>.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.</p>

    <p>The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the <code>&lt;cloud:data-source&gt;</code> element.</p>
  </li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">        http://www.springframework.org/schema/context</span>
<span class="s">        http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
<span class="s">        http://schema.cloudfoundry.org/spring</span>
<span class="s">        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">        &gt;</span>

<span class="s">    &lt;cloud:data-source id="</span><span class="err">dataSource"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

        <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as <code>driverClassName</code> or <code>url</code> or <code>username</code> - this is because Cloud Foundry automatically takes care of those properties for you.</p>

<p>For complete information about all the <code>&lt;cloud:&gt;</code> elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:</p>

<ul>
<li><a href="#clouddata-source">&lt;cloud:data-source&gt;: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases</a></li>
  <li><a href="#cloudmongo-db-factory">&lt;cloud:mongo-db-factory&gt;: Configure a MongoDB Connection Factory</a></li>
  <li><a href="#cloudredis-connection-factory">&lt;cloud:redis-connection-factory&gt;: Configure a Redis Connection Factory</a></li>
  <li><a href="#cloudrabbit-connection-factory">&lt;cloud:rabbit-connection-factory&gt;: Configure a RabbitMQ Connection Factory</a></li>
  <li><a href="#cloudservice-scan">&lt;cloud:service-scan&gt; Injecting Services Into @Autowired Beans </a></li>
  <li>
    <p><a href="#cloudproperties">&lt;cloud:properties&gt; Get Cloud Foundry Service Information</a></p>
  </li>
  <li>After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</li>
</ul><h2 id="clouddata-source">&lt;cloud:data-source&gt;</h2>

<p>The <code>&lt;cloud:data-source&gt;</code> element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.</p>

<p>The following example shows a simple way to configure a JDBC data source that will be injected into a <code>org.springframework.jdbc.core.JdbcTemplate</code> bean:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:data-source&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Data Source Configuration</strong></p>

<p>The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of <code>&lt;cloud:data-source&gt;</code>:  <code>&lt;cloud:connection&gt;</code> and <code>&lt;cloud:pool&gt;</code>.</p>

<p>The <code>&lt;cloud:connection&gt;</code> child element takes a single String attribute (<code>properties</code>) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (<code>[propertyName=property;]</code>).</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced data source configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"mydatasource"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:connection</span> <span class="na">properties=</span><span class="s">"charset=utf-8"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:data-source&gt;</span></code></pre>

<p>In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.</p>

<h2 id="cloudmongo-db-factory-">&lt;cloud:mongo-db-factory &gt;</h2>

<p>The <code>&lt;cloud:mongo-db-factory&gt;</code> provides a simple way for you to configure a MongoDB connection factory for your Spring application.</p>

<p>The following example shows a MongoDbFactory configuration that will be injected into a <code>org.springframework.data.mongodb.core.MongoTemplate</code> object:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:mongo-db-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
<li>
<b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li>
<b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li>
<b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li>
<b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
</td>
   <td>String</td>
 </tr>
</table><h2 id="advanced-mongodb-configuration">Advanced MongoDB Configuration</h2>

<p>The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional <code>&lt;cloud:mongo-options&gt;</code> child element of <code>&lt;cloud:mongo-db-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:mongo-options&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table><p>The following example shows how to use the advanced MongoDB options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">write-concern=</span><span class="s">"FSYNC_SAFE"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:mongo-options</span> <span class="na">connections-per-host=</span><span class="s">"12"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:mongo-db-factory&gt;</span></code></pre>

<p>In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (<code>FSYNC_SAFE</code>).</p>

<h2 id="cloudredis-connection-factory-">&lt;cloud:redis-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:redis-connection-factory&gt;</code> provides a simple way for you to configure a Redis connection factory for your Spring application.</p>

<p>The following example shows a <code>RedisConnectionFactory</code> configuration that will be injected into a <code>org.springframework.data.redis.core.StringRedisTemplate</code> object:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"redisConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redisTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.redis.core.StringRedisTemplate"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection-factory"</span> <span class="na">ref=</span><span class="s">"redisConnectionFactory"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:redis-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Redis Configuration</strong></p>

<p>The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:pool&gt;</code> child element of <code>&lt;cloud:redis-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced Redis configuration options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"myRedisConnectionFactory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:redis-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.</p>

<h2 id="cloudrabbit-connection-factory-">&lt;cloud:rabbit-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:rabbit-connection-factory&gt;</code> provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.</p>

<p>The following complete example of a Spring application contenxt file shows a <code>RabbitConnectionFactory</code> configuration that will be injected into a <code>rabbitTemplate</code> object.  The example also uses the <code>&lt;rabbit:&gt;</code> namespace to perform RabbitMQ-specific configurations, as explained after the example:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">"rabbitTemplate"</span>
        <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the preceding example, note the definition and location of the <code>&lt;rabbit:&gt;</code> namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called <code>messages</code> within the RabbitMQ broker.</p>

<p>See <a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a> for additional information about using RabbitMQ in your Spring applications.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:rabbit-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced RabbitMQ Configuration</strong></p>

<p>The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:rabbit-options&gt;</code> child element of <code>&lt;cloud:rabbit-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:rabbit-options&gt;</code> child element defines one attribute called <code>channel-cache-size</code> which you can set to specify the size of the channel cache size.  The default value is 1.</p>

<p>The following example shows how to use these advanced RabbitMQ configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:rabbit-options</span> <span class="na">channel-cache-size=</span><span class="s">"10"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:rabbit-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.</p>

<h2 id="cloudservice-scan">&lt;cloud:service-scan&gt;</h2>

<p>The <code>&lt;cloud:service-scan&gt;</code> element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the <code>@org.springframework.beans.factory.annotation.Autowired</code> annotation.  The <code>&lt;cloud:service-scan&gt;</code> element acts as a cloud equivalent of <code>&lt;context:component-scan&gt;</code> in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a <code>&lt;cloud:&gt;</code> element to your Spring application context file for each new service that you bind.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> element has no attributes or child elements; for example:</p>

<pre><code class="language-xml">         <span class="nt">&lt;cloud:service-scan</span> <span class="nt">/&gt;</span></code></pre>

<p>In your Java code, you must annotate each dependency with <code>@Autowired</code> so that a bean of the corresponding service is automatically created.  For example:</p>

<pre><code class="language-java">  <span class="kn">package</span> <span class="n">cf</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

  <span class="o">....</span>

  <span class="nd">@Autowired</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">ConnectionFactory</span> <span class="n">rabbitConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">MongoDbFactory</span> <span class="n">mongoDbFactory</span><span class="o">;</span>

  <span class="o">...</span></code></pre>

<p>Use of only the <code>@Autowired</code> annotation is adequate if you have bound only <em>one</em> service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the <code>@Qualifier</code> annotation to match the Spring bean with the specific service instance.</p>

<p>For example, assume you bound two MySQL services (named <code>inventory-db</code> and <code>pricing-db</code>) to your application; use the <code>@Qualifier</code> annotation as shown in the following example to specify which service instance applies to which Spring bean:</p>

<pre><code class="language-java">  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"inventory-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">inventoryDataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"pricing-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">pricingDataSource</span><span class="o">;</span></code></pre>

<h2 id="cloudproperties">&lt;cloud:properties&gt;</h2>

<p>The <code>&lt;cloud:properties&gt;</code> element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.</p>

<p>The <code>&lt;cloud:properties&gt;</code> element has just a single attribute (<code>id</code>) which specifies the name of the Properties bean.  Use this ID as a reference to <code>&lt;context:property-placeholder&gt;</code> which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.</p>

<p>Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include <code>&lt;cloud:properties&gt;</code> in your application context file.</p>

<p>The following example shows how to use this element in your Spring application context file:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:properties</span> <span class="na">id=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;context:property-placeholder</span> <span class="na">properties-ref=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span>
                  <span class="na">value=</span><span class="s">"${cloud.services.mysql.connection.username}"</span> <span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, <code>cloud.services.mysql.connection.username</code> is one of the properties exposed by Cloud Foundry.</p>

<p>For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see <a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a>.</p>

<h2 id="rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</h2>

<p>This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:</p>

<ul>
<li>
<a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a>, cover the basics of creating messaging in your applications.</li>
  <li>
<a href="http://www.rabbitmq.com/download.html">Download</a>, <a href="http://www.rabbitmq.com/install.html">install</a> and <a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ</li>
  <li><a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMPQ reference documentation</a></li>
</ul><p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP protocol</a> (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.</p>

<p>The following sample <code>pom.xml</code> file shows RabbitMQ dependencies and repositories in addition to the <code>cloudfoundry-runtime</code> dependency described above:</p>

<pre><code class="language-xml">    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
              <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                       <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span></code></pre>

<p>Then update your application controller/logic as follows:</p>

<ul>
<li>Include the messaging libraries:</li>
</ul><pre><code class="language-java">   <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
   <span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span></code></pre>

<ul>
<li>Read and write messages as shown in the following Java code snippets:</li>
</ul><pre><code class="language-java">   <span class="nd">@Controller</span>
   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
       <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
           <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Send a message to the "messages" queue</span>
           <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Receive a message from the "messages" queue</span>
           <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
           <span class="k">else</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
   <span class="o">}</span></code></pre>

<h2 id="using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</h2>

<p>The preceding sections describe how to use the <code>&lt;cloud:&gt;</code> namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to <em>conditionalize</em> the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring <em>profiles</em> feature, available in Spring Framework 3.1 or later.</p>

<p>The basic idea is that you group the configuration for a specific environment using the <code>profile</code> attribute of a nested <code>&lt;beans&gt;</code> element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are <code>default</code> and <code>cloud</code>.</p>

<p>When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the <code>cloud</code> profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the <code>&lt;cloud:&gt;</code> namespace within the <code>cloud</code> profile block to allow the application to run outside of Cloud Foundry environments.  You then use the <code>default</code> profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.</p>

<p>Here is an example of a Spring <code>MongoTemplate</code> being populated from two alternately configured connection factories. When running on Cloud Foundry (<code>cloud</code> profile), the connection factory is automatically configured. When not running on Cloud Foundry (<code>default</code> profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
        <span class="na">xmlns:jdbc=</span><span class="s">"http://www.springframework.org/schema/jdbc"</span>
        <span class="na">xmlns:util=</span><span class="s">"http://www.springframework.org/schema/util"</span>
        <span class="na">xmlns:mongo=</span><span class="s">"http://www.springframework.org/schema/data/mongo"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/data/mongo</span>
<span class="s">          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd</span>
<span class="s">          http://www.springframework.org/schema/jdbc</span>
<span class="s">          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd</span>
<span class="s">          http://schema.cloudfoundry.org/spring</span>
<span class="s">          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">          http://www.springframework.org/schema/beans</span>
<span class="s">          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">          http://www.springframework.org/schema/util</span>
<span class="s">          http://www.springframework.org/schema/util/spring-util-3.1.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"default"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;mongo:db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">dbname=</span><span class="s">"pwdtest"</span> <span class="na">host=</span><span class="s">"127.0.0.1"</span> <span class="na">port=</span><span class="s">"27017"</span> <span class="na">username=</span><span class="s">"test_user"</span> <span class="na">password=</span><span class="s">"efgh"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Note that the <code>&lt;beans profile="value"&gt;</code> element is nested inside the standard root <code>&lt;beans&gt;</code> element.  The MongoDB connection factory in the <code>cloud</code> profile uses the <code>&lt;cloud:&gt;</code> namespace, the connection factory configuration in the <code>default</code> profile uses the <code>&lt;mongo:&gt;</code> namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.</p>

<p>See the <a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">SpringSource Blog</a> for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.</p>

<h2 id="sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</h2>

<p>In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.</p>

<p>Service providers, such as <a href="http://sendgrid.com">SendGrid</a>, can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Spring Profiles</a> to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.</p>

<p>The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the <code>cloud</code> profile:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>

    <span class="err">...</span>

    <span class="err">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">"mailSender"</span> <span class="na">class=</span><span class="s">"example.SendGridMailSender"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiUser"</span> <span class="na">value=</span><span class="s">"youremail@domain.com"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiKey"</span> <span class="na">value=</span><span class="s">"secureSecret"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/beans&gt;</span>

   ...

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the example, <code>example.SendGridMailSender</code> is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.</p>

<h2 id="accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</h2>

<p>Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.</p>

<p>Service properties generally take one of the following forms:</p>

<pre><code>    cloud.services.{service-name}.connection.{property}
    cloud.services.{service-name}.{property}
</code></pre>

<p>where <code>{service-name}</code> refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.</p>

<p>For example, assume that in VMC you created a vFabric Postgres service called <code>my-postgres</code> and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:</p>

<pre><code>    cloud.services.my-postgres.connection.host
    cloud.services.my-postgres.connection.hostname
    cloud.services.my-postgres.connection.name
    cloud.services.my-postgres.connection.password
    cloud.services.my-postgres.connection.port
    cloud.services.my-postgres.connection.user
    cloud.services.my-postgres.connection.username
    cloud.services.my-postgres.plan
    cloud.services.my-postgres.type
</code></pre>

<p>For convenience, if you have bound just <em>one</em> service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form <code>cloud.services.mysql.connection.{property}</code>.   Cloud Foundry uses the following aliases in this case:</p>

<ul>
<li><code>mysql</code></li>
  <li><code>mongodb</code></li>
  <li><code>postgresql</code></li>
  <li><code>rabbitmq</code></li>
  <li><code>redis</code></li>
</ul><p>If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a <code>cloud</code> profile; Spring profiles are briefly described in <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a>.</p>

<p>For example, assume that you have bound a MySQL service called <code>spring-mysql</code> to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"c3p0DataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span>
                <span class="na">value=</span><span class="s">"jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.username}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.password}"</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, <code>{service-name}</code> refers to the actual name of the bound service.</p>

<table class="std">
<tr>
<th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
<tr>
<td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
<tr>
<td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr></tt>
</td>
</tr></tt>
</td>
</tr>
</table>;T;@^I" /frameworks/ruby/rails-3-1/;T{;{	;I"‚E<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/rails-3-1.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby on Rails 3.1 and Above' property='og:title'>
<meta content='Ruby on Rails 3.1 Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby on Rails 3.1 and Above</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby on Rails 3.1 and Above</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby on Rails 3.1 Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Rails 3.1 and 3.2 developers using Cloud Foundry. It makes the following assumptions:</p>

<ul>
<li>
    <p>You have vmc installed.</p>
  </li>
  <li>
    <p>You are proficient in developing Rails applications and are familiar with tools used to manage dependencies in Rails applications.</p>
  </li>
</ul><p>For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the <code>VCAP_SERVICES</code> environment variable, as described in <a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="rails-312-and-32-on-ruby-18-and-ruby-19">Rails 3.1.2 and 3.2 on Ruby 1.8 and Ruby 1.9</h2>

<p>Rails 3.1 introduces the asset pipeline. To get the asset pipeline working on Cloud Foundry, precompile your assets in your development environment, which compiles them into <code>public/assets</code>, then tweak the production environment configuration before excuting a normal <code>vmc push</code>.</p>

<p>The following steps illustrate the process.</p>

<h3 id="gemfile">Gemfile</h3>

<h4 id="ruby-18">Ruby 1.8</h4>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry.</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.1 can use the latest mysql2 gem.</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span>
   <span class="k">end</span></code></pre>

<h4 id="ruby-19">Ruby 1.9</h4>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry.</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.1 can use the latest mysql2 gem.</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span>
   <span class="k">end</span>

   <span class="c1"># For Ruby 1.9 Cloud Foundry requires a tweak to the jquery-rails gem.</span>
   <span class="c1"># gem 'jquery-rails'</span>
   <span class="n">gem</span> <span class="s1">'cloudfoundry-jquery-rails'</span>

   <span class="c1"># For Ruby 1.9 Cloud Foundry requires a tweak to devise.</span>
   <span class="c1"># Uncomment next line if you plan to use devise.</span>
   <span class="c1"># gem 'cloudfoundry-devise', :require =&gt; 'devise'</span></code></pre>

<h3 id="bundle-your-application">Bundle your application:</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="configs">Configs</h3>

<p>Edit <code>config/environments/production.rb</code> and change</p>

<pre><code class="language-ruby"><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">false</span></code></pre>

<p>to</p>

<pre><code class="language-ruby"><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">true</span></code></pre>

<h3 id="assets">Assets</h3>

<p>Pre-compile your asset pipeline.</p>

<pre class="terminal">
$ bundle exec rake assets:precompile
</pre>

<h3 id="vcs">VCS</h3>

<p>Commit the current configuration to your version control system. Consider including:
   + <code>Gemfile.lock</code>
   + gems packaged into <code>vendor/cache</code>
   + assets compiled into <code>public/assets</code></p>

<h3 id="deploy">Deploy</h3>

<pre class="terminal">
$ vmc push
</pre>

<p>Respond to the interactive prompts to deploy and start the application.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Ï
This is a guide for Rails 3.1 and 3.2 developers using Cloud Foundry. It makes the following assumptions:

+   You have vmc installed.

+   You are proficient in developing Rails applications and are familiar with tools used to manage dependencies in Rails applications.

For more information about Ruby and Cloud Foundry, see:

+  [Ruby on Rails](http://rubyonrails.org/)
+  [Getting Started with Cloud Foundry](/getting-started.html)
+  [Ruby Application Development with Cloud Foundry](ruby.html)

Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the `VCAP_SERVICES` environment variable, as described in [Ruby Application Development with Cloud Foundry](/frameworks/ruby/ruby.html#using-cloud-foundry-services).

## Rails 3.1.2 and 3.2 on Ruby 1.8 and Ruby 1.9

Rails 3.1 introduces the asset pipeline. To get the asset pipeline working on Cloud Foundry, precompile your assets in your development environment, which compiles them into `public/assets`, then tweak the production environment configuration before excuting a normal `vmc push`.

The following steps illustrate the process.

### Gemfile

#### Ruby 1.8

```ruby

   # If you use a different database in development, hide it from Cloud Foundry.
   group :development do
     gem 'sqlite3'
   end

   # Rails 3.1 can use the latest mysql2 gem.
   group :production do
     gem 'mysql2'
   end

```

#### Ruby 1.9

```ruby

   # If you use a different database in development, hide it from Cloud Foundry.
   group :development do
     gem 'sqlite3'
   end

   # Rails 3.1 can use the latest mysql2 gem.
   group :production do
     gem 'mysql2'
   end

   # For Ruby 1.9 Cloud Foundry requires a tweak to the jquery-rails gem.
   # gem 'jquery-rails'
   gem 'cloudfoundry-jquery-rails'

   # For Ruby 1.9 Cloud Foundry requires a tweak to devise.
   # Uncomment next line if you plan to use devise.
   # gem 'cloudfoundry-devise', :require => 'devise'

```

### Bundle your application:

```bash
$ bundle package
$ bundle install
```

### Configs

Edit `config/environments/production.rb` and change

```ruby
config.serve_static_assets = false
```

to

```ruby
config.serve_static_assets = true
```

### Assets

Pre-compile your asset pipeline.

```bash
$ bundle exec rake assets:precompile
```

### VCS

Commit the current configuration to your version control system. Consider including:
   + `Gemfile.lock`
   + gems packaged into `vendor/cache`
   + assets compiled into `public/assets`

### Deploy

```bash
$ vmc push
```

Respond to the interactive prompts to deploy and start the application.;T;
I"†<p>This is a guide for Rails 3.1 and 3.2 developers using Cloud Foundry. It makes the following assumptions:</p>

<ul>
<li>
    <p>You have vmc installed.</p>
  </li>
  <li>
    <p>You are proficient in developing Rails applications and are familiar with tools used to manage dependencies in Rails applications.</p>
  </li>
</ul><p>For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the <code>VCAP_SERVICES</code> environment variable, as described in <a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="rails-312-and-32-on-ruby-18-and-ruby-19">Rails 3.1.2 and 3.2 on Ruby 1.8 and Ruby 1.9</h2>

<p>Rails 3.1 introduces the asset pipeline. To get the asset pipeline working on Cloud Foundry, precompile your assets in your development environment, which compiles them into <code>public/assets</code>, then tweak the production environment configuration before excuting a normal <code>vmc push</code>.</p>

<p>The following steps illustrate the process.</p>

<h3 id="gemfile">Gemfile</h3>

<h4 id="ruby-18">Ruby 1.8</h4>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry.</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.1 can use the latest mysql2 gem.</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span>
   <span class="k">end</span></code></pre>

<h4 id="ruby-19">Ruby 1.9</h4>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry.</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.1 can use the latest mysql2 gem.</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span>
   <span class="k">end</span>

   <span class="c1"># For Ruby 1.9 Cloud Foundry requires a tweak to the jquery-rails gem.</span>
   <span class="c1"># gem 'jquery-rails'</span>
   <span class="n">gem</span> <span class="s1">'cloudfoundry-jquery-rails'</span>

   <span class="c1"># For Ruby 1.9 Cloud Foundry requires a tweak to devise.</span>
   <span class="c1"># Uncomment next line if you plan to use devise.</span>
   <span class="c1"># gem 'cloudfoundry-devise', :require =&gt; 'devise'</span></code></pre>

<h3 id="bundle-your-application">Bundle your application:</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="configs">Configs</h3>

<p>Edit <code>config/environments/production.rb</code> and change</p>

<pre><code class="language-ruby"><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">false</span></code></pre>

<p>to</p>

<pre><code class="language-ruby"><span class="n">config</span><span class="o">.</span><span class="n">serve_static_assets</span> <span class="o">=</span> <span class="kp">true</span></code></pre>

<h3 id="assets">Assets</h3>

<p>Pre-compile your asset pipeline.</p>

<pre class="terminal">
$ bundle exec rake assets:precompile
</pre>

<h3 id="vcs">VCS</h3>

<p>Commit the current configuration to your version control system. Consider including:
   + <code>Gemfile.lock</code>
   + gems packaged into <code>vendor/cache</code>
   + assets compiled into <code>public/assets</code></p>

<h3 id="deploy">Deploy</h3>

<pre class="terminal">
$ vmc push
</pre>

<p>Respond to the interactive prompts to deploy and start the application.</p>;T;@dI"/frameworks/ruby/ruby-cf/;T{;{	;I"Pb<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/ruby-cf.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby, Rails and Cloud Foundry' property='og:title'>
<meta content='Things to Know about Ruby, Rails and Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby, Rails and Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby, Rails and Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Things to Know about Ruby, Rails and Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/bundler" rel="tag">bundler</a><a href="/tags/Gemfile" rel="tag">Gemfile</a><a href="/tags/git" rel="tag">git</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This article provides useful tips when building Ruby Apps on Cloud Foundry.
Many of the initial limitations have now been removed.
To review the latest news about Ruby support on Cloud Foundry visit:
<a href="http://blog.cloudfoundry.com/tag/ruby/">http://blog.cloudfoundry.com/tag/ruby/</a></p>

<p>Here are the highlights of the topics covered below:</p>

<ul>
<li>Your application MUST supply a <code>Gemfile</code> that specifies ALL required gems</li>
  <li>Pre-package your app to the greatest possible extent</li>
  <li>Ruby 1.8 and Ruby 1.9 are supported</li>
</ul><h2 id="gems-and-libraries">Gems and Libraries</h2>

<p>Some important comments about Gems and Gemfiles:</p>

<p>GEM list completeness - The proper way to interact with cloud foundry is to supply a complete <code>Gemfile</code> and
then also run <code>bundle install;bundle package</code> each time you touch your Gemfile and
prior to any <code>vmc push</code> or <code>vmc update</code> commands.</p>

<p>The supported way of using gems is via <a href="http://gembundler.com/">Bundler</a>
VCAP <strong>does not support</strong> alternative method to Bundler <a href="https://github.com/jbarnette/isolate">Isolate</a>.</p>

<p>**Your application MUST supply a <code>Gemfile</code> that specifies ALL required gems as well as a <code>Gemfile.lock</code> with the specific versions of the gems **</p>

<p>For more information on <code>bundle package</code> see <a href="http://gembundler.com/bundle_package.html">http://gembundler.com/bundle_package.html</a></p>

<h2 id="bundler">Bundler</h2>

<p>In General â€“ Watch out for complicated and confusing bundle settings.
While VCAP tries to handle your configuration as best it can, it is possible to
write Gemfiles that cannot be satisfied, such as requesting an old version of Rails and a brand-new version of Rack.
These combinations fail immediately; you wonâ€™t need to wait to push your app to
the cloud to see it breaks. In the same token, Gemfiles and Gems that are too vague about versions can still create as well.</p>

<p>Along with published gems, Gemfiles can refer to git repos by url, branch name, etc. And Bundler will build them using a specialized mechanism.
<strong>VCAP now supports reading Gemfiles with git urls.</strong></p>

<p>Example <code>Gemfile</code>:</p>

<pre><code class="language-ruby"><span class="n">source</span> <span class="ss">:rubygems</span>

<span class="c1"># Gets the json gem from rubygems</span>
<span class="n">gem</span> <span class="s2">"json"</span><span class="p">,</span> <span class="s2">"~&gt; 1.4.6"</span>

<span class="c1"># Gets the vcap_services_base gem from cloudfoundry's vcap-services-base repo on github.com at master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>

<span class="c1"># Gets the vcap_logging gem from cloudfoundry's common repo on github.com at the specified ref on the master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>

<span class="c1"># Gets the eventmachine from cloudfoundry eventmachine repo on github.com using the release-0.12.11-cf branch</span>
<span class="n">gem</span> <span class="s1">'eventmachine'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/eventmachine.git'</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">'release-0.12.11-cf'</span></code></pre>

<p>You can only link to gems using paths if the paths are relative inside your app and the gems in the path have been built.</p>

<ul>
<li>gem :path =&gt; â€œsome/pathâ€</li>
</ul><p>Note that both patforms and git urls are now supported. This allows you to work in a Windows environment for example and
require additional gems which will not be installed on Cloud Foundry when your app starts running.</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'vcap_common'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/common'</span><span class="p">,</span> <span class="s1">'vcap/component'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-common.git'</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>
<span class="n">gem</span> <span class="s1">'warden-client'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'warden/client'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/warden.git'</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>Library dependency resolution - When a library you require has dependencies,
you need to pay special attention to the way it tries to load dependent library versions (through $LOAD_PATH).</p>

<h3 id="bundler-groups">Bundler groups</h3>

<p>Groups are fully supported allowing you to specify <code>development</code> and <code>test</code> groups for example and then exclude them for your app.</p>

<p>Example <code>Gemfile</code></p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"sinatra"</span>
<span class="n">gem</span> <span class="s2">"newrelic_rpm"</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vmc"</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>Note that you can now set environment variable <code>BUNDLE_WITHOUT</code> to specify excluding development and test
Also note that Cloud Foundry will now honor the values you set in <code>RAILS_ENV</code> and <code>RACK_ENV</code></p>

<pre class="terminal">
vmc push --nostart

vmc env-add &lt;app_name&gt; RAILS_ENV=staging
vmc env-add &lt;app_name&gt; BUNDLE_WITHOUT=test:development

vmc start &lt;app_name&gt;

</pre>

<h3 id="platforms">Platforms</h3>

<p>Platforms are now fully supported, allowing you to require different gems for different OSs
Here is an example <code>Gemfile</code> using platforms:</p>

<pre><code class="language-ruby"><span class="c1"># Unix Rubies (OSX, Linux)</span>
<span class="n">platform</span> <span class="ss">:ruby</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rb-inotify'</span>
<span class="k">end</span>

<span class="c1"># Windows Rubies (RubyInstaller)</span>
<span class="n">platforms</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:mingw</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'eventmachine-win32'</span>
  <span class="n">gem</span> <span class="s1">'win32-changenotify'</span>
  <span class="n">gem</span> <span class="s1">'win32-event'</span>
<span class="k">end</span></code></pre>

<h2 id="rails-3">Rails 3</h2>

<p>In General - Rails 3 includes â€˜nativeâ€™ support for Bundler.
Newly-generated Rails apps come with a Gemfile that the user can edit, and Rails
automatically activates the bundle at boot.
If VCAP sees a <code>Gemfile.lock</code> in the application, it will ensure the needed gems are packaged, and set the <code>BUNDLE_PATH</code> environment variable to point at them.</p>

<p>Rails 3 Bundler support limitations â€“ For simple lists of gem dependencies (anything that â€˜gem installâ€™ knows how to find), VCAP supports these well currently.
However, for complex lists, or build scripts for gems, being assembled at deploy time from several repos, VCAP has very limited support.
<strong>As a rule, pre-package your app to the greatest possible extent.</strong></p>

<h2 id="rails-23">Rails 2.3</h2>

<p>Railsâ€™ â€˜config.gemâ€™ mechanism, which allows the user to specify a list of gems that the app needs to operate,
is limited in that it cannot protect you from multi-deep dependencies (deeply layered gems using other gems).
In a cloud environment, this is an invitation for failure.</p>

<p>As mitigation, many Rails 2.3 applications have subsequently adopted Gem Bundler.</p>

<p><strong>VCAP currently does not â€˜detectâ€™ Rails 2.3 applications. If you need to run a
Ruby 2.3 app, disguise yourself as a Rails 3 app (by creating a config/application.rb file and a â€˜config.ruâ€™).</strong></p>

<h2 id="app-servers">App Servers</h2>

<p>The command-line and the deployed clouds currently only offer one app server for Sinatra and Rails applications: <code>Thin</code>.
However, if you are using Bundler, and nothing in your bundle requires Thin, VCAP cannot safely start your app using it.
In such cases, it will fall back to running your application using â€˜rails serverâ€™, which uses WEBrick.</p>

<p><strong>For best performance and results, we suggest putting â€œgem â€˜thinâ€™â€ in your Gemfile.</strong></p>

<h2 id="ruby-versions">Ruby versions</h2>

<p>VCAP supports two ruby â€˜runtimesâ€™:</p>

<ul>
<li>ruby18: Ruby version 1.8.7-p302 (or higher)</li>
  <li>ruby19: Ruby version 1.9.2-p180</li>
</ul><p><strong>The default is ruby18</strong>; you can specify otherwise using the <code>--runtime</code> flag at the vmc command-line:</p>

<pre class="terminal">
$ vmc push myapp --runtime ruby19
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"›This article provides useful tips when building Ruby Apps on Cloud Foundry.
Many of the initial limitations have now been removed.
To review the latest news about Ruby support on Cloud Foundry visit:
[http://blog.cloudfoundry.com/tag/ruby/](http://blog.cloudfoundry.com/tag/ruby/)

Here are the highlights of the topics covered below:

+ Your application MUST supply a `Gemfile` that specifies ALL required gems
+ Pre-package your app to the greatest possible extent
+ Ruby 1.8 and Ruby 1.9 are supported


## Gems and Libraries

Some important comments about Gems and Gemfiles:

GEM list completeness - The proper way to interact with cloud foundry is to supply a complete `Gemfile` and
then also run `bundle install;bundle package` each time you touch your Gemfile and
prior to any `vmc push` or `vmc update` commands.

The supported way of using gems is via [Bundler](http://gembundler.com/)
VCAP **does not support** alternative method to Bundler [Isolate](https://github.com/jbarnette/isolate).

**Your application MUST supply a `Gemfile` that specifies ALL required gems as well as a `Gemfile.lock` with the specific versions of the gems **

For more information on `bundle package` see [http://gembundler.com/bundle_package.html](http://gembundler.com/bundle_package.html)


## Bundler

In General â€“ Watch out for complicated and confusing bundle settings.
While VCAP tries to handle your configuration as best it can, it is possible to
write Gemfiles that cannot be satisfied, such as requesting an old version of Rails and a brand-new version of Rack.
These combinations fail immediately; you won't need to wait to push your app to
the cloud to see it breaks. In the same token, Gemfiles and Gems that are too vague about versions can still create as well.

Along with published gems, Gemfiles can refer to git repos by url, branch name, etc. And Bundler will build them using a specialized mechanism.
**VCAP now supports reading Gemfiles with git urls.**

Example `Gemfile`:

``` ruby

source :rubygems

# Gets the json gem from rubygems
gem "json", "~> 1.4.6"

# Gets the vcap_services_base gem from cloudfoundry's vcap-services-base repo on github.com at master branch
gem 'vcap_services_base', :git => 'git://github.com/cloudfoundry/vcap-services-base.git'

# Gets the vcap_logging gem from cloudfoundry's common repo on github.com at the specified ref on the master branch
gem 'vcap_logging', :require => ['vcap/logging'], :git => 'git://github.com/cloudfoundry/common.git', :ref => 'b96ec1192'

# Gets the eventmachine from cloudfoundry eventmachine repo on github.com using the release-0.12.11-cf branch
gem 'eventmachine', :git => 'git://github.com/cloudfoundry/eventmachine.git', :branch => 'release-0.12.11-cf'

```


You can only link to gems using paths if the paths are relative inside your app and the gems in the path have been built.

+ gem :path => "some/path"

Note that both patforms and git urls are now supported. This allows you to work in a Windows environment for example and
require additional gems which will not be installed on Cloud Foundry when your app starts running.

``` ruby

gem 'vcap_common', :require => ['vcap/common', 'vcap/component'], :git => 'git://github.com/cloudfoundry/vcap-common.git'
gem 'vcap_logging', :require => ['vcap/logging'], :git => 'git://github.com/cloudfoundry/common.git', :ref => 'b96ec1192'
gem 'vcap_services_base', :git => 'git://github.com/cloudfoundry/vcap-services-base.git'
gem 'warden-client', :require => ['warden/client'], :git => 'git://github.com/cloudfoundry/warden.git'

group :test do
  gem "webmock"
  gem "rake"
  gem "rack-test"
  gem "rspec"
  gem "simplecov"
  gem "simplecov-rcov"
  gem "ci_reporter"
end

```

Library dependency resolution - When a library you require has dependencies,
you need to pay special attention to the way it tries to load dependent library versions (through $LOAD_PATH).

### Bundler groups

Groups are fully supported allowing you to specify `development` and `test` groups for example and then exclude them for your app.

Example `Gemfile`

``` ruby

gem "sinatra"
gem "newrelic_rpm"

group :development do
  gem "vmc"
end

group :test do
  gem "webmock"
  gem "rake"
  gem "rack-test"
  gem "rspec"
  gem "simplecov"
  gem "simplecov-rcov"
  gem "ci_reporter"
end

```

Note that you can now set environment variable `BUNDLE_WITHOUT` to specify excluding development and test
Also note that Cloud Foundry will now honor the values you set in `RAILS_ENV` and `RACK_ENV`

``` bash

vmc push --nostart

vmc env-add <app_name> RAILS_ENV=staging
vmc env-add <app_name> BUNDLE_WITHOUT=test:development

vmc start <app_name>

```

### Platforms

Platforms are now fully supported, allowing you to require different gems for different OSs
Here is an example `Gemfile` using platforms:

``` ruby

# Unix Rubies (OSX, Linux)
platform :ruby do
  gem 'rb-inotify'
end

# Windows Rubies (RubyInstaller)
platforms :mswin, :mingw do
  gem 'eventmachine-win32'
  gem 'win32-changenotify'
  gem 'win32-event'
end

```


## Rails 3

In General - Rails 3 includes 'native' support for Bundler.
Newly-generated Rails apps come with a Gemfile that the user can edit, and Rails
automatically activates the bundle at boot.
If VCAP sees a `Gemfile.lock` in the application, it will ensure the needed gems are packaged, and set the `BUNDLE_PATH` environment variable to point at them.

Rails 3 Bundler support limitations â€“ For simple lists of gem dependencies (anything that 'gem install' knows how to find), VCAP supports these well currently.
However, for complex lists, or build scripts for gems, being assembled at deploy time from several repos, VCAP has very limited support.
**As a rule, pre-package your app to the greatest possible extent.**



## Rails 2.3

Railsâ€™ 'config.gem' mechanism, which allows the user to specify a list of gems that the app needs to operate,
is limited in that it cannot protect you from multi-deep dependencies (deeply layered gems using other gems).
In a cloud environment, this is an invitation for failure.

As mitigation, many Rails 2.3 applications have subsequently adopted Gem Bundler.

**VCAP currently does not 'detect' Rails 2.3 applications. If you need to run a
Ruby 2.3 app, disguise yourself as a Rails 3 app (by creating a config/application.rb file and a 'config.ru').**

## App Servers

The command-line and the deployed clouds currently only offer one app server for Sinatra and Rails applications: `Thin`.
However, if you are using Bundler, and nothing in your bundle requires Thin, VCAP cannot safely start your app using it.
In such cases, it will fall back to running your application using 'rails server', which uses WEBrick.

**For best performance and results, we suggest putting "gem 'thin'" in your Gemfile.**


## Ruby versions

VCAP supports two ruby 'runtimes':

- ruby18: Ruby version 1.8.7-p302 (or higher)
- ruby19: Ruby version 1.9.2-p180

**The default is ruby18**; you can specify otherwise using the `--runtime` flag at the vmc command-line:

```bash
$ vmc push myapp --runtime ruby19
```;T;
I"ö-<p>This article provides useful tips when building Ruby Apps on Cloud Foundry.
Many of the initial limitations have now been removed.
To review the latest news about Ruby support on Cloud Foundry visit:
<a href="http://blog.cloudfoundry.com/tag/ruby/">http://blog.cloudfoundry.com/tag/ruby/</a></p>

<p>Here are the highlights of the topics covered below:</p>

<ul>
<li>Your application MUST supply a <code>Gemfile</code> that specifies ALL required gems</li>
  <li>Pre-package your app to the greatest possible extent</li>
  <li>Ruby 1.8 and Ruby 1.9 are supported</li>
</ul><h2 id="gems-and-libraries">Gems and Libraries</h2>

<p>Some important comments about Gems and Gemfiles:</p>

<p>GEM list completeness - The proper way to interact with cloud foundry is to supply a complete <code>Gemfile</code> and
then also run <code>bundle install;bundle package</code> each time you touch your Gemfile and
prior to any <code>vmc push</code> or <code>vmc update</code> commands.</p>

<p>The supported way of using gems is via <a href="http://gembundler.com/">Bundler</a>
VCAP <strong>does not support</strong> alternative method to Bundler <a href="https://github.com/jbarnette/isolate">Isolate</a>.</p>

<p>**Your application MUST supply a <code>Gemfile</code> that specifies ALL required gems as well as a <code>Gemfile.lock</code> with the specific versions of the gems **</p>

<p>For more information on <code>bundle package</code> see <a href="http://gembundler.com/bundle_package.html">http://gembundler.com/bundle_package.html</a></p>

<h2 id="bundler">Bundler</h2>

<p>In General â€“ Watch out for complicated and confusing bundle settings.
While VCAP tries to handle your configuration as best it can, it is possible to
write Gemfiles that cannot be satisfied, such as requesting an old version of Rails and a brand-new version of Rack.
These combinations fail immediately; you wonâ€™t need to wait to push your app to
the cloud to see it breaks. In the same token, Gemfiles and Gems that are too vague about versions can still create as well.</p>

<p>Along with published gems, Gemfiles can refer to git repos by url, branch name, etc. And Bundler will build them using a specialized mechanism.
<strong>VCAP now supports reading Gemfiles with git urls.</strong></p>

<p>Example <code>Gemfile</code>:</p>

<pre><code class="language-ruby"><span class="n">source</span> <span class="ss">:rubygems</span>

<span class="c1"># Gets the json gem from rubygems</span>
<span class="n">gem</span> <span class="s2">"json"</span><span class="p">,</span> <span class="s2">"~&gt; 1.4.6"</span>

<span class="c1"># Gets the vcap_services_base gem from cloudfoundry's vcap-services-base repo on github.com at master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>

<span class="c1"># Gets the vcap_logging gem from cloudfoundry's common repo on github.com at the specified ref on the master branch</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>

<span class="c1"># Gets the eventmachine from cloudfoundry eventmachine repo on github.com using the release-0.12.11-cf branch</span>
<span class="n">gem</span> <span class="s1">'eventmachine'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/eventmachine.git'</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s1">'release-0.12.11-cf'</span></code></pre>

<p>You can only link to gems using paths if the paths are relative inside your app and the gems in the path have been built.</p>

<ul>
<li>gem :path =&gt; â€œsome/pathâ€</li>
</ul><p>Note that both patforms and git urls are now supported. This allows you to work in a Windows environment for example and
require additional gems which will not be installed on Cloud Foundry when your app starts running.</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'vcap_common'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/common'</span><span class="p">,</span> <span class="s1">'vcap/component'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-common.git'</span>
<span class="n">gem</span> <span class="s1">'vcap_logging'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'vcap/logging'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/common.git'</span><span class="p">,</span> <span class="ss">:ref</span> <span class="o">=&gt;</span> <span class="s1">'b96ec1192'</span>
<span class="n">gem</span> <span class="s1">'vcap_services_base'</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/vcap-services-base.git'</span>
<span class="n">gem</span> <span class="s1">'warden-client'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">'warden/client'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">'git://github.com/cloudfoundry/warden.git'</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>Library dependency resolution - When a library you require has dependencies,
you need to pay special attention to the way it tries to load dependent library versions (through $LOAD_PATH).</p>

<h3 id="bundler-groups">Bundler groups</h3>

<p>Groups are fully supported allowing you to specify <code>development</code> and <code>test</code> groups for example and then exclude them for your app.</p>

<p>Example <code>Gemfile</code></p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"sinatra"</span>
<span class="n">gem</span> <span class="s2">"newrelic_rpm"</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"vmc"</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s2">"webmock"</span>
  <span class="n">gem</span> <span class="s2">"rake"</span>
  <span class="n">gem</span> <span class="s2">"rack-test"</span>
  <span class="n">gem</span> <span class="s2">"rspec"</span>
  <span class="n">gem</span> <span class="s2">"simplecov"</span>
  <span class="n">gem</span> <span class="s2">"simplecov-rcov"</span>
  <span class="n">gem</span> <span class="s2">"ci_reporter"</span>
<span class="k">end</span></code></pre>

<p>Note that you can now set environment variable <code>BUNDLE_WITHOUT</code> to specify excluding development and test
Also note that Cloud Foundry will now honor the values you set in <code>RAILS_ENV</code> and <code>RACK_ENV</code></p>

<pre class="terminal">
vmc push --nostart

vmc env-add &lt;app_name&gt; RAILS_ENV=staging
vmc env-add &lt;app_name&gt; BUNDLE_WITHOUT=test:development

vmc start &lt;app_name&gt;

</pre>

<h3 id="platforms">Platforms</h3>

<p>Platforms are now fully supported, allowing you to require different gems for different OSs
Here is an example <code>Gemfile</code> using platforms:</p>

<pre><code class="language-ruby"><span class="c1"># Unix Rubies (OSX, Linux)</span>
<span class="n">platform</span> <span class="ss">:ruby</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'rb-inotify'</span>
<span class="k">end</span>

<span class="c1"># Windows Rubies (RubyInstaller)</span>
<span class="n">platforms</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:mingw</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'eventmachine-win32'</span>
  <span class="n">gem</span> <span class="s1">'win32-changenotify'</span>
  <span class="n">gem</span> <span class="s1">'win32-event'</span>
<span class="k">end</span></code></pre>

<h2 id="rails-3">Rails 3</h2>

<p>In General - Rails 3 includes â€˜nativeâ€™ support for Bundler.
Newly-generated Rails apps come with a Gemfile that the user can edit, and Rails
automatically activates the bundle at boot.
If VCAP sees a <code>Gemfile.lock</code> in the application, it will ensure the needed gems are packaged, and set the <code>BUNDLE_PATH</code> environment variable to point at them.</p>

<p>Rails 3 Bundler support limitations â€“ For simple lists of gem dependencies (anything that â€˜gem installâ€™ knows how to find), VCAP supports these well currently.
However, for complex lists, or build scripts for gems, being assembled at deploy time from several repos, VCAP has very limited support.
<strong>As a rule, pre-package your app to the greatest possible extent.</strong></p>

<h2 id="rails-23">Rails 2.3</h2>

<p>Railsâ€™ â€˜config.gemâ€™ mechanism, which allows the user to specify a list of gems that the app needs to operate,
is limited in that it cannot protect you from multi-deep dependencies (deeply layered gems using other gems).
In a cloud environment, this is an invitation for failure.</p>

<p>As mitigation, many Rails 2.3 applications have subsequently adopted Gem Bundler.</p>

<p><strong>VCAP currently does not â€˜detectâ€™ Rails 2.3 applications. If you need to run a
Ruby 2.3 app, disguise yourself as a Rails 3 app (by creating a config/application.rb file and a â€˜config.ruâ€™).</strong></p>

<h2 id="app-servers">App Servers</h2>

<p>The command-line and the deployed clouds currently only offer one app server for Sinatra and Rails applications: <code>Thin</code>.
However, if you are using Bundler, and nothing in your bundle requires Thin, VCAP cannot safely start your app using it.
In such cases, it will fall back to running your application using â€˜rails serverâ€™, which uses WEBrick.</p>

<p><strong>For best performance and results, we suggest putting â€œgem â€˜thinâ€™â€ in your Gemfile.</strong></p>

<h2 id="ruby-versions">Ruby versions</h2>

<p>VCAP supports two ruby â€˜runtimesâ€™:</p>

<ul>
<li>ruby18: Ruby version 1.8.7-p302 (or higher)</li>
  <li>ruby19: Ruby version 1.9.2-p180</li>
</ul><p><strong>The default is ruby18</strong>; you can specify otherwise using the <code>--runtime</code> flag at the vmc command-line:</p>

<pre class="terminal">
$ vmc push myapp --runtime ruby19
</pre>;T;@jI"/frameworks/ruby/sinatra/;T{;{	;I"ub<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/sinatra.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Sinatra' property='og:title'>
<meta content='Sinatra Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Sinatra</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Sinatra</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Sinatra Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/sinatra" rel="tag">sinatra</a><a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Sinatra developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>To use Cloud Foundry services with Sinatra, you must access the
<code>VCAP_SERVICES</code> environment variable, as described in
<a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="sinatra-and-bundler">Sinatra and Bundler</h2>

<p>Currently, Cloud Foundry may not properly detect a Sinatra app if it uses
Bundler.  Cloud Foundry greps for <code>require "sinatra"</code> in the <code>*.rb</code> files,
and picks that file as the main Sinatra application file.  If you use
Bundler to load Sinatra, Cloud Foundry may not recognize your application.
You can put a comment in your applicationâ€™s main file like this:</p>

<pre><code class="language-ruby">  <span class="c1"># require 'sinatra'   # required for framework detection in cloud foundry...</span>
  <span class="nb">require</span> <span class="s1">'rubygems'</span>
  <span class="nb">require</span> <span class="s1">'bundler'</span>
  <span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span></code></pre>

<h2 id="sample-sinatra-app-using-datamapper-and-bundler">Sample Sinatra App using DataMapper and Bundler</h2>

<h3 id="gemfile">Gemfile</h3>

<pre><code class="language-ruby">   <span class="n">source</span> <span class="s1">'http://rubygems.org'</span>

   <span class="n">gem</span> <span class="s1">'sinatra'</span>
   <span class="n">gem</span> <span class="s1">'data_mapper'</span>

   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'dm-sqlite-adapter'</span>
   <span class="k">end</span>

   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'dm-mysql-adapter'</span>
   <span class="k">end</span></code></pre>

<h3 id="sinatradmrb">sinatra_dm.rb</h3>
<p>The name of this sinatra application will be <code>sinatra_dm.rb</code>.</p>

<p>Note the commented out require of sinatra, which is necessary for proper detection of the applicationâ€™s main file.</p>

<pre><code class="language-ruby">   <span class="c1"># Sample Sinatra app with DataMapper</span>
   <span class="c1"># Based on http://sinatra-book.gittr.com/ DataMapper example</span>

   <span class="c1"># require 'sinatra'   # required for framework detection in cloud foundry.</span>
   <span class="nb">require</span> <span class="s1">'rubygems'</span>
   <span class="nb">require</span> <span class="s1">'bundler'</span>
   <span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>

   <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">].</span><span class="n">nil?</span>
     <span class="no">DataMapper</span><span class="o">::</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"sqlite3://</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/blog.db"</span><span class="p">)</span>
   <span class="k">else</span>
     <span class="nb">require</span> <span class="s1">'json'</span>
     <span class="n">svcs</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span>
     <span class="n">mysql</span> <span class="o">=</span> <span class="n">svcs</span><span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">k</span> <span class="o">=~</span> <span class="sr">/^mysql/</span> <span class="p">}</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">first</span>
     <span class="n">creds</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
     <span class="n">user</span><span class="p">,</span> <span class="n">pass</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="nb">name</span> <span class="o">=</span> <span class="sx">%w(user password host name)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="n">creds</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="p">}</span>
     <span class="no">DataMapper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"mysql://</span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
   <span class="k">end</span>

   <span class="k">class</span> <span class="nc">Post</span>
     <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>
     <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
     <span class="n">property</span> <span class="ss">:title</span><span class="p">,</span> <span class="nb">String</span>
     <span class="n">property</span> <span class="ss">:body</span><span class="p">,</span> <span class="no">Text</span>
     <span class="n">property</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="no">DateTime</span>
   <span class="k">end</span>

   <span class="no">DataMapper</span><span class="o">.</span><span class="n">finalize</span>
   <span class="no">Post</span><span class="o">.</span><span class="n">auto_upgrade!</span>

   <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">:order</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:id</span><span class="o">.</span><span class="n">desc</span><span class="o">]</span><span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">)</span>
     <span class="n">erb</span> <span class="ss">:index</span>
   <span class="k">end</span>

   <span class="n">get</span> <span class="s1">'/post/new'</span> <span class="k">do</span>
     <span class="n">erb</span> <span class="ss">:new</span>
   <span class="k">end</span>

   <span class="n">get</span> <span class="s1">'/post/:id'</span> <span class="k">do</span>
     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
     <span class="n">erb</span> <span class="ss">:post</span>
   <span class="k">end</span>

   <span class="n">post</span> <span class="s1">'/post/create'</span> <span class="k">do</span>
     <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:body</span><span class="o">]</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">post</span><span class="o">.</span><span class="n">save</span>
       <span class="n">status</span> <span class="mi">201</span>
       <span class="n">redirect</span> <span class="s2">"/post/</span><span class="si">#{</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
     <span class="k">else</span>
       <span class="n">status</span> <span class="mi">412</span>
       <span class="n">redirect</span> <span class="s1">'/'</span>
     <span class="k">end</span>
   <span class="k">end</span></code></pre>

<h3 id="views">Views</h3>

<h4 id="index">Index</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/index.erb --&gt;</span>

<span class="x">    &lt;h1&gt;All Blog Posts&lt;/h1&gt;</span>
<span class="x">    &lt;ul&gt;</span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">        &lt;li&gt;&lt;a href="/post/</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;br /&gt;</span>
<span class="x">    &lt;a href="/post/new"&gt;Create new post&lt;/a&gt;</span></code></pre>

<h4 id="new">New</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/new.erb --&gt;</span>

<span class="x">    &lt;h1&gt;Create a new blog post&lt;/h1&gt;</span>
<span class="x">    &lt;form action="/post/create" method="POST"&gt;</span>
<span class="x">     &lt;p&gt;Title: &lt;input type="text" name="title"&gt;&lt;/input&gt;&lt;/p&gt;</span>
<span class="x">     &lt;p&gt;Text: &lt;textarea name="body" rows="10" cols="40"&gt;&lt;/textarea&gt;&lt;/p&gt;</span>
<span class="x">     &lt;input type="submit" name="Publish" /&gt;</span>
<span class="x">    &lt;/form&gt;</span></code></pre>

<h4 id="post">Post</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/post.erb --&gt;</span>

<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">body</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">    &lt;a href="/"&gt;All Posts&lt;/a&gt;</span></code></pre>

<h3 id="bundle-and-push">Bundle and push.</h3>

<pre class="terminal">
   $ bundle package
   $ vmc push --runtime ruby19
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"…This is a guide for Sinatra developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:

+  [Ruby on Rails](http://rubyonrails.org/)
+  [Getting Started with Cloud Foundry](/getting-started.html)
+  [Ruby Application Development with Cloud Foundry](ruby.html)

To use Cloud Foundry services with Sinatra, you must access the
`VCAP_SERVICES` environment variable, as described in
[Ruby Application Development with Cloud Foundry](/frameworks/ruby/ruby.html#using-cloud-foundry-services).

## Sinatra and Bundler

Currently, Cloud Foundry may not properly detect a Sinatra app if it uses
Bundler.  Cloud Foundry greps for `require "sinatra"` in the `*.rb` files,
and picks that file as the main Sinatra application file.  If you use
Bundler to load Sinatra, Cloud Foundry may not recognize your application.
You can put a comment in your application's main file like this:

```ruby
  # require 'sinatra'   # required for framework detection in cloud foundry...
  require 'rubygems'
  require 'bundler'
  Bundler.require
  ...
```

## Sample Sinatra App using DataMapper and Bundler

### Gemfile

```ruby
   source 'http://rubygems.org'

   gem 'sinatra'
   gem 'data_mapper'

   group :development do
     gem 'dm-sqlite-adapter'
   end

   group :production do
     gem 'dm-mysql-adapter'
   end
```

### sinatra_dm.rb
 The name of this sinatra application will be `sinatra_dm.rb`.

 Note the commented out require of sinatra, which is necessary for proper detection of the application's main file.

```ruby
   # Sample Sinatra app with DataMapper
   # Based on http://sinatra-book.gittr.com/ DataMapper example

   # require 'sinatra'   # required for framework detection in cloud foundry.
   require 'rubygems'
   require 'bundler'
   Bundler.require

   if ENV['VCAP_SERVICES'].nil?
     DataMapper::setup(:default, "sqlite3://#{Dir.pwd}/blog.db")
   else
     require 'json'
     svcs = JSON.parse ENV['VCAP_SERVICES']
     mysql = svcs.detect { |k,v| k =~ /^mysql/ }.last.first
     creds = mysql['credentials']
     user, pass, host, name = %w(user password host name).map { |key| creds[key] }
     DataMapper.setup(:default, "mysql://#{user}:#{pass}@#{host}/#{name}")
   end

   class Post
     include DataMapper::Resource
     property :id, Serial
     property :title, String
     property :body, Text
     property :created_at, DateTime
   end

   DataMapper.finalize
   Post.auto_upgrade!

   get '/' do
     @posts = Post.all(:order => [:id.desc], :limit => 20)
     erb :index
   end

   get '/post/new' do
     erb :new
   end

   get '/post/:id' do
     @post = Post.get(params[:id])
     erb :post
   end

   post '/post/create' do
     post = Post.new(:title => params[:title], :body => params[:body])
     if post.save
       status 201
       redirect "/post/#{post.id}"
     else
       status 412
       redirect '/'
     end
   end
```

### Views

#### Index
```erb
    <!-- views/index.erb -->

    <h1>All Blog Posts</h1>
    <ul>
      <% @posts.each do |post| %>
        <li><a href="/post/<%= post.id %>"><%= post.title %></a></li>
      <% end %>
    <br />
    <a href="/post/new">Create new post</a>
```

#### New
```erb
    <!-- views/new.erb -->

    <h1>Create a new blog post</h1>
    <form action="/post/create" method="POST">
     <p>Title: <input type="text" name="title"></input></p>
     <p>Text: <textarea name="body" rows="10" cols="40"></textarea></p>
     <input type="submit" name="Publish" />
    </form>
```

#### Post
```erb
    <!-- views/post.erb -->

    <h1><%= @post.title %></h1>
    <p><%= @post.body %></p>
    <a href="/">All Posts</a>
```

### Bundle and push.

```bash
   $ bundle package
   $ vmc push --runtime ruby19
```;T;
I"Ç.<p>This is a guide for Sinatra developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>To use Cloud Foundry services with Sinatra, you must access the
<code>VCAP_SERVICES</code> environment variable, as described in
<a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="sinatra-and-bundler">Sinatra and Bundler</h2>

<p>Currently, Cloud Foundry may not properly detect a Sinatra app if it uses
Bundler.  Cloud Foundry greps for <code>require "sinatra"</code> in the <code>*.rb</code> files,
and picks that file as the main Sinatra application file.  If you use
Bundler to load Sinatra, Cloud Foundry may not recognize your application.
You can put a comment in your applicationâ€™s main file like this:</p>

<pre><code class="language-ruby">  <span class="c1"># require 'sinatra'   # required for framework detection in cloud foundry...</span>
  <span class="nb">require</span> <span class="s1">'rubygems'</span>
  <span class="nb">require</span> <span class="s1">'bundler'</span>
  <span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span></code></pre>

<h2 id="sample-sinatra-app-using-datamapper-and-bundler">Sample Sinatra App using DataMapper and Bundler</h2>

<h3 id="gemfile">Gemfile</h3>

<pre><code class="language-ruby">   <span class="n">source</span> <span class="s1">'http://rubygems.org'</span>

   <span class="n">gem</span> <span class="s1">'sinatra'</span>
   <span class="n">gem</span> <span class="s1">'data_mapper'</span>

   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'dm-sqlite-adapter'</span>
   <span class="k">end</span>

   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'dm-mysql-adapter'</span>
   <span class="k">end</span></code></pre>

<h3 id="sinatradmrb">sinatra_dm.rb</h3>
<p>The name of this sinatra application will be <code>sinatra_dm.rb</code>.</p>

<p>Note the commented out require of sinatra, which is necessary for proper detection of the applicationâ€™s main file.</p>

<pre><code class="language-ruby">   <span class="c1"># Sample Sinatra app with DataMapper</span>
   <span class="c1"># Based on http://sinatra-book.gittr.com/ DataMapper example</span>

   <span class="c1"># require 'sinatra'   # required for framework detection in cloud foundry.</span>
   <span class="nb">require</span> <span class="s1">'rubygems'</span>
   <span class="nb">require</span> <span class="s1">'bundler'</span>
   <span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>

   <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">].</span><span class="n">nil?</span>
     <span class="no">DataMapper</span><span class="o">::</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"sqlite3://</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/blog.db"</span><span class="p">)</span>
   <span class="k">else</span>
     <span class="nb">require</span> <span class="s1">'json'</span>
     <span class="n">svcs</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span>
     <span class="n">mysql</span> <span class="o">=</span> <span class="n">svcs</span><span class="o">.</span><span class="n">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">k</span> <span class="o">=~</span> <span class="sr">/^mysql/</span> <span class="p">}</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">first</span>
     <span class="n">creds</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
     <span class="n">user</span><span class="p">,</span> <span class="n">pass</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="nb">name</span> <span class="o">=</span> <span class="sx">%w(user password host name)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="n">creds</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="p">}</span>
     <span class="no">DataMapper</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="s2">"mysql://</span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
   <span class="k">end</span>

   <span class="k">class</span> <span class="nc">Post</span>
     <span class="kp">include</span> <span class="no">DataMapper</span><span class="o">::</span><span class="no">Resource</span>
     <span class="n">property</span> <span class="ss">:id</span><span class="p">,</span> <span class="no">Serial</span>
     <span class="n">property</span> <span class="ss">:title</span><span class="p">,</span> <span class="nb">String</span>
     <span class="n">property</span> <span class="ss">:body</span><span class="p">,</span> <span class="no">Text</span>
     <span class="n">property</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="no">DateTime</span>
   <span class="k">end</span>

   <span class="no">DataMapper</span><span class="o">.</span><span class="n">finalize</span>
   <span class="no">Post</span><span class="o">.</span><span class="n">auto_upgrade!</span>

   <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
     <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">:order</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:id</span><span class="o">.</span><span class="n">desc</span><span class="o">]</span><span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">)</span>
     <span class="n">erb</span> <span class="ss">:index</span>
   <span class="k">end</span>

   <span class="n">get</span> <span class="s1">'/post/new'</span> <span class="k">do</span>
     <span class="n">erb</span> <span class="ss">:new</span>
   <span class="k">end</span>

   <span class="n">get</span> <span class="s1">'/post/:id'</span> <span class="k">do</span>
     <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
     <span class="n">erb</span> <span class="ss">:post</span>
   <span class="k">end</span>

   <span class="n">post</span> <span class="s1">'/post/create'</span> <span class="k">do</span>
     <span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:body</span><span class="o">]</span><span class="p">)</span>
     <span class="k">if</span> <span class="n">post</span><span class="o">.</span><span class="n">save</span>
       <span class="n">status</span> <span class="mi">201</span>
       <span class="n">redirect</span> <span class="s2">"/post/</span><span class="si">#{</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
     <span class="k">else</span>
       <span class="n">status</span> <span class="mi">412</span>
       <span class="n">redirect</span> <span class="s1">'/'</span>
     <span class="k">end</span>
   <span class="k">end</span></code></pre>

<h3 id="views">Views</h3>

<h4 id="index">Index</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/index.erb --&gt;</span>

<span class="x">    &lt;h1&gt;All Blog Posts&lt;/h1&gt;</span>
<span class="x">    &lt;ul&gt;</span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">        &lt;li&gt;&lt;a href="/post/</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">id</span> <span class="cp">%&gt;</span><span class="x">"&gt;</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;br /&gt;</span>
<span class="x">    &lt;a href="/post/new"&gt;Create new post&lt;/a&gt;</span></code></pre>

<h4 id="new">New</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/new.erb --&gt;</span>

<span class="x">    &lt;h1&gt;Create a new blog post&lt;/h1&gt;</span>
<span class="x">    &lt;form action="/post/create" method="POST"&gt;</span>
<span class="x">     &lt;p&gt;Title: &lt;input type="text" name="title"&gt;&lt;/input&gt;&lt;/p&gt;</span>
<span class="x">     &lt;p&gt;Text: &lt;textarea name="body" rows="10" cols="40"&gt;&lt;/textarea&gt;&lt;/p&gt;</span>
<span class="x">     &lt;input type="submit" name="Publish" /&gt;</span>
<span class="x">    &lt;/form&gt;</span></code></pre>

<h4 id="post">Post</h4>
<pre><code class="language-erb"><span class="x">    &lt;!-- views/post.erb --&gt;</span>

<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@post</span><span class="o">.</span><span class="n">body</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">    &lt;a href="/"&gt;All Posts&lt;/a&gt;</span></code></pre>

<h3 id="bundle-and-push">Bundle and push.</h3>

<pre class="terminal">
   $ bundle package
   $ vmc push --runtime ruby19
</pre>;T;@pI" /frameworks/ruby/rails-3-0/;T{;{	;I"Ò;<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/rails-3-0.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby on Rails 3.0' property='og:title'>
<meta content='Ruby on Rails 3.0 Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby on Rails 3.0</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby on Rails 3.0</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby on Rails 3.0 Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Ruby on Rails 3.0 developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the <code>VCAP_SERVICES</code> environment variable, as described in <a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="rails-3010-on-ruby-18-and-ruby-19">Rails 3.0.10 on Ruby 1.8 and Ruby 1.9</h2>

<p>Rails 3.0 works well on Cloud Foundry. Be sure to use the correct version of the MySQL2 gem.</p>

<h3 id="gemfile">Gemfile</h3>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.0 requires version less than 0.3 of mysql2 gem</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span><span class="p">,</span> <span class="s1">'&lt; 0.3'</span>
   <span class="k">end</span></code></pre>

<h3 id="bundle-your-application">Bundle your application:</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="deploy-the-application">Deploy the application:</h3>

<pre class="terminal">
$ vmc push
   ...
</pre>

<p>Respond to interactive prompts to deploy and start the application.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"@This is a guide for Ruby on Rails 3.0 developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:

+  [Ruby on Rails](http://rubyonrails.org/)
+  [Getting Started with Cloud Foundry](/getting-started.html)
+  [Ruby Application Development with Cloud Foundry](ruby.html)

Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the `VCAP_SERVICES` environment variable, as described in [Ruby Application Development with Cloud Foundry](/frameworks/ruby/ruby.html#using-cloud-foundry-services).

## Rails 3.0.10 on Ruby 1.8 and Ruby 1.9

Rails 3.0 works well on Cloud Foundry. Be sure to use the correct version of the MySQL2 gem.

### Gemfile

```ruby
   # If you use a different database in development, hide it from Cloud Foundry
   group :development do
     gem 'sqlite3'
   end

   # Rails 3.0 requires version less than 0.3 of mysql2 gem
   group :production do
     gem 'mysql2', '< 0.3'
   end
```

### Bundle your application:

```bash
$ bundle package
$ bundle install
```

### Deploy the application:

```bash
$ vmc push
   ...
```

Respond to interactive prompts to deploy and start the application.;T;
I"ô<p>This is a guide for Ruby on Rails 3.0 developers who are using Cloud Foundry.
For more information about Ruby and Cloud Foundry, see:</p>

<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
  <li><a href="/getting-started.html">Getting Started with Cloud Foundry</a></li>
  <li><a href="ruby.html">Ruby Application Development with Cloud Foundry</a></li>
</ul><p>Using Cloud Foundry services with Ruby on Rails is the same as using services with Sinatra applications, except that MySQL is recognized automatically when you stage a Rails application on Cloud Foundry. For other Cloud Foundry services, you must access the <code>VCAP_SERVICES</code> environment variable, as described in <a href="/frameworks/ruby/ruby.html#using-cloud-foundry-services">Ruby Application Development with Cloud Foundry</a>.</p>

<h2 id="rails-3010-on-ruby-18-and-ruby-19">Rails 3.0.10 on Ruby 1.8 and Ruby 1.9</h2>

<p>Rails 3.0 works well on Cloud Foundry. Be sure to use the correct version of the MySQL2 gem.</p>

<h3 id="gemfile">Gemfile</h3>

<pre><code class="language-ruby">   <span class="c1"># If you use a different database in development, hide it from Cloud Foundry</span>
   <span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'sqlite3'</span>
   <span class="k">end</span>

   <span class="c1"># Rails 3.0 requires version less than 0.3 of mysql2 gem</span>
   <span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
     <span class="n">gem</span> <span class="s1">'mysql2'</span><span class="p">,</span> <span class="s1">'&lt; 0.3'</span>
   <span class="k">end</span></code></pre>

<h3 id="bundle-your-application">Bundle your application:</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="deploy-the-application">Deploy the application:</h3>

<pre class="terminal">
$ vmc push
   ...
</pre>

<p>Respond to interactive prompts to deploy and start the application.</p>;T;@vI""/frameworks/ruby/ruby-simple/;T{;{	;I"B=<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/ruby-simple.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Creating a Simple Ruby Application' property='og:title'>
<meta content='Create a Simple Ruby Application and Deploy to Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Creating a Simple Ruby Application</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Creating a Simple Ruby Application</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Create a Simple Ruby Application and Deploy to Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/sinatra" rel="tag">sinatra</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Follow these steps to create a simple Ruby application and deploy it to Cloud Foundry.</p>

<p>Before you begin, be sure you have met these prerequisites:</p>

<ul>
<li><a href="installing-ruby.html">Installed Ruby and RubyGems</a></li>
  <li><a href="/tools/vmc/installing-vmc.html">Installed VMC</a></li>
  <li><a href="https://my.cloudfoundry.com/signup">Registered for a Cloud Foundry account</a></li>
</ul><p>This example creates a short program using the Sinatra Ruby framework.</p>

<p>Create a new directory, <code>hello</code>, and change into it.</p>

<pre class="terminal">
$ mkdir hello
$ cd hello
</pre>

<p>In the <code>hello</code> directory, create the file <code>hello.rb</code> with the following contents:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">"Hello from Cloud Foundry"</span>
<span class="k">end</span></code></pre>

<p>Install the Sinatra Ruby gem, since this application requires it:</p>

<pre class="terminal">
$ gem install sinatra
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
	Successfully targeted to [http://api.cloudfoundry.com]

	$ vmc login
	Attempting login to [http://api.cloudfoundry.com]
	Email:me@example.com
	Password: *********
	Successfully logged into [http://api.cloudfoundry.com]

</pre>

<p>Push the application to Cloud Foundry. You can press <code>Enter</code> at most prompts to accept the default, but be sure to enter a unique URL for your application:</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]: y
	Application Name: hello
	Application Deployed URL [hello.cloudfoundry.com]:
	Detected a Sinatra Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
	Creating Application: OK
	Would you like to bind any services to 'hello'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

</pre>

<p>Use your browser to view the application at the specified URL.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"QFollow these steps to create a simple Ruby application and deploy it to Cloud Foundry.

Before you begin, be sure you have met these prerequisites:

+ 	[Installed Ruby and RubyGems](installing-ruby.html)
+	[Installed VMC](/tools/vmc/installing-vmc.html)
+	[Registered for a Cloud Foundry account](https://my.cloudfoundry.com/signup)

This example creates a short program using the Sinatra Ruby framework.

Create a new directory, `hello`, and change into it.

```bash
$ mkdir hello
$ cd hello
```

In the `hello` directory, create the file `hello.rb` with the following contents:

```ruby
require 'rubygems'
require 'sinatra'
get '/' do
  "Hello from Cloud Foundry"
end

```

Install the Sinatra Ruby gem, since this application requires it:

```bash
$ gem install sinatra
```

Target Cloud Foundry and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
	Successfully targeted to [http://api.cloudfoundry.com]

	$ vmc login
	Attempting login to [http://api.cloudfoundry.com]
	Email:me@example.com
	Password: *********
	Successfully logged into [http://api.cloudfoundry.com]

```

Push the application to Cloud Foundry. You can press `Enter` at most prompts to accept the default, but be sure to enter a unique URL for your application:

```bash
$ vmc push
	Would you like to deploy from the current directory? [Yn]: y
	Application Name: hello
	Application Deployed URL [hello.cloudfoundry.com]:
	Detected a Sinatra Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
	Creating Application: OK
	Would you like to bind any services to 'hello'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

```

Use your browser to view the application at the specified URL.;T;
I"<	<p>Follow these steps to create a simple Ruby application and deploy it to Cloud Foundry.</p>

<p>Before you begin, be sure you have met these prerequisites:</p>

<ul>
<li><a href="installing-ruby.html">Installed Ruby and RubyGems</a></li>
  <li><a href="/tools/vmc/installing-vmc.html">Installed VMC</a></li>
  <li><a href="https://my.cloudfoundry.com/signup">Registered for a Cloud Foundry account</a></li>
</ul><p>This example creates a short program using the Sinatra Ruby framework.</p>

<p>Create a new directory, <code>hello</code>, and change into it.</p>

<pre class="terminal">
$ mkdir hello
$ cd hello
</pre>

<p>In the <code>hello</code> directory, create the file <code>hello.rb</code> with the following contents:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">"Hello from Cloud Foundry"</span>
<span class="k">end</span></code></pre>

<p>Install the Sinatra Ruby gem, since this application requires it:</p>

<pre class="terminal">
$ gem install sinatra
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
	Successfully targeted to [http://api.cloudfoundry.com]

	$ vmc login
	Attempting login to [http://api.cloudfoundry.com]
	Email:me@example.com
	Password: *********
	Successfully logged into [http://api.cloudfoundry.com]

</pre>

<p>Push the application to Cloud Foundry. You can press <code>Enter</code> at most prompts to accept the default, but be sure to enter a unique URL for your application:</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]: y
	Application Name: hello
	Application Deployed URL [hello.cloudfoundry.com]:
	Detected a Sinatra Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
	Creating Application: OK
	Would you like to bind any services to 'hello'? [yN]:
	Uploading Application:
	  Checking for available resources: OK
	  Packing application: OK
	  Uploading (0K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

</pre>

<p>Use your browser to view the application at the specified URL.</p>;T;@|I"&/frameworks/ruby/installing-ruby/;T{;{	;I"‹W<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/installing-ruby.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Installing Ruby and RubyGems' property='og:title'>
<meta content='How to Install Ruby and RubyGems' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Installing Ruby and RubyGems</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Installing Ruby and RubyGems</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>How to Install Ruby and RubyGems</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/tutorial" rel="tag">tutorial</a><a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/vmc" rel="tag">vmc</a><a href="/tags/Gemfile" rel="tag">Gemfile</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers.</p>

<h2 id="windows">Windows</h2>
<p>Download and install <a href="http://www.rubyinstaller.org/" title="ruby installer for windows">Ruby Installer for Windows</a>. The installer already includes RubyGems.</p>

<p>Be sure you use the Ruby-enabled command prompt window when you later install and use <code>vmc</code>.   You access this command prompt from the Windows Start menu (<strong>All Programs &gt; Ruby &lt;version&gt; &gt; Start Command Prompt with Ruby</strong>).</p>

<p>Finally, update RubyGems from the Ruby Command Prompt:</p>

<pre><code>prompt&gt; gem update --system
</code></pre>

<h3 id="support-for-windows-gemfiles">Support for Windows Gemfiles</h3>

<p>Once you have Ruby installed, you can follow the instructions on <a href="ruby-cf.html">Ruby Apps on Cloud Foundry</a> to learn the details of pushing an app and working with your Gemfile</p>

<p>One thing to note for Windows users is the following:</p>

<p>When a <code>Gemfile.lock</code> is generated on a Windows machine, it often contains gems with Windows-specific versions.
Versions of gems such as mysql2, thin, and pg end up containing â€œ-x86-mingw32â€.</p>

<p>For example, running <code>bundle install</code> on a Windows machine with a Gemfile that looks like this:</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="err">â€˜</span><span class="n">sinatra</span><span class="err">â€™</span>
<span class="n">gem</span> <span class="err">â€˜</span><span class="n">mysql2</span><span class="err">â€™</span>
<span class="n">gem</span> <span class="err">â€˜</span><span class="n">json</span><span class="err">â€™</span></code></pre>

<p>Would result in a Gemfile.lock that looks like this:</p>

<pre><code class="language-ruby"><span class="no">GEM</span>
  <span class="n">remote</span><span class="p">:</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>
  <span class="n">specs</span><span class="p">:</span>
    <span class="n">json</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mysql2</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">11</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="n">mingw32</span><span class="p">)</span>
    <span class="n">rack</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rack</span><span class="o">-</span><span class="n">protection</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">rack</span>
    <span class="n">sinatra</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">rack</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
      <span class="n">rack</span><span class="o">-</span><span class="n">protection</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">tilt</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>

<span class="no">PLATFORMS</span>
  <span class="n">x86</span><span class="o">-</span><span class="n">mingw32</span>

<span class="no">DEPENDENCIES</span>
  <span class="n">json</span>
  <span class="n">mysql2</span>
  <span class="n">sinatra</span></code></pre>

<p>Now Cloud Foundry will be able to properly install these gems without the need to modify your <code>Gemfile.lock</code></p>

<h2 id="mac-os-x">Mac OS X</h2>
<p>Version 10.5 and higher of Mac OS X already ships with Ruby and RubyGems installed.</p>

<p>If you are using an earlier version of Mac OS, download and install the latest version of <a href="http://www.ruby-lang.org/en/downloads/" title="ruby source code">Ruby</a> and then <a href="http://rubygems.org/pages/download">RubyGems</a>.</p>

<h2 id="ubuntu">Ubuntu</h2>

<p>From a terminal, use the <code>apt-get</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install the full Ruby package and RubyGems:</p>

    <p><code>prompt$ sudo apt-get install ruby-full rubygems</code></p>

    <p>Consult your system administrator for any required authentication credentials for the <code>sudo</code> command.</p>
  </li>
  <li>
    <p>Test to ensure that the <code>gem</code> command is in your path:</p>

    <p><code>prompt$ which gem</code></p>

    <p>If the command is not found, then update your <code>PATH</code> variable accordingly.  For example, you can update your <code>.bashrc</code> file with the following line:</p>

    <p><code>export PATH=$PATH:/var/lib/gems/1.8/bin</code></p>
  </li>
  <li>
    <p>Update RubyGems:</p>

    <p>Ubuntu 10.04</p>

    <pre><code>prompt$ sudo gem install rubygems-update
prompt$ sudo /var/lib/gems/1.8/bin/update_rubygems
</code></pre>

    <p>Ubuntu 11.10</p>

    <pre><code>prompt$ sudo su -
prompt# export REALLY_GEM_UPDATE_SYSTEM=true
prompt# gem update --system
prompt# exit
</code></pre>
  </li>
</ol><h2 id="redhatfedora">RedHat/Fedora</h2>

<p>From a terminal, use the <code>yum</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install Ruby:</p>

    <p><code>prompt$ sudo yum install ruby</code></p>
  </li>
  <li>
    <p>If you are using RedHat Enterprise Linux 6, enable the <em>Optional</em> channel for your host by logging into <a href="https://rhn.redhat.com/">Red Hat Network (RHN)</a>.</p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ sudo yum install rubygems</code></p>
  </li>
</ol><h2 id="centos">Centos</h2>
<p>From a terminal, use the <code>yum</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install the basic Ruby package:</p>

    <p><code>prompt$ yum install -y ruby</code></p>
  </li>
  <li>
    <p>Install additional Ruby packages and documentation:</p>

    <p><code>prompt$ yum install -y ruby-devel ruby-docs ruby-ri ruby-rdoc</code></p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ yum install -y rubygems</code></p>
  </li>
</ol><h2 id="suse">SuSE</h2>

<p>From a terminal, use the <code>yast</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install Ruby:</p>

    <p><code>prompt$ yast -i ruby</code></p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ yast -i rubygems</code></p>
  </li>
</ol><h2 id="debian">Debian</h2>

<p>You use Ruby Version Manager (<code>rvm</code>) to install Ruby and RubyGems on Debian.  The following procedure shows how to install <code>rvm</code> if you have not already done so.</p>

<ol>
<li>
    <p>Use the following <code>apt-get</code> command-line tool to install the required packages:</p>

    <p><code>prompt$ sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev</code></p>
  </li>
  <li>
    <p>Run the <code>bash</code> script to install <code>rvm</code> from <a href="https://rvm.beginrescueend.com/install/rvm">Ruby Version Manager</a>.</p>

    <p><code>prompt$ bash &lt;&lt; curl -s https://rvm.beginrescueend.com/install/rvm</code></p>
  </li>
  <li>
    <p>Edit your <em>~/.bashrc</em> file as described by the RVM installation in the precding step.</p>
  </li>
  <li>
    <p>Use <code>rvm</code> to install Ruby and RubyGems as shown:</p>

    <p><code>prompt$ rvm package install zlib</code></p>

    <p><code>prompt$ rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr</code></p>

    <p><code>prompt$ rvm use 1.9.2</code></p>
  </li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"¸The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers.

## Windows
Download and install [Ruby Installer for Windows](http://www.rubyinstaller.org/ "ruby installer for windows"). The installer already includes RubyGems.

Be sure you use the Ruby-enabled command prompt window when you later install and use `vmc`.   You access this command prompt from the Windows Start menu (**All Programs > Ruby \<version\> > Start Command Prompt with Ruby**).

Finally, update RubyGems from the Ruby Command Prompt:

    prompt> gem update --system

### Support for Windows Gemfiles

Once you have Ruby installed, you can follow the instructions on [Ruby Apps on Cloud Foundry](ruby-cf.html) to learn the details of pushing an app and working with your Gemfile

One thing to note for Windows users is the following:

When a `Gemfile.lock` is generated on a Windows machine, it often contains gems with Windows-specific versions.
Versions of gems such as mysql2, thin, and pg end up containing â€œ-x86-mingw32â€.

For example, running `bundle install` on a Windows machine with a Gemfile that looks like this:

``` ruby
gem â€˜sinatraâ€™
gem â€˜mysql2â€™
gem â€˜jsonâ€™
```

Would result in a Gemfile.lock that looks like this:

``` ruby
GEM
  remote: http://rubygems.org/
  specs:
    json (1.7.3)
    mysql2 (0.3.11-x86-mingw32)
    rack (1.4.1)
    rack-protection (1.2.0)
      rack
    sinatra (1.3.2)
      rack (~> 1.3, >= 1.3.6)
      rack-protection (~> 1.2)
      tilt (~> 1.3, >= 1.3.3)
    tilt (1.3.3)

PLATFORMS
  x86-mingw32

DEPENDENCIES
  json
  mysql2
  sinatra

```

Now Cloud Foundry will be able to properly install these gems without the need to modify your `Gemfile.lock`

## Mac OS X
Version 10.5 and higher of Mac OS X already ships with Ruby and RubyGems installed.

If you are using an earlier version of Mac OS, download and install the latest version of [Ruby](http://www.ruby-lang.org/en/downloads/ "ruby source code") and then [RubyGems](http://rubygems.org/pages/download).

## Ubuntu

From a terminal, use the `apt-get` command-line tool to install Ruby and RubyGems, as shown below.

1. Install the full Ruby package and RubyGems:

    `prompt$ sudo apt-get install ruby-full rubygems`

    Consult your system administrator for any required authentication credentials for the `sudo` command.

2.  Test to ensure that the `gem` command is in your path:

    `prompt$ which gem`

    If the command is not found, then update your `PATH` variable accordingly.  For example, you can update your `.bashrc` file with the following line:

    `export PATH=$PATH:/var/lib/gems/1.8/bin`

3.	Update RubyGems:

    Ubuntu 10.04

        prompt$ sudo gem install rubygems-update
        prompt$ sudo /var/lib/gems/1.8/bin/update_rubygems

    Ubuntu 11.10

        prompt$ sudo su -
        prompt# export REALLY_GEM_UPDATE_SYSTEM=true
        prompt# gem update --system
        prompt# exit

## RedHat/Fedora

From a terminal, use the `yum` command-line tool to install Ruby and RubyGems, as shown below.

1. Install Ruby:

    `prompt$ sudo yum install ruby`

2.  If you are using RedHat Enterprise Linux 6, enable the *Optional* channel for your host by logging into [Red Hat Network (RHN)](https://rhn.redhat.com/).

3. Install RubyGems:

    `prompt$ sudo yum install rubygems`

## Centos
From a terminal, use the `yum` command-line tool to install Ruby and RubyGems, as shown below.

1. Install the basic Ruby package:

    `prompt$ yum install -y ruby`

2. Install additional Ruby packages and documentation:

    `prompt$ yum install -y ruby-devel ruby-docs ruby-ri ruby-rdoc`

3. Install RubyGems:

    `prompt$ yum install -y rubygems`

## SuSE

From a terminal, use the `yast` command-line tool to install Ruby and RubyGems, as shown below.

1. Install Ruby:

    `prompt$ yast -i ruby`

2. Install RubyGems:

    `prompt$ yast -i rubygems`

## Debian

You use Ruby Version Manager (`rvm`) to install Ruby and RubyGems on Debian.  The following procedure shows how to install `rvm` if you have not already done so.

1.  Use the following `apt-get` command-line tool to install the required packages:

    `prompt$ sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev`

2.  Run the `bash` script to install `rvm` from [Ruby Version Manager](https://rvm.beginrescueend.com/install/rvm).

    `prompt$ bash << curl -s https://rvm.beginrescueend.com/install/rvm`

3.  Edit your *~/.bashrc* file as described by the RVM installation in the precding step.

4. Use `rvm` to install Ruby and RubyGems as shown:

    `prompt$ rvm package install zlib`

    `prompt$ rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr`

    `prompt$ rvm use 1.9.2`;T;
I"w#<p>The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers.</p>

<h2 id="windows">Windows</h2>
<p>Download and install <a href="http://www.rubyinstaller.org/" title="ruby installer for windows">Ruby Installer for Windows</a>. The installer already includes RubyGems.</p>

<p>Be sure you use the Ruby-enabled command prompt window when you later install and use <code>vmc</code>.   You access this command prompt from the Windows Start menu (<strong>All Programs &gt; Ruby &lt;version&gt; &gt; Start Command Prompt with Ruby</strong>).</p>

<p>Finally, update RubyGems from the Ruby Command Prompt:</p>

<pre><code>prompt&gt; gem update --system
</code></pre>

<h3 id="support-for-windows-gemfiles">Support for Windows Gemfiles</h3>

<p>Once you have Ruby installed, you can follow the instructions on <a href="ruby-cf.html">Ruby Apps on Cloud Foundry</a> to learn the details of pushing an app and working with your Gemfile</p>

<p>One thing to note for Windows users is the following:</p>

<p>When a <code>Gemfile.lock</code> is generated on a Windows machine, it often contains gems with Windows-specific versions.
Versions of gems such as mysql2, thin, and pg end up containing â€œ-x86-mingw32â€.</p>

<p>For example, running <code>bundle install</code> on a Windows machine with a Gemfile that looks like this:</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="err">â€˜</span><span class="n">sinatra</span><span class="err">â€™</span>
<span class="n">gem</span> <span class="err">â€˜</span><span class="n">mysql2</span><span class="err">â€™</span>
<span class="n">gem</span> <span class="err">â€˜</span><span class="n">json</span><span class="err">â€™</span></code></pre>

<p>Would result in a Gemfile.lock that looks like this:</p>

<pre><code class="language-ruby"><span class="no">GEM</span>
  <span class="n">remote</span><span class="p">:</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">rubygems</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>
  <span class="n">specs</span><span class="p">:</span>
    <span class="n">json</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mysql2</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">11</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="n">mingw32</span><span class="p">)</span>
    <span class="n">rack</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rack</span><span class="o">-</span><span class="n">protection</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">rack</span>
    <span class="n">sinatra</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">rack</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
      <span class="n">rack</span><span class="o">-</span><span class="n">protection</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">tilt</span> <span class="p">(</span><span class="o">~&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>

<span class="no">PLATFORMS</span>
  <span class="n">x86</span><span class="o">-</span><span class="n">mingw32</span>

<span class="no">DEPENDENCIES</span>
  <span class="n">json</span>
  <span class="n">mysql2</span>
  <span class="n">sinatra</span></code></pre>

<p>Now Cloud Foundry will be able to properly install these gems without the need to modify your <code>Gemfile.lock</code></p>

<h2 id="mac-os-x">Mac OS X</h2>
<p>Version 10.5 and higher of Mac OS X already ships with Ruby and RubyGems installed.</p>

<p>If you are using an earlier version of Mac OS, download and install the latest version of <a href="http://www.ruby-lang.org/en/downloads/" title="ruby source code">Ruby</a> and then <a href="http://rubygems.org/pages/download">RubyGems</a>.</p>

<h2 id="ubuntu">Ubuntu</h2>

<p>From a terminal, use the <code>apt-get</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install the full Ruby package and RubyGems:</p>

    <p><code>prompt$ sudo apt-get install ruby-full rubygems</code></p>

    <p>Consult your system administrator for any required authentication credentials for the <code>sudo</code> command.</p>
  </li>
  <li>
    <p>Test to ensure that the <code>gem</code> command is in your path:</p>

    <p><code>prompt$ which gem</code></p>

    <p>If the command is not found, then update your <code>PATH</code> variable accordingly.  For example, you can update your <code>.bashrc</code> file with the following line:</p>

    <p><code>export PATH=$PATH:/var/lib/gems/1.8/bin</code></p>
  </li>
  <li>
    <p>Update RubyGems:</p>

    <p>Ubuntu 10.04</p>

    <pre><code>prompt$ sudo gem install rubygems-update
prompt$ sudo /var/lib/gems/1.8/bin/update_rubygems
</code></pre>

    <p>Ubuntu 11.10</p>

    <pre><code>prompt$ sudo su -
prompt# export REALLY_GEM_UPDATE_SYSTEM=true
prompt# gem update --system
prompt# exit
</code></pre>
  </li>
</ol><h2 id="redhatfedora">RedHat/Fedora</h2>

<p>From a terminal, use the <code>yum</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install Ruby:</p>

    <p><code>prompt$ sudo yum install ruby</code></p>
  </li>
  <li>
    <p>If you are using RedHat Enterprise Linux 6, enable the <em>Optional</em> channel for your host by logging into <a href="https://rhn.redhat.com/">Red Hat Network (RHN)</a>.</p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ sudo yum install rubygems</code></p>
  </li>
</ol><h2 id="centos">Centos</h2>
<p>From a terminal, use the <code>yum</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install the basic Ruby package:</p>

    <p><code>prompt$ yum install -y ruby</code></p>
  </li>
  <li>
    <p>Install additional Ruby packages and documentation:</p>

    <p><code>prompt$ yum install -y ruby-devel ruby-docs ruby-ri ruby-rdoc</code></p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ yum install -y rubygems</code></p>
  </li>
</ol><h2 id="suse">SuSE</h2>

<p>From a terminal, use the <code>yast</code> command-line tool to install Ruby and RubyGems, as shown below.</p>

<ol>
<li>
    <p>Install Ruby:</p>

    <p><code>prompt$ yast -i ruby</code></p>
  </li>
  <li>
    <p>Install RubyGems:</p>

    <p><code>prompt$ yast -i rubygems</code></p>
  </li>
</ol><h2 id="debian">Debian</h2>

<p>You use Ruby Version Manager (<code>rvm</code>) to install Ruby and RubyGems on Debian.  The following procedure shows how to install <code>rvm</code> if you have not already done so.</p>

<ol>
<li>
    <p>Use the following <code>apt-get</code> command-line tool to install the required packages:</p>

    <p><code>prompt$ sudo apt-get install gcccurl git-core build-essential libssl-dev libreadline5 libreadline5-dev zlib1g zlib1g-dev</code></p>
  </li>
  <li>
    <p>Run the <code>bash</code> script to install <code>rvm</code> from <a href="https://rvm.beginrescueend.com/install/rvm">Ruby Version Manager</a>.</p>

    <p><code>prompt$ bash &lt;&lt; curl -s https://rvm.beginrescueend.com/install/rvm</code></p>
  </li>
  <li>
    <p>Edit your <em>~/.bashrc</em> file as described by the RVM installation in the precding step.</p>
  </li>
  <li>
    <p>Use <code>rvm</code> to install Ruby and RubyGems as shown:</p>

    <p><code>prompt$ rvm package install zlib</code></p>

    <p><code>prompt$ rvm install 1.9.2 -C --with-zlib-dir=$rvm_path/usr</code></p>

    <p><code>prompt$ rvm use 1.9.2</code></p>
  </li>
</ol>;T;@}I")/frameworks/ruby/ruby-rails-sinatra/;T{;{	;I"‡7<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/ruby-rails-sinatra.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby, Rails, Sinatra' property='og:title'>
<meta content='Working with Ruby, Rails and Sinatra' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby, Rails, Sinatra</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby, Rails, Sinatra</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Working with Ruby, Rails and Sinatra</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/sinatra" rel="tag">sinatra</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Working with Ruby, Rails and Sinatra on Cloud Foundry is easy. The following documents will help you get started:</p>

<h2 id="ruby">Ruby</h2>
<ul>
<li><a href="/frameworks/ruby/ruby.html">Ruby Application Development with Cloud Foundry Overview</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html">How to Install Ruby and RubyGems</a></li>
  <li><a href="/frameworks/ruby/ruby-simple.html">Creating a Simple Ruby Application</a></li>
  <li><a href="/frameworks/ruby/ruby-cf.html">Things to Know about Ruby, Rails and Cloud Foundry</a></li>
</ul><h2 id="rails">Rails</h2>

<ul>
<li><a href="/frameworks/ruby/rails-3-0.html">Ruby on Rails 3.0 Development with Cloud Foundry</a></li>
  <li><a href="/frameworks/ruby/rails-3-1.html">Ruby on Rails 3.1 Development with Cloud Foundry</a></li>
</ul><h2 id="sinatra">Sinatra</h2>

<ul>
<li><a href="/frameworks/ruby/sinatra.html">Sinatra Development with Cloud Foundry</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÍWorking with Ruby, Rails and Sinatra on Cloud Foundry is easy. The following documents will help you get started:

## Ruby
+ [Ruby Application Development with Cloud Foundry Overview](/frameworks/ruby/ruby.html)
+ [How to Install Ruby and RubyGems](/frameworks/ruby/installing-ruby.html)
+ [Creating a Simple Ruby Application](/frameworks/ruby/ruby-simple.html)
+ [Things to Know about Ruby, Rails and Cloud Foundry](/frameworks/ruby/ruby-cf.html)

## Rails

+ [Ruby on Rails 3.0 Development with Cloud Foundry](/frameworks/ruby/rails-3-0.html)
+ [Ruby on Rails 3.1 Development with Cloud Foundry](/frameworks/ruby/rails-3-1.html)

## Sinatra

+ [Sinatra Development with Cloud Foundry](/frameworks/ruby/sinatra.html);T;
I"«<p>Working with Ruby, Rails and Sinatra on Cloud Foundry is easy. The following documents will help you get started:</p>

<h2 id="ruby">Ruby</h2>
<ul>
<li><a href="/frameworks/ruby/ruby.html">Ruby Application Development with Cloud Foundry Overview</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html">How to Install Ruby and RubyGems</a></li>
  <li><a href="/frameworks/ruby/ruby-simple.html">Creating a Simple Ruby Application</a></li>
  <li><a href="/frameworks/ruby/ruby-cf.html">Things to Know about Ruby, Rails and Cloud Foundry</a></li>
</ul><h2 id="rails">Rails</h2>

<ul>
<li><a href="/frameworks/ruby/rails-3-0.html">Ruby on Rails 3.0 Development with Cloud Foundry</a></li>
  <li><a href="/frameworks/ruby/rails-3-1.html">Ruby on Rails 3.1 Development with Cloud Foundry</a></li>
</ul><h2 id="sinatra">Sinatra</h2>

<ul>
<li><a href="/frameworks/ruby/sinatra.html">Sinatra Development with Cloud Foundry</a></li>
</ul>;T;@ƒI"/frameworks/ruby/ruby/;T{;{	;I"zF<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/ruby/ruby.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Ruby' property='og:title'>
<meta content='Ruby Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/overview" rel="tag">overview</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This guide for Ruby developers describes Cloud Foundry support for Ruby
applications, including applications built using the Sinatra or Ruby on Rails
frameworks.</p>

<p>This guide makes the following assumptions:</p>

<ul>
<li>You have <a href="installing-ruby.html">installed Ruby and Ruby Gems</a>
</li>
  <li>You have <a href="/tools/vmc/installing-vmc.html">installed vmc</a>
</li>
  <li>You have a <a href="http://www.cloudfoundry.com/signup">Cloud Foundry account</a>
</li>
  <li>You are proficient in developing Ruby applications with your framework of
choice</li>
</ul><p>Subtopics:</p>

<ul>
<li><a href="#supported-ruby-versions">Ruby Versions</a></li>
  <li><a href="#gemfile-and-gem-support">Gemfile and Gem Support</a></li>
  <li><a href="#using-cloud-foundry-services">Using Cloud Foundry Services with Ruby</a></li>
  <li><a href="#what-to-do-next">What to do Next</a></li>
</ul><h2 id="supported-ruby-versions">Supported Ruby Versions</h2>

<p>As of this writing, Cloud Foundry supports <code>ruby 1.8.7-p302</code> or higher and
<code>ruby 1.9.2-p180</code> or higher.
Ruby 1.8.7 is the default. If you use Ruby 1.9.2, add the vmc <code>--runtime ruby19</code>
option when you push your application to Cloud Foundry:</p>

<pre><code>vmc push &lt;appname&gt; --runtime ruby19
</code></pre>

<h2 id="gemfile-and-gem-support">Gemfile and Gem Support</h2>

<p>Cloud Foundry requires a Gemfile in the root of your application that lists
the gems your application depends upon.</p>

<p>You should use <a href="http://gembundler.com">Bundler</a> to package your applications.
Run <code>bundle install;bundle package</code> each time you modify your Gemfile and
before any <code>vmc push</code> or <code>vmc update</code> command.</p>

<p>For more details see:</p>

<ul>
<li><a href="/frameworks/ruby/ruby-cf.html">Ruby on Cloud Foundry</a></li>
</ul><h2 id="using-ruby-on-rails-with-cloud-foundry">Using Ruby on Rails with Cloud Foundry</h2>

<p>Ruby on Rails works well with Cloud Foundry. There are some differences in the
requirements for Rails 3.0 and 3.1 or 3.2 which you can read about at these links:</p>

<ul>
<li><a href="/frameworks/ruby/rails-3-0.html">Ruby on Rails 3.0</a></li>
  <li><a href="/frameworks/ruby/rails-3-1.html">Ruby on Rails &gt;= 3.1</a></li>
</ul><h2 id="using-cloud-foundry-services">Using Cloud Foundry Services</h2>

<p>You can use any of the following Cloud Foundry services in your Ruby application:</p>

<ul>
<li>
<a href="http://www.mysql.com/">MySQL</a>, the open source relational database</li>
  <li>
<a href="http://www.mongodb.org/">MongoDB</a>, the scalable, open,
document-based database</li>
  <li>
<a href="http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director">vFabric Postgres</a>,
the VMware vFabric Postgres 9.0 relational database</li>
  <li>
<a href="http://www.rabbitmq.com/">RabbitMQ</a>, for messaging</li>
  <li>
<a href="http://redis.io/">Redis</a>, the open source key-value data structure server</li>
</ul><p>While you develop your application, you can run these services locally, or you
can use <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to host your application.
An advantage of using Micro Cloud Foundry is that your application runs in an
environment that is very similar to Cloud Foundry. Also, with Micro Cloud
Foundry, you do not have to set up local services, and you do not have to tool
your application to connect to different services for your development and
deployment environments.</p>

<p>Following are examples and tutorials for using the Cloud Foundry services with Ruby and Ruby frameworks.</p>

<ul>
<li><a href="/services/mysql/ruby-mysql.html">MySQL</a></li>
  <li><a href="/services/mongodb/ruby-mongodb.html">MongoDB</a></li>
  <li><a href="/services/mongodb/ruby-mongodb-gridfs.html">MongoDB with GridFS</a></li>
  <li><a href="/services/rabbitmq/ruby-rabbitmq.html">RabbitMQ</a></li>
</ul><h2 id="what-to-do-next">What to do Next</h2>

<ul>
<li>
<a href="/tools/vmc/installing-vmc.html">VMC Installation</a> describes how to install the Cloud Foundry command-line interface. If you have Ruby installed, it is as simple as installing the vmc gem.</li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></li>
  <li>
<a href="ruby-simple.html">Creating a Simple Ruby Application</a> is a tutorial that shows you how to create a simple Sinatra application and deploy it to Cloud Foundry.</li>
  <li>
<a href="rails-3-0.html">Ruby on Rails 3.0 Development with Cloud Foundry</a> provides the information you need to successfully deploy Rails 3.0 applications on Cloud Foundry.</li>
  <li>
<a href="rails-3-1.html">Ruby on Rails 3.1 Development with Cloud Foundry</a> provides the information you need to successfully deploy Rails 3.1 applications on Cloud Foundry.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"zThis guide for Ruby developers describes Cloud Foundry support for Ruby
applications, including applications built using the Sinatra or Ruby on Rails
frameworks.

This guide makes the following assumptions:

-  You have [installed Ruby and Ruby Gems](installing-ruby.html)
-  You have [installed vmc](/tools/vmc/installing-vmc.html)
-  You have a [Cloud Foundry account](http://www.cloudfoundry.com/signup)
-  You are proficient in developing Ruby applications with your framework of
   choice

Subtopics:

-  [Ruby Versions](#supported-ruby-versions)
-  [Gemfile and Gem Support](#gemfile-and-gem-support)
-  [Using Cloud Foundry Services with Ruby](#using-cloud-foundry-services)
-  [What to do Next](#what-to-do-next)

## Supported Ruby Versions

As of this writing, Cloud Foundry supports `ruby 1.8.7-p302` or higher and
`ruby 1.9.2-p180` or higher.
Ruby 1.8.7 is the default. If you use Ruby 1.9.2, add the vmc `--runtime ruby19`
option when you push your application to Cloud Foundry:

    vmc push <appname> --runtime ruby19

## Gemfile and Gem Support

Cloud Foundry requires a Gemfile in the root of your application that lists
the gems your application depends upon.

You should use [Bundler](http://gembundler.com) to package your applications.
Run `bundle install;bundle package` each time you modify your Gemfile and
before any `vmc push` or `vmc update` command.

For more details see:

+ [Ruby on Cloud Foundry](/frameworks/ruby/ruby-cf.html)

## Using Ruby on Rails with Cloud Foundry

Ruby on Rails works well with Cloud Foundry. There are some differences in the
requirements for Rails 3.0 and 3.1 or 3.2 which you can read about at these links:

+   [Ruby on Rails 3.0](/frameworks/ruby/rails-3-0.html)
+   [Ruby on Rails >= 3.1](/frameworks/ruby/rails-3-1.html)

## Using Cloud Foundry Services

You can use any of the following Cloud Foundry services in your Ruby application:

-   [MySQL](http://www.mysql.com/), the open source relational database
-   [MongoDB](http://www.mongodb.org/), the scalable, open,
    document-based database
-   [vFabric Postgres](http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director),
    the VMware vFabric Postgres 9.0 relational database
-   [RabbitMQ](http://www.rabbitmq.com/), for messaging
-   [Redis](http://redis.io/), the open source key-value data structure server

While you develop your application, you can run these services locally, or you
can use [Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html) to host your application.
An advantage of using Micro Cloud Foundry is that your application runs in an
environment that is very similar to Cloud Foundry. Also, with Micro Cloud
Foundry, you do not have to set up local services, and you do not have to tool
your application to connect to different services for your development and
deployment environments.

Following are examples and tutorials for using the Cloud Foundry services with Ruby and Ruby frameworks.

-   [MySQL](/services/mysql/ruby-mysql.html)
-   [MongoDB](/services/mongodb/ruby-mongodb.html)
-   [MongoDB with GridFS](/services/mongodb/ruby-mongodb-gridfs.html)
-   [RabbitMQ](/services/rabbitmq/ruby-rabbitmq.html)

## What to do Next

-   [VMC Installation](/tools/vmc/installing-vmc.html) describes how to install the Cloud Foundry command-line interface. If you have Ruby installed, it is as simple as installing the vmc gem.
-   [VMC Quick Reference](/tools/vmc/vmc-quick-ref.html)
-   [Creating a Simple Ruby Application](ruby-simple.html) is a tutorial that shows you how to create a simple Sinatra application and deploy it to Cloud Foundry.
-   [Ruby on Rails 3.0 Development with Cloud Foundry](rails-3-0.html) provides the information you need to successfully deploy Rails 3.0 applications on Cloud Foundry.
-   [Ruby on Rails 3.1 Development with Cloud Foundry](rails-3-1.html) provides the information you need to successfully deploy Rails 3.1 applications on Cloud Foundry.;T;
I"í<p>This guide for Ruby developers describes Cloud Foundry support for Ruby
applications, including applications built using the Sinatra or Ruby on Rails
frameworks.</p>

<p>This guide makes the following assumptions:</p>

<ul>
<li>You have <a href="installing-ruby.html">installed Ruby and Ruby Gems</a>
</li>
  <li>You have <a href="/tools/vmc/installing-vmc.html">installed vmc</a>
</li>
  <li>You have a <a href="http://www.cloudfoundry.com/signup">Cloud Foundry account</a>
</li>
  <li>You are proficient in developing Ruby applications with your framework of
choice</li>
</ul><p>Subtopics:</p>

<ul>
<li><a href="#supported-ruby-versions">Ruby Versions</a></li>
  <li><a href="#gemfile-and-gem-support">Gemfile and Gem Support</a></li>
  <li><a href="#using-cloud-foundry-services">Using Cloud Foundry Services with Ruby</a></li>
  <li><a href="#what-to-do-next">What to do Next</a></li>
</ul><h2 id="supported-ruby-versions">Supported Ruby Versions</h2>

<p>As of this writing, Cloud Foundry supports <code>ruby 1.8.7-p302</code> or higher and
<code>ruby 1.9.2-p180</code> or higher.
Ruby 1.8.7 is the default. If you use Ruby 1.9.2, add the vmc <code>--runtime ruby19</code>
option when you push your application to Cloud Foundry:</p>

<pre><code>vmc push &lt;appname&gt; --runtime ruby19
</code></pre>

<h2 id="gemfile-and-gem-support">Gemfile and Gem Support</h2>

<p>Cloud Foundry requires a Gemfile in the root of your application that lists
the gems your application depends upon.</p>

<p>You should use <a href="http://gembundler.com">Bundler</a> to package your applications.
Run <code>bundle install;bundle package</code> each time you modify your Gemfile and
before any <code>vmc push</code> or <code>vmc update</code> command.</p>

<p>For more details see:</p>

<ul>
<li><a href="/frameworks/ruby/ruby-cf.html">Ruby on Cloud Foundry</a></li>
</ul><h2 id="using-ruby-on-rails-with-cloud-foundry">Using Ruby on Rails with Cloud Foundry</h2>

<p>Ruby on Rails works well with Cloud Foundry. There are some differences in the
requirements for Rails 3.0 and 3.1 or 3.2 which you can read about at these links:</p>

<ul>
<li><a href="/frameworks/ruby/rails-3-0.html">Ruby on Rails 3.0</a></li>
  <li><a href="/frameworks/ruby/rails-3-1.html">Ruby on Rails &gt;= 3.1</a></li>
</ul><h2 id="using-cloud-foundry-services">Using Cloud Foundry Services</h2>

<p>You can use any of the following Cloud Foundry services in your Ruby application:</p>

<ul>
<li>
<a href="http://www.mysql.com/">MySQL</a>, the open source relational database</li>
  <li>
<a href="http://www.mongodb.org/">MongoDB</a>, the scalable, open,
document-based database</li>
  <li>
<a href="http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director">vFabric Postgres</a>,
the VMware vFabric Postgres 9.0 relational database</li>
  <li>
<a href="http://www.rabbitmq.com/">RabbitMQ</a>, for messaging</li>
  <li>
<a href="http://redis.io/">Redis</a>, the open source key-value data structure server</li>
</ul><p>While you develop your application, you can run these services locally, or you
can use <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to host your application.
An advantage of using Micro Cloud Foundry is that your application runs in an
environment that is very similar to Cloud Foundry. Also, with Micro Cloud
Foundry, you do not have to set up local services, and you do not have to tool
your application to connect to different services for your development and
deployment environments.</p>

<p>Following are examples and tutorials for using the Cloud Foundry services with Ruby and Ruby frameworks.</p>

<ul>
<li><a href="/services/mysql/ruby-mysql.html">MySQL</a></li>
  <li><a href="/services/mongodb/ruby-mongodb.html">MongoDB</a></li>
  <li><a href="/services/mongodb/ruby-mongodb-gridfs.html">MongoDB with GridFS</a></li>
  <li><a href="/services/rabbitmq/ruby-rabbitmq.html">RabbitMQ</a></li>
</ul><h2 id="what-to-do-next">What to do Next</h2>

<ul>
<li>
<a href="/tools/vmc/installing-vmc.html">VMC Installation</a> describes how to install the Cloud Foundry command-line interface. If you have Ruby installed, it is as simple as installing the vmc gem.</li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></li>
  <li>
<a href="ruby-simple.html">Creating a Simple Ruby Application</a> is a tutorial that shows you how to create a simple Sinatra application and deploy it to Cloud Foundry.</li>
  <li>
<a href="rails-3-0.html">Ruby on Rails 3.0 Development with Cloud Foundry</a> provides the information you need to successfully deploy Rails 3.0 applications on Cloud Foundry.</li>
  <li>
<a href="rails-3-1.html">Ruby on Rails 3.1 Development with Cloud Foundry</a> provides the information you need to successfully deploy Rails 3.1 applications on Cloud Foundry.</li>
</ul>;T;@‰I"/getting-started/;T{;{	;I"U8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/getting-started.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Get Started' property='og:title'>
<meta content='Getting Started with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Get Started</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Get Started</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Getting Started with Cloud Foundry</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<ol>
<li>
    <p>Register at the <a href="http://www.cloudfoundry.com">Cloud Foundry Web page</a>. You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>Install one or both of the Cloud Foundry tools that you use to deploy and manage applications:</p>

    <ul>
<li>
<a href="/tools/vmc/installing-vmc.html">VMC</a> if you prefer using command-line utilities.</li>
      <li>
<a href="/tools/STS/configuring-STS.html">Cloud Foundry extension to Spring Tool Suite (STS) or Eclipse</a> if you prefer using graphical IDEs.</li>
    </ul>
</li>
  <li>
    <p>Optionally install <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to develop on a version of Cloud Foundry that runs on your local computer.</p>
  </li>
  <li>
    <p><a href="frameworks.html">Configure your applications to deploy on Cloud Foundry.</a></p>

    <p>You may not need to perform any configuration at all. However, if your
 application requires multiple services or you want more control, then
 you need to do some minimal configuration.</p>
  </li>
  <li>
    <p><a href="/tools/deploying-apps.html">Deploy your application using VMC or STS.</a></p>

    <p>This step includes creating service instances, binding the service
 instances to your application, and managing the lifecycle of your
 deployed application.</p>
  </li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"k1. Register at the [Cloud Foundry Web page](http://www.cloudfoundry.com). You will receive an email with your user credentials.

2. Install one or both of the Cloud Foundry tools that you use to deploy and manage applications:

	+ [VMC](/tools/vmc/installing-vmc.html) if you prefer using command-line utilities.
	+ [Cloud Foundry extension to Spring Tool Suite (STS) or Eclipse](/tools/STS/configuring-STS.html) if you prefer using graphical IDEs.

3. Optionally install [Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html) to develop on a version of Cloud Foundry that runs on your local computer.

4. [Configure your applications to deploy on Cloud Foundry.](frameworks.html)

    You may not need to perform any configuration at all. However, if your
    application requires multiple services or you want more control, then
    you need to do some minimal configuration.

5. [Deploy your application using VMC or STS.](/tools/deploying-apps.html)

    This step includes creating service instances, binding the service
    instances to your application, and managing the lifecycle of your
    deployed application.;T;
I"L<ol>
<li>
    <p>Register at the <a href="http://www.cloudfoundry.com">Cloud Foundry Web page</a>. You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>Install one or both of the Cloud Foundry tools that you use to deploy and manage applications:</p>

    <ul>
<li>
<a href="/tools/vmc/installing-vmc.html">VMC</a> if you prefer using command-line utilities.</li>
      <li>
<a href="/tools/STS/configuring-STS.html">Cloud Foundry extension to Spring Tool Suite (STS) or Eclipse</a> if you prefer using graphical IDEs.</li>
    </ul>
</li>
  <li>
    <p>Optionally install <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to develop on a version of Cloud Foundry that runs on your local computer.</p>
  </li>
  <li>
    <p><a href="frameworks.html">Configure your applications to deploy on Cloud Foundry.</a></p>

    <p>You may not need to perform any configuration at all. However, if your
 application requires multiple services or you want more control, then
 you need to do some minimal configuration.</p>
  </li>
  <li>
    <p><a href="/tools/deploying-apps.html">Deploy your application using VMC or STS.</a></p>

    <p>This step includes creating service instances, binding the service
 instances to your application, and managing the lifecycle of your
 deployed application.</p>
  </li>
</ol>;T;@I"
/faq/;T{;{	;I"z{<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/faq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | FAQ' property='og:title'>
<meta content='Frequently Asked Questions' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | FAQ</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>FAQ</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Frequently Asked Questions</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/faq" rel="tag">faq</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h3 id="how-do-i-get-started-on-cloud-foundry">How Do I Get Started on Cloud Foundry</h3>
<p>For resources on getting started with Cloud Foundry, please refer to our <a href="/getting-started.html">Getting Started Guide</a>.</p>

<h3 id="how-can-i-change-my-cloudfoundrycom-password">How can I change my CloudFoundry.com password?</h3>

<p>Please use the following link to reset your CloudFoundry.com password: <a href="https://my.cloudfoundry.com/passwd">https://my.cloudfoundry.com/passwd</a></p>

<h3 id="im-having-trouble-with-my-login-credentials">Iâ€™m having trouble with my login credentials</h3>

<p>Here are a few things you can do to make sure that you are using your credentials correctly:</p>

<ul>
<li>Verify that your target is set correctly ($vmc target api.cloudfoundry.com)</li>
  <li>Check the target ($vmc target and $vmc info)</li>
  <li>Verify that you are using the vmc client ($vmc login [email] [password] )</li>
</ul><p>Please try with the temporary password provided in the Welcome email from Cloud Foundry after sign-up.  If you had subsequently changed that with a â€˜vmc passwdâ€™ command, please try with that password also.</p>

<p>If you are still not able to use vmc, open a ticket by clicking on the â€œSubmit a requestâ€ tab. Make sure to provide us with the details and the support team will look into it for you.</p>

<h3 id="why-cant-i-register-the-application-name-i-want">Why canâ€™t I register the application name I want?</h3>

<p>Application names must be longer than 3 characters. In addition, please note that some names are reserved and will not be allowed even if they are of the right length.</p>

<p>If you receive the message: â€œThe URI: â€˜fo.cloudfoundry.comâ€™ has already been taken or reservedâ€, please pick another name for your application.</p>

<h3 id="can-apps-use-the-local-file-system-for-storage">Can apps use the local file system for storage?</h3>
<p>Your application needs to treat local file storage as ephemeral, which can disappear when your application stops, crashes, or moves. It should not be used for durable storage of content such as user-uploaded files. Further, if more than one instance of your app is running the local storage is only visible to a specific instance of the app, and is not visible or shared across all instances. If persistent storage is required, a local service such as <a href="http://www.mongodb.org/display/DOCS/GridFS">MongoDB GridFS</a> or external blob stores such as <a href="http://developers.blog.box.com/2011/12/14/deploying-to-cloud-foundry-and-heroku-from-box/">Box.net</a> or <a href="http://aws.amazon.com/s3/">Amazon S3</a> can be used.</p>

<h3 id="is-there-session-support">Is there session support?</h3>
<p>When scaling an app to multiple instances the topic of session management arises. Cloud Foundry uses session affinity, also known as sticky sessions: when a user login request is handled by a particular instance of your app, future requests from that user/session will be routed to the same app instance. Sticky sessions are provided for all apps and do not have to be configured, with the exception of Node.js. Node.js apps need to set a cookie named JSESSIONID to a unique value for each user/session.</p>

<p>Cloud Foundry does not offer session replication: if the particular instance crashes the user is routed to another instance which wonâ€™t have authentication data in the session, and the user will have to log in again.</p>

<h3 id="what-happens-when-a-service-runs-out-of-capacity">What happens when a service runs out of capacity?</h3>
<p>When a service runs out of capacity (e.g. MySQL hits the 128MB size limit), the service switches to a read/delete-only mode. For example, on a SQL service removing data and reading data is allowed, but writing more data is disabled:</p>

<pre class="terminal">
delete from table where ... # allowed
drop table ... # allowed
select ... from ... # allowed
insert into ... # not allowed
update ... # not allowed
</pre>

<p>The application bound to a service that has run out of capacity may see errors such as â€œINSERT is disabled.â€ Other services (redis, MongoDB) will exhibit similar behavior.</p>

<h3 id="can-i-send-and-receive-email-from-my-app">Can I send and receive email from my app?</h3>
<p>Applications cannot send outbound email via TCP port 25. An app can use an external email service available on a different port (such as 587 for SMTP-AUTH). Applications cannot receive email by listening on port 25 either. We recommend using an external mail service such as <a href="http://sendgrid.com/">SendGrid</a> or <a href="http://mailgun.net/">Mailgun</a>.</p>

<h3 id="is-there-a-firewall-that-prevents-my-app-from-accessing-external-services">Is there a firewall that prevents my app from accessing external services?</h3>
<p>No, your application has direct access to the internet with the exception of connecting to TCP port 25 (used for sending email).</p>

<h3 id="why-is-my-app-returning-504-gateway-time-out-errors">Why is my app returning â€œ504 Gateway Time-outâ€ errors?</h3>
<p>The error page originates from the CloudFoundry.com HTTP Router and not your application. Application requests taking longer than 30 seconds are terminated by the Router. The 30-second timeout cannot be adjusted and applies to all apps running on CloudFoundry.com. However, the Router supports long-polling and streaming on a rolling 30-second window: if an application sends data to a client within 30 seconds, the timeout counter is reset and starts again at 30 seconds. To troubleshoot 504 errors, please investigate what is causing the delayed response from an app and ensure data is returned every 30 seconds.</p>

<h3 id="im-having-issues-with-httpproxy">Iâ€™m having issues with HTTP_proxy</h3>

<p>When CloudFoundry.com launched in April 2011, applications making outbound requests had to use an HTTP proxy (for about the first 10 days of operation). When we removed the need for a proxy, we did not eliminate the HTTP_PROXY, http_proxy, etc. environment variables. These variables used to be made available to your application, however, now we are eliminating the HTTP_PROXY, HTTPS_PROXY, http_proxy, https_proxy, no_proxy, NO_PROXY. For the vast majority of applications, this change will have no effect. All well written applications either use http client classes that correctly process and use proxy related environment variables, OR the application writer codes his algorithms to correctly use the proxy environment variables when they are present.</p>

<p>However, some applications may  be hard-coded to look up one or all of the following proxy-related environment variables and either use the values incorrectly, OR not correctly handle the absence of an environment variable. The variables:</p>

<pre class="terminal">
- http_proxy

- HTTP_PROXY

- https_proxy

- HTTPS_PROXY

- no_proxy

- NO_PROXY
</pre>

<p>As of May 14th, 2012 these environment variables will not be defined for apps on CloudFoundry.com. If your app is not working as expected, please check your code for any references to the above variables and remove them. The safest method would be searching for any references to proxy in your application root:</p>

<pre class="terminal">
$ cd myapp
$ grep -i -r proxy .
</pre>

<h3 id="what-runtimes-are-supported-on-cloudfoundrycom-beta">What runtimes are supported on CloudFoundry.com (beta)?</h3>

<p>Use the vmc runtimes command to view the complete list of supported runtimes ($vmc runtimes)</p>

<h3 id="what-are-the-account-application-and-service-limits-for-my-cloudfoundrycom-beta-account">What are the account, application and service limits for my CloudFoundry.com (beta) account?</h3>

<p><strong>Account Limits</strong></p>

<p>Limits associated with a user account in CloudFoundry.com (beta) can be obtained using the following command.</p>

<pre class="terminal">
$ vmc info

VMware's Cloud Application Platform
For support visit support@cloudfoundry.com

Target:   http://api.cloudfoundry.com (v0.999)
Client:   v0.3.10

User:     user@email.com
Usage:    Memory   (256.0M of 2.0G total)
          Services (1 of 16 total)
          Apps     (2 of 20 total)
</pre>

<p>For accounts:
Applications are limited to 20.
Service instances are limited to 16.
Memory is limited to 2GB.</p>

<p><strong>Application Limits</strong></p>

<p>For each application:
Memory is limited to 2GB.
Disk space is limited to 2GB.
CPU	is limited to the fair share of 4 cores.
Network	is limited to your fair share.
File descriptors are limited to	256.
URIs are limited to 4.</p>

<p>Total Number of Instances: Limited by the amount of reservable memory, 2GB.  For example, if you reserve 128M for an application, you can have upto 16 instances, 256M -&gt; 8 instances, 512M -&gt; 4 instances and so on.  (assuming just one application).</p>

<p>Also, per-application usage statistics are available using the following command:</p>

<pre class="terminal">
$ vmc stats &lt;appname&gt;

+----------+-------------+----------------+--------------+--------------+
| Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
+----------+-------------+----------------+--------------+--------------+
| 0        | 0.0% (1)    | 19.4M (128M)   | 14.5M (2G)   | 0d:2h:13m:6s |
+----------+-------------+----------------+--------------+--------------+
</pre>

<p>Memory : 19.4M used, 128M reserved.  ($ vmc mem appname command can be used to update the memory reservation, please note that this will restart the application)</p>

<p>Disk : 14.M used of 2G limit</p>

<p><strong>Service Limits</strong></p>

<p>For services:
MySQL DB size is limited to	128MB.
Redis memory is limited to 16MB.
MongoDB memory is limited to 240MB.</p>

<h3 id="my-app-stopped-running">My app stopped running.</h3>

<p>If any application stops running without the end user initiating that action, we consider it a crash.</p>

<p>When an application crashes, vcloudlabs will maintain the crashed state for a period of time for introspection.</p>

<p>You can see this state via **vmc crashlogs <appname>**</appname></p>

<p>In the case of an app running successfully and then crashing, it could be something app specific or it could be that the application is using more resources than it is allowed.</p>

<p><strong>vmc info</strong></p>

<p>This will show you the account wide resources for memory, services, and application instances. This is a good place to check first.</p>

<p><strong>vmc stats &lt;appname&gt;</strong></p>

<p>This will show you detailed information on the resource usage of your application. So for instance, the application that runs <a href="http://www.cloudfoundry.com/">http://www.cloudfoundry.com</a>, named <strong>www</strong>, outputs the following:</p>

<p><strong>~&gt; vmc stats www</strong></p>

<p>Instance   CPU (Cores)     Memory (limit)  Disk (limit)    Uptime
â€”â€”â€”  â€”â€”â€”â€“     â€”â€”â€”â€”â€“  â€”â€”â€”â€”    â€”â€”
0          0.0% (8)        29.2M (64M)     824.0K (2G)     60d:19h:53m:58s
1          0.0% (8)        29.3M (64M)     816.0K (2G)     60d:19h:50m:3s</p>

<p>This will show you various resource usage levels and their current limits.</p>

<p>Currently CloudFoundry.com will terminate applications that exceed their memory or disk limits. This information will be available through the crashlogs command to vmc as outlined above.</p>

<p>If your app is stopping unexpectedly after running for some time, and you donâ€™t suspect your app, please use this checklist to see if you are running into a resource limit issue.</p>

<h3 id="im-getting-the-vmc-error-the-input-stream-is-exhausted">Iâ€™m getting the VMC Error: â€˜The input stream is exhaustedâ€™</h3>

<p><strong>Problem</strong></p>

<p>On some Mac OSX releases the stock ruby installed causes vmc client tool to fail emitting following error.  This is due to a library (used by vmc) incompatibility with the packaged ruby that comes with OSX.</p>

<p>For example in Mac OSX Lion, the stock ruby is 1.8.7 with patchlevel 249</p>

<pre class="terminal">
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [universal-darwin11.0]
</pre>

<p>And the error shows up during vmc transaction as</p>

<p><code>bash
$ vmc push
Would you like to deploy from the current directory? [Yn]: The input stream is exhausted.
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:608:in `get_line'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:629:in `get_response'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:216:in `ask'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/commands/apps.rb:370:in `push'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `send'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:14:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/bin/vmc:5
/usr/bin/vmc:19:in `load'
/usr/bin/vmc:19
</code></p>

<p><strong>Solution</strong></p>

<p>Solution to this problem is to install <a href="https://rvm.beginrescueend.com/">RVM</a> (Ruby Version Manager) and install and use 1.8.7 (or 1.9.2).  Typically higher patchlevels will get installed.  But please note that even if you install the same patchlevel as the stock ruby the problem will be solved.</p>

<p>A quick guide to installing RVM:
1.  Install rvm (<a href="http://beginrescueend.com/rvm/install/">http://beginrescueend.com/rvm/install/</a>)
2.  Add the below lines to ~/.bash_profile file
&lt;pre class="terminal"&gt;
# Ruby Version Manager
[[ -s "$HOME/.rvm/scripts/rvm" ]] &amp;&amp; . "$HOME/.rvm/scripts/rvm"
&lt;/pre&gt;</p>

<ol>
<li>Open new terminal</li>
  <li>Re-install ruby 1.9.2 using rvm and also re-install the vmc gem under rvm installed ruby
&lt;pre class="terminal"&gt;
$ rvm install 1.9.2
$ rvm use 1.9.2
$ gem install vmc</li>
</ol><p>&lt;/pre&gt;</p>

<p><strong>Sample Use</strong></p>

<p>Here is a transcript using rvm installed ruby.</p>

<pre class="terminal">
$ rvm use 1.8.7-p249
Using /Users/Alex/.rvm/gems/ruby-1.8.7-p249
</pre>

<pre class="terminal">
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [i686-darwin11.0.0]
</pre>

<pre class="terminal">
$ vmc push
Would you like to deploy from the current directory? [Yn]:
Application Name: hello-sinatra
Application Deployed URL: 'hello-sinatra.cloudfoundry.com'? hello-sinatra-alexsuraci.cloudfoundry.com
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M or 1G)
Creating Application: OK
Would you like to bind any services to 'hello-sinatra'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (2K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<h3 id="can-i-use-hyperic-to-monitor-my-applications-on-cloud-foundry">Can I use Hyperic to monitor my applications on Cloud Foundry?</h3>

<p><a href="http://blog.cloudfoundry.com/2011/06/29/hyperic-brings-application-monitoring-to-cloud-foundry/">Yes</a></p>

<h3 id="my-rubysinatrarails-app-is-failing-on-start">My Ruby/Sinatra/Rails app is failing on start.</h3>

<p>When performing a vmc push for a Ruby/Sinatra/Rails app, and after answering all the prompted questions, you might see this error:</p>

<p>Starting Application: â€¦â€¦â€¦â€¦Error: Application [APP]â€™s state
is undetermined, not enough information available.</p>

<p>The reason for this error is likely a missing gem or gems. Depending on where the issue occurred, additional details are typically found in one of 4 logs: staging.log, migration.log, stderr.log, and stdout.log</p>

<p>To diagnose: use â€œvmc files app-name logsâ€ to view the log files, and then â€œvmc files app-name logs/stderr.logâ€ to view a log.</p>

<p>In Cloud Foundry, we require that all gem dependencies are formally called out. For a simple Sinatra app, a simple Gemfile like this (in the root directory) is the typical fix:</p>

<p>Gemfile contains:</p>

<pre class="terminal">
source "http://rubygems.org"
gem 'bundler'
gem 'sinatra'
gem 'json'
gem 'httpclient'
gem 'redis'
</pre>

<p>With this in place, run â€œbundle package; bundle installâ€ to correct the problem</p>

<p>If you can not find the missing elements for upload, see if you can find the answer in the forums or create your own question thread. Alternatively send us an e-mail to support.cloudfoundry.com and we will try to help.</p>

<p>One of the common causes for the sample demo applications (hello.rb) as shown in our demos failing to start is due to copy/paste, which copies in smart quotes and causes the application to not run.  Please type in the demo application by hand.  Also, please make sure that you do not have any extraneous tab (\t) characters in the source file, and replace them with spaces.</p>

<h3 id="is-there-a-getting-started-guide-in-japanese">Is there a Getting Started guide in Japanese?</h3>

<p><a href="/getting-started-japanese.html">Yes</a></p>

<h3 id="how-can-i-update-my-application-without-dropping-user-traffic">How can I update my application without dropping user traffic?</h3>

<p>In general, when developing and testing applications with Cloud Foundry, <strong>vmc update</strong> fits the bill quite well.</p>

<p>However, when an app is considered â€œliveâ€, like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.</p>

<p>We use the concept of a new application that will assume the URL space of the original application.</p>

<p>Here is how to update your application without any downtime:</p>

<p>NOTE: â€˜vmc updateâ€™ will drop traffic..</p>

<ul>
<li>vmc push [app]NEW (bind any shared services, like DB, Cache, etc)</li>
</ul><p>TEST [app]NEW.cloufoundry.com</p>

<ul>
<li>vmc map [app]NEW [app].cloudfoundry.com</li>
</ul><p>TEST [app].cloudfoundry.com several times, looping through new and old now..</p>

<ul>
<li>vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic</li>
</ul><p>TEST</p>

<ul>
<li>vmc delete [app]OLD</li>
</ul><h3 id="my-application-is-still-reporting-as-running-even-after-exiting">My application is still reporting as running even after exiting.</h3>

<p>If you exit an app using System.exit(), Tomcatâ€™s security manager will prevent the process from terminating. This will cause the system to report the application as running. We will be adding a custom health check so that app terminated in this way may be detected by the system.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Ø>### How Do I Get Started on Cloud Foundry
For resources on getting started with Cloud Foundry, please refer to our [Getting Started Guide](/getting-started.html).

### How can I change my CloudFoundry.com password?

Please use the following link to reset your CloudFoundry.com password: [https://my.cloudfoundry.com/passwd](https://my.cloudfoundry.com/passwd)

### I'm having trouble with my login credentials

Here are a few things you can do to make sure that you are using your credentials correctly:

+ Verify that your target is set correctly ($vmc target api.cloudfoundry.com)
+ Check the target ($vmc target and $vmc info)
+ Verify that you are using the vmc client ($vmc login [email] [password] )

Please try with the temporary password provided in the Welcome email from Cloud Foundry after sign-up.  If you had subsequently changed that with a 'vmc passwd' command, please try with that password also.

If you are still not able to use vmc, open a ticket by clicking on the "Submit a request" tab. Make sure to provide us with the details and the support team will look into it for you.

### Why can't I register the application name I want?

Application names must be longer than 3 characters. In addition, please note that some names are reserved and will not be allowed even if they are of the right length.

If you receive the message: "The URI: 'fo.cloudfoundry.com' has already been taken or reserved", please pick another name for your application.


### Can apps use the local file system for storage?
Your application needs to treat local file storage as ephemeral, which can disappear when your application stops, crashes, or moves. It should not be used for durable storage of content such as user-uploaded files. Further, if more than one instance of your app is running the local storage is only visible to a specific instance of the app, and is not visible or shared across all instances. If persistent storage is required, a local service such as [MongoDB GridFS](http://www.mongodb.org/display/DOCS/GridFS) or external blob stores such as [Box.net](http://developers.blog.box.com/2011/12/14/deploying-to-cloud-foundry-and-heroku-from-box/) or [Amazon S3](http://aws.amazon.com/s3/) can be used.

### Is there session support?
When scaling an app to multiple instances the topic of session management arises. Cloud Foundry uses session affinity, also known as sticky sessions: when a user login request is handled by a particular instance of your app, future requests from that user/session will be routed to the same app instance. Sticky sessions are provided for all apps and do not have to be configured, with the exception of Node.js. Node.js apps need to set a cookie named JSESSIONID to a unique value for each user/session.

Cloud Foundry does not offer session replication: if the particular instance crashes the user is routed to another instance which won't have authentication data in the session, and the user will have to log in again.

### What happens when a service runs out of capacity?
When a service runs out of capacity (e.g. MySQL hits the 128MB size limit), the service switches to a read/delete-only mode. For example, on a SQL service removing data and reading data is allowed, but writing more data is disabled:

```bash
delete from table where ... # allowed
drop table ... # allowed
select ... from ... # allowed
insert into ... # not allowed
update ... # not allowed
```

The application bound to a service that has run out of capacity may see errors such as "INSERT is disabled." Other services (redis, MongoDB) will exhibit similar behavior.

### Can I send and receive email from my app?
Applications cannot send outbound email via TCP port 25. An app can use an external email service available on a different port (such as 587 for SMTP-AUTH). Applications cannot receive email by listening on port 25 either. We recommend using an external mail service such as [SendGrid](http://sendgrid.com/) or [Mailgun](http://mailgun.net/).

### Is there a firewall that prevents my app from accessing external services?
No, your application has direct access to the internet with the exception of connecting to TCP port 25 (used for sending email).

### Why is my app returning "504 Gateway Time-out" errors?
The error page originates from the CloudFoundry.com HTTP Router and not your application. Application requests taking longer than 30 seconds are terminated by the Router. The 30-second timeout cannot be adjusted and applies to all apps running on CloudFoundry.com. However, the Router supports long-polling and streaming on a rolling 30-second window: if an application sends data to a client within 30 seconds, the timeout counter is reset and starts again at 30 seconds. To troubleshoot 504 errors, please investigate what is causing the delayed response from an app and ensure data is returned every 30 seconds.


### I'm having issues with HTTP_proxy

When CloudFoundry.com launched in April 2011, applications making outbound requests had to use an HTTP proxy (for about the first 10 days of operation). When we removed the need for a proxy, we did not eliminate the HTTP_PROXY, http_proxy, etc. environment variables. These variables used to be made available to your application, however, now we are eliminating the HTTP_PROXY, HTTPS_PROXY, http_proxy, https_proxy, no_proxy, NO_PROXY. For the vast majority of applications, this change will have no effect. All well written applications either use http client classes that correctly process and use proxy related environment variables, OR the application writer codes his algorithms to correctly use the proxy environment variables when they are present.

However, some applications may  be hard-coded to look up one or all of the following proxy-related environment variables and either use the values incorrectly, OR not correctly handle the absence of an environment variable. The variables:

```bash
- http_proxy

- HTTP_PROXY

- https_proxy

- HTTPS_PROXY

- no_proxy

- NO_PROXY
```

As of May 14th, 2012 these environment variables will not be defined for apps on CloudFoundry.com. If your app is not working as expected, please check your code for any references to the above variables and remove them. The safest method would be searching for any references to proxy in your application root:

```bash
$ cd myapp
$ grep -i -r proxy .
```

### What runtimes are supported on CloudFoundry.com (beta)?

Use the vmc runtimes command to view the complete list of supported runtimes ($vmc runtimes)

### What are the account, application and service limits for my CloudFoundry.com (beta) account?

**Account Limits**

Limits associated with a user account in CloudFoundry.com (beta) can be obtained using the following command.

```bash
$ vmc info

VMware's Cloud Application Platform
For support visit support@cloudfoundry.com

Target:   http://api.cloudfoundry.com (v0.999)
Client:   v0.3.10

User:     user@email.com
Usage:    Memory   (256.0M of 2.0G total)
          Services (1 of 16 total)
          Apps     (2 of 20 total)
```

For accounts:
Applications are limited to 20.
Service instances are limited to 16.
Memory is limited to 2GB.


**Application Limits**

For each application:
Memory is limited to 2GB.
Disk space is limited to 2GB.
CPU	is limited to the fair share of 4 cores.
Network	is limited to your fair share.
File descriptors are limited to	256.
URIs are limited to 4.

Total Number of Instances: Limited by the amount of reservable memory, 2GB.  For example, if you reserve 128M for an application, you can have upto 16 instances, 256M -> 8 instances, 512M -> 4 instances and so on.  (assuming just one application).

Also, per-application usage statistics are available using the following command:


```bash
$ vmc stats <appname>

+----------+-------------+----------------+--------------+--------------+
| Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
+----------+-------------+----------------+--------------+--------------+
| 0        | 0.0% (1)    | 19.4M (128M)   | 14.5M (2G)   | 0d:2h:13m:6s |
+----------+-------------+----------------+--------------+--------------+
```

Memory : 19.4M used, 128M reserved.  ($ vmc mem appname command can be used to update the memory reservation, please note that this will restart the application)

Disk : 14.M used of 2G limit

**Service Limits**

For services:
MySQL DB size is limited to	128MB.
Redis memory is limited to 16MB.
MongoDB memory is limited to 240MB.



### My app stopped running.

If any application stops running without the end user initiating that action, we consider it a crash.

When an application crashes, vcloudlabs will maintain the crashed state for a period of time for introspection.

You can see this state via **vmc crashlogs <appname>**

In the case of an app running successfully and then crashing, it could be something app specific or it could be that the application is using more resources than it is allowed.


**vmc info**


This will show you the account wide resources for memory, services, and application instances. This is a good place to check first.


**vmc stats \<appname\>**


This will show you detailed information on the resource usage of your application. So for instance, the application that runs [http://www.cloudfoundry.com](http://www.cloudfoundry.com/), named **www**, outputs the following:


**~> vmc stats www**

Instance   CPU (Cores)     Memory (limit)  Disk (limit)    Uptime
---------  -----------     --------------  ------------    ------
0          0.0% (8)        29.2M (64M)     824.0K (2G)     60d:19h:53m:58s
1          0.0% (8)        29.3M (64M)     816.0K (2G)     60d:19h:50m:3s


This will show you various resource usage levels and their current limits.


Currently CloudFoundry.com will terminate applications that exceed their memory or disk limits. This information will be available through the crashlogs command to vmc as outlined above.


If your app is stopping unexpectedly after running for some time, and you don't suspect your app, please use this checklist to see if you are running into a resource limit issue.


### I'm getting the VMC Error: 'The input stream is exhausted'

**Problem**

On some Mac OSX releases the stock ruby installed causes vmc client tool to fail emitting following error.  This is due to a library (used by vmc) incompatibility with the packaged ruby that comes with OSX.

For example in Mac OSX Lion, the stock ruby is 1.8.7 with patchlevel 249

```bash
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [universal-darwin11.0]
```

And the error shows up during vmc transaction as

```bash
$ vmc push
Would you like to deploy from the current directory? [Yn]: The input stream is exhausted.
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:608:in `get_line'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:629:in `get_response'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:216:in `ask'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/commands/apps.rb:370:in `push'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `send'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:14:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/bin/vmc:5
/usr/bin/vmc:19:in `load'
/usr/bin/vmc:19
```

**Solution**

Solution to this problem is to install [RVM](https://rvm.beginrescueend.com/) (Ruby Version Manager) and install and use 1.8.7 (or 1.9.2).  Typically higher patchlevels will get installed.  But please note that even if you install the same patchlevel as the stock ruby the problem will be solved.

A quick guide to installing RVM:
1.  Install rvm ([http://beginrescueend.com/rvm/install/](http://beginrescueend.com/rvm/install/))
2.  Add the below lines to ~/.bash_profile file
```bash
# Ruby Version Manager
[[ -s "$HOME/.rvm/scripts/rvm" ]] && . "$HOME/.rvm/scripts/rvm"
```
3.  Open new terminal
4.  Re-install ruby 1.9.2 using rvm and also re-install the vmc gem under rvm installed ruby
```bash
$ rvm install 1.9.2
$ rvm use 1.9.2
$ gem install vmc
```


**Sample Use**

Here is a transcript using rvm installed ruby.

```bash
$ rvm use 1.8.7-p249
Using /Users/Alex/.rvm/gems/ruby-1.8.7-p249
```
```bash
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [i686-darwin11.0.0]
```
```bash
$ vmc push
Would you like to deploy from the current directory? [Yn]:
Application Name: hello-sinatra
Application Deployed URL: 'hello-sinatra.cloudfoundry.com'? hello-sinatra-alexsuraci.cloudfoundry.com
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M or 1G)
Creating Application: OK
Would you like to bind any services to 'hello-sinatra'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (2K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
```


### Can I use Hyperic to monitor my applications on Cloud Foundry?

[Yes](http://blog.cloudfoundry.com/2011/06/29/hyperic-brings-application-monitoring-to-cloud-foundry/)


### My Ruby/Sinatra/Rails app is failing on start.

When performing a vmc push for a Ruby/Sinatra/Rails app, and after answering all the prompted questions, you might see this error:

Starting Application: ............Error: Application [APP]'s state
is undetermined, not enough information available.

The reason for this error is likely a missing gem or gems. Depending on where the issue occurred, additional details are typically found in one of 4 logs: staging.log, migration.log, stderr.log, and stdout.log

To diagnose: use "vmc files app-name logs" to view the log files, and then "vmc files app-name logs/stderr.log" to view a log.

In Cloud Foundry, we require that all gem dependencies are formally called out. For a simple Sinatra app, a simple Gemfile like this (in the root directory) is the typical fix:

Gemfile contains:

```bash
source "http://rubygems.org"
gem 'bundler'
gem 'sinatra'
gem 'json'
gem 'httpclient'
gem 'redis'
```

With this in place, run "bundle package; bundle install" to correct the problem

If you can not find the missing elements for upload, see if you can find the answer in the forums or create your own question thread. Alternatively send us an e-mail to support.cloudfoundry.com and we will try to help.

One of the common causes for the sample demo applications (hello.rb) as shown in our demos failing to start is due to copy/paste, which copies in smart quotes and causes the application to not run.  Please type in the demo application by hand.  Also, please make sure that you do not have any extraneous tab (\t) characters in the source file, and replace them with spaces.


### Is there a Getting Started guide in Japanese?

[Yes](/getting-started-japanese.html)

### How can I update my application without dropping user traffic?

In general, when developing and testing applications with Cloud Foundry, **vmc update** fits the bill quite well.

However, when an app is considered "live", like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.

We use the concept of a new application that will assume the URL space of the original application.

Here is how to update your application without any downtime:

NOTE: 'vmc update' will drop traffic..

- vmc push [app]NEW (bind any shared services, like DB, Cache, etc)

 TEST [app]NEW.cloufoundry.com

- vmc map [app]NEW [app].cloudfoundry.com

 TEST [app].cloudfoundry.com several times, looping through new and old now..

- vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic

 TEST

- vmc delete [app]OLD


### My application is still reporting as running even after exiting.

If you exit an app using System.exit(), Tomcat's security manager will prevent the process from terminating. This will cause the system to report the application as running. We will be adding a custom health check so that app terminated in this way may be detected by the system.;T;
I"YH<h3 id="how-do-i-get-started-on-cloud-foundry">How Do I Get Started on Cloud Foundry</h3>
<p>For resources on getting started with Cloud Foundry, please refer to our <a href="/getting-started.html">Getting Started Guide</a>.</p>

<h3 id="how-can-i-change-my-cloudfoundrycom-password">How can I change my CloudFoundry.com password?</h3>

<p>Please use the following link to reset your CloudFoundry.com password: <a href="https://my.cloudfoundry.com/passwd">https://my.cloudfoundry.com/passwd</a></p>

<h3 id="im-having-trouble-with-my-login-credentials">Iâ€™m having trouble with my login credentials</h3>

<p>Here are a few things you can do to make sure that you are using your credentials correctly:</p>

<ul>
<li>Verify that your target is set correctly ($vmc target api.cloudfoundry.com)</li>
  <li>Check the target ($vmc target and $vmc info)</li>
  <li>Verify that you are using the vmc client ($vmc login [email] [password] )</li>
</ul><p>Please try with the temporary password provided in the Welcome email from Cloud Foundry after sign-up.  If you had subsequently changed that with a â€˜vmc passwdâ€™ command, please try with that password also.</p>

<p>If you are still not able to use vmc, open a ticket by clicking on the â€œSubmit a requestâ€ tab. Make sure to provide us with the details and the support team will look into it for you.</p>

<h3 id="why-cant-i-register-the-application-name-i-want">Why canâ€™t I register the application name I want?</h3>

<p>Application names must be longer than 3 characters. In addition, please note that some names are reserved and will not be allowed even if they are of the right length.</p>

<p>If you receive the message: â€œThe URI: â€˜fo.cloudfoundry.comâ€™ has already been taken or reservedâ€, please pick another name for your application.</p>

<h3 id="can-apps-use-the-local-file-system-for-storage">Can apps use the local file system for storage?</h3>
<p>Your application needs to treat local file storage as ephemeral, which can disappear when your application stops, crashes, or moves. It should not be used for durable storage of content such as user-uploaded files. Further, if more than one instance of your app is running the local storage is only visible to a specific instance of the app, and is not visible or shared across all instances. If persistent storage is required, a local service such as <a href="http://www.mongodb.org/display/DOCS/GridFS">MongoDB GridFS</a> or external blob stores such as <a href="http://developers.blog.box.com/2011/12/14/deploying-to-cloud-foundry-and-heroku-from-box/">Box.net</a> or <a href="http://aws.amazon.com/s3/">Amazon S3</a> can be used.</p>

<h3 id="is-there-session-support">Is there session support?</h3>
<p>When scaling an app to multiple instances the topic of session management arises. Cloud Foundry uses session affinity, also known as sticky sessions: when a user login request is handled by a particular instance of your app, future requests from that user/session will be routed to the same app instance. Sticky sessions are provided for all apps and do not have to be configured, with the exception of Node.js. Node.js apps need to set a cookie named JSESSIONID to a unique value for each user/session.</p>

<p>Cloud Foundry does not offer session replication: if the particular instance crashes the user is routed to another instance which wonâ€™t have authentication data in the session, and the user will have to log in again.</p>

<h3 id="what-happens-when-a-service-runs-out-of-capacity">What happens when a service runs out of capacity?</h3>
<p>When a service runs out of capacity (e.g. MySQL hits the 128MB size limit), the service switches to a read/delete-only mode. For example, on a SQL service removing data and reading data is allowed, but writing more data is disabled:</p>

<pre class="terminal">
delete from table where ... # allowed
drop table ... # allowed
select ... from ... # allowed
insert into ... # not allowed
update ... # not allowed
</pre>

<p>The application bound to a service that has run out of capacity may see errors such as â€œINSERT is disabled.â€ Other services (redis, MongoDB) will exhibit similar behavior.</p>

<h3 id="can-i-send-and-receive-email-from-my-app">Can I send and receive email from my app?</h3>
<p>Applications cannot send outbound email via TCP port 25. An app can use an external email service available on a different port (such as 587 for SMTP-AUTH). Applications cannot receive email by listening on port 25 either. We recommend using an external mail service such as <a href="http://sendgrid.com/">SendGrid</a> or <a href="http://mailgun.net/">Mailgun</a>.</p>

<h3 id="is-there-a-firewall-that-prevents-my-app-from-accessing-external-services">Is there a firewall that prevents my app from accessing external services?</h3>
<p>No, your application has direct access to the internet with the exception of connecting to TCP port 25 (used for sending email).</p>

<h3 id="why-is-my-app-returning-504-gateway-time-out-errors">Why is my app returning â€œ504 Gateway Time-outâ€ errors?</h3>
<p>The error page originates from the CloudFoundry.com HTTP Router and not your application. Application requests taking longer than 30 seconds are terminated by the Router. The 30-second timeout cannot be adjusted and applies to all apps running on CloudFoundry.com. However, the Router supports long-polling and streaming on a rolling 30-second window: if an application sends data to a client within 30 seconds, the timeout counter is reset and starts again at 30 seconds. To troubleshoot 504 errors, please investigate what is causing the delayed response from an app and ensure data is returned every 30 seconds.</p>

<h3 id="im-having-issues-with-httpproxy">Iâ€™m having issues with HTTP_proxy</h3>

<p>When CloudFoundry.com launched in April 2011, applications making outbound requests had to use an HTTP proxy (for about the first 10 days of operation). When we removed the need for a proxy, we did not eliminate the HTTP_PROXY, http_proxy, etc. environment variables. These variables used to be made available to your application, however, now we are eliminating the HTTP_PROXY, HTTPS_PROXY, http_proxy, https_proxy, no_proxy, NO_PROXY. For the vast majority of applications, this change will have no effect. All well written applications either use http client classes that correctly process and use proxy related environment variables, OR the application writer codes his algorithms to correctly use the proxy environment variables when they are present.</p>

<p>However, some applications may  be hard-coded to look up one or all of the following proxy-related environment variables and either use the values incorrectly, OR not correctly handle the absence of an environment variable. The variables:</p>

<pre class="terminal">
- http_proxy

- HTTP_PROXY

- https_proxy

- HTTPS_PROXY

- no_proxy

- NO_PROXY
</pre>

<p>As of May 14th, 2012 these environment variables will not be defined for apps on CloudFoundry.com. If your app is not working as expected, please check your code for any references to the above variables and remove them. The safest method would be searching for any references to proxy in your application root:</p>

<pre class="terminal">
$ cd myapp
$ grep -i -r proxy .
</pre>

<h3 id="what-runtimes-are-supported-on-cloudfoundrycom-beta">What runtimes are supported on CloudFoundry.com (beta)?</h3>

<p>Use the vmc runtimes command to view the complete list of supported runtimes ($vmc runtimes)</p>

<h3 id="what-are-the-account-application-and-service-limits-for-my-cloudfoundrycom-beta-account">What are the account, application and service limits for my CloudFoundry.com (beta) account?</h3>

<p><strong>Account Limits</strong></p>

<p>Limits associated with a user account in CloudFoundry.com (beta) can be obtained using the following command.</p>

<pre class="terminal">
$ vmc info

VMware's Cloud Application Platform
For support visit support@cloudfoundry.com

Target:   http://api.cloudfoundry.com (v0.999)
Client:   v0.3.10

User:     user@email.com
Usage:    Memory   (256.0M of 2.0G total)
          Services (1 of 16 total)
          Apps     (2 of 20 total)
</pre>

<p>For accounts:
Applications are limited to 20.
Service instances are limited to 16.
Memory is limited to 2GB.</p>

<p><strong>Application Limits</strong></p>

<p>For each application:
Memory is limited to 2GB.
Disk space is limited to 2GB.
CPU	is limited to the fair share of 4 cores.
Network	is limited to your fair share.
File descriptors are limited to	256.
URIs are limited to 4.</p>

<p>Total Number of Instances: Limited by the amount of reservable memory, 2GB.  For example, if you reserve 128M for an application, you can have upto 16 instances, 256M -&gt; 8 instances, 512M -&gt; 4 instances and so on.  (assuming just one application).</p>

<p>Also, per-application usage statistics are available using the following command:</p>

<pre class="terminal">
$ vmc stats &lt;appname&gt;

+----------+-------------+----------------+--------------+--------------+
| Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
+----------+-------------+----------------+--------------+--------------+
| 0        | 0.0% (1)    | 19.4M (128M)   | 14.5M (2G)   | 0d:2h:13m:6s |
+----------+-------------+----------------+--------------+--------------+
</pre>

<p>Memory : 19.4M used, 128M reserved.  ($ vmc mem appname command can be used to update the memory reservation, please note that this will restart the application)</p>

<p>Disk : 14.M used of 2G limit</p>

<p><strong>Service Limits</strong></p>

<p>For services:
MySQL DB size is limited to	128MB.
Redis memory is limited to 16MB.
MongoDB memory is limited to 240MB.</p>

<h3 id="my-app-stopped-running">My app stopped running.</h3>

<p>If any application stops running without the end user initiating that action, we consider it a crash.</p>

<p>When an application crashes, vcloudlabs will maintain the crashed state for a period of time for introspection.</p>

<p>You can see this state via **vmc crashlogs <appname>**</appname></p>

<p>In the case of an app running successfully and then crashing, it could be something app specific or it could be that the application is using more resources than it is allowed.</p>

<p><strong>vmc info</strong></p>

<p>This will show you the account wide resources for memory, services, and application instances. This is a good place to check first.</p>

<p><strong>vmc stats &lt;appname&gt;</strong></p>

<p>This will show you detailed information on the resource usage of your application. So for instance, the application that runs <a href="http://www.cloudfoundry.com/">http://www.cloudfoundry.com</a>, named <strong>www</strong>, outputs the following:</p>

<p><strong>~&gt; vmc stats www</strong></p>

<p>Instance   CPU (Cores)     Memory (limit)  Disk (limit)    Uptime
â€”â€”â€”  â€”â€”â€”â€“     â€”â€”â€”â€”â€“  â€”â€”â€”â€”    â€”â€”
0          0.0% (8)        29.2M (64M)     824.0K (2G)     60d:19h:53m:58s
1          0.0% (8)        29.3M (64M)     816.0K (2G)     60d:19h:50m:3s</p>

<p>This will show you various resource usage levels and their current limits.</p>

<p>Currently CloudFoundry.com will terminate applications that exceed their memory or disk limits. This information will be available through the crashlogs command to vmc as outlined above.</p>

<p>If your app is stopping unexpectedly after running for some time, and you donâ€™t suspect your app, please use this checklist to see if you are running into a resource limit issue.</p>

<h3 id="im-getting-the-vmc-error-the-input-stream-is-exhausted">Iâ€™m getting the VMC Error: â€˜The input stream is exhaustedâ€™</h3>

<p><strong>Problem</strong></p>

<p>On some Mac OSX releases the stock ruby installed causes vmc client tool to fail emitting following error.  This is due to a library (used by vmc) incompatibility with the packaged ruby that comes with OSX.</p>

<p>For example in Mac OSX Lion, the stock ruby is 1.8.7 with patchlevel 249</p>

<pre class="terminal">
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [universal-darwin11.0]
</pre>

<p>And the error shows up during vmc transaction as</p>

<p><code>bash
$ vmc push
Would you like to deploy from the current directory? [Yn]: The input stream is exhausted.
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:608:in `get_line'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:629:in `get_response'
/Library/Ruby/Gems/1.8/gems/highline-1.6.2/lib/highline.rb:216:in `ask'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/commands/apps.rb:370:in `push'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `send'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:428:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/lib/cli/runner.rb:14:in `run'
/Library/Ruby/Gems/1.8/gems/vmc-0.3.12/bin/vmc:5
/usr/bin/vmc:19:in `load'
/usr/bin/vmc:19
</code></p>

<p><strong>Solution</strong></p>

<p>Solution to this problem is to install <a href="https://rvm.beginrescueend.com/">RVM</a> (Ruby Version Manager) and install and use 1.8.7 (or 1.9.2).  Typically higher patchlevels will get installed.  But please note that even if you install the same patchlevel as the stock ruby the problem will be solved.</p>

<p>A quick guide to installing RVM:
1.  Install rvm (<a href="http://beginrescueend.com/rvm/install/">http://beginrescueend.com/rvm/install/</a>)
2.  Add the below lines to ~/.bash_profile file
&lt;pre class="terminal"&gt;
# Ruby Version Manager
[[ -s "$HOME/.rvm/scripts/rvm" ]] &amp;&amp; . "$HOME/.rvm/scripts/rvm"
&lt;/pre&gt;</p>

<ol>
<li>Open new terminal</li>
  <li>Re-install ruby 1.9.2 using rvm and also re-install the vmc gem under rvm installed ruby
&lt;pre class="terminal"&gt;
$ rvm install 1.9.2
$ rvm use 1.9.2
$ gem install vmc</li>
</ol><p>&lt;/pre&gt;</p>

<p><strong>Sample Use</strong></p>

<p>Here is a transcript using rvm installed ruby.</p>

<pre class="terminal">
$ rvm use 1.8.7-p249
Using /Users/Alex/.rvm/gems/ruby-1.8.7-p249
</pre>

<pre class="terminal">
$ ruby --version
ruby 1.8.7 (2010-01-10 patchlevel 249) [i686-darwin11.0.0]
</pre>

<pre class="terminal">
$ vmc push
Would you like to deploy from the current directory? [Yn]:
Application Name: hello-sinatra
Application Deployed URL: 'hello-sinatra.cloudfoundry.com'? hello-sinatra-alexsuraci.cloudfoundry.com
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M or 1G)
Creating Application: OK
Would you like to bind any services to 'hello-sinatra'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (2K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<h3 id="can-i-use-hyperic-to-monitor-my-applications-on-cloud-foundry">Can I use Hyperic to monitor my applications on Cloud Foundry?</h3>

<p><a href="http://blog.cloudfoundry.com/2011/06/29/hyperic-brings-application-monitoring-to-cloud-foundry/">Yes</a></p>

<h3 id="my-rubysinatrarails-app-is-failing-on-start">My Ruby/Sinatra/Rails app is failing on start.</h3>

<p>When performing a vmc push for a Ruby/Sinatra/Rails app, and after answering all the prompted questions, you might see this error:</p>

<p>Starting Application: â€¦â€¦â€¦â€¦Error: Application [APP]â€™s state
is undetermined, not enough information available.</p>

<p>The reason for this error is likely a missing gem or gems. Depending on where the issue occurred, additional details are typically found in one of 4 logs: staging.log, migration.log, stderr.log, and stdout.log</p>

<p>To diagnose: use â€œvmc files app-name logsâ€ to view the log files, and then â€œvmc files app-name logs/stderr.logâ€ to view a log.</p>

<p>In Cloud Foundry, we require that all gem dependencies are formally called out. For a simple Sinatra app, a simple Gemfile like this (in the root directory) is the typical fix:</p>

<p>Gemfile contains:</p>

<pre class="terminal">
source "http://rubygems.org"
gem 'bundler'
gem 'sinatra'
gem 'json'
gem 'httpclient'
gem 'redis'
</pre>

<p>With this in place, run â€œbundle package; bundle installâ€ to correct the problem</p>

<p>If you can not find the missing elements for upload, see if you can find the answer in the forums or create your own question thread. Alternatively send us an e-mail to support.cloudfoundry.com and we will try to help.</p>

<p>One of the common causes for the sample demo applications (hello.rb) as shown in our demos failing to start is due to copy/paste, which copies in smart quotes and causes the application to not run.  Please type in the demo application by hand.  Also, please make sure that you do not have any extraneous tab (\t) characters in the source file, and replace them with spaces.</p>

<h3 id="is-there-a-getting-started-guide-in-japanese">Is there a Getting Started guide in Japanese?</h3>

<p><a href="/getting-started-japanese.html">Yes</a></p>

<h3 id="how-can-i-update-my-application-without-dropping-user-traffic">How can I update my application without dropping user traffic?</h3>

<p>In general, when developing and testing applications with Cloud Foundry, <strong>vmc update</strong> fits the bill quite well.</p>

<p>However, when an app is considered â€œliveâ€, like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.</p>

<p>We use the concept of a new application that will assume the URL space of the original application.</p>

<p>Here is how to update your application without any downtime:</p>

<p>NOTE: â€˜vmc updateâ€™ will drop traffic..</p>

<ul>
<li>vmc push [app]NEW (bind any shared services, like DB, Cache, etc)</li>
</ul><p>TEST [app]NEW.cloufoundry.com</p>

<ul>
<li>vmc map [app]NEW [app].cloudfoundry.com</li>
</ul><p>TEST [app].cloudfoundry.com several times, looping through new and old now..</p>

<ul>
<li>vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic</li>
</ul><p>TEST</p>

<ul>
<li>vmc delete [app]OLD</li>
</ul><h3 id="my-application-is-still-reporting-as-running-even-after-exiting">My application is still reporting as running even after exiting.</h3>

<p>If you exit an app using System.exit(), Tomcatâ€™s security manager will prevent the process from terminating. This will cause the system to report the application as running. We will be adding a custom health check so that app terminated in this way may be detected by the system.</p>;T;@•I"/;T{;{	;I"‡8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Documentation' property='og:title'>
<meta content='Cloud Foundry Documentation' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Documentation</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Documentation</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Cloud Foundry Documentation</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<ul>
<li>
    <p><a href="quick-start.html">Quick Start Guide</a></p>
  </li>
  <li>
    <p><a href="getting-started.html">Getting Started with Cloud Foundry</a></p>

    <ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
      <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite and Eclipse</a></li>
      <li><a href="tools/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
    </ul>
</li>
  <li>
    <p><a href="frameworks.html">Configuring Applications to Use Cloud Foundry</a></p>

    <ul>
<li><a href="frameworks/java/spring/spring.html">Configuring Spring Applications</a></li>
      <li><a href="frameworks/ruby/ruby.html">Configuring Ruby Applications</a></li>
      <li><a href="frameworks/nodejs.html">Configuring Node.js Applications</a></li>
      <li><a href="frameworks/java/spring/grails.html">Configuring Grails Applications</a></li>
    </ul>
</li>
  <li>
    <p><a href="/tools/deploying-apps.html">Deploying and Managing Applications</a></p>
  </li>
  <li>
    <p><a href="tools/spring-insight.html">Monitoring Application Performance With Spring Insight</a></p>
  </li>
  <li>
    <p><a href="tools/vmc/debugging.html">Debugging Problems with Your Applications</a></p>
  </li>
  <li>
    <p><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></p>
  </li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ë+ [Quick Start Guide](quick-start.html)

+ [Getting Started with Cloud Foundry](getting-started.html)

	+ [Installing the Command-Line Utility (VMC)](/tools/vmc/installing-vmc.html)
	+ [Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite and Eclipse](/tools/STS/configuring-STS.html)
	+ [Installing Micro Cloud Foundry](tools/micro/installing-mcf.html)

+ [Configuring Applications to Use Cloud Foundry](frameworks.html)

	+ [Configuring Spring Applications](frameworks/java/spring/spring.html)
	+ [Configuring Ruby Applications](frameworks/ruby/ruby.html)
	+ [Configuring Node.js Applications](frameworks/nodejs.html)
	+ [Configuring Grails Applications](frameworks/java/spring/grails.html)

+ [Deploying and Managing Applications](/tools/deploying-apps.html)

+ [Monitoring Application Performance With Spring Insight](tools/spring-insight.html)

+ [Debugging Problems with Your Applications](tools/vmc/debugging.html)

+ [VMC Quick Reference](/tools/vmc/vmc-quick-ref.html);T;
I"š<ul>
<li>
    <p><a href="quick-start.html">Quick Start Guide</a></p>
  </li>
  <li>
    <p><a href="getting-started.html">Getting Started with Cloud Foundry</a></p>

    <ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
      <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite and Eclipse</a></li>
      <li><a href="tools/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
    </ul>
</li>
  <li>
    <p><a href="frameworks.html">Configuring Applications to Use Cloud Foundry</a></p>

    <ul>
<li><a href="frameworks/java/spring/spring.html">Configuring Spring Applications</a></li>
      <li><a href="frameworks/ruby/ruby.html">Configuring Ruby Applications</a></li>
      <li><a href="frameworks/nodejs.html">Configuring Node.js Applications</a></li>
      <li><a href="frameworks/java/spring/grails.html">Configuring Grails Applications</a></li>
    </ul>
</li>
  <li>
    <p><a href="/tools/deploying-apps.html">Deploying and Managing Applications</a></p>
  </li>
  <li>
    <p><a href="tools/spring-insight.html">Monitoring Application Performance With Spring Insight</a></p>
  </li>
  <li>
    <p><a href="tools/vmc/debugging.html">Debugging Problems with Your Applications</a></p>
  </li>
  <li>
    <p><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></p>
  </li>
</ul>;T;@›I"&/services/mongodb/grails-mongodb/;T{;{	;I"c8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mongodb/grails-mongodb.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MongoDB with Grails' property='og:title'>
<meta content='Grails Development with the MongoDB Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MongoDB with Grails</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MongoDB with Grails</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Grails Development with the MongoDB Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/grails" rel="tag">grails</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The <a href="http://www.grails.org">Grails</a> framework allows rapid development of web applications that run in a Java servlet container. Grails is based on the Groovy language and the Spring framework.</p>

<p>To use Grails with Cloud Foundry, install the Cloud Foundry Grails plugin from your application directory:</p>

<pre class="terminal">
$ grails install-plugin cloud-foundry
</pre>

<p>To use <a href="http://www.mongodb.org/">MongoDB</a> in your Grails applciation, install the Grails <a href="http://grails.org/plugin/mongodb">MongoDB plug-in</a>.</p>

<pre class="terminal">
$ grails install-plugin mongodb
</pre>

<p>Once you install the mongodb plugin, your application has access to MongoDB. The MongoDB plug-in allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for directly accessing the MongoDB driver for Java.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="http://grails-plugins.github.com/grails-cloud-foundry/">Grails Cloud Foundry Plugin User Guide</a></li>
  <li>
<a href="http://grails.github.com/inconsequential/mongo/manual/index.html">Gorm for Mongo</a> Reference Documentation</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ëThe [Grails](http://www.grails.org) framework allows rapid development of web applications that run in a Java servlet container. Grails is based on the Groovy language and the Spring framework.

To use Grails with Cloud Foundry, install the Cloud Foundry Grails plugin from your application directory:

```bash
$ grails install-plugin cloud-foundry
```

To use [MongoDB](http://www.mongodb.org/) in your Grails applciation, install the Grails [MongoDB plug-in](http://grails.org/plugin/mongodb).

```bash
$ grails install-plugin mongodb
```

Once you install the mongodb plugin, your application has access to MongoDB. The MongoDB plug-in allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for directly accessing the MongoDB driver for Java.

## References

+	[Grails Cloud Foundry Plugin User Guide](http://grails-plugins.github.com/grails-cloud-foundry/)
+	[Gorm for Mongo](http://grails.github.com/inconsequential/mongo/manual/index.html) Reference Documentation;T;
I"”<p>The <a href="http://www.grails.org">Grails</a> framework allows rapid development of web applications that run in a Java servlet container. Grails is based on the Groovy language and the Spring framework.</p>

<p>To use Grails with Cloud Foundry, install the Cloud Foundry Grails plugin from your application directory:</p>

<pre class="terminal">
$ grails install-plugin cloud-foundry
</pre>

<p>To use <a href="http://www.mongodb.org/">MongoDB</a> in your Grails applciation, install the Grails <a href="http://grails.org/plugin/mongodb">MongoDB plug-in</a>.</p>

<pre class="terminal">
$ grails install-plugin mongodb
</pre>

<p>Once you install the mongodb plugin, your application has access to MongoDB. The MongoDB plug-in allows you to map GORM entities to MongoDB Collections. It also provides a low-level API for directly accessing the MongoDB driver for Java.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="http://grails-plugins.github.com/grails-cloud-foundry/">Grails Cloud Foundry Plugin User Guide</a></li>
  <li>
<a href="http://grails.github.com/inconsequential/mongo/manual/index.html">Gorm for Mongo</a> Reference Documentation</li>
</ul>;T;@¡I"$/services/mongodb/ruby-mongodb/;T{;{	;I"IK<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mongodb/ruby-mongodb.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MongoDB with Ruby' property='og:title'>
<meta content='Ruby Development with the MongoDB Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MongoDB with Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MongoDB with Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Development with the MongoDB Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/sinatra" rel="tag">sinatra</a><a href="/tags/ruby" rel="tag">ruby</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://www.mongodb.org">MongoDB</a>, the scalable, open source, document-oriented database is provided as a service on Cloud Foundry.
This section describes how you can adapt a Ruby on Rails application to access the Cloud Foundry mongodb service.
It is assumed that you are using the <a href="http://mongomapper.com">MongoMapper</a> ORM.</p>

<h3 id="gemfile">Gemfile</h3>

<pre class="terminal">
$ gem install "mongo_mapper"
$ gem install "bson_ext"
</pre>

<p>Add BSON for serialization of JSON-like documents; it is needed to interface with the MongoDB Ruby driver.</p>

<h3 id="rails">Rails</h3>
<p>If your application is a Rails app, modify the production section of <code>config/mongo.yml</code> to set credentials, host, and port for Cloud Foundry by parsing the JSON-formatted <code>VCAP_SERVICES</code> environment variable.</p>

<pre><code class="language-erb"><span class="x">production:</span>
<span class="x">host: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'hostname'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">'localhost'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">port: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'port'</span><span class="o">]</span> <span class="k">rescue</span> <span class="mi">27017</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">database:  </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'db'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">'tutorial_db'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">username: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'username'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">''</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">password: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'password'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">''</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre>

<p>If your application is not a Rails app, the <code>JSON.parse()</code> code in the previous step demonstrates how to extract from <code>VCAP_SERVICES</code> the information you need to construct a <a href="http://www.mongodb.org/display/DOCS/Connections">MongoDB connection string</a> to access the Cloud Foundry MongoDB service.</p>

<h3 id="bundle">Bundle</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="deploy">Deploy</h3>

<p>When vmc asks if you want to bind any services, enter <code>y</code> and choose <code>mongodb</code> from the menu. Provide a name for the service or accept the default, as in this transcript:</p>

<pre class="terminal">
$ vmc push --runtime ruby19
    Would you like to deploy from the current directory? [Yn]:
    Application Name: test
    Application Deployed URL [test.pubs.cloudfoundry.me]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [256M]:
    Creating Application: OK
    Would you like to bind any services to 'test'? [yN]: y
    Would you like to use an existing provisioned service [yN]? N
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-dcc48]:
    Creating Service: OK
    Binding Service [mongodb-dcc48]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"[MongoDB](http://www.mongodb.org), the scalable, open source, document-oriented database is provided as a service on Cloud Foundry.
This section describes how you can adapt a Ruby on Rails application to access the Cloud Foundry mongodb service.
It is assumed that you are using the [MongoMapper](http://mongomapper.com) ORM.

### Gemfile

``` bash
$ gem install "mongo_mapper"
$ gem install "bson_ext"
```

Add BSON for serialization of JSON-like documents; it is needed to interface with the MongoDB Ruby driver.

### Rails
If your application is a Rails app, modify the production section of `config/mongo.yml` to set credentials, host, and port for Cloud Foundry by parsing the JSON-formatted `VCAP_SERVICES` environment variable.

``` erb
production:
host: <%= JSON.parse(ENV['VCAP_SERVICES'])['mongodb-2.0'].first['credentials']['hostname'] rescue 'localhost' %>
port: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-2.0'].first['credentials']['port'] rescue 27017 %>
database:  <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-2.0'].first['credentials']['db'] rescue 'tutorial_db' %>
username: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-2.0'].first['credentials']['username'] rescue '' %>
password: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-2.0'].first['credentials']['password'] rescue '' %>

```

If your application is not a Rails app, the `JSON.parse()` code in the previous step demonstrates how to extract from `VCAP_SERVICES` the information you need to construct a [MongoDB connection string](http://www.mongodb.org/display/DOCS/Connections) to access the Cloud Foundry MongoDB service.

### Bundle

```bash
$ bundle package
$ bundle install
```

### Deploy

When vmc asks if you want to bind any services, enter `y` and choose `mongodb` from the menu. Provide a name for the service or accept the default, as in this transcript:

``` bash
$ vmc push --runtime ruby19
    Would you like to deploy from the current directory? [Yn]:
    Application Name: test
    Application Deployed URL [test.pubs.cloudfoundry.me]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [256M]:
    Creating Application: OK
    Would you like to bind any services to 'test'? [yN]: y
    Would you like to use an existing provisioned service [yN]? N
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-dcc48]:
    Creating Service: OK
    Binding Service [mongodb-dcc48]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
```;T;
I"]<p><a href="http://www.mongodb.org">MongoDB</a>, the scalable, open source, document-oriented database is provided as a service on Cloud Foundry.
This section describes how you can adapt a Ruby on Rails application to access the Cloud Foundry mongodb service.
It is assumed that you are using the <a href="http://mongomapper.com">MongoMapper</a> ORM.</p>

<h3 id="gemfile">Gemfile</h3>

<pre class="terminal">
$ gem install "mongo_mapper"
$ gem install "bson_ext"
</pre>

<p>Add BSON for serialization of JSON-like documents; it is needed to interface with the MongoDB Ruby driver.</p>

<h3 id="rails">Rails</h3>
<p>If your application is a Rails app, modify the production section of <code>config/mongo.yml</code> to set credentials, host, and port for Cloud Foundry by parsing the JSON-formatted <code>VCAP_SERVICES</code> environment variable.</p>

<pre><code class="language-erb"><span class="x">production:</span>
<span class="x">host: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'hostname'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">'localhost'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">port: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'port'</span><span class="o">]</span> <span class="k">rescue</span> <span class="mi">27017</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">database:  </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'db'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">'tutorial_db'</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">username: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'username'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">''</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">password: </span><span class="cp">&lt;%=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span> <span class="p">)</span><span class="o">[</span><span class="s1">'mongodb-2.0'</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">][</span><span class="s1">'password'</span><span class="o">]</span> <span class="k">rescue</span> <span class="s1">''</span> <span class="cp">%&gt;</span><span class="x"></span></code></pre>

<p>If your application is not a Rails app, the <code>JSON.parse()</code> code in the previous step demonstrates how to extract from <code>VCAP_SERVICES</code> the information you need to construct a <a href="http://www.mongodb.org/display/DOCS/Connections">MongoDB connection string</a> to access the Cloud Foundry MongoDB service.</p>

<h3 id="bundle">Bundle</h3>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<h3 id="deploy">Deploy</h3>

<p>When vmc asks if you want to bind any services, enter <code>y</code> and choose <code>mongodb</code> from the menu. Provide a name for the service or accept the default, as in this transcript:</p>

<pre class="terminal">
$ vmc push --runtime ruby19
    Would you like to deploy from the current directory? [Yn]:
    Application Name: test
    Application Deployed URL [test.pubs.cloudfoundry.me]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [256M]:
    Creating Application: OK
    Would you like to bind any services to 'test'? [yN]: y
    Would you like to use an existing provisioned service [yN]? N
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-dcc48]:
    Creating Service: OK
    Binding Service [mongodb-dcc48]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</pre>;T;@§I"&/services/mongodb/nodejs-mongodb/;T{;{	;I"“<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mongodb/nodejs-mongodb.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MongoDB with Node.js' property='og:title'>
<meta content='Node.js Development with the MongoDB Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MongoDB with Node.js</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MongoDB with Node.js</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Node.js Development with the MongoDB Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/nodejs" rel="tag">nodejs</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Before you begin, review these prerequisites:</p>

<ul>
<li>
    <p><a href="http://cloudfoundry.com/signup">Cloud Foundry account</a> and <a href="/tools/vmc/installing-vmc.html">vmc</a></p>
  </li>
  <li>
    <p><a href="http://nodejs.org/">Node.js</a> installed on your development machine</p>
  </li>
  <li>
    <p><a href="http://www.mongodb.org">MongoDB</a>, the open source NoSQL database, installed on your development computer</p>
  </li>
</ul><p>See <a href="/frameworks/nodejs/nodejs.html">Node.js Application Development with Cloud Foundry</a> for a first tutorial on deploying Node.js applications.</p>

<h2 id="using-the-cloud-foundry-mongodb-service">Using the Cloud Foundry MongoDB Service</h2>

<p>MongoDB is a scalable, open source, document-oriented database provided as a service at Cloud Foundry. This section describes how you can create Node.js applications that use this service. The examples are coded so that you can run and test them locally as well as on Cloud Foundry.
Code for these examples can be found at <a href="https://github.com/gatesvp/cloudfoundry_node_mongodb">GitHub</a>.</p>

<h3 id="setup">Setup</h3>

<p>Start <code>mongod</code> in your local environment with the following command:</p>

<pre class="terminal">
$ mongod
</pre>

<p>Confirm that Node.js is correctly installed:</p>

<ul>
<li>Run <code>node</code> to start the interactive javascript console:</li>
</ul><pre class="terminal">
$ node
</pre>

<p>Press <code>Control-C</code> to exit.</p>

<ul>
<li>Check that Node Package Manager (NPM) is installed:</li>
</ul><pre class="terminal">
$ npm -v
1.0.6
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<h3 id="create-a-working-nodejs-application-for-cloud-foundry">Create a Working Node.js Application for Cloud Foundry</h3>

<p>In this step, you create a basic application and make sure that it works locally and on Cloud Foundry.</p>

<dl>
<dt>Note</dt>
  <dd>Throughout this tutorial, we use the name â€œmongo-nodeâ€ for the application. When you deploy to Cloud Foundry you must choose a different, unique name.</dd>
</dl><p>Create an application directory and change into it:</p>

<pre class="terminal">
$ mkdir mongo-node
$ cd mongo-node
</pre>

<p>Create a file <code>app.js</code> containing the following code:</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VMC_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_HOST</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World\n'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<p>This creates a Node.js web server using port 3000 on localhost that responds to any HTTP request with the string â€œHello World.â€</p>

<p>Start the Node.js web server locally:</p>

<pre class="terminal">
$ node app.js
</pre>

<p>In another terminal window send a request:</p>

<pre class="terminal">
$ curl localhost:3000
Hello World
</pre>

<p>Alternatively, browse to http://localhost:3000 to see the response from the web server.</p>

<p>Press <code>Control-C</code> in the first terminal window to stop the web server.</p>

<p>Push the application to Cloud Foundry. Press <code>Enter</code> to accept the defaults, except enter a unique name for the application, and set up a mongodb service, as shown in the following vmc transcript:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: mongo-node
    Application Deployed URL [mongo-node.cloudfoundry.com]:
    Detected a Node.js Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'mongo-node'? [yN]: y
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-e840e]:
    Creating Service: OK
    Binding Service [mongodb-e840e]: OK
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<p>Cloud Foundry stages and starts your application.</p>

<p>Test the application.</p>

<pre class="terminal">
$ curl mongo-node.cloudfoundry.com
	Hello World
</pre>

<h3 id="add-mongodb-configuration">Add MongoDB Configuration</h3>

<p>In the previous step, you deployed the application and bound it to a Cloud Foundry mongodb service, although the application does not yet use the service.</p>

<p>In this step, you update the application to set up MongoDB connection information and credentials, whether the application is running locally or on the cloud.</p>

<ul>
<li>Add the following code to the beginning of <code>app.js</code>:</li>
</ul><pre><code class="language-javascript"><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">'mongodb-2.0'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'credentials'</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"localhost"</span><span class="p">,</span>
    <span class="s2">"port"</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">"username"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"password"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"db"</span><span class="o">:</span><span class="s2">"db"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">generate_mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">'test'</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">"@"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongourl</span> <span class="o">=</span> <span class="nx">generate_mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">);</span></code></pre>

<p>The <code>if</code> provides two different sets of information, depending on whether the application is running on the cloud or locally. <code>generate_mongo_url</code> creates appropriate connection information for MongoDB, which is then assigned to mongourl.</p>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ node app.js
</pre>

<ul>
<li>In another terminal:</li>
</ul><pre class="terminal">
$ curl localhost:3000
</pre>

<p>The application returns the string â€œHello Worldâ€.</p>

<ul>
<li>Update the deployed cloud application:</li>
</ul><pre class="terminal">
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<ul>
<li>Test the deployed application:</li>
</ul><pre class="terminal">
$ curl mongo-node.cloudfoundry.com
    Hello World
</pre>

<h3 id="add-mongodb-functionality">Add MongoDB Functionality</h3>

<p>Next, install the MongoDB native drivers locally and update the application to use MongoDB.</p>

<ul>
<li>Install MongoDB native drivers locally:</li>
</ul><pre class="terminal">
$ npm install mongodb
</pre>

<p>This creates a new local directory, <code>node_modules</code>, in the application root.</p>

<ul>
<li>In <code>app.js</code>, create a new function, record_visit, that stores the server request to MongoDB:</li>
</ul><pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<p>The <code>.connect</code> method connects to MongoDB using either the local or Cloud Foundry mongourl.
Then the <code>.collection('ips', ...)</code> method adds the request information to the data that will be committed.</p>

<ul>
<li>Update the <code>http.createServer</code> method so that it calls the <code>record_visit</code> function when the server request is made:</li>
</ul><pre><code class="language-javascript">    <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ node app.js
</pre>

<p>and from another terminal:</p>

<pre class="terminal">
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</pre>

<p>Press Control-C in the first terminal to stop the web server.</p>

<ul>
<li>Test the application on Cloud Foundry:</li>
</ul><pre class="terminal">
$ vmc update mongo-node
$ curl appname.cloudfoundry.com
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</pre>

<ul>
<li>Create a function <code>print_visits</code> that prints the last ten visits/requests:</li>
</ul><pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="cm">/* Connect to the DB and auth */</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
        <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
            <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
                <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="p">}</span></code></pre>

<ul>
<li>Update the <code>createServer</code> method to call the new <code>print_visits</code> function:</li>
</ul><pre><code class="language-javascript"><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<p>Web server requests will either add the current visit to MongoDB (the default) or,
if url includes â€œ/historyâ€, output the last ten visits.</p>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
$ curl localhost:3000/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:39.339Z","_id":"4efcf85b2f9d30481f000002"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:26.678Z","_id":"4efcf84e2f9d30481f000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</pre>

<ul>
<li>Stop the application locally and update it on Cloud Foundry.</li>
</ul><pre class="terminal">
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<ul>
<li>Test the cloud version of the application.</li>
</ul><pre class="terminal">
$ curl mongo-node.cloudfoundry.com/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:49:46.738Z","_id":"4efcfc9acbfffadc0b000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"J'Before you begin, review these prerequisites:

+	[Cloud Foundry account](http://cloudfoundry.com/signup) and [vmc](/tools/vmc/installing-vmc.html)

+	[Node.js](http://nodejs.org/) installed on your development machine

+	[MongoDB](http://www.mongodb.org), the open source NoSQL database, installed on your development computer

See [Node.js Application Development with Cloud Foundry](/frameworks/nodejs/nodejs.html) for a first tutorial on deploying Node.js applications.

## Using the Cloud Foundry MongoDB Service

MongoDB is a scalable, open source, document-oriented database provided as a service at Cloud Foundry. This section describes how you can create Node.js applications that use this service. The examples are coded so that you can run and test them locally as well as on Cloud Foundry.
Code for these examples can be found at [GitHub](https://github.com/gatesvp/cloudfoundry_node_mongodb).

### Setup

Start `mongod` in your local environment with the following command:

``` bash
$ mongod
```

Confirm that Node.js is correctly installed:

+	Run `node` to start the interactive javascript console:

```bash
$ node
```

Press `Control-C` to exit.

+	Check that Node Package Manager (NPM) is installed:

```bash
$ npm -v
1.0.6
```

Target Cloud Foundry and log in with your Cloud Foundry credentials:

``` bash
$ vmc target api.cloudfoundry.com
$ vmc login
```

### Create a Working Node.js Application for Cloud Foundry

In this step, you create a basic application and make sure that it works locally and on Cloud Foundry.

Note
: Throughout this tutorial, we use the name "mongo-node" for the application. When you deploy to Cloud Foundry you must choose a different, unique name.

Create an application directory and change into it:

``` bash
$ mkdir mongo-node
$ cd mongo-node
```

Create a file `app.js` containing the following code:

``` javascript
var port = (process.env.VMC_APP_PORT || 3000);
var host = (process.env.VCAP_APP_HOST || 'localhost');
var http = require('http');

http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello World\n');
}).listen(port, host);
```

This creates a Node.js web server using port 3000 on localhost that responds to any HTTP request with the string "Hello World."

Start the Node.js web server locally:

``` bash
$ node app.js
```

In another terminal window send a request:

``` bash
$ curl localhost:3000
Hello World
```

Alternatively, browse to http://localhost:3000 to see the response from the web server.

Press `Control-C` in the first terminal window to stop the web server.

Push the application to Cloud Foundry. Press `Enter` to accept the defaults, except enter a unique name for the application, and set up a mongodb service, as shown in the following vmc transcript:

```bash
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: mongo-node
    Application Deployed URL [mongo-node.cloudfoundry.com]:
    Detected a Node.js Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'mongo-node'? [yN]: y
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-e840e]:
    Creating Service: OK
    Binding Service [mongodb-e840e]: OK
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
```

Cloud Foundry stages and starts your application.

Test the application.

``` bash
$ curl mongo-node.cloudfoundry.com
	Hello World
```

### Add MongoDB Configuration

In the previous step, you deployed the application and bound it to a Cloud Foundry mongodb service, although the application does not yet use the service.

In this step, you update the application to set up MongoDB connection information and credentials, whether the application is running locally or on the cloud.

* Add the following code to the beginning of `app.js`:

``` javascript

if(process.env.VCAP_SERVICES){
  var env = JSON.parse(process.env.VCAP_SERVICES);
  var mongo = env['mongodb-2.0'][0]['credentials'];
}
else{
  var mongo = {
    "hostname":"localhost",
    "port":27017,
    "username":"",
    "password":"",
    "name":"",
    "db":"db"
  }
}

var generate_mongo_url = function(obj){
  obj.hostname = (obj.hostname || 'localhost');
  obj.port = (obj.port || 27017);
  obj.db = (obj.db || 'test');

  if(obj.username && obj.password){
    return "mongodb://" + obj.username + ":" + obj.password + "@" + obj.hostname + ":" + obj.port + "/" + obj.db;
  }
  else{
    return "mongodb://" + obj.hostname + ":" + obj.port + "/" + obj.db;
  }
}

var mongourl = generate_mongo_url(mongo);
```

The `if` provides two different sets of information, depending on whether the application is running on the cloud or locally. `generate_mongo_url` creates appropriate connection information for MongoDB, which is then assigned to mongourl.

* Test the application locally:

``` bash
$ node app.js
```

* In another terminal:

``` bash
$ curl localhost:3000
```

The application returns the string "Hello World".

* Update the deployed cloud application:

``` bash
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
```

* Test the deployed application:

```bash
$ curl mongo-node.cloudfoundry.com
    Hello World
```

### Add MongoDB Functionality

Next, install the MongoDB native drivers locally and update the application to use MongoDB.

* Install MongoDB native drivers locally:

``` bash
$ npm install mongodb
```

This creates a new local directory, `node_modules`, in the application root.

* In `app.js`, create a new function, record_visit, that stores the server request to MongoDB:

``` javascript
var record_visit = function(req, res){
  /* Connect to the DB and auth */
  require('mongodb').connect(mongourl, function(err, conn){
    conn.collection('ips', function(err, coll){
      /* Simple object to insert: ip address and date */
      object_to_insert = { 'ip': req.connection.remoteAddress, 'ts': new Date() };

      /* Insert the object then print in response */
      /* Note the _id has been created */
      coll.insert( object_to_insert, {safe:true}, function(err){
        res.writeHead(200, {'Content-Type': 'text/plain'});
        res.write(JSON.stringify(object_to_insert));
        res.end('\n');
      });
    });
  });
}
```

The `.connect` method connects to MongoDB using either the local or Cloud Foundry mongourl.
Then the `.collection('ips', ...)` method adds the request information to the data that will be committed.

* Update the `http.createServer` method so that it calls the `record_visit` function when the server request is made:

``` javascript
    http.createServer(function (req, res) {
        record_visit(req, res);
    }).listen(port, host);
```

* Test the application locally:

``` bash
$ node app.js
```

and from another terminal:

``` bash
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
```

Press Control-C in the first terminal to stop the web server.

* Test the application on Cloud Foundry:

``` bash
$ vmc update mongo-node
$ curl appname.cloudfoundry.com
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
```

* Create a function `print_visits` that prints the last ten visits/requests:

``` javascript
var print_visits = function(req, res){
/* Connect to the DB and auth */
require('mongodb').connect(mongourl, function(err, conn){
    conn.collection('ips', function(err, coll){
        coll.find({}, {limit:10, sort:[['_id','desc']]}, function(err, cursor){
            cursor.toArray(function(err, items){
                res.writeHead(200, {'Content-Type': 'text/plain'});
                for(i=0; i<items.length;i++){
                    res.write(JSON.stringify(items[i]) + "\n");
                }
                res.end();
            });
        });
    });
});
}
```

* Update the `createServer` method to call the new `print_visits` function:

``` javascript

http.createServer(function (req, res) {
    params = require('url').parse(req.url);
    if(params.pathname === '/history') {
        print_visits(req, res);
    }
    else{
        record_visit(req, res);
    }
}).listen(port, host);
```

Web server requests will either add the current visit to MongoDB (the default) or,
if url includes "/history", output the last ten visits.

* Test the application locally:

``` bash
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
$ curl localhost:3000/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:39.339Z","_id":"4efcf85b2f9d30481f000002"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:26.678Z","_id":"4efcf84e2f9d30481f000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
```

* Stop the application locally and update it on Cloud Foundry.

``` bash
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
```

* Test the cloud version of the application.

``` bash
$ curl mongo-node.cloudfoundry.com/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:49:46.738Z","_id":"4efcfc9acbfffadc0b000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
```;T;
I"<_<p>Before you begin, review these prerequisites:</p>

<ul>
<li>
    <p><a href="http://cloudfoundry.com/signup">Cloud Foundry account</a> and <a href="/tools/vmc/installing-vmc.html">vmc</a></p>
  </li>
  <li>
    <p><a href="http://nodejs.org/">Node.js</a> installed on your development machine</p>
  </li>
  <li>
    <p><a href="http://www.mongodb.org">MongoDB</a>, the open source NoSQL database, installed on your development computer</p>
  </li>
</ul><p>See <a href="/frameworks/nodejs/nodejs.html">Node.js Application Development with Cloud Foundry</a> for a first tutorial on deploying Node.js applications.</p>

<h2 id="using-the-cloud-foundry-mongodb-service">Using the Cloud Foundry MongoDB Service</h2>

<p>MongoDB is a scalable, open source, document-oriented database provided as a service at Cloud Foundry. This section describes how you can create Node.js applications that use this service. The examples are coded so that you can run and test them locally as well as on Cloud Foundry.
Code for these examples can be found at <a href="https://github.com/gatesvp/cloudfoundry_node_mongodb">GitHub</a>.</p>

<h3 id="setup">Setup</h3>

<p>Start <code>mongod</code> in your local environment with the following command:</p>

<pre class="terminal">
$ mongod
</pre>

<p>Confirm that Node.js is correctly installed:</p>

<ul>
<li>Run <code>node</code> to start the interactive javascript console:</li>
</ul><pre class="terminal">
$ node
</pre>

<p>Press <code>Control-C</code> to exit.</p>

<ul>
<li>Check that Node Package Manager (NPM) is installed:</li>
</ul><pre class="terminal">
$ npm -v
1.0.6
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<h3 id="create-a-working-nodejs-application-for-cloud-foundry">Create a Working Node.js Application for Cloud Foundry</h3>

<p>In this step, you create a basic application and make sure that it works locally and on Cloud Foundry.</p>

<dl>
<dt>Note</dt>
  <dd>Throughout this tutorial, we use the name â€œmongo-nodeâ€ for the application. When you deploy to Cloud Foundry you must choose a different, unique name.</dd>
</dl><p>Create an application directory and change into it:</p>

<pre class="terminal">
$ mkdir mongo-node
$ cd mongo-node
</pre>

<p>Create a file <code>app.js</code> containing the following code:</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VMC_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_HOST</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'Hello World\n'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<p>This creates a Node.js web server using port 3000 on localhost that responds to any HTTP request with the string â€œHello World.â€</p>

<p>Start the Node.js web server locally:</p>

<pre class="terminal">
$ node app.js
</pre>

<p>In another terminal window send a request:</p>

<pre class="terminal">
$ curl localhost:3000
Hello World
</pre>

<p>Alternatively, browse to http://localhost:3000 to see the response from the web server.</p>

<p>Press <code>Control-C</code> in the first terminal window to stop the web server.</p>

<p>Push the application to Cloud Foundry. Press <code>Enter</code> to accept the defaults, except enter a unique name for the application, and set up a mongodb service, as shown in the following vmc transcript:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: mongo-node
    Application Deployed URL [mongo-node.cloudfoundry.com]:
    Detected a Node.js Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [64M]:
    Creating Application: OK
    Would you like to bind any services to 'mongo-node'? [yN]: y
    The following system services are available
    1: mongodb
    2: mysql
    3: postgresql
    4: rabbitmq
    5: redis
    Please select one you wish to provision: 1
    Specify the name of the service [mongodb-e840e]:
    Creating Service: OK
    Binding Service [mongodb-e840e]: OK
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<p>Cloud Foundry stages and starts your application.</p>

<p>Test the application.</p>

<pre class="terminal">
$ curl mongo-node.cloudfoundry.com
	Hello World
</pre>

<h3 id="add-mongodb-configuration">Add MongoDB Configuration</h3>

<p>In the previous step, you deployed the application and bound it to a Cloud Foundry mongodb service, although the application does not yet use the service.</p>

<p>In this step, you update the application to set up MongoDB connection information and credentials, whether the application is running locally or on the cloud.</p>

<ul>
<li>Add the following code to the beginning of <code>app.js</code>:</li>
</ul><pre><code class="language-javascript"><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="nx">env</span><span class="p">[</span><span class="s1">'mongodb-2.0'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'credentials'</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">mongo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"localhost"</span><span class="p">,</span>
    <span class="s2">"port"</span><span class="o">:</span><span class="mi">27017</span><span class="p">,</span>
    <span class="s2">"username"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"password"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span>
    <span class="s2">"db"</span><span class="o">:</span><span class="s2">"db"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">generate_mongo_url</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">||</span> <span class="s1">'localhost'</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">'test'</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">password</span> <span class="o">+</span> <span class="s2">"@"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="k">return</span> <span class="s2">"mongodb://"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">db</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mongourl</span> <span class="o">=</span> <span class="nx">generate_mongo_url</span><span class="p">(</span><span class="nx">mongo</span><span class="p">);</span></code></pre>

<p>The <code>if</code> provides two different sets of information, depending on whether the application is running on the cloud or locally. <code>generate_mongo_url</code> creates appropriate connection information for MongoDB, which is then assigned to mongourl.</p>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ node app.js
</pre>

<ul>
<li>In another terminal:</li>
</ul><pre class="terminal">
$ curl localhost:3000
</pre>

<p>The application returns the string â€œHello Worldâ€.</p>

<ul>
<li>Update the deployed cloud application:</li>
</ul><pre class="terminal">
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<ul>
<li>Test the deployed application:</li>
</ul><pre class="terminal">
$ curl mongo-node.cloudfoundry.com
    Hello World
</pre>

<h3 id="add-mongodb-functionality">Add MongoDB Functionality</h3>

<p>Next, install the MongoDB native drivers locally and update the application to use MongoDB.</p>

<ul>
<li>Install MongoDB native drivers locally:</li>
</ul><pre class="terminal">
$ npm install mongodb
</pre>

<p>This creates a new local directory, <code>node_modules</code>, in the application root.</p>

<ul>
<li>In <code>app.js</code>, create a new function, record_visit, that stores the server request to MongoDB:</li>
</ul><pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">record_visit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="cm">/* Connect to the DB and auth */</span>
  <span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
      <span class="cm">/* Simple object to insert: ip address and date */</span>
      <span class="nx">object_to_insert</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'ip'</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">,</span> <span class="s1">'ts'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">};</span>

      <span class="cm">/* Insert the object then print in response */</span>
      <span class="cm">/* Note the _id has been created */</span>
      <span class="nx">coll</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span> <span class="nx">object_to_insert</span><span class="p">,</span> <span class="p">{</span><span class="nx">safe</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object_to_insert</span><span class="p">));</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre>

<p>The <code>.connect</code> method connects to MongoDB using either the local or Cloud Foundry mongourl.
Then the <code>.collection('ips', ...)</code> method adds the request information to the data that will be committed.</p>

<ul>
<li>Update the <code>http.createServer</code> method so that it calls the <code>record_visit</code> function when the server request is made:</li>
</ul><pre><code class="language-javascript">    <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ node app.js
</pre>

<p>and from another terminal:</p>

<pre class="terminal">
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</pre>

<p>Press Control-C in the first terminal to stop the web server.</p>

<ul>
<li>Test the application on Cloud Foundry:</li>
</ul><pre class="terminal">
$ vmc update mongo-node
$ curl appname.cloudfoundry.com
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</pre>

<ul>
<li>Create a function <code>print_visits</code> that prints the last ten visits/requests:</li>
</ul><pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">print_visits</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="cm">/* Connect to the DB and auth */</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">'mongodb'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="nx">mongourl</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">conn</span><span class="p">){</span>
    <span class="nx">conn</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'ips'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
        <span class="nx">coll</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="nx">sort</span><span class="o">:</span><span class="p">[[</span><span class="s1">'_id'</span><span class="p">,</span><span class="s1">'desc'</span><span class="p">]]},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cursor</span><span class="p">){</span>
            <span class="nx">cursor</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">items</span><span class="p">){</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span><span class="o">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
                <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="p">}</span></code></pre>

<ul>
<li>Update the <code>createServer</code> method to call the new <code>print_visits</code> function:</li>
</ul><pre><code class="language-javascript"><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">).</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="s1">'/history'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">print_visits</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">record_visit</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">host</span><span class="p">);</span></code></pre>

<p>Web server requests will either add the current visit to MongoDB (the default) or,
if url includes â€œ/historyâ€, output the last ten visits.</p>

<ul>
<li>Test the application locally:</li>
</ul><pre class="terminal">
$ curl localhost:3000
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
$ curl localhost:3000/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:44:30.254Z","_id":"4efcfb5e2f9d30481f000003"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:39.339Z","_id":"4efcf85b2f9d30481f000002"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:31:26.678Z","_id":"4efcf84e2f9d30481f000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:22:38.192Z","_id":"4efcf63ecab9a5b41e000001"}
</pre>

<ul>
<li>Stop the application locally and update it on Cloud Foundry.</li>
</ul><pre class="terminal">
$ vmc update mongo-node
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (8K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK
</pre>

<ul>
<li>Test the cloud version of the application.</li>
</ul><pre class="terminal">
$ curl mongo-node.cloudfoundry.com/history
    {"ip":"127.0.0.1","ts":"2011-12-29T23:49:46.738Z","_id":"4efcfc9acbfffadc0b000001"}
    {"ip":"127.0.0.1","ts":"2011-12-29T23:24:25.199Z","_id":"4efcf6a927996b5f79000001"}
</pre>;T;@­I"+/services/mongodb/ruby-mongodb-gridfs/;T{;{	;I"1z<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mongodb/ruby-mongodb-gridfs.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MongoDB and GridFS with Ruby' property='og:title'>
<meta content='Ruby Development with MongoDB and GridFS' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MongoDB and GridFS with Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MongoDB and GridFS with Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Development with MongoDB and GridFS</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/grid-fs" rel="tag">grid-fs</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>GridFS is a specification for storing files larger than the MongoDB size limit in MongoDB databases. It works by storing the file in chunks, which are managed through an API that treats the collection of chunks as a single ojbect. This tutorial shows how to use GridFS in a Rails application by adding an avatar to the User model.</p>

<p>Many web applications allow users to upload and retrieve generated images, such as profile pictures, photos, or video thumbnails. If you are using Ruby on Rails there are a couple of great frameworks you can use: PaperClip and CarrierWave.</p>

<p>CarrierWave was selected for this project because it seems the least obtrusive and most flexible. CarrierWave can be used with the file system, Amazon S3, or a database, including Mongo GridFS.</p>

<p>The first task is to add images when users register on the app using their Facebook account. Here are the steps to support uploading and serving images. For more details on the Facebook integration review the <code>user.rb</code> model in the source code.</p>

<h2 id="steps-to-perform-on-your-terminal">Steps to Perform on Your Terminal</h2>

<p>This assumes you already have a Ruby on Rails 3.0 application on Cloud Foundry with a Users model.</p>

<pre class="terminal">
# Log in to Cloud Foundry if you are not logged in
$ vmc login youremail@domain.com

$ vmc create-service mongodb

# See what the newly created mongo service is called
$ vmc services

# Bind the service to your existing application
$ vmc bind-service mongodb-???? appname

</pre>

<h2 id="steps-on-your-code-base">Steps on Your Code Base</h2>

<h3 id="dependencies">Dependencies</h3>

<p>Add the following gems to your Gemfile</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'carrierwave'</span>
<span class="n">gem</span> <span class="s1">'carrierwave-mongoid'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s2">"carrierwave/mongoid"</span></code></pre>

<p>Generate the uploader</p>

<pre class="terminal">
$ rails generate uploader Avatar
</pre>

<p>Edit the generated file, <code>app/uploaders/avadar_uploader.rb</code>, to use grid_fs</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">AvatarUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>

    <span class="c1"># Choose what kind of storage to use for this uploader:</span>
    <span class="n">storage</span> <span class="ss">:grid_fs</span>

    <span class="c1"># Override the directory where uploaded files will be stored.</span>
    <span class="c1"># This is a sensible default for uploaders that are meant to be mounted:</span>
    <span class="k">def</span> <span class="nf">store_dir</span>
        <span class="s2">"</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>

    <span class="c1"># Provide a default URL as a default if there hasn't been a file uploaded:</span>
    <span class="k">def</span> <span class="nf">default_url</span>
        <span class="s2">"/images/fallback/"</span> <span class="o">+</span> <span class="o">[</span><span class="n">version_name</span><span class="p">,</span> <span class="s2">"default.png"</span><span class="o">].</span><span class="n">compact</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'_'</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Update your ActiveRecord model to store the avatar.</p>

<p>Make sure you are loading CarrierWave after loading the ORM, otherwise you need to require the relevant extension manually, for example:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'carrierwave/orm/activerecord'</span></code></pre>

<p>Add a string column to the model on which you want to mount the uploader.</p>

<pre class="terminal">
$ add_column :users, :avatar, :string
</pre>

<p>Open your model file and add code to mount the uploader:</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">User</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="n">mount_uploader</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="no">AvatarUploader</span>

    <span class="c1"># Make sure that the avatar is accessible</span>
    <span class="n">attr_accessible</span> <span class="ss">:emails</span><span class="p">,</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">:remote_avatar_url</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:last_name</span> <span class="c1">#....</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span></code></pre>

<p>Create an initializer for Mongoid to use your MongoDB instance on Cloud Foundry. Name it <code>01_mongoid.rb</code> so it runs before everything else.</p>

<pre><code class="language-ruby"><span class="no">Mongoid</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">conn_info</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">services</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">service_version</span><span class="p">,</span> <span class="n">bindings</span><span class="o">|</span>
      <span class="n">bindings</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">binding</span><span class="o">|</span>
        <span class="k">if</span> <span class="nb">binding</span><span class="o">[</span><span class="s1">'label'</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/mongo/i</span>
          <span class="n">conn_info</span> <span class="o">=</span> <span class="nb">binding</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
          <span class="k">break</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">raise</span> <span class="s2">"could not find connection info for mongo"</span> <span class="k">unless</span> <span class="n">conn_info</span>
  <span class="k">else</span>
    <span class="n">conn_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span> <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="mi">27017</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">cnx</span> <span class="o">=</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Connection</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">conn_info</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:pool_size</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="n">db</span> <span class="o">=</span> <span class="n">cnx</span><span class="o">[</span><span class="s1">'db'</span><span class="o">]</span>
  <span class="k">if</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]</span> <span class="ow">and</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span>
    <span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">conn_info</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]</span><span class="p">,</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">db</span>
<span class="k">end</span></code></pre>

<p>Update your CarrierWave initializer to use the Cloud Foundry MongoDB service.</p>

<pre><code class="language-ruby"><span class="c1">#initializers/carrierwave.rb</span>
<span class="nb">require</span> <span class="s1">'serve_gridfs_image'</span>

<span class="no">CarrierWave</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="ss">:grid_fs</span>
  <span class="n">config</span><span class="o">.</span><span class="n">grid_fs_connection</span> <span class="o">=</span> <span class="no">Mongoid</span><span class="o">.</span><span class="n">database</span>

  <span class="c1"># Storage access url</span>
  <span class="n">config</span><span class="o">.</span><span class="n">grid_fs_access_url</span> <span class="o">=</span> <span class="s2">"/grid"</span>
<span class="k">end</span></code></pre>

<p>Handle requests for the images in <code>lib/serve_gridfs_image.rb</code>:</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">ServeGridfsImage</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
      <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">[</span><span class="s2">"PATH_INFO"</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^\/grid\/(.+)$/</span>
      <span class="n">process_request</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="vg">$1</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="vi">@app</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">begin</span>
      <span class="no">Mongo</span><span class="o">::</span><span class="no">GridFileSystem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Mongoid</span><span class="o">.</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
        <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="n">file</span><span class="o">.</span><span class="n">content_type</span> <span class="p">},</span> <span class="o">[</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="o">]]</span>
      <span class="k">end</span>
    <span class="k">rescue</span>
      <span class="o">[</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span> <span class="p">},</span> <span class="o">[</span><span class="s1">'File not found.'</span><span class="o">]]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h2 id="deploy">Deploy</h2>

<pre class="terminal">
$ bundle install
    bundle package
    vmc update app_name
</pre>

<h2 id="conclusion">Conclusion</h2>

<p>This will give you the ability to upload and serve images. Do note that it does not provide image resizing. If you are using devise for example you can import the avatar(profile picture) of the user when they sign up.</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">new_with_session</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
      <span class="k">super</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="s1">'devise.omniauth_info'</span><span class="o">]</span>
          <span class="k">if</span> <span class="n">data</span> <span class="o">=</span> <span class="n">session</span><span class="o">[</span><span class="s1">'devise.omniauth_info'</span><span class="o">][</span><span class="s1">'user_info'</span><span class="o">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'email'</span><span class="o">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'nickname'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'nickname'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'first_name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'first_name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'last_name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'last_name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">remote_avatar_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'image'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'image'</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre>

<h2 id="references">References</h2>

<ul>
<li><a href="http://support.cloudfoundry.com/entries/20016922-connecting-to-a-mongo-db">Connecting to a MongoDB Database</a></li>
  <li><a href="https://github.com/jnicklas/carrierwave">CarrierWave</a></li>
  <li><a href="https://github.com/jnicklas/carrierwave-mongoid">CarrierWave for Mongoid</a></li>
  <li><a href="http://antekpiechnik.com/posts/setting-up-carrierwave-file-uploads-using-gridfs-on-rails-3-and-mongoid">Setting up CarrierWave file uploads using GridFS on Rails 3 and mongoid</a></li>
  <li><a href="https://github.com/plataformatec/devise">Devise</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"GridFS is a specification for storing files larger than the MongoDB size limit in MongoDB databases. It works by storing the file in chunks, which are managed through an API that treats the collection of chunks as a single ojbect. This tutorial shows how to use GridFS in a Rails application by adding an avatar to the User model.

Many web applications allow users to upload and retrieve generated images, such as profile pictures, photos, or video thumbnails. If you are using Ruby on Rails there are a couple of great frameworks you can use: PaperClip and CarrierWave.

CarrierWave was selected for this project because it seems the least obtrusive and most flexible. CarrierWave can be used with the file system, Amazon S3, or a database, including Mongo GridFS.

The first task is to add images when users register on the app using their Facebook account. Here are the steps to support uploading and serving images. For more details on the Facebook integration review the `user.rb` model in the source code.

## Steps to Perform on Your Terminal

This assumes you already have a Ruby on Rails 3.0 application on Cloud Foundry with a Users model.

```bash

# Log in to Cloud Foundry if you are not logged in
$ vmc login youremail@domain.com

$ vmc create-service mongodb

# See what the newly created mongo service is called
$ vmc services

# Bind the service to your existing application
$ vmc bind-service mongodb-???? appname

```

## Steps on Your Code Base

### Dependencies

Add the following gems to your Gemfile

``` ruby
gem 'carrierwave'
gem 'carrierwave-mongoid', :require => "carrierwave/mongoid"
```

Generate the uploader

```bash
$ rails generate uploader Avatar
```

Edit the generated file, `app/uploaders/avadar_uploader.rb`, to use grid_fs

``` ruby
class AvatarUploader < CarrierWave::Uploader::Base

    # Choose what kind of storage to use for this uploader:
    storage :grid_fs

    # Override the directory where uploaded files will be stored.
    # This is a sensible default for uploaders that are meant to be mounted:
    def store_dir
        "#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
    end

    # Provide a default URL as a default if there hasn't been a file uploaded:
    def default_url
        "/images/fallback/" + [version_name, "default.png"].compact.join('_')
    end
end
```

Update your ActiveRecord model to store the avatar.

Make sure you are loading CarrierWave after loading the ORM, otherwise you need to require the relevant extension manually, for example:

``` ruby
require 'carrierwave/orm/activerecord'
```

Add a string column to the model on which you want to mount the uploader.

```bash
$ add_column :users, :avatar, :string
```

Open your model file and add code to mount the uploader:

``` ruby
class User
...
    mount_uploader :avatar, AvatarUploader

    # Make sure that the avatar is accessible
    attr_accessible :emails, :avatar, :remote_avatar_url, :email, :last_name #....
...
end
```

Create an initializer for Mongoid to use your MongoDB instance on Cloud Foundry. Name it `01_mongoid.rb` so it runs before everything else.

``` ruby
Mongoid.configure do |config|
  conn_info = nil

  if ENV['VCAP_SERVICES']
    services = JSON.parse(ENV['VCAP_SERVICES'])
    services.each do |service_version, bindings|
      bindings.each do |binding|
        if binding['label'] =~ /mongo/i
          conn_info = binding['credentials']
          break
        end
      end
    end
    raise "could not find connection info for mongo" unless conn_info
  else
    conn_info = {'hostname' => 'localhost', 'port' => 27017}
  end

  cnx = Mongo::Connection.new(conn_info['hostname'], conn_info['port'], :pool_size => 5, :timeout => 5)
  db = cnx['db']
  if conn_info['username'] and conn_info['password']
    db.authenticate(conn_info['username'], conn_info['password'])
  end

  config.master = db
end
```

Update your CarrierWave initializer to use the Cloud Foundry MongoDB service.

``` ruby
#initializers/carrierwave.rb
require 'serve_gridfs_image'

CarrierWave.configure do |config|
  config.storage = :grid_fs
  config.grid_fs_connection = Mongoid.database

  # Storage access url
  config.grid_fs_access_url = "/grid"
end
```

Handle requests for the images in `lib/serve_gridfs_image.rb`:

``` ruby
class ServeGridfsImage
  def initialize(app)
      @app = app
  end

  def call(env)
    if env["PATH_INFO"] =~ /^\/grid\/(.+)$/
      process_request(env, $1)
    else
      @app.call(env)
    end
  end

  private
  def process_request(env, key)
    begin
      Mongo::GridFileSystem.new(Mongoid.database).open(key, 'r') do |file|
        [200, { 'Content-Type' => file.content_type }, [file.read]]
      end
    rescue
      [404, { 'Content-Type' => 'text/plain' }, ['File not found.']]
    end
  end
end
```

## Deploy

```bash
$ bundle install
    bundle package
    vmc update app_name
```

## Conclusion

This will give you the ability to upload and serve images. Do note that it does not provide image resizing. If you are using devise for example you can import the avatar(profile picture) of the user when they sign up.

``` ruby
class << self
    def new_with_session(params, session)
      super.tap do |user|
        if session['devise.omniauth_info']
          if data = session['devise.omniauth_info']['user_info']
            user.display_name = data['name'] if data.has_key? 'name'
            user.email = data['email']
            user.username = data['nickname'] if data.has_key? 'nickname'
            user.first_name = data['first_name'] if data.has_key? 'first_name'
            user.last_name = data['last_name'] if data.has_key? 'last_name'
            user.remote_avatar_url = data['image'] if data.has_key? 'image'
          end
        end
      end
    end
  end
```

## References

+ [Connecting to a MongoDB Database](http://support.cloudfoundry.com/entries/20016922-connecting-to-a-mongo-db)
+ [CarrierWave](https://github.com/jnicklas/carrierwave)
+ [CarrierWave for Mongoid](https://github.com/jnicklas/carrierwave-mongoid)
+ [Setting up CarrierWave file uploads using GridFS on Rails 3 and mongoid](http://antekpiechnik.com/posts/setting-up-carrierwave-file-uploads-using-gridfs-on-rails-3-and-mongoid)
+ [Devise](https://github.com/plataformatec/devise);T;
I"îE<p>GridFS is a specification for storing files larger than the MongoDB size limit in MongoDB databases. It works by storing the file in chunks, which are managed through an API that treats the collection of chunks as a single ojbect. This tutorial shows how to use GridFS in a Rails application by adding an avatar to the User model.</p>

<p>Many web applications allow users to upload and retrieve generated images, such as profile pictures, photos, or video thumbnails. If you are using Ruby on Rails there are a couple of great frameworks you can use: PaperClip and CarrierWave.</p>

<p>CarrierWave was selected for this project because it seems the least obtrusive and most flexible. CarrierWave can be used with the file system, Amazon S3, or a database, including Mongo GridFS.</p>

<p>The first task is to add images when users register on the app using their Facebook account. Here are the steps to support uploading and serving images. For more details on the Facebook integration review the <code>user.rb</code> model in the source code.</p>

<h2 id="steps-to-perform-on-your-terminal">Steps to Perform on Your Terminal</h2>

<p>This assumes you already have a Ruby on Rails 3.0 application on Cloud Foundry with a Users model.</p>

<pre class="terminal">
# Log in to Cloud Foundry if you are not logged in
$ vmc login youremail@domain.com

$ vmc create-service mongodb

# See what the newly created mongo service is called
$ vmc services

# Bind the service to your existing application
$ vmc bind-service mongodb-???? appname

</pre>

<h2 id="steps-on-your-code-base">Steps on Your Code Base</h2>

<h3 id="dependencies">Dependencies</h3>

<p>Add the following gems to your Gemfile</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'carrierwave'</span>
<span class="n">gem</span> <span class="s1">'carrierwave-mongoid'</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s2">"carrierwave/mongoid"</span></code></pre>

<p>Generate the uploader</p>

<pre class="terminal">
$ rails generate uploader Avatar
</pre>

<p>Edit the generated file, <code>app/uploaders/avadar_uploader.rb</code>, to use grid_fs</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">AvatarUploader</span> <span class="o">&lt;</span> <span class="no">CarrierWave</span><span class="o">::</span><span class="no">Uploader</span><span class="o">::</span><span class="no">Base</span>

    <span class="c1"># Choose what kind of storage to use for this uploader:</span>
    <span class="n">storage</span> <span class="ss">:grid_fs</span>

    <span class="c1"># Override the directory where uploaded files will be stored.</span>
    <span class="c1"># This is a sensible default for uploaders that are meant to be mounted:</span>
    <span class="k">def</span> <span class="nf">store_dir</span>
        <span class="s2">"</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>

    <span class="c1"># Provide a default URL as a default if there hasn't been a file uploaded:</span>
    <span class="k">def</span> <span class="nf">default_url</span>
        <span class="s2">"/images/fallback/"</span> <span class="o">+</span> <span class="o">[</span><span class="n">version_name</span><span class="p">,</span> <span class="s2">"default.png"</span><span class="o">].</span><span class="n">compact</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'_'</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Update your ActiveRecord model to store the avatar.</p>

<p>Make sure you are loading CarrierWave after loading the ORM, otherwise you need to require the relevant extension manually, for example:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'carrierwave/orm/activerecord'</span></code></pre>

<p>Add a string column to the model on which you want to mount the uploader.</p>

<pre class="terminal">
$ add_column :users, :avatar, :string
</pre>

<p>Open your model file and add code to mount the uploader:</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">User</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="n">mount_uploader</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="no">AvatarUploader</span>

    <span class="c1"># Make sure that the avatar is accessible</span>
    <span class="n">attr_accessible</span> <span class="ss">:emails</span><span class="p">,</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">:remote_avatar_url</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:last_name</span> <span class="c1">#....</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span></code></pre>

<p>Create an initializer for Mongoid to use your MongoDB instance on Cloud Foundry. Name it <code>01_mongoid.rb</code> so it runs before everything else.</p>

<pre><code class="language-ruby"><span class="no">Mongoid</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">conn_info</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="k">if</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">services</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">service_version</span><span class="p">,</span> <span class="n">bindings</span><span class="o">|</span>
      <span class="n">bindings</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">binding</span><span class="o">|</span>
        <span class="k">if</span> <span class="nb">binding</span><span class="o">[</span><span class="s1">'label'</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/mongo/i</span>
          <span class="n">conn_info</span> <span class="o">=</span> <span class="nb">binding</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
          <span class="k">break</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">raise</span> <span class="s2">"could not find connection info for mongo"</span> <span class="k">unless</span> <span class="n">conn_info</span>
  <span class="k">else</span>
    <span class="n">conn_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span> <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="mi">27017</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">cnx</span> <span class="o">=</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Connection</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">conn_info</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:pool_size</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="n">db</span> <span class="o">=</span> <span class="n">cnx</span><span class="o">[</span><span class="s1">'db'</span><span class="o">]</span>
  <span class="k">if</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]</span> <span class="ow">and</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span>
    <span class="n">db</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">conn_info</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]</span><span class="p">,</span> <span class="n">conn_info</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">db</span>
<span class="k">end</span></code></pre>

<p>Update your CarrierWave initializer to use the Cloud Foundry MongoDB service.</p>

<pre><code class="language-ruby"><span class="c1">#initializers/carrierwave.rb</span>
<span class="nb">require</span> <span class="s1">'serve_gridfs_image'</span>

<span class="no">CarrierWave</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="ss">:grid_fs</span>
  <span class="n">config</span><span class="o">.</span><span class="n">grid_fs_connection</span> <span class="o">=</span> <span class="no">Mongoid</span><span class="o">.</span><span class="n">database</span>

  <span class="c1"># Storage access url</span>
  <span class="n">config</span><span class="o">.</span><span class="n">grid_fs_access_url</span> <span class="o">=</span> <span class="s2">"/grid"</span>
<span class="k">end</span></code></pre>

<p>Handle requests for the images in <code>lib/serve_gridfs_image.rb</code>:</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="nc">ServeGridfsImage</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
      <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">[</span><span class="s2">"PATH_INFO"</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^\/grid\/(.+)$/</span>
      <span class="n">process_request</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="vg">$1</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="vi">@app</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">begin</span>
      <span class="no">Mongo</span><span class="o">::</span><span class="no">GridFileSystem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">Mongoid</span><span class="o">.</span><span class="n">database</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
        <span class="o">[</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="n">file</span><span class="o">.</span><span class="n">content_type</span> <span class="p">},</span> <span class="o">[</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="o">]]</span>
      <span class="k">end</span>
    <span class="k">rescue</span>
      <span class="o">[</span><span class="mi">404</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'text/plain'</span> <span class="p">},</span> <span class="o">[</span><span class="s1">'File not found.'</span><span class="o">]]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h2 id="deploy">Deploy</h2>

<pre class="terminal">
$ bundle install
    bundle package
    vmc update app_name
</pre>

<h2 id="conclusion">Conclusion</h2>

<p>This will give you the ability to upload and serve images. Do note that it does not provide image resizing. If you are using devise for example you can import the avatar(profile picture) of the user when they sign up.</p>

<pre><code class="language-ruby"><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">new_with_session</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
      <span class="k">super</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="s1">'devise.omniauth_info'</span><span class="o">]</span>
          <span class="k">if</span> <span class="n">data</span> <span class="o">=</span> <span class="n">session</span><span class="o">[</span><span class="s1">'devise.omniauth_info'</span><span class="o">][</span><span class="s1">'user_info'</span><span class="o">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'email'</span><span class="o">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'nickname'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'nickname'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'first_name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'first_name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'last_name'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'last_name'</span>
            <span class="n">user</span><span class="o">.</span><span class="n">remote_avatar_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">'image'</span><span class="o">]</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key?</span> <span class="s1">'image'</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre>

<h2 id="references">References</h2>

<ul>
<li><a href="http://support.cloudfoundry.com/entries/20016922-connecting-to-a-mongo-db">Connecting to a MongoDB Database</a></li>
  <li><a href="https://github.com/jnicklas/carrierwave">CarrierWave</a></li>
  <li><a href="https://github.com/jnicklas/carrierwave-mongoid">CarrierWave for Mongoid</a></li>
  <li><a href="http://antekpiechnik.com/posts/setting-up-carrierwave-file-uploads-using-gridfs-on-rails-3-and-mongoid">Setting up CarrierWave file uploads using GridFS on Rails 3 and mongoid</a></li>
  <li><a href="https://github.com/plataformatec/devise">Devise</a></li>
</ul>;T;@³I"/services/mongodb/mongodb/;T{;{	;I"Á5<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mongodb/mongodb.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | MongoDB' property='og:title'>
<meta content='Using the MongoDB Service on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | MongoDB</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>MongoDB</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using the MongoDB Service on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mongodb" rel="tag">mongodb</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resources will help you get started using the MongoDB service on Cloud Foundry:</p>

<h2 id="grails">Grails</h2>

<ul>
<li><a href="/services/mongodb/grails-mongodb.html">Grails Development with the MongoDB Service</a></li>
</ul><h2 id="nodejs">Node.js</h2>

<ul>
<li><a href="/services/mongodb/nodejs-mongodb.html">Using MongoDB with Node.js</a></li>
</ul><h2 id="ruby">Ruby</h2>

<ul>
<li><a href="/services/mongodb/ruby-mongodb.html">Working with Ruby and MongoDB</a></li>
  <li><a href="/services/mongodb/ruby-mongodb-gridfs.html">Working with Ruby, MongoDB and GridFS</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ºThe following resources will help you get started using the MongoDB service on Cloud Foundry:

## Grails

+ [Grails Development with the MongoDB Service](/services/mongodb/grails-mongodb.html)

## Node.js

+ [Using MongoDB with Node.js](/services/mongodb/nodejs-mongodb.html)

## Ruby

+ [Working with Ruby and MongoDB](/services/mongodb/ruby-mongodb.html)
+ [Working with Ruby, MongoDB and GridFS](/services/mongodb/ruby-mongodb-gridfs.html);T;
I"\<p>The following resources will help you get started using the MongoDB service on Cloud Foundry:</p>

<h2 id="grails">Grails</h2>

<ul>
<li><a href="/services/mongodb/grails-mongodb.html">Grails Development with the MongoDB Service</a></li>
</ul><h2 id="nodejs">Node.js</h2>

<ul>
<li><a href="/services/mongodb/nodejs-mongodb.html">Using MongoDB with Node.js</a></li>
</ul><h2 id="ruby">Ruby</h2>

<ul>
<li><a href="/services/mongodb/ruby-mongodb.html">Working with Ruby and MongoDB</a></li>
  <li><a href="/services/mongodb/ruby-mongodb-gridfs.html">Working with Ruby, MongoDB and GridFS</a></li>
</ul>;T;@¹I"(/services/rabbitmq/spring-rabbitmq/;T{;{	;I"šÉ<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/rabbitmq/spring-rabbitmq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using RabbitMQ with Spring' property='og:title'>
<meta content='Getting Started with the RabbitMQ Service from a Spring Application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using RabbitMQ with Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using RabbitMQ with Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Getting Started with the RabbitMQ Service from a Spring Application</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/rabbitmq" rel="tag">rabbitmq</a><a href="/tags/tutorial" rel="tag">tutorial</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This tutorial explains how to use the RabbitMQ service for Cloud Foundry from a Java and Spring application.</p>

<p>There are a number of ways that messaging can be useful in the context of a Spring web application. See the <a href="http://www.rabbitmq.com/getstarted.html">Getting Started</a> area on the main RabbitMQ web site for some ideas. But in this tutorial, weâ€™ll build a very simple application that uses RabbitMQ, focusing on the basics of connecting to the RabbitMQ service. Once you understand that, you will be able to integrate more realistic uses of the service into your Spring applications on Cloud Foundry.</p>

<p>This tutorial goes through the complete process of creating a very simple Spring application on Cloud Foundry, and hooking it up to the RabbitMQ service. If you already have your own applications on Cloud Foundry, much of this material may already be familiar. If so, you can skip straight to the last section, where we discuss how to access the RabbitMQ service from your application. You can also find the complete code for the finished application <a href="https://github.com/rabbitmq/rabbitmq-coudfoundry-samples/tree/master/spring">on GitHub</a>.</p>

<p>The application we are going to build will consist of a single page, looking like this:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/kx0fcgzrgasd4eq/?name=page.png" alt="page.png"></p>

<p>This application can publish messages to and get messages from a single RabbitMQ queue. We can type a message into the input box and click the Publish button to publish it to the queue. Alternatively, we can click the Get button to take a message from the queue; the next message will be displayed, or it will say that the queue was empty.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To start off, there are a few things that need to be installed on your development machine. This guide will assume that you already have the <a href="http://www.oracle.com/technetwork/java/javase/downloads/">JDK 6</a> and <a href="http://maven.apache.org/">Maven</a> installed.</p>

<p>This tutorial will use the vmc command line tool used to interact with Cloud Foundry. If you donâ€™t already have vmc installed, please follow the instructions <a href="/tools/vmc/vmc.html">here</a>. Note that vmc continues to be enhanced, so even if you already have it installed, you should update it regularly by doing:</p>

<pre class="terminal">
$ gem update vmc
</pre>

<p>vmc is not the only way to develop with Cloud Foundry: <a href="http://www.springsource.org/sts">Spring Tool Suite</a> supports Clound Foundry in an Eclipse-powered development environment. See <a href="http://www.springsource.org/sts">this section</a> for how to use Cloud Foundry within STS.</p>

<p>Creating an Initial Spring MVC App
Now we will create a minimal Spring VMC app and push it to Cloud Foundry, following the article <a href="http://blog.springsource.org/2011/01/04/green-beans-getting-started-with-spring-mvc/">Green Beans: Getting Started with Spring MVC</a>. The application source comprises just five files. The file locations will obey the normal Maven project layout.</p>

<p>src/main/webapp/WEB-INF/web.xml simply hands off to the Spring framework:</p>

<pre><code class="language-xml"><span class="cp">&lt;!DOCTYPE web-app PUBLIC</span>
<span class="cp"> "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span>
<span class="cp"> "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;</span>

<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">"2.5"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/servlet-context.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span></code></pre>

<p>The Spring Application Context XML file, src/main/webapp/WEB-INF/spring/servlet-context.xml, is minimal, simply declaring that we will use annotation-based configuration for MVC, and which package to scan:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.rabbitmq.cftutorial.simple"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The controller class, src/main/java/com/rabbitmq/cftutorial/simple/HomeController.java, simply hands off to the JSP template:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>And the JSP template, src/main/webapp/WEB-INF/views/home.jsp, displays a simple static page.</p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">"false"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>Finally, the pom.xml file to describe the project to Maven:</p>

<pre><code class="language-xml"> <span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.rabbitmq.cftutorial<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>simple<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;name&gt;</span>cftutorial-simple<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;description&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/description&gt;</span>

  <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;java-version&gt;</span>1.6<span class="nt">&lt;/java-version&gt;</span>
      <span class="nt">&lt;org.springframework-version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>

  <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>

      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>

  <span class="nt">&lt;build&gt;</span>
      <span class="nt">&lt;plugins&gt;</span>
          <span class="nt">&lt;plugin&gt;</span>
              <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;configuration&gt;</span>
                  <span class="nt">&lt;source&gt;</span>${java-version}<span class="nt">&lt;/source&gt;</span>
                  <span class="nt">&lt;target&gt;</span>${java-version}<span class="nt">&lt;/target&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>

<p>Next we build the project:</p>

<pre class="terminal">
$ mvn package
[...]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Tue Aug 02 14:04:59 BST 2011
[INFO] Final Memory: 17M/321M
[INFO] ------------------------------------------------------------------------
</pre>

<p>And we are ready to push the application to Cloud Foundry. Change to the target directory before doing vmc push. Here, I will call my application â€œrabbit-simpleâ€, but you should choose your own name.</p>

<p>We also get the opportunity to bind services to our application at this point. But we wonâ€™t add the rabbitmq service at this point â€” we will do that later, after we have the initial app running.</p>

<pre class="terminal">
$ cd target
$ vmc push
Would you like to deploy from the current directory? [Yn]: y
Application Name: rabbit-simple
Application Deployed URL: 'rabbit-simple.cloudfoundry.com'?
Detected a Java SpringSource Spring Application, is this correct? [Yn]: y
Memory Reservation [Default:512M] (64M, 128M, 256M or 512M)
Creating Application: OK
Would you like to bind any services to 'rabbit-simple'? [yN]: n
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>If this succeeds, you should be able to go to the URL for the application and see the home page:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/119cuj9gvkhnzs4/?name=home.png" alt="home.png"></p>

<h2 id="extending-the-application">Extending the application</h2>

<p>Now that we have a minimal Spring MVC application running on Cloud Foundry, we will add the pieces we need to demonstrate the use of the RabbitMQ service.</p>

<p>We extend the JSP template at src/main/webapp/WEB-INF/views/home.jsp with the page elements to construct the page shown in the introduction:</p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"form"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://www.springframework.org/tags/form"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">"false"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Publish a message<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">"message"</span> <span class="na">action=</span><span class="s">"/publish"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form:label</span> <span class="na">for=</span><span class="s">"value"</span> <span class="na">path=</span><span class="s">"value"</span><span class="nt">&gt;</span>Message to publish:<span class="nt">&lt;/form:label&gt;</span>
      <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">"value"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>

      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Publish"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>

    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${published}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>Published a message!<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Get a message<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">"/get"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Get one"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>

    <span class="nt">&lt;c:choose&gt;</span>
      <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${got_queue_empty}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Queue empty<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/c:when&gt;</span>
      <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${got != null}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Got message: <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">"${got}"</span><span class="nt">/&gt;&lt;/p&gt;</span>
      <span class="nt">&lt;/c:when&gt;</span>
    <span class="nt">&lt;/c:choose&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>And we need to add actions to the controller class to support the Publish and Get one forms:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>We also need to add a Message class, to back the Publish form. This simply holds the String value for the message.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>With these additions, we can update the application on Cloud Foundry and take a look:</p>

<pre class="terminal">
$ mvn package
[...]
$ cd target
$ vmc update rabbit-simple
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>You should now be able to see the page shown in the introduction above. In the next section we will fill out the code for the actions in the controller in order to make the application fully functional.</p>

<h2 id="using-the-rabbitmq-service">Using the RabbitMQ Service</h2>

<p>In this section, we will take the simple application created in the previous section and make it use the RabbitMQ service.</p>

<p>First, we will create an instance of the RabbitMQ service on Cloud Foundry:</p>

<pre class="terminal">
$ vmc create-service
1. rabbitmq
2. mysql
3. mongodb
4. redis
Please select one you wish to provision: 1
Creating Service [rabbitmq-aaaad]: OK
</pre>

<p>At this point, the service instance has been successfully created. But in order for it to be accessible to our application, we also need to bind it:</p>

<pre class="terminal">
$ vmc bind-service rabbitmq-aaaad rabbit-simple
Binding Service: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>The vmc apps command confirms that the service has been bound to our application:</p>

<pre class="terminal">
$ vmc apps

+-----------------+----+---------+----------------------------------+-----------------------------+
| Application     | #  | Health  | URLS                             | Services                    |
+-----------------+----+---------+----------------------------------+-----------------------------+
| rabbit-simple   | 1  | RUNNING | rabbit-simple.cloudfoundry.com   | rabbitmq-aaaad              |
+-----------------+----+---------+----------------------------------+-----------------------------+
</pre>

<p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP</a> protocol (RabbitMQ supports versions 0.8 and 0.9.1 of AMQP). So we need to use an AMQP client library. Fortunately, there is a Spring AMQP project which allows AMQP applications to take advantage of Spring concepts. We will also use the cloudfoundry-runtime jar, which facilitates access to Cloud Foundry services, including RabbitMQ, from Spring applications. So we will add the corresponding dependencies to the pom.xml file:</p>

<pre><code class="language-xml">[...]
   <span class="nt">&lt;properties&gt;</span>
       [...]
   <span class="nt">&lt;/properties&gt;</span>

  <span class="nt">&lt;repositories&gt;</span>
      <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>spring-milestone<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;name&gt;</span>Spring Maven MILESTONE Repository<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>

  <span class="nt">&lt;dependencies&gt;</span>
      [...]
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      [...]
  <span class="nt">&lt;/dependencies&gt;</span>
[...]</code></pre>

<p>Next we extend the Spring Application Context XML. The additions:</p>

<ul>
<li>Use cloudfoundry-runtimeto obtain a connection to the RabbitMQ service.</li>
  <li>Configure the RabbitTemplate and RabbitAdmin that are the main entry points to Spring AMQP.</li>
  <li>Declare a queue called messages within the RabbitMQ broker.</li>
  <li>See the <a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMQP documentation</a> for more details.</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">                           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring-0.7.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.rabbitmq.cftutorial.simple"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">connection-factory=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically</span>
<span class="c">         declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Finally, the changes to HomeController to actually publish and get messages are very simple:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Send a message to the "messages" queue</span>
        <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Receive a message from the "messages" queue</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>Everything is now in place, so a final vmc update gives us the fully functional application. We can publish a message:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/6btegldivmhssve/?name=publish1.png" alt="publish1.png"><img src="http://support.cloudfoundry.com/attachments/token/y4ls3aqh00thzen/?name=publish2.png" alt="publish2.png"></p>

<p>And get it back:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/e5ojjwwhs6ljjwd/?name=get1.png" alt="get1.png"><img src="http://support.cloudfoundry.com/attachments/token/lejqlsjmiu75lc7/?name=get2.png" alt="get2.png"></p>

<p>That concludes this tutorial. You can find more resources about RabbitMQ and AMQP on the <a href="http://www.rabbitmq.com/">RabbitMQ web site</a>. And you can find more information about using RabbitMQ within a Spring application on the <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> website. And if you have questions or feedback on this tutorial or the RabbitMQ service, please contact us using the forums on <a href="http://support.cloudfoundry.com/">support.cloudfoundry.com</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"&LThis tutorial explains how to use the RabbitMQ service for Cloud Foundry from a Java and Spring application.

There are a number of ways that messaging can be useful in the context of a Spring web application. See the [Getting Started](http://www.rabbitmq.com/getstarted.html) area on the main RabbitMQ web site for some ideas. But in this tutorial, we'll build a very simple application that uses RabbitMQ, focusing on the basics of connecting to the RabbitMQ service. Once you understand that, you will be able to integrate more realistic uses of the service into your Spring applications on Cloud Foundry.

This tutorial goes through the complete process of creating a very simple Spring application on Cloud Foundry, and hooking it up to the RabbitMQ service. If you already have your own applications on Cloud Foundry, much of this material may already be familiar. If so, you can skip straight to the last section, where we discuss how to access the RabbitMQ service from your application. You can also find the complete code for the finished application [on GitHub](https://github.com/rabbitmq/rabbitmq-coudfoundry-samples/tree/master/spring).

The application we are going to build will consist of a single page, looking like this:

![page.png](http://support.cloudfoundry.com/attachments/token/kx0fcgzrgasd4eq/?name=page.png)

This application can publish messages to and get messages from a single RabbitMQ queue. We can type a message into the input box and click the Publish button to publish it to the queue. Alternatively, we can click the Get button to take a message from the queue; the next message will be displayed, or it will say that the queue was empty.


## Prerequisites

To start off, there are a few things that need to be installed on your development machine. This guide will assume that you already have the [JDK 6](http://www.oracle.com/technetwork/java/javase/downloads/) and [Maven](http://maven.apache.org/) installed.

This tutorial will use the vmc command line tool used to interact with Cloud Foundry. If you don't already have vmc installed, please follow the instructions [here](/tools/vmc/vmc.html). Note that vmc continues to be enhanced, so even if you already have it installed, you should update it regularly by doing:

```bash
$ gem update vmc
```

vmc is not the only way to develop with Cloud Foundry: [Spring Tool Suite](http://www.springsource.org/sts) supports Clound Foundry in an Eclipse-powered development environment. See [this section](http://www.springsource.org/sts) for how to use Cloud Foundry within STS.

Creating an Initial Spring MVC App
Now we will create a minimal Spring VMC app and push it to Cloud Foundry, following the article [Green Beans: Getting Started with Spring MVC](http://blog.springsource.org/2011/01/04/green-beans-getting-started-with-spring-mvc/). The application source comprises just five files. The file locations will obey the normal Maven project layout.

src/main/webapp/WEB-INF/web.xml simply hands off to the Spring framework:

```xml
<!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" >

<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">
    <servlet>
        <servlet-name>appServlet</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/spring/servlet-context.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>appServlet</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
</web-app>
```

The Spring Application Context XML file, src/main/webapp/WEB-INF/spring/servlet-context.xml, is minimal, simply declaring that we will use annotation-based configuration for MVC, and which package to scan:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">
    <context:component-scan base-package="com.rabbitmq.cftutorial.simple"/>
    <mvc:annotation-driven/>
</beans>
```


The controller class, src/main/java/com/rabbitmq/cftutorial/simple/HomeController.java, simply hands off to the JSP template:

```java
package com.rabbitmq.cftutorial.simple;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class HomeController {
    @RequestMapping(value = "/")
    public String home() {
        return "WEB-INF/views/home.jsp";
    }
}
```

And the JSP template, src/main/webapp/WEB-INF/views/home.jsp, displays a simple static page.

```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="false" %>
<html>
  <head>
    <title>Simple RabbitMQ Application</title>
  </head>
  <body>
    <h1>Simple RabbitMQ Application</h1>
  </body>
</html>
```

Finally, the pom.xml file to describe the project to Maven:

```xml
 <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.rabbitmq.cftutorial</groupId>
  <artifactId>simple</artifactId>
  <packaging>war</packaging>
  <version>1.0-SNAPSHOT</version>
  <name>cftutorial-simple</name>
  <description>Simple RabbitMQ Application</description>

  <properties>
      <java-version>1.6</java-version>
      <org.springframework-version>3.0.5.RELEASE</org.springframework-version>
  </properties>

  <dependencies>
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-context</artifactId>
          <version>${org.springframework-version}</version>
      </dependency>
      <dependency>
          <groupId>org.springframework</groupId>
          <artifactId>spring-webmvc</artifactId>
          <version>${org.springframework-version}</version>
      </dependency>

      <dependency>
          <groupId>javax.servlet</groupId>
          <artifactId>jstl</artifactId>
          <version>1.2</version>
      </dependency>
  </dependencies>

  <build>
      <plugins>
          <plugin>
              <groupId>org.apache.maven.plugins</groupId>
              <artifactId>maven-compiler-plugin</artifactId>
              <configuration>
                  <source>${java-version}</source>
                  <target>${java-version}</target>
              </configuration>
          </plugin>
      </plugins>
  </build>
</project>
```

Next we build the project:

```bash
$ mvn package
[...]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Tue Aug 02 14:04:59 BST 2011
[INFO] Final Memory: 17M/321M
[INFO] ------------------------------------------------------------------------
```

And we are ready to push the application to Cloud Foundry. Change to the target directory before doing vmc push. Here, I will call my application â€œrabbit-simpleâ€, but you should choose your own name.

We also get the opportunity to bind services to our application at this point. But we won't add the rabbitmq service at this point â€” we will do that later, after we have the initial app running.

```bash
$ cd target
$ vmc push
Would you like to deploy from the current directory? [Yn]: y
Application Name: rabbit-simple
Application Deployed URL: 'rabbit-simple.cloudfoundry.com'?
Detected a Java SpringSource Spring Application, is this correct? [Yn]: y
Memory Reservation [Default:512M] (64M, 128M, 256M or 512M)
Creating Application: OK
Would you like to bind any services to 'rabbit-simple'? [yN]: n
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
```

If this succeeds, you should be able to go to the URL for the application and see the home page:

![home.png](http://support.cloudfoundry.com/attachments/token/119cuj9gvkhnzs4/?name=home.png)

## Extending the application

Now that we have a minimal Spring MVC application running on Cloud Foundry, we will add the pieces we need to demonstrate the use of the RabbitMQ service.

We extend the JSP template at src/main/webapp/WEB-INF/views/home.jsp with the page elements to construct the page shown in the introduction:

```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ page session="false" %>
<html>
  <head>
    <title>Simple RabbitMQ Application</title>
  </head>
  <body>
    <h1>Simple RabbitMQ Application</h1>

    <h2>Publish a message</h2>

    <form:form modelAttribute="message" action="/publish" method="post">
      <form:label for="value" path="value">Message to publish:</form:label>
      <form:input path="value" type="text"/>

      <input type="submit" value="Publish"/>
    </form:form>

    <c:if test="${published}">
      <p>Published a message!</p>
    </c:if>

    <h2>Get a message</h2>

    <form:form action="/get" method="post">
      <input type="submit" value="Get one"/>
    </form:form>

    <c:choose>
      <c:when test="${got_queue_empty}">
        <p>Queue empty</p>
      </c:when>
      <c:when test="${got != null}">
        <p>Got message: <c:out value="${got}"/></p>
      </c:when>
    </c:choose>
  </body>
</html>
```

And we need to add actions to the controller class to support the Publish and Get one forms:

```java
package com.rabbitmq.cftutorial.simple;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.ui.Model;

@Controller
public class HomeController {
    @RequestMapping(value = "/")
    public String home(Model model) {
        model.addAttribute(new Message());
        return "WEB-INF/views/home.jsp";
    }

    @RequestMapping(value = "/publish", method=RequestMethod.POST)
    public String publish(Model model) {
        return home(model);
    }

    @RequestMapping(value = "/get", method=RequestMethod.POST)
    public String get(Model model) {
        return home(model);
    }
}
```

We also need to add a Message class, to back the Publish form. This simply holds the String value for the message.

```java
package com.rabbitmq.cftutorial.simple;

public class Message {
    private String value;

    public String getValue() {
        return value;
    }

    public void setValue(String value) {
        this.value = value;
    }
}
```

With these additions, we can update the application on Cloud Foundry and take a look:

```bash
$ mvn package
[...]
$ cd target
$ vmc update rabbit-simple
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
```

You should now be able to see the page shown in the introduction above. In the next section we will fill out the code for the actions in the controller in order to make the application fully functional.

## Using the RabbitMQ Service

In this section, we will take the simple application created in the previous section and make it use the RabbitMQ service.

First, we will create an instance of the RabbitMQ service on Cloud Foundry:

```bash
$ vmc create-service
1. rabbitmq
2. mysql
3. mongodb
4. redis
Please select one you wish to provision: 1
Creating Service [rabbitmq-aaaad]: OK
```

At this point, the service instance has been successfully created. But in order for it to be accessible to our application, we also need to bind it:

```bash
$ vmc bind-service rabbitmq-aaaad rabbit-simple
Binding Service: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
```

The vmc apps command confirms that the service has been bound to our application:

```bash
$ vmc apps

+-----------------+----+---------+----------------------------------+-----------------------------+
| Application     | #  | Health  | URLS                             | Services                    |
+-----------------+----+---------+----------------------------------+-----------------------------+
| rabbit-simple   | 1  | RUNNING | rabbit-simple.cloudfoundry.com   | rabbitmq-aaaad              |
+-----------------+----+---------+----------------------------------+-----------------------------+
```

The RabbitMQ service is accessed through the [AMQP](http://www.amqp.org/) protocol (RabbitMQ supports versions 0.8 and 0.9.1 of AMQP). So we need to use an AMQP client library. Fortunately, there is a Spring AMQP project which allows AMQP applications to take advantage of Spring concepts. We will also use the cloudfoundry-runtime jar, which facilitates access to Cloud Foundry services, including RabbitMQ, from Spring applications. So we will add the corresponding dependencies to the pom.xml file:

```xml
[...]
   <properties>
       [...]
   </properties>

  <repositories>
      <repository>
          <id>spring-milestone</id>
          <name>Spring Maven MILESTONE Repository</name>
          <url>http://maven.springframework.org/milestone</url>
      </repository>
  </repositories>

  <dependencies>
      [...]
      <dependency>
          <groupId>cglib</groupId>
          <artifactId>cglib-nodep</artifactId>
          <version>2.2</version>
      </dependency>
      <dependency>
          <groupId>org.springframework.amqp</groupId>
          <artifactId>spring-rabbit</artifactId>
          <version>1.0.0.RC2</version>
      </dependency>
      <dependency>
          <groupId>org.cloudfoundry</groupId>
          <artifactId>cloudfoundry-runtime</artifactId>
          <version>0.7.1</version>
      </dependency>
      [...]
  </dependencies>
[...]
```

Next we extend the Spring Application Context XML. The additions:

+ Use cloudfoundry-runtimeto obtain a connection to the RabbitMQ service.
+ Configure the RabbitTemplate and RabbitAdmin that are the main entry points to Spring AMQP.
+ Declare a queue called messages within the RabbitMQ broker.
+ See the [Spring AMQP documentation](http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/) for more details.

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:cloud="http://schema.cloudfoundry.org/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
                           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd
                           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring-0.7.xsd">
    <context:component-scan base-package="com.rabbitmq.cftutorial.simple"/>
    <mvc:annotation-driven/>

    <!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: -->
    <cloud:rabbit-connection-factory id="connectionFactory"/>

    <!-- Set up the AmqpTemplate/RabbitTemplate: -->
    <rabbit:template connection-factory="connectionFactory"/>

    <!-- Request that queues, exchanges and bindings be automatically
         declared on the broker: -->
    <rabbit:admin connection-factory="connectionFactory"/>

    <!-- Declare the "messages" queue: -->
    <rabbit:queue name="messages" durable="true"/>
</beans>
```

Finally, the changes to HomeController to actually publish and get messages are very simple:

```java
package com.rabbitmq.cftutorial.simple;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.ui.Model;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.amqp.core.AmqpTemplate;

@Controller
public class HomeController {
    @Autowired AmqpTemplate amqpTemplate;

    @RequestMapping(value = "/")
    public String home(Model model) {
        model.addAttribute(new Message());
        return "WEB-INF/views/home.jsp";
    }

    @RequestMapping(value = "/publish", method=RequestMethod.POST)
    public String publish(Model model, Message message) {
        // Send a message to the "messages" queue
        amqpTemplate.convertAndSend("messages", message.getValue());
        model.addAttribute("published", true);
        return home(model);
    }

    @RequestMapping(value = "/get", method=RequestMethod.POST)
    public String get(Model model) {
        // Receive a message from the "messages" queue
        String message = (String)amqpTemplate.receiveAndConvert("messages");
        if (message != null)
            model.addAttribute("got", message);
        else
            model.addAttribute("got_queue_empty", true);

        return home(model);
    }
}
```

Everything is now in place, so a final vmc update gives us the fully functional application. We can publish a message:

![publish1.png](http://support.cloudfoundry.com/attachments/token/6btegldivmhssve/?name=publish1.png)
![publish2.png](http://support.cloudfoundry.com/attachments/token/y4ls3aqh00thzen/?name=publish2.png)

And get it back:

![get1.png](http://support.cloudfoundry.com/attachments/token/e5ojjwwhs6ljjwd/?name=get1.png)
![get2.png](http://support.cloudfoundry.com/attachments/token/lejqlsjmiu75lc7/?name=get2.png)

That concludes this tutorial. You can find more resources about RabbitMQ and AMQP on the [RabbitMQ web site](http://www.rabbitmq.com/). And you can find more information about using RabbitMQ within a Spring application on the [Spring AMQP](http://www.springsource.org/spring-amqp) website. And if you have questions or feedback on this tutorial or the RabbitMQ service, please contact us using the forums on [support.cloudfoundry.com](http://support.cloudfoundry.com/).;T;
I",•<p>This tutorial explains how to use the RabbitMQ service for Cloud Foundry from a Java and Spring application.</p>

<p>There are a number of ways that messaging can be useful in the context of a Spring web application. See the <a href="http://www.rabbitmq.com/getstarted.html">Getting Started</a> area on the main RabbitMQ web site for some ideas. But in this tutorial, weâ€™ll build a very simple application that uses RabbitMQ, focusing on the basics of connecting to the RabbitMQ service. Once you understand that, you will be able to integrate more realistic uses of the service into your Spring applications on Cloud Foundry.</p>

<p>This tutorial goes through the complete process of creating a very simple Spring application on Cloud Foundry, and hooking it up to the RabbitMQ service. If you already have your own applications on Cloud Foundry, much of this material may already be familiar. If so, you can skip straight to the last section, where we discuss how to access the RabbitMQ service from your application. You can also find the complete code for the finished application <a href="https://github.com/rabbitmq/rabbitmq-coudfoundry-samples/tree/master/spring">on GitHub</a>.</p>

<p>The application we are going to build will consist of a single page, looking like this:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/kx0fcgzrgasd4eq/?name=page.png" alt="page.png"></p>

<p>This application can publish messages to and get messages from a single RabbitMQ queue. We can type a message into the input box and click the Publish button to publish it to the queue. Alternatively, we can click the Get button to take a message from the queue; the next message will be displayed, or it will say that the queue was empty.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To start off, there are a few things that need to be installed on your development machine. This guide will assume that you already have the <a href="http://www.oracle.com/technetwork/java/javase/downloads/">JDK 6</a> and <a href="http://maven.apache.org/">Maven</a> installed.</p>

<p>This tutorial will use the vmc command line tool used to interact with Cloud Foundry. If you donâ€™t already have vmc installed, please follow the instructions <a href="/tools/vmc/vmc.html">here</a>. Note that vmc continues to be enhanced, so even if you already have it installed, you should update it regularly by doing:</p>

<pre class="terminal">
$ gem update vmc
</pre>

<p>vmc is not the only way to develop with Cloud Foundry: <a href="http://www.springsource.org/sts">Spring Tool Suite</a> supports Clound Foundry in an Eclipse-powered development environment. See <a href="http://www.springsource.org/sts">this section</a> for how to use Cloud Foundry within STS.</p>

<p>Creating an Initial Spring MVC App
Now we will create a minimal Spring VMC app and push it to Cloud Foundry, following the article <a href="http://blog.springsource.org/2011/01/04/green-beans-getting-started-with-spring-mvc/">Green Beans: Getting Started with Spring MVC</a>. The application source comprises just five files. The file locations will obey the normal Maven project layout.</p>

<p>src/main/webapp/WEB-INF/web.xml simply hands off to the Spring framework:</p>

<pre><code class="language-xml"><span class="cp">&lt;!DOCTYPE web-app PUBLIC</span>
<span class="cp"> "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span>
<span class="cp"> "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;</span>

<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">"2.5"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/servlet-context.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span></code></pre>

<p>The Spring Application Context XML file, src/main/webapp/WEB-INF/spring/servlet-context.xml, is minimal, simply declaring that we will use annotation-based configuration for MVC, and which package to scan:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.rabbitmq.cftutorial.simple"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The controller class, src/main/java/com/rabbitmq/cftutorial/simple/HomeController.java, simply hands off to the JSP template:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>And the JSP template, src/main/webapp/WEB-INF/views/home.jsp, displays a simple static page.</p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">"false"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>Finally, the pom.xml file to describe the project to Maven:</p>

<pre><code class="language-xml"> <span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.rabbitmq.cftutorial<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>simple<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;name&gt;</span>cftutorial-simple<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;description&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/description&gt;</span>

  <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;java-version&gt;</span>1.6<span class="nt">&lt;/java-version&gt;</span>
      <span class="nt">&lt;org.springframework-version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>

  <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>

      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>

  <span class="nt">&lt;build&gt;</span>
      <span class="nt">&lt;plugins&gt;</span>
          <span class="nt">&lt;plugin&gt;</span>
              <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
              <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
              <span class="nt">&lt;configuration&gt;</span>
                  <span class="nt">&lt;source&gt;</span>${java-version}<span class="nt">&lt;/source&gt;</span>
                  <span class="nt">&lt;target&gt;</span>${java-version}<span class="nt">&lt;/target&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>

<p>Next we build the project:</p>

<pre class="terminal">
$ mvn package
[...]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Tue Aug 02 14:04:59 BST 2011
[INFO] Final Memory: 17M/321M
[INFO] ------------------------------------------------------------------------
</pre>

<p>And we are ready to push the application to Cloud Foundry. Change to the target directory before doing vmc push. Here, I will call my application â€œrabbit-simpleâ€, but you should choose your own name.</p>

<p>We also get the opportunity to bind services to our application at this point. But we wonâ€™t add the rabbitmq service at this point â€” we will do that later, after we have the initial app running.</p>

<pre class="terminal">
$ cd target
$ vmc push
Would you like to deploy from the current directory? [Yn]: y
Application Name: rabbit-simple
Application Deployed URL: 'rabbit-simple.cloudfoundry.com'?
Detected a Java SpringSource Spring Application, is this correct? [Yn]: y
Memory Reservation [Default:512M] (64M, 128M, 256M or 512M)
Creating Application: OK
Would you like to bind any services to 'rabbit-simple'? [yN]: n
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>If this succeeds, you should be able to go to the URL for the application and see the home page:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/119cuj9gvkhnzs4/?name=home.png" alt="home.png"></p>

<h2 id="extending-the-application">Extending the application</h2>

<p>Now that we have a minimal Spring MVC application running on Cloud Foundry, we will add the pieces we need to demonstrate the use of the RabbitMQ service.</p>

<p>We extend the JSP template at src/main/webapp/WEB-INF/views/home.jsp with the page elements to construct the page shown in the introduction:</p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"form"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://www.springframework.org/tags/form"</span> <span class="k">%&gt;</span>
<span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">session</span><span class="o">=</span><span class="s">"false"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Simple RabbitMQ Application<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Publish a message<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;form:form</span> <span class="na">modelAttribute=</span><span class="s">"message"</span> <span class="na">action=</span><span class="s">"/publish"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form:label</span> <span class="na">for=</span><span class="s">"value"</span> <span class="na">path=</span><span class="s">"value"</span><span class="nt">&gt;</span>Message to publish:<span class="nt">&lt;/form:label&gt;</span>
      <span class="nt">&lt;form:input</span> <span class="na">path=</span><span class="s">"value"</span> <span class="na">type=</span><span class="s">"text"</span><span class="nt">/&gt;</span>

      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Publish"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>

    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${published}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>Published a message!<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/c:if&gt;</span>

    <span class="nt">&lt;h2&gt;</span>Get a message<span class="nt">&lt;/h2&gt;</span>

    <span class="nt">&lt;form:form</span> <span class="na">action=</span><span class="s">"/get"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Get one"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form:form&gt;</span>

    <span class="nt">&lt;c:choose&gt;</span>
      <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${got_queue_empty}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Queue empty<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/c:when&gt;</span>
      <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${got != null}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Got message: <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">"${got}"</span><span class="nt">/&gt;&lt;/p&gt;</span>
      <span class="nt">&lt;/c:when&gt;</span>
    <span class="nt">&lt;/c:choose&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>And we need to add actions to the controller class to support the Publish and Get one forms:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>We also need to add a Message class, to back the Publish form. This simply holds the String value for the message.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>With these additions, we can update the application on Cloud Foundry and take a look:</p>

<pre class="terminal">
$ mvn package
[...]
$ cd target
$ vmc update rabbit-simple
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (3K): OK
Push Status: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>You should now be able to see the page shown in the introduction above. In the next section we will fill out the code for the actions in the controller in order to make the application fully functional.</p>

<h2 id="using-the-rabbitmq-service">Using the RabbitMQ Service</h2>

<p>In this section, we will take the simple application created in the previous section and make it use the RabbitMQ service.</p>

<p>First, we will create an instance of the RabbitMQ service on Cloud Foundry:</p>

<pre class="terminal">
$ vmc create-service
1. rabbitmq
2. mysql
3. mongodb
4. redis
Please select one you wish to provision: 1
Creating Service [rabbitmq-aaaad]: OK
</pre>

<p>At this point, the service instance has been successfully created. But in order for it to be accessible to our application, we also need to bind it:</p>

<pre class="terminal">
$ vmc bind-service rabbitmq-aaaad rabbit-simple
Binding Service: OK
Stopping Application: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>The vmc apps command confirms that the service has been bound to our application:</p>

<pre class="terminal">
$ vmc apps

+-----------------+----+---------+----------------------------------+-----------------------------+
| Application     | #  | Health  | URLS                             | Services                    |
+-----------------+----+---------+----------------------------------+-----------------------------+
| rabbit-simple   | 1  | RUNNING | rabbit-simple.cloudfoundry.com   | rabbitmq-aaaad              |
+-----------------+----+---------+----------------------------------+-----------------------------+
</pre>

<p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP</a> protocol (RabbitMQ supports versions 0.8 and 0.9.1 of AMQP). So we need to use an AMQP client library. Fortunately, there is a Spring AMQP project which allows AMQP applications to take advantage of Spring concepts. We will also use the cloudfoundry-runtime jar, which facilitates access to Cloud Foundry services, including RabbitMQ, from Spring applications. So we will add the corresponding dependencies to the pom.xml file:</p>

<pre><code class="language-xml">[...]
   <span class="nt">&lt;properties&gt;</span>
       [...]
   <span class="nt">&lt;/properties&gt;</span>

  <span class="nt">&lt;repositories&gt;</span>
      <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>spring-milestone<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;name&gt;</span>Spring Maven MILESTONE Repository<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;/repository&gt;</span>
  <span class="nt">&lt;/repositories&gt;</span>

  <span class="nt">&lt;dependencies&gt;</span>
      [...]
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      [...]
  <span class="nt">&lt;/dependencies&gt;</span>
[...]</code></pre>

<p>Next we extend the Spring Application Context XML. The additions:</p>

<ul>
<li>Use cloudfoundry-runtimeto obtain a connection to the RabbitMQ service.</li>
  <li>Configure the RabbitTemplate and RabbitAdmin that are the main entry points to Spring AMQP.</li>
  <li>Declare a queue called messages within the RabbitMQ broker.</li>
  <li>See the <a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMQP documentation</a> for more details.</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">                           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">                           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring-0.7.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.rabbitmq.cftutorial.simple"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:annotation-driven/&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">connection-factory=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically</span>
<span class="c">         declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"connectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Finally, the changes to HomeController to actually publish and get messages are very simple:</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">cftutorial</span><span class="o">.</span><span class="na">simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Send a message to the "messages" queue</span>
        <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Receive a message from the "messages" queue</span>
        <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>Everything is now in place, so a final vmc update gives us the fully functional application. We can publish a message:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/6btegldivmhssve/?name=publish1.png" alt="publish1.png"><img src="http://support.cloudfoundry.com/attachments/token/y4ls3aqh00thzen/?name=publish2.png" alt="publish2.png"></p>

<p>And get it back:</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/e5ojjwwhs6ljjwd/?name=get1.png" alt="get1.png"><img src="http://support.cloudfoundry.com/attachments/token/lejqlsjmiu75lc7/?name=get2.png" alt="get2.png"></p>

<p>That concludes this tutorial. You can find more resources about RabbitMQ and AMQP on the <a href="http://www.rabbitmq.com/">RabbitMQ web site</a>. And you can find more information about using RabbitMQ within a Spring application on the <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> website. And if you have questions or feedback on this tutorial or the RabbitMQ service, please contact us using the forums on <a href="http://support.cloudfoundry.com/">support.cloudfoundry.com</a>.</p>;T;@¿I"(/services/rabbitmq/nodejs-rabbitmq/;T{;{	;I"•„<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/rabbitmq/nodejs-rabbitmq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using RabbitMQ with Node.js' property='og:title'>
<meta content='Node.js Application Development with RabbitMQ Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using RabbitMQ with Node.js</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using RabbitMQ with Node.js</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Node.js Application Development with RabbitMQ Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/nodejs" rel="tag">nodejs</a><a href="/tags/rabbitmq" rel="tag">rabbitmq</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Node.js is an event-driven, scalable, Javascript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools recognize Node.js applications.</p>

<p>RabbitMQ is a message broker that provides robust messaging services for your applications.</p>

<p>This is a guide for Node.js developers who are using the Cloud Foundry RabbitMQ service. It shows you how to access the Cloud Foundry RabbitMQ services in your applications.</p>

<p>See <a href="/frameworks/nodejs/nodejs.html">Node.js Application Development with Cloud Foundry</a> for a first tutorial on deploying Node.js applications.</p>

<h3 id="setup">Setup</h3>

<p>Confirm Node.js is correctly installed:</p>

<p>Run node to start the interactive JavaScript console. Press <code>Control-C</code> twice to exit.</p>

<pre class="terminal">
$ node
</pre>

<p>Check that Node Package Manager (NPM) is installed. At the command line:</p>

<pre class="terminal">
$ npm -v
1.0.6
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<h3 id="create-application-files">Create Application Files</h3>

<p>Create an application directory and change into it:</p>

<pre class="terminal">
$ mkdir rabbitmq-node
$ cd rabbitmq-node
</pre>

<p>Create the file <code>package.json</code> with the following contents:</p>

<pre><code class="language-javascript"><span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">"node-amqp-demo"</span><span class="p">,</span>
    <span class="s2">"version"</span><span class="o">:</span><span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="s2">"dependencies"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"amqp"</span><span class="o">:</span><span class="s2">"&gt;= 0.1.0"</span><span class="p">,</span>
        <span class="s2">"sanitizer"</span><span class="o">:</span> <span class="s2">"*"</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>This <code>package.json</code> specifies two dependent libraries: amqp for message processing and sanitizer to escape HTML messages.</p>

<p>Install the dependencies, using npm (Node Package Manager):</p>

<pre class="terminal">
$ npm install
</pre>

<p>Create <code>app.js</code> with the following code:</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">amqp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'amqp'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">URL</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">htmlEscape</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'sanitizer/sanitizer'</span><span class="p">).</span><span class="nx">escape</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">rabbitUrl</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">conf</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">conf</span><span class="p">[</span><span class="s1">'rabbitmq-2.4'</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"amqp://localhost"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">function</span> <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">exchange</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">exchange</span><span class="p">(</span><span class="s1">'cf-demo'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'type'</span><span class="o">:</span> <span class="s1">'fanout'</span><span class="p">,</span> <span class="nx">durable</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span><span class="nx">durable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">exclusive</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">htmlEscape</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">body</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">messages</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">messages</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">exchange</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">queue</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'queueBindOk'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">httpServer</span><span class="p">(</span><span class="nx">exchange</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">httpServer</span><span class="p">(</span><span class="nx">exchange</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">serv</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'GET'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/env'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">printEnv</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'GET'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
      <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">writeForm</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">writeMessages</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'POST'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">chunks</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span> <span class="nx">chunks</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span> <span class="p">});</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">msg</span> <span class="o">=</span> <span class="nx">unescapeFormData</span><span class="p">(</span><span class="nx">chunks</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nx">exchange</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span><span class="nx">body</span><span class="o">:</span> <span class="nx">msg</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">303</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">"This is not the page you were looking for."</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">serv</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Starting ... AMQP URL: "</span> <span class="o">+</span> <span class="nx">rabbitUrl</span><span class="p">());</span>
<span class="kd">var</span> <span class="nx">conn</span> <span class="o">=</span> <span class="nx">amqp</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="nx">rabbitUrl</span><span class="p">()});</span>
<span class="nx">conn</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'ready'</span><span class="p">,</span> <span class="nx">setup</span><span class="p">);</span>

<span class="c1">// ---- helpers</span>

<span class="kd">function</span> <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Node.js / RabbitMQ demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">"&lt;/body&gt;&lt;/html&gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">writeMessages</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;h2&gt;Messages&lt;/h2&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;ol&gt;'</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">messages</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;/ol&gt;'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">writeForm</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;form method="post"&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;input name="data"/&gt;&lt;input type="submit"/&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;/form&gt;'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printEnv</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">entry</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">entry</span> <span class="o">+</span> <span class="s2">"="</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="nx">entry</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">unescapeFormData</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">unescape</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">));</span>
<span class="p">}</span></code></pre>

<p>Push the application to Cloud Foundry. For most prompts you can press <code>Enter</code> to accept the default value.
At the Application Name prompt, enter a unique application name. Also, be sure to create and bind a rabbitmq service, as shown in the following transcript.</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: rabbitmq-node
	Application Deployed URL [rabbitmq-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'rabbitmq-node'? [yN]: y
	Would you like to use an existing provisioned service? [yN]: n
	The following system services are available
	1: mongodb
	2: mysql
	3: postgresql
	4: rabbitmq
	5: redis
	Please select one you wish to provision: 4
	Specify the name of the service [rabbitmq-6c981]:
	Creating Service: OK
	Binding Service [rabbitmq-6c981]: OK
	Uploading Application:
	  Checking for available resources: OK
	  Processing resources: OK
	  Packing application: OK
	  Uploading (1K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

</pre>

<p>Access the application at the specified URL using your browser. Enter messages in the form and see them echoed in the browser.</p>

<p><img src="/images/screenshots/nodejs-rabbitmq/rmq-app.png" alt="RabbitMQ with Node.js application"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"~Node.js is an event-driven, scalable, Javascript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools recognize Node.js applications.

RabbitMQ is a message broker that provides robust messaging services for your applications.

This is a guide for Node.js developers who are using the Cloud Foundry RabbitMQ service. It shows you how to access the Cloud Foundry RabbitMQ services in your applications.

See [Node.js Application Development with Cloud Foundry](/frameworks/nodejs/nodejs.html) for a first tutorial on deploying Node.js applications.

### Setup

Confirm Node.js is correctly installed:

Run node to start the interactive JavaScript console. Press `Control-C` twice to exit.

```bash
$ node
```

Check that Node Package Manager (NPM) is installed. At the command line:

```bash
$ npm -v
1.0.6
```

Target Cloud Foundry and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
$ vmc login
```

### Create Application Files

Create an application directory and change into it:

```bash
$ mkdir rabbitmq-node
$ cd rabbitmq-node
```

Create the file `package.json` with the following contents:

``` javascript
{
    "name":"node-amqp-demo",
    "version":"0.0.1",
    "dependencies": {
        "amqp":">= 0.1.0",
        "sanitizer": "*"
    }
}
```

This `package.json` specifies two dependent libraries: amqp for message processing and sanitizer to escape HTML messages.

Install the dependencies, using npm (Node Package Manager):

```bash
$ npm install
```

Create `app.js` with the following code:

``` javascript
var http = require('http');
var amqp = require('amqp');
var URL = require('url');
var htmlEscape = require('sanitizer/sanitizer').escape;

function rabbitUrl() {
  if (process.env.VCAP_SERVICES) {
    conf = JSON.parse(process.env.VCAP_SERVICES);
    return conf['rabbitmq-2.4'][0].credentials.url;
  }
  else {
    return "amqp://localhost";
  }
}

var port = process.env.VCAP_APP_PORT || 3000;

var messages = [];

function setup() {

  var exchange = conn.exchange('cf-demo', {'type': 'fanout', durable: false}, function() {

    var queue = conn.queue('', {durable: false, exclusive: true},
    function() {
      queue.subscribe(function(msg) {
        messages.push(htmlEscape(msg.body));
        if (messages.length > 10) {
          messages.shift();
        }
      });
      queue.bind(exchange.name, '');
    });
    queue.on('queueBindOk', function() { httpServer(exchange); });
  });
}

function httpServer(exchange) {
  var serv = http.createServer(function(req, res) {
    var url = URL.parse(req.url);
    if (req.method == 'GET' && url.pathname == '/env') {
      printEnv(res);
    }
    else if (req.method == 'GET' && url.pathname == '/') {
      res.statusCode = 200;
      openHtml(res);
      writeForm(res);
      writeMessages(res);
      closeHtml(res);
    }
    else if (req.method == 'POST' && url.pathname == '/') {
      chunks = '';
      req.on('data', function(chunk) { chunks += chunk; });
      req.on('end', function() {
        msg = unescapeFormData(chunks.split('=')[1]);
        exchange.publish('', {body: msg});
        res.statusCode = 303;
        res.setHeader('Location', '/');
        res.end();
      });
    }
    else {
      res.statusCode = 404;
      res.end("This is not the page you were looking for.");
    }
  });
  serv.listen(port);
}

console.log("Starting ... AMQP URL: " + rabbitUrl());
var conn = amqp.createConnection({url: rabbitUrl()});
conn.on('ready', setup);

// ---- helpers

function openHtml(res) {
  res.write("<html><head><title>Node.js / RabbitMQ demo</title></head><body>");
}

function closeHtml(res) {
  res.end("</body></html>");
}

function writeMessages(res) {
  res.write('<h2>Messages</h2>');
  res.write('<ol>');
  for (i in messages) {
    res.write('<li>' + messages[i] + '</li>');
  }
  res.write('</ol>');
}

function writeForm(res) {
  res.write('<form method="post">');
  res.write('<input name="data"/><input type="submit"/>');
  res.write('</form>');
}

function printEnv(res) {
  res.statusCode = 200;
  openHtml(res);
  for (entry in process.env) {
    res.write(entry + "=" + process.env[entry] + "<br/>");
  }
  closeHtml(res);
}

function unescapeFormData(msg) {
  return unescape(msg.replace('+', ' '));
}
```

Push the application to Cloud Foundry. For most prompts you can press `Enter` to accept the default value.
At the Application Name prompt, enter a unique application name. Also, be sure to create and bind a rabbitmq service, as shown in the following transcript.

```bash
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: rabbitmq-node
	Application Deployed URL [rabbitmq-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'rabbitmq-node'? [yN]: y
	Would you like to use an existing provisioned service? [yN]: n
	The following system services are available
	1: mongodb
	2: mysql
	3: postgresql
	4: rabbitmq
	5: redis
	Please select one you wish to provision: 4
	Specify the name of the service [rabbitmq-6c981]:
	Creating Service: OK
	Binding Service [rabbitmq-6c981]: OK
	Uploading Application:
	  Checking for available resources: OK
	  Processing resources: OK
	  Packing application: OK
	  Uploading (1K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

```

Access the application at the specified URL using your browser. Enter messages in the form and see them echoed in the browser.

![RabbitMQ with Node.js application](/images/screenshots/nodejs-rabbitmq/rmq-app.png);T;
I"yP<p>Node.js is an event-driven, scalable, Javascript-based platform for networking applications. Cloud Foundry provides a runtime environment for Node.js applications and the Cloud Foundry deployment tools recognize Node.js applications.</p>

<p>RabbitMQ is a message broker that provides robust messaging services for your applications.</p>

<p>This is a guide for Node.js developers who are using the Cloud Foundry RabbitMQ service. It shows you how to access the Cloud Foundry RabbitMQ services in your applications.</p>

<p>See <a href="/frameworks/nodejs/nodejs.html">Node.js Application Development with Cloud Foundry</a> for a first tutorial on deploying Node.js applications.</p>

<h3 id="setup">Setup</h3>

<p>Confirm Node.js is correctly installed:</p>

<p>Run node to start the interactive JavaScript console. Press <code>Control-C</code> twice to exit.</p>

<pre class="terminal">
$ node
</pre>

<p>Check that Node Package Manager (NPM) is installed. At the command line:</p>

<pre class="terminal">
$ npm -v
1.0.6
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<h3 id="create-application-files">Create Application Files</h3>

<p>Create an application directory and change into it:</p>

<pre class="terminal">
$ mkdir rabbitmq-node
$ cd rabbitmq-node
</pre>

<p>Create the file <code>package.json</code> with the following contents:</p>

<pre><code class="language-javascript"><span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span><span class="s2">"node-amqp-demo"</span><span class="p">,</span>
    <span class="s2">"version"</span><span class="o">:</span><span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="s2">"dependencies"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"amqp"</span><span class="o">:</span><span class="s2">"&gt;= 0.1.0"</span><span class="p">,</span>
        <span class="s2">"sanitizer"</span><span class="o">:</span> <span class="s2">"*"</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>This <code>package.json</code> specifies two dependent libraries: amqp for message processing and sanitizer to escape HTML messages.</p>

<p>Install the dependencies, using npm (Node Package Manager):</p>

<pre class="terminal">
$ npm install
</pre>

<p>Create <code>app.js</code> with the following code:</p>

<pre><code class="language-javascript"><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">amqp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'amqp'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">URL</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">htmlEscape</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'sanitizer/sanitizer'</span><span class="p">).</span><span class="nx">escape</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">rabbitUrl</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">conf</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_SERVICES</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">conf</span><span class="p">[</span><span class="s1">'rabbitmq-2.4'</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">"amqp://localhost"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VCAP_APP_PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">function</span> <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">exchange</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">exchange</span><span class="p">(</span><span class="s1">'cf-demo'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'type'</span><span class="o">:</span> <span class="s1">'fanout'</span><span class="p">,</span> <span class="nx">durable</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span><span class="nx">durable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">exclusive</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">htmlEscape</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">body</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">messages</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">messages</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">exchange</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">queue</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'queueBindOk'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">httpServer</span><span class="p">(</span><span class="nx">exchange</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">httpServer</span><span class="p">(</span><span class="nx">exchange</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">serv</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'GET'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/env'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">printEnv</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'GET'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
      <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">writeForm</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">writeMessages</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
      <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">'POST'</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">chunks</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span> <span class="nx">chunks</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span> <span class="p">});</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">msg</span> <span class="o">=</span> <span class="nx">unescapeFormData</span><span class="p">(</span><span class="nx">chunks</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="nx">exchange</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="p">{</span><span class="nx">body</span><span class="o">:</span> <span class="nx">msg</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">303</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">"This is not the page you were looking for."</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">serv</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Starting ... AMQP URL: "</span> <span class="o">+</span> <span class="nx">rabbitUrl</span><span class="p">());</span>
<span class="kd">var</span> <span class="nx">conn</span> <span class="o">=</span> <span class="nx">amqp</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="nx">rabbitUrl</span><span class="p">()});</span>
<span class="nx">conn</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'ready'</span><span class="p">,</span> <span class="nx">setup</span><span class="p">);</span>

<span class="c1">// ---- helpers</span>

<span class="kd">function</span> <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Node.js / RabbitMQ demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">"&lt;/body&gt;&lt;/html&gt;"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">writeMessages</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;h2&gt;Messages&lt;/h2&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;ol&gt;'</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">messages</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;/ol&gt;'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">writeForm</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;form method="post"&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;input name="data"/&gt;&lt;input type="submit"/&gt;'</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'&lt;/form&gt;'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printEnv</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="nx">openHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">entry</span> <span class="k">in</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">entry</span> <span class="o">+</span> <span class="s2">"="</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="nx">entry</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"&lt;br/&gt;"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">closeHtml</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">unescapeFormData</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">unescape</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">));</span>
<span class="p">}</span></code></pre>

<p>Push the application to Cloud Foundry. For most prompts you can press <code>Enter</code> to accept the default value.
At the Application Name prompt, enter a unique application name. Also, be sure to create and bind a rabbitmq service, as shown in the following transcript.</p>

<pre class="terminal">
$ vmc push
	Would you like to deploy from the current directory? [Yn]:
	Application Name: rabbitmq-node
	Application Deployed URL [rabbitmq-node.cloudfoundry.com]:
	Detected a Node.js Application, is this correct? [Yn]:
	Memory Reservation (64M, 128M, 256M, 512M) [64M]:
	Creating Application: OK
	Would you like to bind any services to 'rabbitmq-node'? [yN]: y
	Would you like to use an existing provisioned service? [yN]: n
	The following system services are available
	1: mongodb
	2: mysql
	3: postgresql
	4: rabbitmq
	5: redis
	Please select one you wish to provision: 4
	Specify the name of the service [rabbitmq-6c981]:
	Creating Service: OK
	Binding Service [rabbitmq-6c981]: OK
	Uploading Application:
	  Checking for available resources: OK
	  Processing resources: OK
	  Packing application: OK
	  Uploading (1K): OK
	Push Status: OK
	Staging Application: OK
	Starting Application: OK

</pre>

<p>Access the application at the specified URL using your browser. Enter messages in the form and see them echoed in the browser.</p>

<p><img src="/images/screenshots/nodejs-rabbitmq/rmq-app.png" alt="RabbitMQ with Node.js application"></p>;T;@ÅI"&/services/rabbitmq/ruby-rabbitmq/;T{;{	;I"ñW<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/rabbitmq/ruby-rabbitmq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using RabbitMQ with Ruby' property='og:title'>
<meta content='Ruby Development with the RabbitMQ Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using RabbitMQ with Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using RabbitMQ with Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Development with the RabbitMQ Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rabbitmq" rel="tag">rabbitmq</a><a href="/tags/tutorial" rel="tag">tutorial</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Cloud Foundry supports <a href="http://www.rabbitmq.com/">RabbitMQ</a>, the
open-source message broker, as a service. The Cloud Foundry RabbitMQ service is
based on rabbitmq-server-2.4.1.</p>

<p>For more information about RabbitMQ, see these resources:</p>

<ul>
<li>
    <p><a href="http://www.rabbitmq.com/download.html">Download</a>,
<a href="http://www.rabbitmq.com/install.html">install</a>, and
<a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ.</p>
  </li>
  <li>
    <p><a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a> cover
the basics of creating messaging in your applications.</p>
  </li>
</ul><h2 id="language-and-framework-support">Language and Framework Support</h2>
<p>Languages and frameworks supported by Cloud
Foundry that have an Advanced Message Queue Protocol (AMQP) client library are
also supported by the RabbitMQ service. Ruby on Rails and Sinatra have been
deployed on Cloud Foundry with the <a href="https://github.com/ruby-amqp/bunny">bunny gem</a>, version 0.7.4.</p>

<h2 id="protocol-support">Protocol Support</h2>
<p>The Cloud Foundry RabbitMQ service supports the core
protocols of RabbitMQ: AMQP versions 0-8 and 0-9-1. Other protocols will be
supported by RabbitMQ plugins.</p>

<p>Follow these steps to provision and bind RabbitMQ to an application:</p>

<ul>
<li>Create the RabbitMQ service and bind it to your application:</li>
</ul><pre class="terminal">
$ vmc create-service rabbitmq --bind appname
</pre>

<ul>
<li>Check the application:</li>
</ul><pre class="terminal">
$ vmc apps
</pre>

<p>Returns a list of applications on your cloud, with any associated
services.</p>

<h2 id="rails-and-rabbitmq">Rails and RabbitMQ</h2>

<p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP
protocol</a> (versions 0.8 and 0.9.1), so your
application requires an AMQP client library to use the service.</p>

<p>A popular AMQP client libraries for Rails is
<a href="https://github.com/ruby-amqp/bunny">bunny</a>.  we will use it demonstrate
the process you would follow:</p>

<p>Add the bunny and json gems to your Gemfile.  (json is used to parse the service connection data):</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'bunny'</span>
<span class="n">gem</span> <span class="s1">'json'</span></code></pre>

<p>Run bundle install to install the gems you added:</p>

<pre class="terminal">
$ bundle install
</pre>

<p>Require the gems in your controller:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'bunny'</span>
<span class="nb">require</span> <span class="s1">'json'</span></code></pre>

<p>Update the controller class to get the connection string for the service and make the connection:</p>

<pre><code class="language-ruby"><span class="c1"># Extracts the connection string for the rabbitmq service from the</span>
<span class="c1"># service information provided by Cloud Foundry in an environment</span>
<span class="c1"># variable.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">amqp_url</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:symbolize_names</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">srvs</span><span class="o">|</span>
    <span class="n">srvs</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">srv</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">srv</span><span class="o">[</span><span class="ss">:label</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^rabbitmq-/</span>
            <span class="n">srv</span><span class="o">[</span><span class="ss">:credentials</span><span class="o">][</span><span class="ss">:url</span><span class="o">]</span>
            <span class="k">else</span>
            <span class="o">[]</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">end</span><span class="o">.</span><span class="n">flatten!</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>

<span class="c1"># Opens a client connection to the RabbitMQ service, if one is not</span>
<span class="c1"># already open.  This is a class method because a new instance of</span>
<span class="c1"># the controller class will be created upon each request.  But AMQP</span>
<span class="c1"># connections can be long-lived, so we would like to re-use the</span>
<span class="c1"># connection across many requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">client</span>
    <span class="k">unless</span> <span class="vi">@client</span>
        <span class="n">c</span> <span class="o">=</span> <span class="no">Bunny</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">amqp_url</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">start</span>
        <span class="vi">@client</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">end</span>
    <span class="vi">@client</span>
<span class="k">end</span></code></pre>

<p>Set up message queues in the controller:</p>

<pre><code class="language-ruby"><span class="c1"># Return the "nameless exchange", pre-defined by AMQP as a means to</span>
<span class="c1"># send messages to specific queues.  Again, we use a class method to</span>
<span class="c1"># share this across requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">nameless_exchange</span>
    <span class="vi">@nameless_exchange</span> <span class="o">||=</span> <span class="n">client</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Return a queue named "messages".  This will create the queue on</span>
<span class="c1"># the server, if it did not already exist.  Again, we use a class</span>
<span class="c1"># method to share this across requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">messages_queue</span>
    <span class="vi">@messages_queue</span> <span class="o">||=</span> <span class="n">client</span><span class="o">.</span><span class="n">queue</span><span class="p">(</span><span class="s2">"messages"</span><span class="p">)</span>
<span class="k">end</span></code></pre>

<p>Add controller methods to read and write messages:</p>

<pre><code class="language-ruby"><span class="c1"># The action for our publish form.</span>
<span class="k">def</span> <span class="nf">publish</span>
    <span class="c1"># Send the message from the form's input box to the "messages"</span>
    <span class="c1"># queue, via the nameless exchange.  The name of the queue to</span>
    <span class="c1"># publish to is specified in the routing key.</span>
    <span class="no">HomeController</span><span class="o">.</span><span class="n">nameless_exchange</span><span class="o">.</span><span class="n">publish</span> <span class="n">params</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span><span class="p">,</span>
                                   <span class="ss">:key</span> <span class="o">=&gt;</span> <span class="s2">"messages"</span>
    <span class="c1"># Notify the user that we published.</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:published</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">redirect_to</span> <span class="n">home_index_path</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">get</span>
    <span class="c1"># Synchronously get a message from the queue</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="no">HomeController</span><span class="o">.</span><span class="n">messages_queue</span><span class="o">.</span><span class="n">pop</span>
    <span class="c1"># Show the user what we got</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:got</span><span class="o">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">[</span><span class="ss">:payload</span><span class="o">]</span>
    <span class="n">redirect_to</span> <span class="n">home_index_path</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÎCloud Foundry supports [RabbitMQ](http://www.rabbitmq.com/), the
open-source message broker, as a service. The Cloud Foundry RabbitMQ service is
based on rabbitmq-server-2.4.1.

For more information about RabbitMQ, see these resources:

-   [Download](http://www.rabbitmq.com/download.html),
    [install](http://www.rabbitmq.com/install.html), and
    [configure](http://www.rabbitmq.com/configure.html) RabbitMQ.

-   [RabbitMQ Tutorials](http://www.rabbitmq.com/getstarted.html) cover
    the basics of creating messaging in your applications.

## Language and Framework Support
Languages and frameworks supported by Cloud
Foundry that have an Advanced Message Queue Protocol (AMQP) client library are
also supported by the RabbitMQ service. Ruby on Rails and Sinatra have been
deployed on Cloud Foundry with the [bunny gem](https://github.com/ruby-amqp/bunny), version 0.7.4.

## Protocol Support
The Cloud Foundry RabbitMQ service supports the core
protocols of RabbitMQ: AMQP versions 0-8 and 0-9-1. Other protocols will be
supported by RabbitMQ plugins.

Follow these steps to provision and bind RabbitMQ to an application:

*  Create the RabbitMQ service and bind it to your application:

```bash
$ vmc create-service rabbitmq --bind appname
```

*  Check the application:

```bash
$ vmc apps
```

Returns a list of applications on your cloud, with any associated
services.

## Rails and RabbitMQ

The RabbitMQ service is accessed through the [AMQP
protocol](http://www.amqp.org/) (versions 0.8 and 0.9.1), so your
application requires an AMQP client library to use the service.

A popular AMQP client libraries for Rails is
[bunny](https://github.com/ruby-amqp/bunny).  we will use it demonstrate
the process you would follow:

Add the bunny and json gems to your Gemfile.  (json is used to parse the service connection data):

``` ruby
gem 'bunny'
gem 'json'
```

Run bundle install to install the gems you added:

```bash
$ bundle install
```

Require the gems in your controller:

``` ruby
require 'bunny'
require 'json'
```

Update the controller class to get the connection string for the service and make the connection:

``` ruby
# Extracts the connection string for the rabbitmq service from the
# service information provided by Cloud Foundry in an environment
# variable.
def self.amqp_url
    services = JSON.parse(ENV['VCAP_SERVICES'], :symbolize_names => true)
    url = services.values.map do |srvs|
    srvs.map do |srv|
        if srv[:label] =~ /^rabbitmq-/
            srv[:credentials][:url]
            else
            []
        end
    end
    end.flatten!.first
end

# Opens a client connection to the RabbitMQ service, if one is not
# already open.  This is a class method because a new instance of
# the controller class will be created upon each request.  But AMQP
# connections can be long-lived, so we would like to re-use the
# connection across many requests.
def self.client
    unless @client
        c = Bunny.new(amqp_url)
        c.start
        @client = c
    end
    @client
end
```

Set up message queues in the controller:

``` ruby
# Return the "nameless exchange", pre-defined by AMQP as a means to
# send messages to specific queues.  Again, we use a class method to
# share this across requests.
def self.nameless_exchange
    @nameless_exchange ||= client.exchange('')
end

# Return a queue named "messages".  This will create the queue on
# the server, if it did not already exist.  Again, we use a class
# method to share this across requests.
def self.messages_queue
    @messages_queue ||= client.queue("messages")
end
```

Add controller methods to read and write messages:

``` ruby
# The action for our publish form.
def publish
    # Send the message from the form's input box to the "messages"
    # queue, via the nameless exchange.  The name of the queue to
    # publish to is specified in the routing key.
    HomeController.nameless_exchange.publish params[:message],
                                   :key => "messages"
    # Notify the user that we published.
    flash[:published] = true
    redirect_to home_index_path
end

def get
    # Synchronously get a message from the queue
    msg = HomeController.messages_queue.pop
    # Show the user what we got
    flash[:got] = msg[:payload]
    redirect_to home_index_path
end
```;T;
I"Á#<p>Cloud Foundry supports <a href="http://www.rabbitmq.com/">RabbitMQ</a>, the
open-source message broker, as a service. The Cloud Foundry RabbitMQ service is
based on rabbitmq-server-2.4.1.</p>

<p>For more information about RabbitMQ, see these resources:</p>

<ul>
<li>
    <p><a href="http://www.rabbitmq.com/download.html">Download</a>,
<a href="http://www.rabbitmq.com/install.html">install</a>, and
<a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ.</p>
  </li>
  <li>
    <p><a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a> cover
the basics of creating messaging in your applications.</p>
  </li>
</ul><h2 id="language-and-framework-support">Language and Framework Support</h2>
<p>Languages and frameworks supported by Cloud
Foundry that have an Advanced Message Queue Protocol (AMQP) client library are
also supported by the RabbitMQ service. Ruby on Rails and Sinatra have been
deployed on Cloud Foundry with the <a href="https://github.com/ruby-amqp/bunny">bunny gem</a>, version 0.7.4.</p>

<h2 id="protocol-support">Protocol Support</h2>
<p>The Cloud Foundry RabbitMQ service supports the core
protocols of RabbitMQ: AMQP versions 0-8 and 0-9-1. Other protocols will be
supported by RabbitMQ plugins.</p>

<p>Follow these steps to provision and bind RabbitMQ to an application:</p>

<ul>
<li>Create the RabbitMQ service and bind it to your application:</li>
</ul><pre class="terminal">
$ vmc create-service rabbitmq --bind appname
</pre>

<ul>
<li>Check the application:</li>
</ul><pre class="terminal">
$ vmc apps
</pre>

<p>Returns a list of applications on your cloud, with any associated
services.</p>

<h2 id="rails-and-rabbitmq">Rails and RabbitMQ</h2>

<p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP
protocol</a> (versions 0.8 and 0.9.1), so your
application requires an AMQP client library to use the service.</p>

<p>A popular AMQP client libraries for Rails is
<a href="https://github.com/ruby-amqp/bunny">bunny</a>.  we will use it demonstrate
the process you would follow:</p>

<p>Add the bunny and json gems to your Gemfile.  (json is used to parse the service connection data):</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'bunny'</span>
<span class="n">gem</span> <span class="s1">'json'</span></code></pre>

<p>Run bundle install to install the gems you added:</p>

<pre class="terminal">
$ bundle install
</pre>

<p>Require the gems in your controller:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'bunny'</span>
<span class="nb">require</span> <span class="s1">'json'</span></code></pre>

<p>Update the controller class to get the connection string for the service and make the connection:</p>

<pre><code class="language-ruby"><span class="c1"># Extracts the connection string for the rabbitmq service from the</span>
<span class="c1"># service information provided by Cloud Foundry in an environment</span>
<span class="c1"># variable.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">amqp_url</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:symbolize_names</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">srvs</span><span class="o">|</span>
    <span class="n">srvs</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">srv</span><span class="o">|</span>
        <span class="k">if</span> <span class="n">srv</span><span class="o">[</span><span class="ss">:label</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^rabbitmq-/</span>
            <span class="n">srv</span><span class="o">[</span><span class="ss">:credentials</span><span class="o">][</span><span class="ss">:url</span><span class="o">]</span>
            <span class="k">else</span>
            <span class="o">[]</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">end</span><span class="o">.</span><span class="n">flatten!</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>

<span class="c1"># Opens a client connection to the RabbitMQ service, if one is not</span>
<span class="c1"># already open.  This is a class method because a new instance of</span>
<span class="c1"># the controller class will be created upon each request.  But AMQP</span>
<span class="c1"># connections can be long-lived, so we would like to re-use the</span>
<span class="c1"># connection across many requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">client</span>
    <span class="k">unless</span> <span class="vi">@client</span>
        <span class="n">c</span> <span class="o">=</span> <span class="no">Bunny</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">amqp_url</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">start</span>
        <span class="vi">@client</span> <span class="o">=</span> <span class="n">c</span>
    <span class="k">end</span>
    <span class="vi">@client</span>
<span class="k">end</span></code></pre>

<p>Set up message queues in the controller:</p>

<pre><code class="language-ruby"><span class="c1"># Return the "nameless exchange", pre-defined by AMQP as a means to</span>
<span class="c1"># send messages to specific queues.  Again, we use a class method to</span>
<span class="c1"># share this across requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">nameless_exchange</span>
    <span class="vi">@nameless_exchange</span> <span class="o">||=</span> <span class="n">client</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Return a queue named "messages".  This will create the queue on</span>
<span class="c1"># the server, if it did not already exist.  Again, we use a class</span>
<span class="c1"># method to share this across requests.</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">messages_queue</span>
    <span class="vi">@messages_queue</span> <span class="o">||=</span> <span class="n">client</span><span class="o">.</span><span class="n">queue</span><span class="p">(</span><span class="s2">"messages"</span><span class="p">)</span>
<span class="k">end</span></code></pre>

<p>Add controller methods to read and write messages:</p>

<pre><code class="language-ruby"><span class="c1"># The action for our publish form.</span>
<span class="k">def</span> <span class="nf">publish</span>
    <span class="c1"># Send the message from the form's input box to the "messages"</span>
    <span class="c1"># queue, via the nameless exchange.  The name of the queue to</span>
    <span class="c1"># publish to is specified in the routing key.</span>
    <span class="no">HomeController</span><span class="o">.</span><span class="n">nameless_exchange</span><span class="o">.</span><span class="n">publish</span> <span class="n">params</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span><span class="p">,</span>
                                   <span class="ss">:key</span> <span class="o">=&gt;</span> <span class="s2">"messages"</span>
    <span class="c1"># Notify the user that we published.</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:published</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">redirect_to</span> <span class="n">home_index_path</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">get</span>
    <span class="c1"># Synchronously get a message from the queue</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="no">HomeController</span><span class="o">.</span><span class="n">messages_queue</span><span class="o">.</span><span class="n">pop</span>
    <span class="c1"># Show the user what we got</span>
    <span class="n">flash</span><span class="o">[</span><span class="ss">:got</span><span class="o">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">[</span><span class="ss">:payload</span><span class="o">]</span>
    <span class="n">redirect_to</span> <span class="n">home_index_path</span>
<span class="k">end</span></code></pre>;T;@ËI"!/services/rabbitmq/rabbitmq/;T{;{	;I"Ä;<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/rabbitmq/rabbitmq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | RabbitMQ' property='og:title'>
<meta content='Using the RabbitMQ Service on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | RabbitMQ</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>RabbitMQ</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using the RabbitMQ Service on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/rabbitmq" rel="tag">rabbitmq</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resources will help you get started using the RabbitMQ service on Cloud Foundry:</p>

<h2 id="docs">Docs</h2>

<ul>
<li><a href="/services/rabbitmq/spring-rabbitmq.html">Using RabbitMQ with Spring and Java</a></li>
  <li><a href="/services/rabbitmq/ruby-rabbitmq.html">Ruby Development with the RabbitMQ Service</a></li>
  <li><a href="/services/rabbitmq/nodejs-rabbitmq.html">Using RabbitMQ with Node.js</a></li>
  <li><a href="/services/rabbitmq/faq-rabbitmq.html">FAQ</a></li>
</ul><h2 id="sample-applications">Sample Applications</h2>
<p><a href="https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples">https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples</a></p>

<h2 id="blog-posts">Blog posts</h2>

<ul>
<li><a href="http://blog.cloudfoundry.com/2011/08/09/rabbitmq-cloud-foundry-cloud-messaging-that-just-works/">RabbitMQ and Cloud Foundry: Cloud Messaging that Just Works</a></li>
  <li><a href="http://blog.springsource.com/2011/08/16/chatting-in-the-cloud-part-1/">Spring: rabbit-chat : Chatting in the Cloud</a></li>
  <li><a href="http://www.rabbitmq.com/blog/2011/08/16/using-the-rabbitmq-service-on-cloud-foundry-with-nodejs/">NodeJS: SockJS : Web Sockets like API for the Cloud</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/grails-rabbitmq-cloud-foundry-messaging.html">Grails: Grails + RabbitMQ + Cloud Foundry: Messaging in Cloud Foundry</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq-tracking.html">Grails: Cloud Foundry + Grails + RabbitMQ: Tracking Messages in the Cloud</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq.html">Grails: Cloud Foundry + Grails + RabbitMQ - Publishing Messages into the Cloud</a></li>
  <li><a href="http://blog.springsource.com/2011/08/29/rabbitmq-enabling-grails-full-text-search-on-cloud-foundry/">Grails: RabbitMQ: Enabling Grails full text search on Cloud Foundry</a></li>
  <li><a href="http://joe.blog.freemansoft.com/2011/11/accessing-rabbitmq-console-in-cloud.html">RabbitMQ Console: Accessing the RabbitMQ Console in Cloud Foundry</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ûThe following resources will help you get started using the RabbitMQ service on Cloud Foundry:

## Docs

+ [Using RabbitMQ with Spring and Java](/services/rabbitmq/spring-rabbitmq.html)
+ [Ruby Development with the RabbitMQ Service](/services/rabbitmq/ruby-rabbitmq.html)
+ [Using RabbitMQ with Node.js](/services/rabbitmq/nodejs-rabbitmq.html)
+ [FAQ](/services/rabbitmq/faq-rabbitmq.html)


## Sample Applications
[https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples](https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples)


## Blog posts

+ [RabbitMQ and Cloud Foundry: Cloud Messaging that Just Works](http://blog.cloudfoundry.com/2011/08/09/rabbitmq-cloud-foundry-cloud-messaging-that-just-works/)
+ [Spring: rabbit-chat : Chatting in the Cloud](http://blog.springsource.com/2011/08/16/chatting-in-the-cloud-part-1/)
+ [NodeJS: SockJS : Web Sockets like API for the Cloud](http://www.rabbitmq.com/blog/2011/08/16/using-the-rabbitmq-service-on-cloud-foundry-with-nodejs/)
+ [Grails: Grails + RabbitMQ + Cloud Foundry: Messaging in Cloud Foundry](http://cjharris5.blogspot.com/2011/08/grails-rabbitmq-cloud-foundry-messaging.html)
+ [Grails: Cloud Foundry + Grails + RabbitMQ: Tracking Messages in the Cloud](http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq-tracking.html)
+ [Grails: Cloud Foundry + Grails + RabbitMQ - Publishing Messages into the Cloud](http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq.html)
+ [Grails: RabbitMQ: Enabling Grails full text search on Cloud Foundry]( http://blog.springsource.com/2011/08/29/rabbitmq-enabling-grails-full-text-search-on-cloud-foundry/)
+ [RabbitMQ Console: Accessing the RabbitMQ Console in Cloud Foundry](http://joe.blog.freemansoft.com/2011/11/accessing-rabbitmq-console-in-cloud.html);T;
I"V<p>The following resources will help you get started using the RabbitMQ service on Cloud Foundry:</p>

<h2 id="docs">Docs</h2>

<ul>
<li><a href="/services/rabbitmq/spring-rabbitmq.html">Using RabbitMQ with Spring and Java</a></li>
  <li><a href="/services/rabbitmq/ruby-rabbitmq.html">Ruby Development with the RabbitMQ Service</a></li>
  <li><a href="/services/rabbitmq/nodejs-rabbitmq.html">Using RabbitMQ with Node.js</a></li>
  <li><a href="/services/rabbitmq/faq-rabbitmq.html">FAQ</a></li>
</ul><h2 id="sample-applications">Sample Applications</h2>
<p><a href="https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples">https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples</a></p>

<h2 id="blog-posts">Blog posts</h2>

<ul>
<li><a href="http://blog.cloudfoundry.com/2011/08/09/rabbitmq-cloud-foundry-cloud-messaging-that-just-works/">RabbitMQ and Cloud Foundry: Cloud Messaging that Just Works</a></li>
  <li><a href="http://blog.springsource.com/2011/08/16/chatting-in-the-cloud-part-1/">Spring: rabbit-chat : Chatting in the Cloud</a></li>
  <li><a href="http://www.rabbitmq.com/blog/2011/08/16/using-the-rabbitmq-service-on-cloud-foundry-with-nodejs/">NodeJS: SockJS : Web Sockets like API for the Cloud</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/grails-rabbitmq-cloud-foundry-messaging.html">Grails: Grails + RabbitMQ + Cloud Foundry: Messaging in Cloud Foundry</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq-tracking.html">Grails: Cloud Foundry + Grails + RabbitMQ: Tracking Messages in the Cloud</a></li>
  <li><a href="http://cjharris5.blogspot.com/2011/08/cloud-foundry-grails-rabbitmq.html">Grails: Cloud Foundry + Grails + RabbitMQ - Publishing Messages into the Cloud</a></li>
  <li><a href="http://blog.springsource.com/2011/08/29/rabbitmq-enabling-grails-full-text-search-on-cloud-foundry/">Grails: RabbitMQ: Enabling Grails full text search on Cloud Foundry</a></li>
  <li><a href="http://joe.blog.freemansoft.com/2011/11/accessing-rabbitmq-console-in-cloud.html">RabbitMQ Console: Accessing the RabbitMQ Console in Cloud Foundry</a></li>
</ul>;T;@ÑI"%/services/rabbitmq/faq-rabbitmq/;T{;{	;I",G<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/rabbitmq/faq-rabbitmq.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | RabbitMQ FAQ' property='og:title'>
<meta content='RabbitMQ FAQ' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | RabbitMQ FAQ</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>RabbitMQ FAQ</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>RabbitMQ FAQ</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/rabbitmq" rel="tag">rabbitmq</a><a href="/tags/faq" rel="tag">faq</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h3 id="what-is-the-rabbitmq-service">What is the RabbitMQ service?</h3>
<p>The RabbitMQ service on Cloud Foundry brings the messaging functionality of RabbitMQ to developers building applications on Cloud Foundry. Like the rest of CloudFoundry.com, the RabbitMQ service is currently offered as a free beta service.</p>

<h3 id="what-is-rabbitmq">What is RabbitMQ?</h3>
<p>RabbitMQ is a popular open-source <a href="http://en.wikipedia.org/wiki/Message_broker">message broker</a>, developed at VMware. See the <a href="http://www.rabbitmq.com/">RabbitMQ site</a> for more details.</p>

<h3 id="how-does-the-rabbitmq-service-relate-to-cloud-foundry">How does the RabbitMQ service relate to Cloud Foundry?</h3>
<p>In addition to providing a platform for applications, Cloud Foundry provides a portfolio of on-demand services that developers can bind to their applications. Services available at the launch of Cloud Foundry included MySQL, MongoDB and Redis. The RabbitMQ service is on a par with those other services. You use the standard Cloud Foundry vmc commands (or their Spring Tool Suite equivalents) to create, bind, unbind and delete RabbitMQ services.</p>

<h3 id="which-languages-and-frameworks-can-i-use-with-the-rabbitmq-service">Which languages and frameworks can I use with the RabbitMQ service?</h3>
<p>Any that are supported by Cloud Foundry and that have an AMQP client library available.</p>

<p>We have developed applications for Cloud Foundry using the following language, framework and client library combinations:</p>

<p>Java Spring applications with <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> (version 1.0.0.RC2)
Ruby on Rails and Ruby Sinatra applications with the <a href="https://github.com/ruby-amqp/bunny">bunny gem</a> (version 0.7.4)
Node.js applications using with <a href="https://github.com/postwait/node-amqp">node-amqp</a> (version 0.1.0)</p>

<h3 id="how-do-i-get-started">How do I get started?</h3>
<p>At <a href="https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples">github.com/rabbitmq/rabbitmq-cloudfoundry-samples</a> you can find introductory samples showing how to use the service from various languages and frameworks, including Spring Java, Ruby on Rails, Ruby Sinatra, and node.js. And there are detailed tutorials for <a href="http://www.rabbitmq.com/cloudfoundry/rails">Rails</a> and <a href="http://www.rabbitmq.com/cloudfoundry/spring">Spring</a> on this site.</p>

<p>You can find more information about how to develop applications using RabbitMQ, which also applies to the RabbitMQ service, on the <a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ site</a>.</p>

<h3 id="which-protocols-can-i-use-to-access-the-rabbitmq-service">Which protocols can I use to access the RabbitMQ service?</h3>
<p>Currently the service supports the core protocols of RabbitMQ: <a href="http://en.wikipedia.org/wiki/AMQP">AMQP</a> versions 0-8 and 0-9-1. In the future we plan to incorporate other protocols supported by RabbitMQ plugins. Let us know if you are interested in support for a particular protocol.</p>

<h3 id="is-the-rabbitmq-service-accessible-to-applications-outside-of-cloudfoundrycom">Is the RabbitMQ service accessible to applications outside of CloudFoundry.com?</h3>
<p>Not at present.</p>

<h3 id="which-of-the-rabbitmq-use-cases-listed-on-the-getting-startedhttpswwwrabbitmqcomgetstartedhtml-page-on-rabbitmqcom-work-with-the-rabbitmq-service">Which of the RabbitMQ use cases listed on the <a href="https://www.rabbitmq.com/getstarted.html">Getting Started</a> page on RabbitMQ.com work with the RabbitMQ service?</h3>
<p>All these use cases will work.</p>

<h3 id="does-the-rabbitmq-service-support-clustering">Does the RabbitMQ service support clustering?</h3>
<p>Not yet, but we are considering this for the future.</p>

<h3 id="which-version-of-rabbitmq-server-is-the-rabbitmq-service-based-on">Which version of rabbitmq-server is the RabbitMQ service based on?</h3>
<p>Currently rabbitmq-server-2.4.1.</p>

<h3 id="how-is-the-rabbitmq-service-priced">How is the RabbitMQ service priced?</h3>
<p>Like the rest of Cloud Foundry, it is initially offered as a free beta service.</p>

<h3 id="is-rabbitmq-now-part-of-the-cloud-foundry-open-source-project">Is RabbitMQ now part of the Cloud Foundry open source project?</h3>
<p>No, the RabbitMQ service is not a part of the Cloud Foundry open source project.</p>

<h3 id="do-i-need-to-update-vmc-to-use-the-rabbitmq-service">Do I need to update vmc to use the RabbitMQ service?</h3>
<p>No, you do not need to update vmc to use the RabbitMQ service. But note that vmc continues to be enhanced, so you should occasionally update it with the rubygems command gem update vmc</p>

<h3 id="where-can-i-ask-questions-or-send-feedback-about-the-service">Where can I ask questions or send feedback about the service?</h3>
<p>Please ask your questions on the forums at <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> or on <a href="http://stackoverflow.com/questions/tagged/cloudfoundry">StackOverflow</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"### What is the RabbitMQ service?
The RabbitMQ service on Cloud Foundry brings the messaging functionality of RabbitMQ to developers building applications on Cloud Foundry. Like the rest of CloudFoundry.com, the RabbitMQ service is currently offered as a free beta service.

### What is RabbitMQ?
RabbitMQ is a popular open-source [message broker](http://en.wikipedia.org/wiki/Message_broker), developed at VMware. See the [RabbitMQ site](http://www.rabbitmq.com/) for more details.

### How does the RabbitMQ service relate to Cloud Foundry?
In addition to providing a platform for applications, Cloud Foundry provides a portfolio of on-demand services that developers can bind to their applications. Services available at the launch of Cloud Foundry included MySQL, MongoDB and Redis. The RabbitMQ service is on a par with those other services. You use the standard Cloud Foundry vmc commands (or their Spring Tool Suite equivalents) to create, bind, unbind and delete RabbitMQ services.

### Which languages and frameworks can I use with the RabbitMQ service?
Any that are supported by Cloud Foundry and that have an AMQP client library available.

We have developed applications for Cloud Foundry using the following language, framework and client library combinations:

Java Spring applications with [Spring AMQP](http://www.springsource.org/spring-amqp) (version 1.0.0.RC2)
Ruby on Rails and Ruby Sinatra applications with the [bunny gem](https://github.com/ruby-amqp/bunny) (version 0.7.4)
Node.js applications using with [node-amqp](https://github.com/postwait/node-amqp) (version 0.1.0)

### How do I get started?
At [github.com/rabbitmq/rabbitmq-cloudfoundry-samples](https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples) you can find introductory samples showing how to use the service from various languages and frameworks, including Spring Java, Ruby on Rails, Ruby Sinatra, and node.js. And there are detailed tutorials for [Rails](http://www.rabbitmq.com/cloudfoundry/rails) and [Spring](http://www.rabbitmq.com/cloudfoundry/spring) on this site.

You can find more information about how to develop applications using RabbitMQ, which also applies to the RabbitMQ service, on the [RabbitMQ site](http://www.rabbitmq.com/getstarted.html).

### Which protocols can I use to access the RabbitMQ service?
Currently the service supports the core protocols of RabbitMQ: [AMQP](http://en.wikipedia.org/wiki/AMQP) versions 0-8 and 0-9-1. In the future we plan to incorporate other protocols supported by RabbitMQ plugins. Let us know if you are interested in support for a particular protocol.

### Is the RabbitMQ service accessible to applications outside of CloudFoundry.com?
Not at present.

### Which of the RabbitMQ use cases listed on the [Getting Started](https://www.rabbitmq.com/getstarted.html) page on RabbitMQ.com work with the RabbitMQ service?
All these use cases will work.

### Does the RabbitMQ service support clustering?
Not yet, but we are considering this for the future.

### Which version of rabbitmq-server is the RabbitMQ service based on?
Currently rabbitmq-server-2.4.1.

### How is the RabbitMQ service priced?
Like the rest of Cloud Foundry, it is initially offered as a free beta service.

### Is RabbitMQ now part of the Cloud Foundry open source project?
No, the RabbitMQ service is not a part of the Cloud Foundry open source project.

### Do I need to update vmc to use the RabbitMQ service?
No, you do not need to update vmc to use the RabbitMQ service. But note that vmc continues to be enhanced, so you should occasionally update it with the rubygems command gem update vmc

### Where can I ask questions or send feedback about the service?
Please ask your questions on the forums at [support.cloudfoundry.com](http://support.cloudfoundry.com) or on [StackOverflow](http://stackoverflow.com/questions/tagged/cloudfoundry).;T;
I"Ç<h3 id="what-is-the-rabbitmq-service">What is the RabbitMQ service?</h3>
<p>The RabbitMQ service on Cloud Foundry brings the messaging functionality of RabbitMQ to developers building applications on Cloud Foundry. Like the rest of CloudFoundry.com, the RabbitMQ service is currently offered as a free beta service.</p>

<h3 id="what-is-rabbitmq">What is RabbitMQ?</h3>
<p>RabbitMQ is a popular open-source <a href="http://en.wikipedia.org/wiki/Message_broker">message broker</a>, developed at VMware. See the <a href="http://www.rabbitmq.com/">RabbitMQ site</a> for more details.</p>

<h3 id="how-does-the-rabbitmq-service-relate-to-cloud-foundry">How does the RabbitMQ service relate to Cloud Foundry?</h3>
<p>In addition to providing a platform for applications, Cloud Foundry provides a portfolio of on-demand services that developers can bind to their applications. Services available at the launch of Cloud Foundry included MySQL, MongoDB and Redis. The RabbitMQ service is on a par with those other services. You use the standard Cloud Foundry vmc commands (or their Spring Tool Suite equivalents) to create, bind, unbind and delete RabbitMQ services.</p>

<h3 id="which-languages-and-frameworks-can-i-use-with-the-rabbitmq-service">Which languages and frameworks can I use with the RabbitMQ service?</h3>
<p>Any that are supported by Cloud Foundry and that have an AMQP client library available.</p>

<p>We have developed applications for Cloud Foundry using the following language, framework and client library combinations:</p>

<p>Java Spring applications with <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> (version 1.0.0.RC2)
Ruby on Rails and Ruby Sinatra applications with the <a href="https://github.com/ruby-amqp/bunny">bunny gem</a> (version 0.7.4)
Node.js applications using with <a href="https://github.com/postwait/node-amqp">node-amqp</a> (version 0.1.0)</p>

<h3 id="how-do-i-get-started">How do I get started?</h3>
<p>At <a href="https://github.com/rabbitmq/rabbitmq-cloudfoundry-samples">github.com/rabbitmq/rabbitmq-cloudfoundry-samples</a> you can find introductory samples showing how to use the service from various languages and frameworks, including Spring Java, Ruby on Rails, Ruby Sinatra, and node.js. And there are detailed tutorials for <a href="http://www.rabbitmq.com/cloudfoundry/rails">Rails</a> and <a href="http://www.rabbitmq.com/cloudfoundry/spring">Spring</a> on this site.</p>

<p>You can find more information about how to develop applications using RabbitMQ, which also applies to the RabbitMQ service, on the <a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ site</a>.</p>

<h3 id="which-protocols-can-i-use-to-access-the-rabbitmq-service">Which protocols can I use to access the RabbitMQ service?</h3>
<p>Currently the service supports the core protocols of RabbitMQ: <a href="http://en.wikipedia.org/wiki/AMQP">AMQP</a> versions 0-8 and 0-9-1. In the future we plan to incorporate other protocols supported by RabbitMQ plugins. Let us know if you are interested in support for a particular protocol.</p>

<h3 id="is-the-rabbitmq-service-accessible-to-applications-outside-of-cloudfoundrycom">Is the RabbitMQ service accessible to applications outside of CloudFoundry.com?</h3>
<p>Not at present.</p>

<h3 id="which-of-the-rabbitmq-use-cases-listed-on-the-getting-startedhttpswwwrabbitmqcomgetstartedhtml-page-on-rabbitmqcom-work-with-the-rabbitmq-service">Which of the RabbitMQ use cases listed on the <a href="https://www.rabbitmq.com/getstarted.html">Getting Started</a> page on RabbitMQ.com work with the RabbitMQ service?</h3>
<p>All these use cases will work.</p>

<h3 id="does-the-rabbitmq-service-support-clustering">Does the RabbitMQ service support clustering?</h3>
<p>Not yet, but we are considering this for the future.</p>

<h3 id="which-version-of-rabbitmq-server-is-the-rabbitmq-service-based-on">Which version of rabbitmq-server is the RabbitMQ service based on?</h3>
<p>Currently rabbitmq-server-2.4.1.</p>

<h3 id="how-is-the-rabbitmq-service-priced">How is the RabbitMQ service priced?</h3>
<p>Like the rest of Cloud Foundry, it is initially offered as a free beta service.</p>

<h3 id="is-rabbitmq-now-part-of-the-cloud-foundry-open-source-project">Is RabbitMQ now part of the Cloud Foundry open source project?</h3>
<p>No, the RabbitMQ service is not a part of the Cloud Foundry open source project.</p>

<h3 id="do-i-need-to-update-vmc-to-use-the-rabbitmq-service">Do I need to update vmc to use the RabbitMQ service?</h3>
<p>No, you do not need to update vmc to use the RabbitMQ service. But note that vmc continues to be enhanced, so you should occasionally update it with the rubygems command gem update vmc</p>

<h3 id="where-can-i-ask-questions-or-send-feedback-about-the-service">Where can I ask questions or send feedback about the service?</h3>
<p>Please ask your questions on the forums at <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> or on <a href="http://stackoverflow.com/questions/tagged/cloudfoundry">StackOverflow</a>.</p>;T;@×I"!/services/managing-services/;T{;{	;I"B3<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/managing-services.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Managing Cloud Foundry Services' property='og:title'>
<meta property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Managing Cloud Foundry Services</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Managing Cloud Foundry Services</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Managing Cloud Foundry Services</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Documentation not yet available.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"%Documentation not yet available.;T;
I",<p>Documentation not yet available.</p>;T;@İI"$/services/mysql/mysql-overview/;T{;{	;I"à4<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mysql/mysql-overview.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | MySQL' property='og:title'>
<meta content='Using the MySQL Service on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | MySQL</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>MySQL</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using the MySQL Service on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resources will help you get started using the MySQL service on Cloud Foundry:</p>

<ul>
<li><a href="/services/mysql/mysql.html">Introduction to the Cloud Foundry MySQL Service</a></li>
  <li><a href="/services/mysql/grails-mysql.html">Using MySQL with Grails</a></li>
  <li><a href="/services/mysql/ruby-mysql.html">Ruby Development with the MySQL Service</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"8The following resources will help you get started using the MySQL service on Cloud Foundry:

+ [Introduction to the Cloud Foundry MySQL Service](/services/mysql/mysql.html)
+ [Using MySQL with Grails](/services/mysql/grails-mysql.html)
+ [Ruby Development with the MySQL Service](/services/mysql/ruby-mysql.html);T;
I"„<p>The following resources will help you get started using the MySQL service on Cloud Foundry:</p>

<ul>
<li><a href="/services/mysql/mysql.html">Introduction to the Cloud Foundry MySQL Service</a></li>
  <li><a href="/services/mysql/grails-mysql.html">Using MySQL with Grails</a></li>
  <li><a href="/services/mysql/ruby-mysql.html">Ruby Development with the MySQL Service</a></li>
</ul>;T;@ãI"/services/mysql/mysql/;T{;{	;I"ƒL<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mysql/mysql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | MySQL' property='og:title'>
<meta content='Introduction to the Cloud Foundry MySQL Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | MySQL</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>MySQL</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Introduction to the Cloud Foundry MySQL Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mysql" rel="tag">mysql</a><a href="/tags/overview" rel="tag">overview</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://www.mysql.com/products/community">MySQL</a>, the popular open source relational database, is provided as a service on Cloud Foundry, accessible to applications using any of the Cloud Foundry supported runtimes and frameworks. When deploying a Rails, Grails, or Spring application to Cloud Foundry, vmc or STS may automatically configure your application to use the Cloud Foundry instance. If your application cannot be automatically configured, you can get the information your application needs to connect to the database from the <a href="#the-vcap_services-environment-variable"><code>VCAP_SERVICES</code></a> environment variable.</p>

<h2 id="the-vcapservices-environment-variable">The VCAP_SERVICES Environment Variable</h2>

<p>If your application cannot be automatically configured, you must provide code to get connection information from the <code>VCAP_SERVICES</code> variable, which is set in the applicationâ€™s Cloud Foundry environment. The contents of this variable is a JSON document containing a list of all provisioned services bound to the application.</p>

<p>Following is an example JSON document (reformatted for readability) from the environment of a Cloud Foundry application with two provisioned MySQL services.</p>

<pre><code class="language-javascript"><span class="p">{</span><span class="s2">"mysql-5.1"</span><span class="o">:</span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span><span class="s2">"mysql-4f700"</span><span class="p">,</span>
        <span class="s2">"label"</span><span class="o">:</span><span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"plan"</span><span class="o">:</span><span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span><span class="o">:</span><span class="p">[</span><span class="s2">"mysql"</span><span class="p">,</span><span class="s2">"mysql-5.1"</span><span class="p">,</span><span class="s2">"relational"</span><span class="p">],</span>
        <span class="s2">"credentials"</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span><span class="s2">"d6d665aa69817406d8901cd145e05e3c6"</span><span class="p">,</span>
            <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"host"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"port"</span><span class="o">:</span><span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span><span class="o">:</span><span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"username"</span><span class="o">:</span><span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"password"</span><span class="o">:</span><span class="s2">"pzAx0iaOp2yKB"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span><span class="s2">"mysql-f1a13"</span><span class="p">,</span>
        <span class="s2">"label"</span><span class="o">:</span><span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"plan"</span><span class="o">:</span><span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span><span class="o">:</span><span class="p">[</span><span class="s2">"mysql"</span><span class="p">,</span><span class="s2">"mysql-5.1"</span><span class="p">,</span><span class="s2">"relational"</span><span class="p">],</span>
        <span class="s2">"credentials"</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span><span class="s2">"db777ab9da32047d99dd6cdae3aafebda"</span><span class="p">,</span>
            <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"host"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"port"</span><span class="o">:</span><span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span><span class="o">:</span><span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"username"</span><span class="o">:</span><span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"password"</span><span class="o">:</span><span class="s2">"p146KmfkqGYmi"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]}</span></code></pre>

<p>Retrieve the value of <code>VCAP_SERVICES</code> using your programming languageâ€™s facility for accessing OS environment variables. In Java, for example, it is <code>java.lang.System.getenv("VCAP_SERVICES")</code>; in  Ruby, <code>ENV['VCAP_SERVICES']</code>. In Node.js (JavaScript), use <code>process.env.VCAP_SERVICES</code> and in Python it is <code>os.getenv("VCAP_SERVICES")</code>.</p>

<p>Use a language-specific JSON library or module to parse the value and access the information you need.</p>

<p>The value of the <code>name</code> key can be used to distinguish between multiple MySQL instances; it is set when you create the instance using vmc or STS.</p>

<p>The <code>credentials</code> object contains all of the data you need to connect to MySQL through a driver or library.</p>

<ul>
<li>
<code>hostname</code> and <code>host</code> have the same value, which is the host where the MySQL server is running</li>
  <li>
<code>port</code> is the port where MySQL server accepts connections on the host</li>
  <li>
<code>user</code> and <code>username</code> are the name of the MySQL database user</li>
  <li>
<code>password</code> is the userâ€™s MySQL password</li>
  <li>
<code>name</code> is the name of the MySQL database</li>
</ul><p>Look for language- and framework-specific examples using MySQL in the <a href="/services.html">Services</a> section of the Cloud Foundry Getting Started Website.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÿ[MySQL](http://www.mysql.com/products/community), the popular open source relational database, is provided as a service on Cloud Foundry, accessible to applications using any of the Cloud Foundry supported runtimes and frameworks. When deploying a Rails, Grails, or Spring application to Cloud Foundry, vmc or STS may automatically configure your application to use the Cloud Foundry instance. If your application cannot be automatically configured, you can get the information your application needs to connect to the database from the [`VCAP_SERVICES`](#the-vcap_services-environment-variable) environment variable.

## The VCAP_SERVICES Environment Variable

If your application cannot be automatically configured, you must provide code to get connection information from the `VCAP_SERVICES` variable, which is set in the application's Cloud Foundry environment. The contents of this variable is a JSON document containing a list of all provisioned services bound to the application.

Following is an example JSON document (reformatted for readability) from the environment of a Cloud Foundry application with two provisioned MySQL services.

``` javascript
{"mysql-5.1":[
    {
        "name":"mysql-4f700",
        "label":"mysql-5.1",
        "plan":"free",
        "tags":["mysql","mysql-5.1","relational"],
        "credentials":{
            "name":"d6d665aa69817406d8901cd145e05e3c6",
            "hostname":"mysql-node01.us-east-1.aws.af.cm",
            "host":"mysql-node01.us-east-1.aws.af.cm",
            "port":3306,
            "user":"uB7CoL4Hxv9Ny",
            "username":"uB7CoL4Hxv9Ny",
            "password":"pzAx0iaOp2yKB"
        }
    },
    {
        "name":"mysql-f1a13",
        "label":"mysql-5.1",
        "plan":"free",
        "tags":["mysql","mysql-5.1","relational"],
        "credentials":{
            "name":"db777ab9da32047d99dd6cdae3aafebda",
            "hostname":"mysql-node01.us-east-1.aws.af.cm",
            "host":"mysql-node01.us-east-1.aws.af.cm",
            "port":3306,
            "user":"uJHApvZF6JBqT",
            "username":"uJHApvZF6JBqT",
            "password":"p146KmfkqGYmi"
        }
    }
]}
```

Retrieve the value of `VCAP_SERVICES` using your programming language's facility for accessing OS environment variables. In Java, for example, it is `java.lang.System.getenv("VCAP_SERVICES")`; in  Ruby, `ENV['VCAP_SERVICES']`. In Node.js (JavaScript), use `process.env.VCAP_SERVICES` and in Python it is `os.getenv("VCAP_SERVICES")`.

Use a language-specific JSON library or module to parse the value and access the information you need.

The value of the `name` key can be used to distinguish between multiple MySQL instances; it is set when you create the instance using vmc or STS.

The `credentials` object contains all of the data you need to connect to MySQL through a driver or library.

+ `hostname` and `host` have the same value, which is the host where the MySQL server is running
+ `port` is the port where MySQL server accepts connections on the host
+ `user` and `username` are the name of the MySQL database user
+ `password` is the user's MySQL password
+ `name` is the name of the MySQL database

Look for language- and framework-specific examples using MySQL in the [Services](/services.html) section of the Cloud Foundry Getting Started Website.;T;
I"ó<p><a href="http://www.mysql.com/products/community">MySQL</a>, the popular open source relational database, is provided as a service on Cloud Foundry, accessible to applications using any of the Cloud Foundry supported runtimes and frameworks. When deploying a Rails, Grails, or Spring application to Cloud Foundry, vmc or STS may automatically configure your application to use the Cloud Foundry instance. If your application cannot be automatically configured, you can get the information your application needs to connect to the database from the <a href="#the-vcap_services-environment-variable"><code>VCAP_SERVICES</code></a> environment variable.</p>

<h2 id="the-vcapservices-environment-variable">The VCAP_SERVICES Environment Variable</h2>

<p>If your application cannot be automatically configured, you must provide code to get connection information from the <code>VCAP_SERVICES</code> variable, which is set in the applicationâ€™s Cloud Foundry environment. The contents of this variable is a JSON document containing a list of all provisioned services bound to the application.</p>

<p>Following is an example JSON document (reformatted for readability) from the environment of a Cloud Foundry application with two provisioned MySQL services.</p>

<pre><code class="language-javascript"><span class="p">{</span><span class="s2">"mysql-5.1"</span><span class="o">:</span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span><span class="s2">"mysql-4f700"</span><span class="p">,</span>
        <span class="s2">"label"</span><span class="o">:</span><span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"plan"</span><span class="o">:</span><span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span><span class="o">:</span><span class="p">[</span><span class="s2">"mysql"</span><span class="p">,</span><span class="s2">"mysql-5.1"</span><span class="p">,</span><span class="s2">"relational"</span><span class="p">],</span>
        <span class="s2">"credentials"</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span><span class="s2">"d6d665aa69817406d8901cd145e05e3c6"</span><span class="p">,</span>
            <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"host"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"port"</span><span class="o">:</span><span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span><span class="o">:</span><span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"username"</span><span class="o">:</span><span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"password"</span><span class="o">:</span><span class="s2">"pzAx0iaOp2yKB"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span><span class="s2">"mysql-f1a13"</span><span class="p">,</span>
        <span class="s2">"label"</span><span class="o">:</span><span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"plan"</span><span class="o">:</span><span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span><span class="o">:</span><span class="p">[</span><span class="s2">"mysql"</span><span class="p">,</span><span class="s2">"mysql-5.1"</span><span class="p">,</span><span class="s2">"relational"</span><span class="p">],</span>
        <span class="s2">"credentials"</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span><span class="s2">"db777ab9da32047d99dd6cdae3aafebda"</span><span class="p">,</span>
            <span class="s2">"hostname"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"host"</span><span class="o">:</span><span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"port"</span><span class="o">:</span><span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span><span class="o">:</span><span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"username"</span><span class="o">:</span><span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"password"</span><span class="o">:</span><span class="s2">"p146KmfkqGYmi"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]}</span></code></pre>

<p>Retrieve the value of <code>VCAP_SERVICES</code> using your programming languageâ€™s facility for accessing OS environment variables. In Java, for example, it is <code>java.lang.System.getenv("VCAP_SERVICES")</code>; in  Ruby, <code>ENV['VCAP_SERVICES']</code>. In Node.js (JavaScript), use <code>process.env.VCAP_SERVICES</code> and in Python it is <code>os.getenv("VCAP_SERVICES")</code>.</p>

<p>Use a language-specific JSON library or module to parse the value and access the information you need.</p>

<p>The value of the <code>name</code> key can be used to distinguish between multiple MySQL instances; it is set when you create the instance using vmc or STS.</p>

<p>The <code>credentials</code> object contains all of the data you need to connect to MySQL through a driver or library.</p>

<ul>
<li>
<code>hostname</code> and <code>host</code> have the same value, which is the host where the MySQL server is running</li>
  <li>
<code>port</code> is the port where MySQL server accepts connections on the host</li>
  <li>
<code>user</code> and <code>username</code> are the name of the MySQL database user</li>
  <li>
<code>password</code> is the userâ€™s MySQL password</li>
  <li>
<code>name</code> is the name of the MySQL database</li>
</ul><p>Look for language- and framework-specific examples using MySQL in the <a href="/services.html">Services</a> section of the Cloud Foundry Getting Started Website.</p>;T;@éI" /services/mysql/ruby-mysql/;T{;{	;I"±E<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mysql/ruby-mysql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MySQL with Ruby' property='og:title'>
<meta content='Ruby Development with the MySQL Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MySQL with Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MySQL with Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Development with the MySQL Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/sinatra" rel="tag">sinatra</a><a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Ruby on Rails applications that use MySQL are reconfigured automatically when you deploy to Cloud Foundry.
This section describes how to access the Cloud Foundry MySQL service from other Ruby applications, such as applications that use Sinatra.</p>

<p>Install the mysql2 gem:</p>

<pre class="terminal">
$ gem install mysql2
</pre>

<p>List the gem for the database as a dependency in your applicationâ€™s Gemfile:</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"mysql2"</span></code></pre>

<p>Rails 3.0 requires mysql2 version less than 0.3.</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"mysql2"</span><span class="p">,</span> <span class="s2">"&lt; 0.3"</span></code></pre>

<p>In your application, get the connection information from the environment and connect to the database:</p>

<pre><code class="language-ruby"><span class="n">configure</span> <span class="k">do</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">mysql_key</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">svc</span><span class="o">|</span> <span class="n">svc</span> <span class="o">=~</span> <span class="sr">/mysql/i</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
    <span class="n">mysql</span> <span class="o">=</span> <span class="n">services</span><span class="o">[</span><span class="n">mysql_key</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
    <span class="n">mysql_conf</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'user'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">}</span>
    <span class="vc">@@client</span> <span class="o">=</span> <span class="no">Mysql2</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="n">mysql_conf</span>
<span class="k">end</span></code></pre>

<p>Before pushing the application to the cloud, execute these commands:</p>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials.</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push your application to Cloud Foundry. During the initial push, create the mysql Cloud Foundry service and bind it to your application, as shown in this <code>vmc push</code> transcript:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: myapp
    Application Deployed URL [myapp.cloudfoundry.com]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
    Creating Application: OK
    Would you like to bind any services to 'myapp'? [yN]: y
    The following system services are available
    1: atmos
    2: mongodb
    3: mysql
    4: postgresql
    5: rabbitmq
    6: redis
    Please select one you wish to provision: 3
    Specify the name of the service [mysql-be3ac]:
    Creating Service: OK
    Binding Service [mysql-be3ac]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (219K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"	Ruby on Rails applications that use MySQL are reconfigured automatically when you deploy to Cloud Foundry.
This section describes how to access the Cloud Foundry MySQL service from other Ruby applications, such as applications that use Sinatra.

Install the mysql2 gem:

```bash
$ gem install mysql2
```

List the gem for the database as a dependency in your application's Gemfile:

``` ruby
gem "mysql2"
```

Rails 3.0 requires mysql2 version less than 0.3.

``` ruby
gem "mysql2", "< 0.3"
```

In your application, get the connection information from the environment and connect to the database:

``` ruby
configure do
    services = JSON.parse(ENV['VCAP_SERVICES'])
    mysql_key = services.keys.select { |svc| svc =~ /mysql/i }.first
    mysql = services[mysql_key].first['credentials']
    mysql_conf = {:host => mysql['hostname'], :port => mysql['port'],
        :username => mysql['user'], :password => mysql['password']}
    @@client = Mysql2::Client.new mysql_conf
end
```

Before pushing the application to the cloud, execute these commands:

```bash
$ bundle package
$ bundle install
```

Target Cloud Foundry and log in with your Cloud Foundry credentials.

```bash
$ vmc target api.cloudfoundry.com
$ vmc login
```

Push your application to Cloud Foundry. During the initial push, create the mysql Cloud Foundry service and bind it to your application, as shown in this `vmc push` transcript:

```bash
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: myapp
    Application Deployed URL [myapp.cloudfoundry.com]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
    Creating Application: OK
    Would you like to bind any services to 'myapp'? [yN]: y
    The following system services are available
    1: atmos
    2: mongodb
    3: mysql
    4: postgresql
    5: rabbitmq
    6: redis
    Please select one you wish to provision: 3
    Specify the name of the service [mysql-be3ac]:
    Creating Service: OK
    Binding Service [mysql-be3ac]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (219K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

```;T;
I"×<p>Ruby on Rails applications that use MySQL are reconfigured automatically when you deploy to Cloud Foundry.
This section describes how to access the Cloud Foundry MySQL service from other Ruby applications, such as applications that use Sinatra.</p>

<p>Install the mysql2 gem:</p>

<pre class="terminal">
$ gem install mysql2
</pre>

<p>List the gem for the database as a dependency in your applicationâ€™s Gemfile:</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"mysql2"</span></code></pre>

<p>Rails 3.0 requires mysql2 version less than 0.3.</p>

<pre><code class="language-ruby"><span class="n">gem</span> <span class="s2">"mysql2"</span><span class="p">,</span> <span class="s2">"&lt; 0.3"</span></code></pre>

<p>In your application, get the connection information from the environment and connect to the database:</p>

<pre><code class="language-ruby"><span class="n">configure</span> <span class="k">do</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">mysql_key</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">svc</span><span class="o">|</span> <span class="n">svc</span> <span class="o">=~</span> <span class="sr">/mysql/i</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
    <span class="n">mysql</span> <span class="o">=</span> <span class="n">services</span><span class="o">[</span><span class="n">mysql_key</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
    <span class="n">mysql_conf</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'user'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">mysql</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">}</span>
    <span class="vc">@@client</span> <span class="o">=</span> <span class="no">Mysql2</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="n">mysql_conf</span>
<span class="k">end</span></code></pre>

<p>Before pushing the application to the cloud, execute these commands:</p>

<pre class="terminal">
$ bundle package
$ bundle install
</pre>

<p>Target Cloud Foundry and log in with your Cloud Foundry credentials.</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login
</pre>

<p>Push your application to Cloud Foundry. During the initial push, create the mysql Cloud Foundry service and bind it to your application, as shown in this <code>vmc push</code> transcript:</p>

<pre class="terminal">
$ vmc push
    Would you like to deploy from the current directory? [Yn]:
    Application Name: myapp
    Application Deployed URL [myapp.cloudfoundry.com]:
    Detected a Sinatra Application, is this correct? [Yn]:
    Memory Reservation (64M, 128M, 256M, 512M, 1G) [128M]:
    Creating Application: OK
    Would you like to bind any services to 'myapp'? [yN]: y
    The following system services are available
    1: atmos
    2: mongodb
    3: mysql
    4: postgresql
    5: rabbitmq
    6: redis
    Please select one you wish to provision: 3
    Specify the name of the service [mysql-be3ac]:
    Creating Service: OK
    Binding Service [mysql-be3ac]: OK
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (219K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK

</pre>;T;@ïI""/services/mysql/grails-mysql/;T{;{	;I"˜;<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/mysql/grails-mysql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using MySQL with Grails' property='og:title'>
<meta content='Grails Development with the MySQL Cloud Foundry Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using MySQL with Grails</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using MySQL with Grails</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Grails Development with the MySQL Cloud Foundry Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/groovy" rel="tag">groovy</a><a href="/tags/mysql" rel="tag">mysql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application.
All you need to access them is the <a href="http://grails.org/plugin/hibernate">Hibernate plug-in</a>, which is included by default
in all new Grails applications. You also need to make sure that the relevant driver is available to your application,
for example by declaring it in <code>BuildConfig.groovy</code>:</p>

<pre><code class="language-java"><span class="n">grails</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">dependency</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">runtime</span> <span class="s">"mysql:mysql-connector-java:5.1.18"</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>and that the JDBC driver class is set in <code>DataSource.groovy</code>:</p>

<pre><code class="language-java"><span class="n">environments</span> <span class="o">{</span>
    <span class="n">production</span> <span class="o">{</span>
        <span class="n">dataSource</span> <span class="o">{</span>
            <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>In this case, weâ€™re going to deploy the application for the standard production environment, but you could easily set
up a â€˜cloudâ€™ or similar environment. Also, you can easily configure the JDBC URL, username and password for the production
environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application.
All you need to access them is the [Hibernate plug-in](http://grails.org/plugin/hibernate), which is included by default
in all new Grails applications. You also need to make sure that the relevant driver is available to your application,
for example by declaring it in `BuildConfig.groovy`:

``` groovy
grails.project.dependency.resolution = {
    ...
    dependencies {
        runtime "mysql:mysql-connector-java:5.1.18"
        ...
    }
}
```

and that the JDBC driver class is set in `DataSource.groovy`:

``` groovy
environments {
    production {
        dataSource {
            driverClassName = "com.mysql.jdbc.Driver"
            ...
        }
    }
}
```

In this case, we're going to deploy the application for the standard production environment, but you could easily set
up a 'cloud' or similar environment. Also, you can easily configure the JDBC URL, username and password for the production
environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.;T;
I"¿<p>Currently, you can either use MySQL or PostgreSQL on Cloud Foundry if you want a relational database for your application.
All you need to access them is the <a href="http://grails.org/plugin/hibernate">Hibernate plug-in</a>, which is included by default
in all new Grails applications. You also need to make sure that the relevant driver is available to your application,
for example by declaring it in <code>BuildConfig.groovy</code>:</p>

<pre><code class="language-java"><span class="n">grails</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">dependency</span><span class="o">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">runtime</span> <span class="s">"mysql:mysql-connector-java:5.1.18"</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>and that the JDBC driver class is set in <code>DataSource.groovy</code>:</p>

<pre><code class="language-java"><span class="n">environments</span> <span class="o">{</span>
    <span class="n">production</span> <span class="o">{</span>
        <span class="n">dataSource</span> <span class="o">{</span>
            <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>In this case, weâ€™re going to deploy the application for the standard production environment, but you could easily set
up a â€˜cloudâ€™ or similar environment. Also, you can easily configure the JDBC URL, username and password for the production
environment to point to a local MySQL database because those settings are overridden when the application is deployed to Cloud Foundry.</p>;T;@õI"/services/;T{;{	;I"U<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Overview' property='og:title'>
<meta content='Application Services Provided by Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Overview</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Overview</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Application Services Provided by Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/environment" rel="tag">environment</a><a href="/tags/services" rel="tag">services</a><a href="/tags/mysql" rel="tag">mysql</a><a href="/tags/redis" rel="tag">redis</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Cloud Foundry has support for the following services:</p>

<ul>
<li>
<a href="http://www.mysql.com/">MySQL</a>, the open source relational database.</li>
  <li>
<a href="http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director/features.html">vFabric Postgres</a>, relational database based on PostgreSQL.</li>
  <li>
<a href="http://www.mongodb.org/">MongoDB</a>, the scalable, open, document-based database.</li>
  <li>
<a href="http://redis.io/">Redis</a>, the open key-value data structure server.</li>
  <li>
<a href="http://www.rabbitmq.com/">RabbitMQ</a>, for reliable, scalable, and portable messaging for your applications.</li>
</ul><p>You can run these services locally while you develop your application, or you can use <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to host your application. An advantage when using Micro Cloud Foundry is that your application runs in an environment that is very similar to Cloud Foundry. Also, with Micro Cloud Foundry, you do not have to tool your application to connect to different services for your development and deployment environments.</p>

<p>To access Cloud Foundry services from your application, you first create a service, and then bind it to your application. When your application runs on Cloud Foundry, the environment contains a <code>VCAP_SERVICES</code> variable that has information about all the services bound to the application. The content of this variable is a JSON document.</p>

<p>The following example <code>VCAP_SERVICES</code> variable contains three bound services, two MySQL databases and a Redis database. The JSON document is formatted for readability.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="s2">"mysql-5.1"</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"host"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"d6d665aa69817406d8901cd145e05e3c6"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"pzAx0iaOp2yKB"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span> <span class="o">:</span> <span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"username"</span> <span class="o">:</span> <span class="s2">"uB7CoL4Hxv9Ny"</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"mysql-4f700"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"mysql"</span><span class="p">,</span>
            <span class="s2">"mysql-5.1"</span><span class="p">,</span>
            <span class="s2">"relational"</span>
          <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"host"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"db777ab9da32047d99dd6cdae3aafebda"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"p146KmfkqGYmi"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span> <span class="o">:</span> <span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"username"</span> <span class="o">:</span> <span class="s2">"uJHApvZF6JBqT"</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"mysql-f1a13"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"mysql"</span><span class="p">,</span>
            <span class="s2">"mysql-5.1"</span><span class="p">,</span>
            <span class="s2">"relational"</span>
          <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
  <span class="s2">"redis-2.2"</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"179.30.48.44"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"redis-70d8d18a-f184-4ec6-bef4-24cae74a9b8c"</span><span class="p">,</span>
            <span class="s2">"node_id"</span> <span class="o">:</span> <span class="s2">"redis_node_5"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"c7945405-73ef-4f1a-bb64-b9e2383e92d6"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">5032</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"redis-2.2"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"redis-a42c1"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"redis"</span><span class="p">,</span>
            <span class="s2">"redis-2.2"</span><span class="p">,</span>
            <span class="s2">"key-value"</span><span class="p">,</span>
            <span class="s2">"nosql"</span>
          <span class="p">]</span>
      <span class="p">}</span> <span class="p">]</span>
<span class="p">}</span></code></pre>

<p>The document is a list of service types. Each service type contains a list of the provisioned services bound to the application. Usually, there will be just one instance of a service type, but you can create and bind multiple instances of a service type, as demonstrated by the MySQL instances in this example. Each service is described with a number of parameters, including a name and label, and a credentials object, which contains all of the information your application requires to access the service.</p>

<p>Whatever programming language or framework you use, you need to get the <code>VCAP_SERVICES</code> variable from the environment, parse it, and extract the connection information and credentials for the service you want to access. Then, you use this data to connect to the service via the library, module, or driver.</p>

<p>Application development frameworks such as Spring, Grails, and Ruby on Rails promote conventions that make it possible to automate much of the application development process. Where possible, Cloud Foundry tools take advantage of conventions and modify your applicationâ€™s configuration at deployment time to use the Cloud Foundry services bound to the application.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"şCloud Foundry has support for the following services:

+ [MySQL](http://www.mysql.com/), the open source relational database.
+ [vFabric Postgres](http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director/features.html), relational database based on PostgreSQL.
+ [MongoDB](http://www.mongodb.org/), the scalable, open, document-based database.
+ [Redis](http://redis.io/), the open key-value data structure server.
+ [RabbitMQ](http://www.rabbitmq.com/), for reliable, scalable, and portable messaging for your applications.

You can run these services locally while you develop your application, or you can use [Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html) to host your application. An advantage when using Micro Cloud Foundry is that your application runs in an environment that is very similar to Cloud Foundry. Also, with Micro Cloud Foundry, you do not have to tool your application to connect to different services for your development and deployment environments.

To access Cloud Foundry services from your application, you first create a service, and then bind it to your application. When your application runs on Cloud Foundry, the environment contains a `VCAP_SERVICES` variable that has information about all the services bound to the application. The content of this variable is a JSON document.

The following example `VCAP_SERVICES` variable contains three bound services, two MySQL databases and a Redis database. The JSON document is formatted for readability.

``` javascript
{ "mysql-5.1" : [
      { "credentials" : {
            "host" : "mysql-node01.us-east-1.aws.af.cm",
            "hostname" : "mysql-node01.us-east-1.aws.af.cm",
            "name" : "d6d665aa69817406d8901cd145e05e3c6",
            "password" : "pzAx0iaOp2yKB",
            "port" : 3306,
            "user" : "uB7CoL4Hxv9Ny",
            "username" : "uB7CoL4Hxv9Ny"
          },
        "label" : "mysql-5.1",
        "name" : "mysql-4f700",
        "plan" : "free",
        "tags" : [ "mysql",
            "mysql-5.1",
            "relational"
          ]
      },
      { "credentials" : {
            "host" : "mysql-node01.us-east-1.aws.af.cm",
            "hostname" : "mysql-node01.us-east-1.aws.af.cm",
            "name" : "db777ab9da32047d99dd6cdae3aafebda",
            "password" : "p146KmfkqGYmi",
            "port" : 3306,
            "user" : "uJHApvZF6JBqT",
            "username" : "uJHApvZF6JBqT"
          },
        "label" : "mysql-5.1",
        "name" : "mysql-f1a13",
        "plan" : "free",
        "tags" : [ "mysql",
            "mysql-5.1",
            "relational"
          ]
      }
    ],
  "redis-2.2" : [
      { "credentials" : {
            "hostname" : "179.30.48.44",
            "name" : "redis-70d8d18a-f184-4ec6-bef4-24cae74a9b8c",
            "node_id" : "redis_node_5",
            "password" : "c7945405-73ef-4f1a-bb64-b9e2383e92d6",
            "port" : 5032
          },
        "label" : "redis-2.2",
        "name" : "redis-a42c1",
        "plan" : "free",
        "tags" : [ "redis",
            "redis-2.2",
            "key-value",
            "nosql"
          ]
      } ]
}
```

The document is a list of service types. Each service type contains a list of the provisioned services bound to the application. Usually, there will be just one instance of a service type, but you can create and bind multiple instances of a service type, as demonstrated by the MySQL instances in this example. Each service is described with a number of parameters, including a name and label, and a credentials object, which contains all of the information your application requires to access the service.

Whatever programming language or framework you use, you need to get the `VCAP_SERVICES` variable from the environment, parse it, and extract the connection information and credentials for the service you want to access. Then, you use this data to connect to the service via the library, module, or driver.

Application development frameworks such as Spring, Grails, and Ruby on Rails promote conventions that make it possible to automate much of the application development process. Where possible, Cloud Foundry tools take advantage of conventions and modify your application's configuration at deployment time to use the Cloud Foundry services bound to the application.;T;
I""!<p>Cloud Foundry has support for the following services:</p>

<ul>
<li>
<a href="http://www.mysql.com/">MySQL</a>, the open source relational database.</li>
  <li>
<a href="http://www.vmware.com/products/datacenter-virtualization/vfabric-data-director/features.html">vFabric Postgres</a>, relational database based on PostgreSQL.</li>
  <li>
<a href="http://www.mongodb.org/">MongoDB</a>, the scalable, open, document-based database.</li>
  <li>
<a href="http://redis.io/">Redis</a>, the open key-value data structure server.</li>
  <li>
<a href="http://www.rabbitmq.com/">RabbitMQ</a>, for reliable, scalable, and portable messaging for your applications.</li>
</ul><p>You can run these services locally while you develop your application, or you can use <a href="/infrastructure/micro/installing-mcf.html">Micro Cloud Foundry</a> to host your application. An advantage when using Micro Cloud Foundry is that your application runs in an environment that is very similar to Cloud Foundry. Also, with Micro Cloud Foundry, you do not have to tool your application to connect to different services for your development and deployment environments.</p>

<p>To access Cloud Foundry services from your application, you first create a service, and then bind it to your application. When your application runs on Cloud Foundry, the environment contains a <code>VCAP_SERVICES</code> variable that has information about all the services bound to the application. The content of this variable is a JSON document.</p>

<p>The following example <code>VCAP_SERVICES</code> variable contains three bound services, two MySQL databases and a Redis database. The JSON document is formatted for readability.</p>

<pre><code class="language-javascript"><span class="p">{</span> <span class="s2">"mysql-5.1"</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"host"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"d6d665aa69817406d8901cd145e05e3c6"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"pzAx0iaOp2yKB"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span> <span class="o">:</span> <span class="s2">"uB7CoL4Hxv9Ny"</span><span class="p">,</span>
            <span class="s2">"username"</span> <span class="o">:</span> <span class="s2">"uB7CoL4Hxv9Ny"</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"mysql-4f700"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"mysql"</span><span class="p">,</span>
            <span class="s2">"mysql-5.1"</span><span class="p">,</span>
            <span class="s2">"relational"</span>
          <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"host"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"mysql-node01.us-east-1.aws.af.cm"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"db777ab9da32047d99dd6cdae3aafebda"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"p146KmfkqGYmi"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">3306</span><span class="p">,</span>
            <span class="s2">"user"</span> <span class="o">:</span> <span class="s2">"uJHApvZF6JBqT"</span><span class="p">,</span>
            <span class="s2">"username"</span> <span class="o">:</span> <span class="s2">"uJHApvZF6JBqT"</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"mysql-5.1"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"mysql-f1a13"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"mysql"</span><span class="p">,</span>
            <span class="s2">"mysql-5.1"</span><span class="p">,</span>
            <span class="s2">"relational"</span>
          <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">],</span>
  <span class="s2">"redis-2.2"</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"credentials"</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"179.30.48.44"</span><span class="p">,</span>
            <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"redis-70d8d18a-f184-4ec6-bef4-24cae74a9b8c"</span><span class="p">,</span>
            <span class="s2">"node_id"</span> <span class="o">:</span> <span class="s2">"redis_node_5"</span><span class="p">,</span>
            <span class="s2">"password"</span> <span class="o">:</span> <span class="s2">"c7945405-73ef-4f1a-bb64-b9e2383e92d6"</span><span class="p">,</span>
            <span class="s2">"port"</span> <span class="o">:</span> <span class="mi">5032</span>
          <span class="p">},</span>
        <span class="s2">"label"</span> <span class="o">:</span> <span class="s2">"redis-2.2"</span><span class="p">,</span>
        <span class="s2">"name"</span> <span class="o">:</span> <span class="s2">"redis-a42c1"</span><span class="p">,</span>
        <span class="s2">"plan"</span> <span class="o">:</span> <span class="s2">"free"</span><span class="p">,</span>
        <span class="s2">"tags"</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">"redis"</span><span class="p">,</span>
            <span class="s2">"redis-2.2"</span><span class="p">,</span>
            <span class="s2">"key-value"</span><span class="p">,</span>
            <span class="s2">"nosql"</span>
          <span class="p">]</span>
      <span class="p">}</span> <span class="p">]</span>
<span class="p">}</span></code></pre>

<p>The document is a list of service types. Each service type contains a list of the provisioned services bound to the application. Usually, there will be just one instance of a service type, but you can create and bind multiple instances of a service type, as demonstrated by the MySQL instances in this example. Each service is described with a number of parameters, including a name and label, and a credentials object, which contains all of the information your application requires to access the service.</p>

<p>Whatever programming language or framework you use, you need to get the <code>VCAP_SERVICES</code> variable from the environment, parse it, and extract the connection information and credentials for the service you want to access. Then, you use this data to connect to the service via the library, module, or driver.</p>

<p>Application development frameworks such as Spring, Grails, and Ruby on Rails promote conventions that make it possible to automate much of the application development process. Where possible, Cloud Foundry tools take advantage of conventions and modify your applicationâ€™s configuration at deployment time to use the Cloud Foundry services bound to the application.</p>;T;@ûI" /services/redis/ruby-redis/;T{;{	;I"DB<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/redis/ruby-redis.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using Redis with Ruby' property='og:title'>
<meta content='Ruby Application Development with the Redis Service' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using Redis with Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Using Redis with Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Ruby Application Development with the Redis Service</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/redis" rel="tag">redis</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://redis.io/">Redis</a> is an open source key-value store, also known as a NoSQL database. You set, get, update and delete information using a key.</p>

<p>For application written in Ruby, such as applications in Rails or Sinatra, follow this process:</p>

<ul>
<li>Add the gem to your applicationâ€™s Gemfile.</li>
</ul><pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'redis'</span></code></pre>

<p>Load the library into your applicationâ€™s runtime. In Rails, for instance, use the require statement in application.rb.
In Sinatra, add this to your .rb configuration file:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'redis'</span></code></pre>

<p>Configure your environment to locate the Redis service on the cloud:</p>

<pre><code class="language-ruby"><span class="n">configure</span> <span class="k">do</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">svc</span><span class="o">|</span> <span class="n">svc</span> <span class="o">=~</span> <span class="sr">/redis/i</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
    <span class="n">redis</span> <span class="o">=</span> <span class="n">services</span><span class="o">[</span><span class="n">redis_key</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
    <span class="n">redis_conf</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">}</span>
    <span class="vc">@@redis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span> <span class="n">redis_conf</span>
<span class="k">end</span></code></pre>

<p>Redis credentials are stored in the JSON-formatted VCAP_SERVICES environment variable.</p>

<p>The last line creates a class variable @@redis, available
to all subclasses in your application, that will be used at
runtime to add keys/values to Redis.</p>

<p>In your application use <a href="http://redis.io/commands">Redis commands</a> to edit and add key/values to the data store.</p>

<p>Run <code>bundle package</code> and update or add your application to the cloud:</p>

<pre class="terminal">
$ bundle package
$ vmc stop appname
$ vmc update
</pre>

<p>or, to add:</p>

<pre class="terminal">
$ bundle package
$ vmc push
</pre>

<p>Create the Redis service and bind the application to it.</p>

<pre class="terminal">
$ vmc create-service redis --bind appname
</pre>

<p>For updated applications, start again:</p>

<pre class="terminal">
$ vmc start appname
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"}[Redis](http://redis.io/) is an open source key-value store, also known as a NoSQL database. You set, get, update and delete information using a key.

For application written in Ruby, such as applications in Rails or Sinatra, follow this process:

*  Add the gem to your application's Gemfile.

``` ruby
gem 'redis'
```

Load the library into your application's runtime. In Rails, for instance, use the require statement in application.rb.
In Sinatra, add this to your .rb configuration file:

``` ruby
require 'redis'
```

Configure your environment to locate the Redis service on the cloud:

``` ruby
configure do
    services = JSON.parse(ENV['VCAP_SERVICES'])
    redis_key = services.keys.select { |svc| svc =~ /redis/i }.first
    redis = services[redis_key].first['credentials']
    redis_conf = {:host => redis['hostname'], :port => redis['port'], :password => redis['password']}
    @@redis = Redis.new redis_conf
end
```

Redis credentials are stored in the JSON-formatted VCAP_SERVICES environment variable.

The last line creates a class variable @@redis, available
to all subclasses in your application, that will be used at
runtime to add keys/values to Redis.

In your application use [Redis commands](http://redis.io/commands) to edit and add key/values to the data store.

Run `bundle package` and update or add your application to the cloud:

```bash
$ bundle package
$ vmc stop appname
$ vmc update
```

or, to add:

```bash
$ bundle package
$ vmc push
```

Create the Redis service and bind the application to it.

```bash
$ vmc create-service redis --bind appname
```

For updated applications, start again:

```bash
$ vmc start appname
```;T;
I"<p><a href="http://redis.io/">Redis</a> is an open source key-value store, also known as a NoSQL database. You set, get, update and delete information using a key.</p>

<p>For application written in Ruby, such as applications in Rails or Sinatra, follow this process:</p>

<ul>
<li>Add the gem to your applicationâ€™s Gemfile.</li>
</ul><pre><code class="language-ruby"><span class="n">gem</span> <span class="s1">'redis'</span></code></pre>

<p>Load the library into your applicationâ€™s runtime. In Rails, for instance, use the require statement in application.rb.
In Sinatra, add this to your .rb configuration file:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'redis'</span></code></pre>

<p>Configure your environment to locate the Redis service on the cloud:</p>

<pre><code class="language-ruby"><span class="n">configure</span> <span class="k">do</span>
    <span class="n">services</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'VCAP_SERVICES'</span><span class="o">]</span><span class="p">)</span>
    <span class="n">redis_key</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">svc</span><span class="o">|</span> <span class="n">svc</span> <span class="o">=~</span> <span class="sr">/redis/i</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
    <span class="n">redis</span> <span class="o">=</span> <span class="n">services</span><span class="o">[</span><span class="n">redis_key</span><span class="o">].</span><span class="n">first</span><span class="o">[</span><span class="s1">'credentials'</span><span class="o">]</span>
    <span class="n">redis_conf</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'hostname'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'port'</span><span class="o">]</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="n">redis</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span><span class="p">}</span>
    <span class="vc">@@redis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span> <span class="n">redis_conf</span>
<span class="k">end</span></code></pre>

<p>Redis credentials are stored in the JSON-formatted VCAP_SERVICES environment variable.</p>

<p>The last line creates a class variable @@redis, available
to all subclasses in your application, that will be used at
runtime to add keys/values to Redis.</p>

<p>In your application use <a href="http://redis.io/commands">Redis commands</a> to edit and add key/values to the data store.</p>

<p>Run <code>bundle package</code> and update or add your application to the cloud:</p>

<pre class="terminal">
$ bundle package
$ vmc stop appname
$ vmc update
</pre>

<p>or, to add:</p>

<pre class="terminal">
$ bundle package
$ vmc push
</pre>

<p>Create the Redis service and bind the application to it.</p>

<pre class="terminal">
$ vmc create-service redis --bind appname
</pre>

<p>For updated applications, start again:</p>

<pre class="terminal">
$ vmc start appname
</pre>;T;@I"/services/redis/redis/;T{;{	;I"+4<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/redis/redis.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Redis' property='og:title'>
<meta content='Using the Redis Service on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Redis</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Redis</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using the Redis Service on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/redis" rel="tag">redis</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resource will help you get started using the Redis service on Cloud Foundry:</p>

<ul>
<li><a href="/services/redis/ruby-redis.html">Ruby Application Development with the Redis Service</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"´The following resource will help you get started using the Redis service on Cloud Foundry:

+ [Ruby Application Development with the Redis Service](/services/redis/ruby-redis.html);T;
I"Ø<p>The following resource will help you get started using the Redis service on Cloud Foundry:</p>

<ul>
<li><a href="/services/redis/ruby-redis.html">Ruby Application Development with the Redis Service</a></li>
</ul>;T;@I"!/services/postgres/postgres/;T{;{	;I"½@<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/postgres/postgres.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Postgres' property='og:title'>
<meta content='PostgreSQL on Cloud Foundry - Frequently Asked Questions' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Postgres</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>Postgres</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>PostgreSQL on Cloud Foundry - Frequently Asked Questions</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/postgres" rel="tag">postgres</a><a href="/tags/vFabric Postgres" rel="tag">vFabric Postgres</a><a href="/tags/postgresql" rel="tag">postgresql</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><strong>Is there a tutorial for using PostgreSQL with Spring on Cloud Foundry?</strong></p>

<p><a href="http://support.cloudfoundry.com/attachments/token/th7bxzkr8dzegx8/?name=cloudfoundrypostgresql.pdf">Yes</a></p>

<p><strong>Is there a tutorial for using PostgreSQL with Ruby and Rails on Cloud Foundry?</strong></p>

<p><a href="/services/postgres/postgres-ruby.html">Yes</a></p>

<h3 id="vfabric-postgres">vFabric Postgres</h3>

<p><strong>What is the vFabric Postgres (vPostgres) service?</strong></p>

<p>The vFabric Postgres (vPostgres) service on Cloud Foundry is an object-relational database management service. The service allows developers to build vPostgre applications on Cloud Foundry. Like the rest of CloudFoundry.com, the vPostgre service is currently offered as a free Beta service.</p>

<p><strong>What is vPostgres?</strong></p>

<p>vPostgres is a new offering from VMware based on and fully compatible with PostgreSQL. Fully ACID and ANSI-SQL compliant, PostgreSQL is an enterprise class database, with a long history of mission-critical customer adoption and support from a vibrant open source community. PostgreSQL is based on Postgres version 4.2, developed at the University of California at Berkeley Computer Science Department. See the PostgreSQL Website for details: <a href="http://www.postgresql.org/">http://www.postgresql.org/</a>.</p>

<p>vPostgres is also the first database supported on vFabric Data Director.</p>

<p><strong>Which languages and frameworks can I use with the PostgreSQL service?</strong></p>

<p>Currently developers can use following language/framework to access the vPostgre service in Cloud Foundry:</p>

<ul>
<li>Java, Spring, JPA</li>
  <li>Groovy, Grails</li>
  <li>Ruby Rails</li>
</ul><p><strong>How do I get started?</strong></p>

<p>Detailed tutorials for Spring, Grails, and Ruby/Rails are available on the the <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> site and more will be provided soon.</p>

<ul>
<li>
    <p>Spring:Guestbooktutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial">http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial</a></p>
  </li>
  <li>
    <p>Grails: Petclinic tutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial">http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial</a></p>
  </li>
  <li>
    <p>RubyRails:Guestbook tutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial">http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial</a></p>
  </li>
</ul><p><strong>Which PostgreSQL version is the vPostgres service compatible with?</strong></p>

<p>Currently the service supports PostgreSQL 9.0.4.</p>

<p><strong>Where can I ask questions or send feedback about the service?</strong></p>

<p>Use one of the <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> forums.</p>

<p><a href="http://support.cloudfoundry.com/attachments/token/jv1hllw6q19js0h/?name=cloudfoundrypostgresqlfaq.pdf">PDF</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"é
**Is there a tutorial for using PostgreSQL with Spring on Cloud Foundry?**

[Yes](http://support.cloudfoundry.com/attachments/token/th7bxzkr8dzegx8/?name=cloudfoundrypostgresql.pdf)

**Is there a tutorial for using PostgreSQL with Ruby and Rails on Cloud Foundry?**

[Yes](/services/postgres/postgres-ruby.html)


###vFabric Postgres

**What is the vFabric Postgres (vPostgres) service?**

The vFabric Postgres (vPostgres) service on Cloud Foundry is an object-relational database management service. The service allows developers to build vPostgre applications on Cloud Foundry. Like the rest of CloudFoundry.com, the vPostgre service is currently offered as a free Beta service.


**What is vPostgres?**

vPostgres is a new offering from VMware based on and fully compatible with PostgreSQL. Fully ACID and ANSI-SQL compliant, PostgreSQL is an enterprise class database, with a long history of mission-critical customer adoption and support from a vibrant open source community. PostgreSQL is based on Postgres version 4.2, developed at the University of California at Berkeley Computer Science Department. See the PostgreSQL Website for details: [http://www.postgresql.org/](http://www.postgresql.org/).

vPostgres is also the first database supported on vFabric Data Director.


**Which languages and frameworks can I use with the PostgreSQL service?**

Currently developers can use following language/framework to access the vPostgre service in Cloud Foundry:

+ Java, Spring, JPA
+ Groovy, Grails
+ Ruby Rails


**How do I get started?**

Detailed tutorials for Spring, Grails, and Ruby/Rails are available on the the [support.cloudfoundry.com](http://support.cloudfoundry.com) site and more will be provided soon.

  + Spring:Guestbooktutorial:

     [http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial](http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial)

  + Grails: Petclinic tutorial:

     [http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial](http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial)

  + RubyRails:Guestbook tutorial:

     [http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial](http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial)


**Which PostgreSQL version is the vPostgres service compatible with?**

Currently the service supports PostgreSQL 9.0.4.


**Where can I ask questions or send feedback about the service?**

Use one of the [support.cloudfoundry.com](http://support.cloudfoundry.com) forums.

[PDF](http://support.cloudfoundry.com/attachments/token/jv1hllw6q19js0h/?name=cloudfoundrypostgresqlfaq.pdf);T;
I"Ã<p><strong>Is there a tutorial for using PostgreSQL with Spring on Cloud Foundry?</strong></p>

<p><a href="http://support.cloudfoundry.com/attachments/token/th7bxzkr8dzegx8/?name=cloudfoundrypostgresql.pdf">Yes</a></p>

<p><strong>Is there a tutorial for using PostgreSQL with Ruby and Rails on Cloud Foundry?</strong></p>

<p><a href="/services/postgres/postgres-ruby.html">Yes</a></p>

<h3 id="vfabric-postgres">vFabric Postgres</h3>

<p><strong>What is the vFabric Postgres (vPostgres) service?</strong></p>

<p>The vFabric Postgres (vPostgres) service on Cloud Foundry is an object-relational database management service. The service allows developers to build vPostgre applications on Cloud Foundry. Like the rest of CloudFoundry.com, the vPostgre service is currently offered as a free Beta service.</p>

<p><strong>What is vPostgres?</strong></p>

<p>vPostgres is a new offering from VMware based on and fully compatible with PostgreSQL. Fully ACID and ANSI-SQL compliant, PostgreSQL is an enterprise class database, with a long history of mission-critical customer adoption and support from a vibrant open source community. PostgreSQL is based on Postgres version 4.2, developed at the University of California at Berkeley Computer Science Department. See the PostgreSQL Website for details: <a href="http://www.postgresql.org/">http://www.postgresql.org/</a>.</p>

<p>vPostgres is also the first database supported on vFabric Data Director.</p>

<p><strong>Which languages and frameworks can I use with the PostgreSQL service?</strong></p>

<p>Currently developers can use following language/framework to access the vPostgre service in Cloud Foundry:</p>

<ul>
<li>Java, Spring, JPA</li>
  <li>Groovy, Grails</li>
  <li>Ruby Rails</li>
</ul><p><strong>How do I get started?</strong></p>

<p>Detailed tutorials for Spring, Grails, and Ruby/Rails are available on the the <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> site and more will be provided soon.</p>

<ul>
<li>
    <p>Spring:Guestbooktutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial">http://support.cloudfoundry.com/entries/20379976-postgresql-for-cloud-foundry-spring-tutorial</a></p>
  </li>
  <li>
    <p>Grails: Petclinic tutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial">http://support.cloudfoundry.com/entries/20404148-postgresql-for-cloud-foundry-grails-tutorial</a></p>
  </li>
  <li>
    <p>RubyRails:Guestbook tutorial:</p>

    <p><a href="http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial">http://support.cloudfoundry.com/entries/20404223-postgresql-for-cloud-foundry-rails-tutorial</a></p>
  </li>
</ul><p><strong>Which PostgreSQL version is the vPostgres service compatible with?</strong></p>

<p>Currently the service supports PostgreSQL 9.0.4.</p>

<p><strong>Where can I ask questions or send feedback about the service?</strong></p>

<p>Use one of the <a href="http://support.cloudfoundry.com">support.cloudfoundry.com</a> forums.</p>

<p><a href="http://support.cloudfoundry.com/attachments/token/jv1hllw6q19js0h/?name=cloudfoundrypostgresqlfaq.pdf">PDF</a></p>;T;@I"&/services/postgres/postgres-ruby/;T{;{	;I"¶C<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/services/postgres/postgres-ruby.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | PostgreSQL, Ruby' property='og:title'>
<meta content='PostgreSQL for Cloud Foundry - Rails Tutorial' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | PostgreSQL, Ruby</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Services</h1>
<p class='sub-head'>PostgreSQL, Ruby</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>PostgreSQL for Cloud Foundry - Rails Tutorial</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/postgres" rel="tag">postgres</a><a href="/tags/ruby" rel="tag">ruby</a><a href="/tags/rails" rel="tag">rails</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This tutorial explains how to use the PostgreSQL service for Cloud Foundry from a Rails 3 application.</p>

<p>In this tutorial, weâ€™ll build a very simple application that uses PostgreSQL service. Once you understand that, you will be able to integrate more realistic uses of the service into your Rails 3 applications on Cloud Foundry.</p>

<p>This tutorial goes through the whole process of creating a simple Rails 3 application on Cloud Foundry. The application manages a basic guestbook page. Every visitor can sign the guestbook by filling a simple form. All visitors that have already signed are listed with date.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Ruby 1.8 or 1.9</li>
  <li>Rubygems</li>
  <li>VMC command line tool</li>
  <li>Rails 3</li>
</ul><p>To start off, there are a few things that need to be installed on your development machine. We assume that you already have a recent version of Ruby 1.8 or 1.9 installed, and rubygems too.</p>

<p>Install Rails via rubygems:</p>

<pre class="terminal">
$ gem install rails
[...]
Successfully installed rails-3.0.9
</pre>

<p>Install VMC command line tool:</p>

<pre class="terminal">
$ gem install vmc
Fetching: vmc-0.3.12.gem (100%)
Successfully installed vmc-0.3.12
1 gem installed
</pre>

<h2 id="create-a-rails-3-application">Create a Rails 3 application</h2>

<p>Now we will create a Rails 3 application. We will use rails to generate a new Rails 3 application to use as our start point.</p>

<p><strong>$ rails new guestbook â€“database=postgresql</strong></p>

<p>create</p>

<p>create README</p>

<p>create Rakefile</p>

<p>[â€¦]</p>

<p><strong>$ cd guestbook</strong></p>

<p>To implement the logic, we need one table â€œEntryâ€ with two columns: one for guest name, the other for last update time. Thanks to Rails 3 framework, now we can use scaffold command to generate model, views, controller and migration for the table â€œEntryâ€.</p>

<p><strong>$ rails generate scaffold Entry name:string</strong></p>

<p>We donâ€™t need to specify the last update time explicitly, because Rails 3 framework will generate â€œupdated_atâ€ column by default.</p>

<p>Edit file app/views/entries/index.html.erb to add one line (highlighted in red color below) to show the last update time for each entry.</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/wauy78kuctleafi/?name=aurora.png" alt="aurora.png"></p>

<p>Now the application is ready to be pushed to Cloud Foundry.</p>

<h2 id="deploy-application">Deploy Application</h2>

<p>Set vmc to target the cloudfoundry.com site, and log in:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
Succesfully targeted to [http://api.cloudfoundry.com]
</pre>

<pre class="terminal">
$ vmc login
Email: [your Cloud Foundry email]
Password: [your Cloud Foundry password]
Successfully logged into [http://api.cloudfoundry.com]
</pre>

<p>Push application:</p>

<pre class="terminal">
$ vmc push
Would you like to deploy from the current directory? [Yn]: Y
Application Name: [your application name]
Application Deployed URL: '[Your application name].cloudfoundry.com'? Y
Detected a Rails Application, is this correct? [Yn]: Y
Memory Reservation [Default:256M] (64M, 128M, 256M or 512M) 64M
Creating Application: OK
Would you like to bind any services to 'guestbook-rails'? [yN]: Y
Would you like to use an existing provisioned service [yN]? N
The following system services are available:
1. mongodb
2. mysql
3. postgresql
4. rabbitmq
5. redis
Please select one you wish to provision: 3
Specify the name of the service [postgresql-1c51b]: [your database service name]
Creating Service: OK
Binding Service: OK
Uploading Application:
 Checking for available resources: OK
 Processing resources: OK
 Packing application: OK
 Uploading (5K): Push Status: OK
Staging Application: ...
Staging Application: OK
Starting Application: OK
</pre>

<p>Now you can go to URL http://your application name].cloudfoundry.com/entries to see the page and play with it.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ëThis tutorial explains how to use the PostgreSQL service for Cloud Foundry from a Rails 3 application.

In this tutorial, we'll build a very simple application that uses PostgreSQL service. Once you understand that, you will be able to integrate more realistic uses of the service into your Rails 3 applications on Cloud Foundry.

This tutorial goes through the whole process of creating a simple Rails 3 application on Cloud Foundry. The application manages a basic guestbook page. Every visitor can sign the guestbook by filling a simple form. All visitors that have already signed are listed with date.

## Prerequisites

+ Ruby 1.8 or 1.9
+ Rubygems
+ VMC command line tool
+ Rails 3

To start off, there are a few things that need to be installed on your development machine. We assume that you already have a recent version of Ruby 1.8 or 1.9 installed, and rubygems too.

Install Rails via rubygems:

```bash
$ gem install rails
[...]
Successfully installed rails-3.0.9
```


Install VMC command line tool:

```bash
$ gem install vmc
Fetching: vmc-0.3.12.gem (100%)
Successfully installed vmc-0.3.12
1 gem installed
```


## Create a Rails 3 application

Now we will create a Rails 3 application. We will use rails to generate a new Rails 3 application to use as our start point.

**$ rails new guestbook --database=postgresql**

create

create README

create Rakefile

[...]

**$ cd guestbook**

To implement the logic, we need one table "Entry" with two columns: one for guest name, the other for last update time. Thanks to Rails 3 framework, now we can use scaffold command to generate model, views, controller and migration for the table "Entry".

**$ rails generate scaffold Entry name:string**

We don't need to specify the last update time explicitly, because Rails 3 framework will generate "updated_at" column by default.

Edit file app/views/entries/index.html.erb to add one line (highlighted in red color below) to show the last update time for each entry.


![aurora.png](http://support.cloudfoundry.com/attachments/token/wauy78kuctleafi/?name=aurora.png)


Now the application is ready to be pushed to Cloud Foundry.



## Deploy Application

Set vmc to target the cloudfoundry.com site, and log in:

```bash
$ vmc target api.cloudfoundry.com
Succesfully targeted to [http://api.cloudfoundry.com]
```

```bash
$ vmc login
Email: [your Cloud Foundry email]
Password: [your Cloud Foundry password]
Successfully logged into [http://api.cloudfoundry.com]
```


Push application:

```bash
$ vmc push
Would you like to deploy from the current directory? [Yn]: Y
Application Name: [your application name]
Application Deployed URL: '[Your application name].cloudfoundry.com'? Y
Detected a Rails Application, is this correct? [Yn]: Y
Memory Reservation [Default:256M] (64M, 128M, 256M or 512M) 64M
Creating Application: OK
Would you like to bind any services to 'guestbook-rails'? [yN]: Y
Would you like to use an existing provisioned service [yN]? N
The following system services are available:
1. mongodb
2. mysql
3. postgresql
4. rabbitmq
5. redis
Please select one you wish to provision: 3
Specify the name of the service [postgresql-1c51b]: [your database service name]
Creating Service: OK
Binding Service: OK
Uploading Application:
 Checking for available resources: OK
 Processing resources: OK
 Packing application: OK
 Uploading (5K): Push Status: OK
Staging Application: ...
Staging Application: OK
Starting Application: OK
```

Now you can go to URL http://your application name].cloudfoundry.com/entries to see the page and play with it.;T;
I"¨<p>This tutorial explains how to use the PostgreSQL service for Cloud Foundry from a Rails 3 application.</p>

<p>In this tutorial, weâ€™ll build a very simple application that uses PostgreSQL service. Once you understand that, you will be able to integrate more realistic uses of the service into your Rails 3 applications on Cloud Foundry.</p>

<p>This tutorial goes through the whole process of creating a simple Rails 3 application on Cloud Foundry. The application manages a basic guestbook page. Every visitor can sign the guestbook by filling a simple form. All visitors that have already signed are listed with date.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Ruby 1.8 or 1.9</li>
  <li>Rubygems</li>
  <li>VMC command line tool</li>
  <li>Rails 3</li>
</ul><p>To start off, there are a few things that need to be installed on your development machine. We assume that you already have a recent version of Ruby 1.8 or 1.9 installed, and rubygems too.</p>

<p>Install Rails via rubygems:</p>

<pre class="terminal">
$ gem install rails
[...]
Successfully installed rails-3.0.9
</pre>

<p>Install VMC command line tool:</p>

<pre class="terminal">
$ gem install vmc
Fetching: vmc-0.3.12.gem (100%)
Successfully installed vmc-0.3.12
1 gem installed
</pre>

<h2 id="create-a-rails-3-application">Create a Rails 3 application</h2>

<p>Now we will create a Rails 3 application. We will use rails to generate a new Rails 3 application to use as our start point.</p>

<p><strong>$ rails new guestbook â€“database=postgresql</strong></p>

<p>create</p>

<p>create README</p>

<p>create Rakefile</p>

<p>[â€¦]</p>

<p><strong>$ cd guestbook</strong></p>

<p>To implement the logic, we need one table â€œEntryâ€ with two columns: one for guest name, the other for last update time. Thanks to Rails 3 framework, now we can use scaffold command to generate model, views, controller and migration for the table â€œEntryâ€.</p>

<p><strong>$ rails generate scaffold Entry name:string</strong></p>

<p>We donâ€™t need to specify the last update time explicitly, because Rails 3 framework will generate â€œupdated_atâ€ column by default.</p>

<p>Edit file app/views/entries/index.html.erb to add one line (highlighted in red color below) to show the last update time for each entry.</p>

<p><img src="http://support.cloudfoundry.com/attachments/token/wauy78kuctleafi/?name=aurora.png" alt="aurora.png"></p>

<p>Now the application is ready to be pushed to Cloud Foundry.</p>

<h2 id="deploy-application">Deploy Application</h2>

<p>Set vmc to target the cloudfoundry.com site, and log in:</p>

<pre class="terminal">
$ vmc target api.cloudfoundry.com
Succesfully targeted to [http://api.cloudfoundry.com]
</pre>

<pre class="terminal">
$ vmc login
Email: [your Cloud Foundry email]
Password: [your Cloud Foundry password]
Successfully logged into [http://api.cloudfoundry.com]
</pre>

<p>Push application:</p>

<pre class="terminal">
$ vmc push
Would you like to deploy from the current directory? [Yn]: Y
Application Name: [your application name]
Application Deployed URL: '[Your application name].cloudfoundry.com'? Y
Detected a Rails Application, is this correct? [Yn]: Y
Memory Reservation [Default:256M] (64M, 128M, 256M or 512M) 64M
Creating Application: OK
Would you like to bind any services to 'guestbook-rails'? [yN]: Y
Would you like to use an existing provisioned service [yN]? N
The following system services are available:
1. mongodb
2. mysql
3. postgresql
4. rabbitmq
5. redis
Please select one you wish to provision: 3
Specify the name of the service [postgresql-1c51b]: [your database service name]
Creating Service: OK
Binding Service: OK
Uploading Application:
 Checking for available resources: OK
 Processing resources: OK
 Packing application: OK
 Uploading (5K): Push Status: OK
Staging Application: ...
Staging Application: OK
Starting Application: OK
</pre>

<p>Now you can go to URL http://your application name].cloudfoundry.com/entries to see the page and play with it.</p>;T;@I"/tools/spring-insight/;T{;{	;I"WY<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/spring-insight.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Insight' property='og:title'>
<meta content='Using Spring Insight to trace Java applications' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Insight</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Spring Insight</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using Spring Insight to trace Java applications</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/performance-monitoring" rel="tag">performance-monitoring</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Spring Insight is a Cloud Foundry service that gives you real-time visibility into your deployed applications.  Spring Insight graphs the health of your applications over time so that you can immediately see any performance problems in your application as they occur.</p>

<p>Spring Insight captures Web application events known as <em>traces</em>. A trace represents a thread of execution. It is usually started by an HTTP request but can also be started by a background job. A trace contains operations, which represent significant points in the execution of the trace, for example, a JDBC query or transaction commit. Insight uses trace data to calculate summary information and to lead you to the specifics of why your application is not performing as well as it should be.</p>

<p>For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see <a href="http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html">Using Spring Insight</a>.   Although that documentation specifically applies to Spring Insight running in a non-Cloud Foundry environment (such as a standalone tc Runtime instance), the usage of the <strong>Browse Resources</strong>, <strong>Recent Activity</strong>, and <strong>Administration</strong> tabs is similar.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#installing-spring-insight-in-your-cloud-foundry-account-and-enabling-your-applications">Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications</a></li>
  <li><a href="#how-spring-insight-works-with-cloud-foundry">How Spring Insight Works With Cloud Foundry</a></li>
  <li><a href="#spring-insights-impact-on-cloud-foundry-quotas">Spring Insightâ€™s Impact on Cloud Foundry Quotas</a></li>
  <li><a href="#configuring-application-and-insight-memory-settings">Configuring Application and Insight Memory Settings</a></li>
</ul><h2 id="installing-spring-insight-in-your-cloud-foundry-account-and-enabling-your-applications">Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications</h2>

<ul>
<li>
    <p>In your browser, go to the <a href="http://insight.cloudfoundry.com/">Spring Insight for Cloud Foundry</a> Web site and log in using your Cloud Foundry credentials.</p>

    <p>The first time you login, Spring Insight automatically installs itself into your Cloud Foundry account and creates and binds to a RabbitMQ service instance.  This takes a few seconds.  When the installation is complete, you will be redirected to your personal Spring Insight dashboard which lists all the applications you have deployed to Cloud Foundry:</p>

    <p><img src="/images/screenshots/spring-insight/insight-cf-app.png" alt="insight-cf-app.png" title="insight dashboard"></p>

    <p>When you subsequently browse and login to the <a href="http://insight.cloudfoundry.com/">Spring Insight for Cloud Foundry</a> Web site, you will be automatically redirected to your dashboard.</p>

    <p>The <strong>Cloud Foundry &gt; Applications</strong> screen lists your deployed applications; by default, Spring Insight is disabled for each one.</p>
  </li>
  <li>
    <p>To enable Insight for an application, click on its name in the list on the left, then click <code>enable</code> in the right frame (see #2 in the image above.)   In the background, Insight installs and associates an agent with your application.</p>

    <p>Currently, only Java, Spring, and Grails Web applications can be enabled for Spring Insight.  You will know whether one of your deployed applications can be enabled for Spring Insight because it will have a leaf icon next to it in the list (see #1 in the image above.)</p>
  </li>
  <li>
    <p>Click the <strong>Cloud Foundry &gt; Environment</strong> tab to view information about the available and provisioned service instances in your Cloud Foundry account.  Spring Insight itself is bound to a provisioned RabbitMQ service instance, as shown below:</p>

    <p><img src="/images/screenshots/spring-insight/insight-cf-env.png" alt="insight-cf-env.png" title="insight dashboard environment"></p>
  </li>
  <li>
    <p>To start actually using Spring Insight to monitor the performance of your applications, click the <strong>Browse Resources</strong> tab.  This screen shows the overall health of your application.  Note that only applications that have been enabled for Insight, and have had some recent activity, will show up in the list on the left.</p>

    <p>Click the <strong>Recent Activity</strong> tab to view the recent traces associated with your applications into which you can drill down.</p>
  </li>
</ul><p>For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see <a href="http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html">Using Spring Insight</a>.</p>

<h2 id="how-spring-insight-works-with-cloud-foundry">How Spring Insight Works With Cloud Foundry</h2>

<p>When you install Spring Insight in your Cloud Foundry Account, Insight shows up as a deployed application, just like any other application you might have previously deployed.  Its name is <code>Insight-&lt;id&gt;</code>, where <code>id</code> is a unique identifier.  You can manage the Insight application just like any other, including deleting it with the <code>vmc delete</code> command.  This has the effect of deleting your dashboard; you can recreate it using the procedure above.</p>

<p>When you enable one of your deployed application for Spring Insight, Insight binds itself to your application as if it were a service, and shows up accordingly when you execute <code>vmc apps</code>.  For example:</p>

<pre class="terminal">
$prompt vmc apps

+----------------+----+---------+---------------------------------+-----------------+
| Application    | #  | Health  | URLS                            | Services        |
+----------------+----+---------+---------------------------------+-----------------+
| Insight-18fe44 | 1  | RUNNING | insight-18fe44.cloudfoundry.com | Insight-18fe441 |
| hello          | 1  | RUNNING | hello-js.cloudfoundry.com       |                 |
| hotels         | 1  | RUNNING | hotels-js.cloudfoundry.com      | Insight-18fe441 |
+----------------+----+---------+---------------------------------+-----------------+

</pre>

<p>The Insight application uses a RabbitMQ service instance, which you can also see by executing <code>vmc services</code>. For example:</p>

<pre class="terminal">
$prompt vmc services

============== System Services ==============

+------------+---------+---------------------------------------+
| Service    | Version | Description                           |
+------------+---------+---------------------------------------+
| mongodb    | 2.0     | MongoDB NoSQL store                   |
| mysql      | 5.1     | MySQL database service                |
| postgresql | 9.0     | vFabric Postgres database service     |
| rabbitmq   | 2.4     | RabbitMQ messaging service            |
| redis      | 2.2     | Redis key-value store service         |
+------------+---------+---------------------------------------+

=========== Provisioned Services ============

+-----------------+----------+
| Name            | Service  |
+-----------------+----------+
| Insight-18fe441 | rabbitmq |
+-----------------+----------+

</pre>

<h2 id="spring-insights-impact-on-cloud-foundry-quotas">Spring Insightâ€™s Impact on Cloud Foundry Quotas</h2>

<p>The Insight dashboard is a Web application installed on your Cloud Foundry account.  With respect to your quota, it counts as one application and uses 512 MB of memory.</p>

<p>Spring Insight also provisions a RabbitMQ service instance that the Insight agents use to communicate with the Insight dashboard. The RabbitMQ service counts as one service of your Cloud Foundry quota.</p>

<p>Finally, each application that you have enabled for Insight will require additional memory. While this varies with the load and instrumentation, Cloud Foundry recommends that when you deploy an application that you want to monitor with Insight, you should use at least 256 MB of your memory quota.</p>

<h2 id="configuring-application-and-insight-memory-settings">Configuring Application and Insight Memory Settings</h2>

<p>When determining how much memory your application is consuming, Cloud Foundry uses the corresponding processâ€™ RSS (resident set size).  If the RSS grows beyond your applicationâ€™s configured memory threshold, Cloud Foundry will stop or kill it. This has special implications in Java, because an applicationâ€™s maximum heap usage is often well below the RSS.</p>

<p>To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.</p>

<p>For instance, if your application runs with around 256 MB, but does not hit that limit, use the following <code>vmc</code> commands to change change the memory settings:</p>

<pre class="terminal">
prompt$ vmc mem my-application 300m
prompt$ vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
</pre>

<p>Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications that do not hit their max heap.  But Insight-enabled applications are more likely to hit these limits due to the reliance on JVM datastructures outside of the heap, on PermGen and in the code cache.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Ï!Spring Insight is a Cloud Foundry service that gives you real-time visibility into your deployed applications.  Spring Insight graphs the health of your applications over time so that you can immediately see any performance problems in your application as they occur.

Spring Insight captures Web application events known as *traces*. A trace represents a thread of execution. It is usually started by an HTTP request but can also be started by a background job. A trace contains operations, which represent significant points in the execution of the trace, for example, a JDBC query or transaction commit. Insight uses trace data to calculate summary information and to lead you to the specifics of why your application is not performing as well as it should be.

For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see [Using Spring Insight](http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html).   Although that documentation specifically applies to Spring Insight running in a non-Cloud Foundry environment (such as a standalone tc Runtime instance), the usage of the **Browse Resources**, **Recent Activity**, and **Administration** tabs is similar.

**Subtopics**

+ [Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications](#installing-spring-insight-in-your-cloud-foundry-account-and-enabling-your-applications)
+ [How Spring Insight Works With Cloud Foundry](#how-spring-insight-works-with-cloud-foundry)
+ [Spring Insight's Impact on Cloud Foundry Quotas](#spring-insights-impact-on-cloud-foundry-quotas)
+ [Configuring Application and Insight Memory Settings](#configuring-application-and-insight-memory-settings)

##Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications

*  In your browser, go to the [Spring Insight for Cloud Foundry](http://insight.cloudfoundry.com/) Web site and log in using your Cloud Foundry credentials.

    The first time you login, Spring Insight automatically installs itself into your Cloud Foundry account and creates and binds to a RabbitMQ service instance.  This takes a few seconds.  When the installation is complete, you will be redirected to your personal Spring Insight dashboard which lists all the applications you have deployed to Cloud Foundry:

    ![insight-cf-app.png](/images/screenshots/spring-insight/insight-cf-app.png "insight dashboard")

    When you subsequently browse and login to the [Spring Insight for Cloud Foundry](http://insight.cloudfoundry.com/) Web site, you will be automatically redirected to your dashboard.

    The **Cloud Foundry > Applications** screen lists your deployed applications; by default, Spring Insight is disabled for each one.

*  To enable Insight for an application, click on its name in the list on the left, then click `enable` in the right frame (see #2 in the image above.)   In the background, Insight installs and associates an agent with your application.

    Currently, only Java, Spring, and Grails Web applications can be enabled for Spring Insight.  You will know whether one of your deployed applications can be enabled for Spring Insight because it will have a leaf icon next to it in the list (see #1 in the image above.)

*  Click the **Cloud Foundry > Environment** tab to view information about the available and provisioned service instances in your Cloud Foundry account.  Spring Insight itself is bound to a provisioned RabbitMQ service instance, as shown below:

    ![insight-cf-env.png](/images/screenshots/spring-insight/insight-cf-env.png "insight dashboard environment")

*  To start actually using Spring Insight to monitor the performance of your applications, click the **Browse Resources** tab.  This screen shows the overall health of your application.  Note that only applications that have been enabled for Insight, and have had some recent activity, will show up in the list on the left.

    Click the **Recent Activity** tab to view the recent traces associated with your applications into which you can drill down.

For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see [Using Spring Insight](http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html).

##How Spring Insight Works With Cloud Foundry

When you install Spring Insight in your Cloud Foundry Account, Insight shows up as a deployed application, just like any other application you might have previously deployed.  Its name is `Insight-<id>`, where `id` is a unique identifier.  You can manage the Insight application just like any other, including deleting it with the `vmc delete` command.  This has the effect of deleting your dashboard; you can recreate it using the procedure above.

When you enable one of your deployed application for Spring Insight, Insight binds itself to your application as if it were a service, and shows up accordingly when you execute `vmc apps`.  For example:

```bash
$prompt vmc apps

+----------------+----+---------+---------------------------------+-----------------+
| Application    | #  | Health  | URLS                            | Services        |
+----------------+----+---------+---------------------------------+-----------------+
| Insight-18fe44 | 1  | RUNNING | insight-18fe44.cloudfoundry.com | Insight-18fe441 |
| hello          | 1  | RUNNING | hello-js.cloudfoundry.com       |                 |
| hotels         | 1  | RUNNING | hotels-js.cloudfoundry.com      | Insight-18fe441 |
+----------------+----+---------+---------------------------------+-----------------+

```

The Insight application uses a RabbitMQ service instance, which you can also see by executing `vmc services`. For example:

```bash
$prompt vmc services

============== System Services ==============

+------------+---------+---------------------------------------+
| Service    | Version | Description                           |
+------------+---------+---------------------------------------+
| mongodb    | 2.0     | MongoDB NoSQL store                   |
| mysql      | 5.1     | MySQL database service                |
| postgresql | 9.0     | vFabric Postgres database service     |
| rabbitmq   | 2.4     | RabbitMQ messaging service            |
| redis      | 2.2     | Redis key-value store service         |
+------------+---------+---------------------------------------+

=========== Provisioned Services ============

+-----------------+----------+
| Name            | Service  |
+-----------------+----------+
| Insight-18fe441 | rabbitmq |
+-----------------+----------+

```

## Spring Insight's Impact on Cloud Foundry Quotas

The Insight dashboard is a Web application installed on your Cloud Foundry account.  With respect to your quota, it counts as one application and uses 512 MB of memory.

Spring Insight also provisions a RabbitMQ service instance that the Insight agents use to communicate with the Insight dashboard. The RabbitMQ service counts as one service of your Cloud Foundry quota.

Finally, each application that you have enabled for Insight will require additional memory. While this varies with the load and instrumentation, Cloud Foundry recommends that when you deploy an application that you want to monitor with Insight, you should use at least 256 MB of your memory quota.

##Configuring Application and Insight Memory Settings

When determining how much memory your application is consuming, Cloud Foundry uses the corresponding process' RSS (resident set size).  If the RSS grows beyond your application's configured memory threshold, Cloud Foundry will stop or kill it. This has special implications in Java, because an application's maximum heap usage is often well below the RSS.

To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.

For instance, if your application runs with around 256 MB, but does not hit that limit, use the following `vmc` commands to change change the memory settings:

```bash
prompt$ vmc mem my-application 300m
prompt$ vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
```

Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications that do not hit their max heap.  But Insight-enabled applications are more likely to hit these limits due to the reliance on JVM datastructures outside of the heap, on PermGen and in the code cache.;T;
I"‘%<p>Spring Insight is a Cloud Foundry service that gives you real-time visibility into your deployed applications.  Spring Insight graphs the health of your applications over time so that you can immediately see any performance problems in your application as they occur.</p>

<p>Spring Insight captures Web application events known as <em>traces</em>. A trace represents a thread of execution. It is usually started by an HTTP request but can also be started by a background job. A trace contains operations, which represent significant points in the execution of the trace, for example, a JDBC query or transaction commit. Insight uses trace data to calculate summary information and to lead you to the specifics of why your application is not performing as well as it should be.</p>

<p>For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see <a href="http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html">Using Spring Insight</a>.   Although that documentation specifically applies to Spring Insight running in a non-Cloud Foundry environment (such as a standalone tc Runtime instance), the usage of the <strong>Browse Resources</strong>, <strong>Recent Activity</strong>, and <strong>Administration</strong> tabs is similar.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#installing-spring-insight-in-your-cloud-foundry-account-and-enabling-your-applications">Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications</a></li>
  <li><a href="#how-spring-insight-works-with-cloud-foundry">How Spring Insight Works With Cloud Foundry</a></li>
  <li><a href="#spring-insights-impact-on-cloud-foundry-quotas">Spring Insightâ€™s Impact on Cloud Foundry Quotas</a></li>
  <li><a href="#configuring-application-and-insight-memory-settings">Configuring Application and Insight Memory Settings</a></li>
</ul><h2 id="installing-spring-insight-in-your-cloud-foundry-account-and-enabling-your-applications">Installing Spring Insight In Your Cloud Foundry Account and Enabling Your Applications</h2>

<ul>
<li>
    <p>In your browser, go to the <a href="http://insight.cloudfoundry.com/">Spring Insight for Cloud Foundry</a> Web site and log in using your Cloud Foundry credentials.</p>

    <p>The first time you login, Spring Insight automatically installs itself into your Cloud Foundry account and creates and binds to a RabbitMQ service instance.  This takes a few seconds.  When the installation is complete, you will be redirected to your personal Spring Insight dashboard which lists all the applications you have deployed to Cloud Foundry:</p>

    <p><img src="/images/screenshots/spring-insight/insight-cf-app.png" alt="insight-cf-app.png" title="insight dashboard"></p>

    <p>When you subsequently browse and login to the <a href="http://insight.cloudfoundry.com/">Spring Insight for Cloud Foundry</a> Web site, you will be automatically redirected to your dashboard.</p>

    <p>The <strong>Cloud Foundry &gt; Applications</strong> screen lists your deployed applications; by default, Spring Insight is disabled for each one.</p>
  </li>
  <li>
    <p>To enable Insight for an application, click on its name in the list on the left, then click <code>enable</code> in the right frame (see #2 in the image above.)   In the background, Insight installs and associates an agent with your application.</p>

    <p>Currently, only Java, Spring, and Grails Web applications can be enabled for Spring Insight.  You will know whether one of your deployed applications can be enabled for Spring Insight because it will have a leaf icon next to it in the list (see #1 in the image above.)</p>
  </li>
  <li>
    <p>Click the <strong>Cloud Foundry &gt; Environment</strong> tab to view information about the available and provisioned service instances in your Cloud Foundry account.  Spring Insight itself is bound to a provisioned RabbitMQ service instance, as shown below:</p>

    <p><img src="/images/screenshots/spring-insight/insight-cf-env.png" alt="insight-cf-env.png" title="insight dashboard environment"></p>
  </li>
  <li>
    <p>To start actually using Spring Insight to monitor the performance of your applications, click the <strong>Browse Resources</strong> tab.  This screen shows the overall health of your application.  Note that only applications that have been enabled for Insight, and have had some recent activity, will show up in the list on the left.</p>

    <p>Click the <strong>Recent Activity</strong> tab to view the recent traces associated with your applications into which you can drill down.</p>
  </li>
</ul><p>For detailed information about using Spring Insight and how to interpret and filter the performance information it displays, see <a href="http://pubs.vmware.com:8080/vfabric5/topic/com.vmware.vfabric.tc-server.2.6/operations/using-browsing-resources.html">Using Spring Insight</a>.</p>

<h2 id="how-spring-insight-works-with-cloud-foundry">How Spring Insight Works With Cloud Foundry</h2>

<p>When you install Spring Insight in your Cloud Foundry Account, Insight shows up as a deployed application, just like any other application you might have previously deployed.  Its name is <code>Insight-&lt;id&gt;</code>, where <code>id</code> is a unique identifier.  You can manage the Insight application just like any other, including deleting it with the <code>vmc delete</code> command.  This has the effect of deleting your dashboard; you can recreate it using the procedure above.</p>

<p>When you enable one of your deployed application for Spring Insight, Insight binds itself to your application as if it were a service, and shows up accordingly when you execute <code>vmc apps</code>.  For example:</p>

<pre class="terminal">
$prompt vmc apps

+----------------+----+---------+---------------------------------+-----------------+
| Application    | #  | Health  | URLS                            | Services        |
+----------------+----+---------+---------------------------------+-----------------+
| Insight-18fe44 | 1  | RUNNING | insight-18fe44.cloudfoundry.com | Insight-18fe441 |
| hello          | 1  | RUNNING | hello-js.cloudfoundry.com       |                 |
| hotels         | 1  | RUNNING | hotels-js.cloudfoundry.com      | Insight-18fe441 |
+----------------+----+---------+---------------------------------+-----------------+

</pre>

<p>The Insight application uses a RabbitMQ service instance, which you can also see by executing <code>vmc services</code>. For example:</p>

<pre class="terminal">
$prompt vmc services

============== System Services ==============

+------------+---------+---------------------------------------+
| Service    | Version | Description                           |
+------------+---------+---------------------------------------+
| mongodb    | 2.0     | MongoDB NoSQL store                   |
| mysql      | 5.1     | MySQL database service                |
| postgresql | 9.0     | vFabric Postgres database service     |
| rabbitmq   | 2.4     | RabbitMQ messaging service            |
| redis      | 2.2     | Redis key-value store service         |
+------------+---------+---------------------------------------+

=========== Provisioned Services ============

+-----------------+----------+
| Name            | Service  |
+-----------------+----------+
| Insight-18fe441 | rabbitmq |
+-----------------+----------+

</pre>

<h2 id="spring-insights-impact-on-cloud-foundry-quotas">Spring Insightâ€™s Impact on Cloud Foundry Quotas</h2>

<p>The Insight dashboard is a Web application installed on your Cloud Foundry account.  With respect to your quota, it counts as one application and uses 512 MB of memory.</p>

<p>Spring Insight also provisions a RabbitMQ service instance that the Insight agents use to communicate with the Insight dashboard. The RabbitMQ service counts as one service of your Cloud Foundry quota.</p>

<p>Finally, each application that you have enabled for Insight will require additional memory. While this varies with the load and instrumentation, Cloud Foundry recommends that when you deploy an application that you want to monitor with Insight, you should use at least 256 MB of your memory quota.</p>

<h2 id="configuring-application-and-insight-memory-settings">Configuring Application and Insight Memory Settings</h2>

<p>When determining how much memory your application is consuming, Cloud Foundry uses the corresponding processâ€™ RSS (resident set size).  If the RSS grows beyond your applicationâ€™s configured memory threshold, Cloud Foundry will stop or kill it. This has special implications in Java, because an applicationâ€™s maximum heap usage is often well below the RSS.</p>

<p>To avoid a scenario in which the RSS is exceeded without hitting the maximum heap usage, increase the memory allocated to your application, or decrease its heap size.</p>

<p>For instance, if your application runs with around 256 MB, but does not hit that limit, use the following <code>vmc</code> commands to change change the memory settings:</p>

<pre class="terminal">
prompt$ vmc mem my-application 300m
prompt$ vmc env-add my-application INSIGHT_OVERRIDES="-Xmx200m"
</pre>

<p>Note that this modification of memory settings is not specific to Insight; Cloud Foundry will kill regular Java applications that do not hit their max heap.  But Insight-enabled applications are more likely to hit these limits due to the reliance on JVM datastructures outside of the heap, on PermGen and in the code cache.</p>;T;@I"/tools/deploying-apps/;T{;{	;I"D<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/deploying-apps.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Deploying and Managing Applications' property='og:title'>
<meta content='Managing Applications on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Deploying and Managing Applications</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Deploying and Managing Applications</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Managing Applications on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/overview" rel="tag">overview</a><a href="/tags/vmc" rel="tag">vmc</a><a href="/tags/sts" rel="tag">sts</a><a href="/tags/maven" rel="tag">maven</a><a href="/tags/roo" rel="tag">roo</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>In the context of Cloud Foundry, deploying an application simply means making it available for users to start using.   When you deploy an application, you push the actual application bits (such as a WAR file in the case of Spring Java) to your target cloud, specify the required application configuration such as the deployment URL and required memory, and binding any required services such as MySQL.  Cloud Foundry then stages the application, starts it, and makes it available at the specified URL so users can use it.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#using-vmc">Using VMC</a></li>
  <li><a href="#using-sts">Using STS</a></li>
  <li><a href="#using-maven">Using Maven</a></li>
  <li><a href="#using-roo">Using Roo</a></li>
</ul><h2 id="using-vmc">Using VMC</h2>

<p>The following user scenarios are described in this documentation:</p>

<ul>
<li><a href="#deploying-an-application-that-does-not-require-a-service">Deploying an Application That Does Not Require a Service</a></li>
  <li><a href="#deploying-an-application-that-requires-one-service">Deploying an Application That Requires One Service</a></li>
  <li><a href="#deploying-an-application-that-requires-multiple-services">Deploying an Application That Requires Multiple Services</a></li>
  <li><a href="#deploying-in-non-interactive-mode">Deploying in Non-Interactive Mode</a></li>
  <li><a href="#managing-the-application-lifecycle-stop-start-restart-delete-rename">Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)</a></li>
  <li><a href="#updating-the-deployment-bits">Updating The Deployment Bits</a></li>
  <li><a href="#avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</a></li>
  <li><a href="#monitoring-and-configuring-a-deployment-scaling-and-memory-management">Monitoring and Configuring A Deployment (Scaling and Memory Management)</a></li>
</ul><h2 id="deploying-an-application-that-does-not-require-a-service">Deploying an Application That Does Not Require a Service</h2>

<p>You use the <code>vmc push</code> command to deploy applications using VMC.  By default, <code>vmc</code> interactively prompts for the required deployment information; alternatively you can specify parameters to override the defaults or run in non-interactive mode.</p>

<p>The simplest deployment example is to run <code>vmc push</code> with no parameters to deploy an application that does not require any services to be bound to it.  The <code>vmc push</code> command will prompt for all required information.  The following example shows the output from deploying a very simple Spring application that is packaged in a WAR file called <code>hello.war</code>; see the text after the example for additional information:</p>

<pre class="terminal">
    prompt$ vmc push

    Would you like to deploy from the current directory? [Yn]:
    Application Name: hello
    Application Deployed URL: 'hello.cloudfoundry.com'? hello-js.cloudfoundry.com
    Detected a Java SpringSource Spring Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
    Creating Application: OK
    Would you like to bind any services to 'hello'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK

    Staging Application: OK
    Starting Application: OK

</pre>

<p>Go to the specified deployment URL in your browser to start using the application.  In the example above, that would be:</p>

<pre><code>    http://hello-js.cloudfoundry.com
</code></pre>

<p>Note the following about the preceding <code>vmc push</code> example:</p>

<ul>
<li>The default value of yes/no prompts is shown in capital letters at the end of the prompt; for example, if the default answer is No, then the prompt ends in <code>[yN]</code>.</li>
  <li>You can deploy from the current directory in which you are running VMC, or specify a different directory. This directory is the location of the actual application bits, such as the <code>hello.war</code> file.   <strong>Note</strong> that <code>vmc push</code> deploys ALL artifacts in the specified directory, so be sure that only those files you want deployed are physically located in the directory.</li>
  <li>The name of the application is the one you use to identify it as you mange its lifecycle, such as stopping it, adding memory to it, and so on.   The scope of the name is your Cloud Foundry account, which means the name should be unique as far as your account but does not need to be unique across the entire Cloud Foundry target.</li>
  <li>By default, the deployment URL is the application name along with the target (for example, <code>cloudfoundry.com</code>).  However, you must be sure to specify a deployment URL that is <em>unique</em> across the entire Cloud Foundry target, even though the name of the application must be unique only within the scope of your Cloud Foundry account.  This is why, in the example above, the deployment URL includes an identifier that makes it unique across the entire cloudfoundry.com Web site.</li>
</ul><h2 id="deploying-an-application-that-requires-one-service">Deploying an Application That Requires One Service</h2>

<p>The following example shows how to deploy an application that requires a service (in this case a MySQL service).   The application is called <code>hotels.war</code>.</p>

<p>In our example, we will first create an instance of the MySQL service using the <code>vmc create-service</code> command, and then bind this service instance to the application when we deploy it with <code>vmc push</code>.u</p>

<p>It is important to note that you do not need to change your existing application in any way for it to â€œfindâ€ the MySQL instance that Cloud Foundry created and to which the application is bound.  This is because Cloud Foundry uses an auto-reconfiguration mechanism that lets typical Spring applications consume services without changing anything in the application.</p>

<ul>
<li>Find the name of the MySQL service by running <code>vmc services</code> and noting the first column:</li>
</ul><pre class="terminal">
        prompt$ vmc services

        ============== System Services ==============

        +------------+---------+---------------------------------------+
        | Service    | Version | Description                           |
        +------------+---------+---------------------------------------+
        | mongodb    | 2.0     | MongoDB NoSQL store                   |
        | mysql      | 5.1     | MySQL database service                |
        | postgresql | 9.0     | vFabric Postgres database service     |
        | rabbitmq   | 2.4     | RabbitMQ messaging service            |
        | redis      | 2.2     | Redis key-value store service         |
        +------------+---------+---------------------------------------+

        =========== Provisioned Services ============

</pre>

<ul>
<li>Create a new instance of the <code>mysql</code> service and call it <code>mysql-js</code>:</li>
</ul><pre class="terminal">
prompt$ vmc create-service mysql mysql-js
</pre>

<ul>
<li>Deploy the <code>hotels.war</code> application, but this time bind it to the <code>mysql-js</code> service instance:</li>
</ul><pre class="terminal">
        prompt$ vmc push

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        Application Deployed URL: 'hotels.cloudfoundry.com'? hotels-js.cloudfoundry.com
        Detected a Java Web Application, is this correct? [Yn]:
        Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
        Creating Application: OK
        Would you like to bind any services to 'hotels'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. mysql-js
        Please select one you wish to provision: 1
        Binding Service: OK
        Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (12K): OK
        Push Status: OK

        Staging Application: OK

        Starting Application: OK

</pre>

<p>You can also create a new instance of a service during the <code>vmc push</code> command by answer <code>N</code> to the prompt about using a provisioned service; in this case, the <code>vmc push</code> command prompts for information about the new service instance.</p>

<h2 id="deploying-an-application-that-requires-multiple-services">Deploying an Application That Requires Multiple Services</h2>

<p>The <a href="#deploying-an-application-that-requires-one-service">preceding section</a> described how to deploy an application using the <code>vmc push</code> command and bind a service (MySQL) to it at the same time.  However, you were only able to bind <em>one</em> service, but what if your application requires multiple services?  This section describes how to perform that task.</p>

<p>This example extends the <a href="#deploying-an-application-that-requires-one-service">previous example</a> in that, in addition to binding the <code>mysql-js</code> service to the <code>hotels</code> application, it will also create and bind the MongoDB and RabbitMQ services.</p>

<ul>
<li>Create new instances of the <code>mysql</code>, <code>mongodb</code>, and <code>rabbitmq</code> services:</li>
</ul><pre class="terminal">
        prompt$ vmc create-service mysql mysql-js
        prompt$ vmc create-service mongodb mongodb-js
        prompt$ vmc create-service rabbitmq rabbitmq-js

</pre>

<ul>
<li>Deploy the <code>hotels.war</code> application and bind the <code>mysql-js</code> service instance to it.  This time, however, be sure to specify the <code>--no-start</code> option so that Cloud Foundry does not stage or start the application:</li>
</ul><pre class="terminal">
        prompt$ vmc push --no-start

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        ...
        Uploading Application:
        ...
        Push Status: OK

</pre>

<ul>
<li>Use the <code>vmc bind-service</code> to bind the two remaining services to the <code>hotels</code> application:</li>
</ul><pre class="terminal">
        prompt$ vmc bind-service mongodb-js hotels
        prompt$ vmc bind-service rabbitmq-js hotels

</pre>

<ul>
<li>Start the application:</li>
</ul><pre class="terminal">
        prompt$ vmc start hotels

        Staging Application: OK
        Starting Application: OK

</pre>

<h2 id="deploying-in-non-interactive-mode">Deploying in Non-Interactive Mode</h2>

<p>Use the <code>-n</code> option of <code>vmc push</code> to deploy an application in non-interactive mode.   The only other requirement is that you specify the name of the application.</p>

<p>If you specify no other options, then Cloud Foundry uses all the default values when deploying the application.  For example, if you execute the following command:</p>

<pre class="terminal">
    prompt$ vmc push hotels -n

</pre>

<p>then Cloud Foundry does the following:</p>

<ul>
<li>Deploys all artifacts in the current directory as part of the <code>hotels</code> application.</li>
  <li>Uses the deployment URL<code>hotels.cloudfoundry.com</code> (assuming your target is the publicly-hosted Cloud Foundry.)</li>
  <li>Creates a single instance of the deployed application.</li>
  <li>Does <em>not</em> bind any services to the application.</li>
  <li>Auto-detects the programming framework (such as Spring or Ruby)</li>
  <li>Reserves 512 MB of memory for the application</li>
  <li>Automatically starts the application after staging it.</li>
</ul><p>You can use additional options to change the default values of the deployment, and still deploy in non-interactive mode.  For example, you can change the deployment URL using the <code>--url</code> option, the reserved memory using the <code>--mem</code> option, and specify that the application not start with the following command:</p>

<pre class="terminal">
    prompt$ vmc push hotels -n --url hotels-js.cloudfoundry.com --mem 256 --no-start

</pre>

<p>See <a href="/tools/vmc/vmc-quick-ref.html#deploying-applications">VMC Quick Reference Guide</a> for the full list of parameters you can specify for the <code>vmc push</code> command.</p>

<h2 id="managing-the-application-lifecycle-stop-start-restart-delete-rename">Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)</h2>

<p>Managing the lifecycle of your application after you have deployed it is easy; just use the appropriate VMC command to stop, start, and restart it.  For example, to stop and then start an application:</p>

<pre class="terminal">
    prompt$ vmc stop hotels
    prompt$ vmc start hotels

</pre>

<p>Or to do the same task with one command:</p>

<pre class="terminal">
    prompt$ vmc restart hotels

</pre>

<p>It is important to note that when Cloud Foundry restarts an application, it creates an entire new virtual infrastructure for it.   Although this is typically transparent to the application, one situation in which this is relevant is if the application created local files on disk when it was previously running.  At restart, these files will be completely lost because Cloud Foundry creates a new virtual disk.  If the application requires that these files be available, even after a restart, then your application should use a data service such as MongoDB which will ensure that the files are always available.</p>

<p>To rename an application, use the <code>vmc rename</code> command, specifying the existing name and then the new name.  For example:</p>

<pre class="terminal">
prompt$ vmc rename hotels hotels-new-name
</pre>

<p>The <code>vmc rename</code> command changes the internal name of the application; it does not change the deployment URL that you use to run the application.  For that you would use <code>vmc map</code>. See <a href="#changing-the-deployment-url">Changing the Deployment URL</a>.</p>

<p>To delete an application, and free up all resources associated with the application, use the <code>vmc delete</code> command:</p>

<pre class="terminal">
prompt$ vmc delete hotels
</pre>

<h2 id="updating-the-deployment-bits">Updating The Deployment Bits</h2>

<p>Use the <code>vmc update &lt;appname&gt;</code> command to update the â€œbitsâ€ that make up an application, such as the packaged WAR file for a Java Spring applications.</p>

<p>When Cloud Foundry updates an application, it first stops it, makes the change, and then starts it again.  This means that the application will be unavailable for a short period of time and existing user sessions will be deleted.  During the iterative development cycle of an application, this might not be a problem, but in production scenarios this may be unaccaptable.  See <a href="#avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</a> for a useful procedure to avoid this short downtime.</p>

<p>Follow these steps to update your application:</p>

<ul>
<li>Use <code>vmc apps</code> to get the exact name of your application; the first column of the output lists the name.  For example:</li>
</ul><pre class="terminal">
        prompt$ vmc apps

        +-------------+----+---------+----------------------------+----------+
        | Application | #  | Health  | URLS                       | Services |
        +-------------+----+---------+----------------------------+----------+
        | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
        | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com |          |
        +-------------+----+---------+----------------------------+----------+

</pre>

<ul>
<li>In your command prompt (Windows) or terminal window (Linux), change to the directory that contains your updated application bits.  Be sure the directory contains <em>only</em> the files and artifacts that you want to deploy because VMC pushes all files in the directory.</li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hotels
</pre>

<ul>
<li>Use <code>vmc update</code> to update your application:</li>
</ul><pre class="terminal">
prompt$ vmc update hotels
</pre>

<pre><code>Check the output of the command to ensure the application started without errors, then start using the updated application.
</code></pre>

<h2 id="avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</h2>

<p>The method for updating an application without any downtime exploits the fact that in Cloud Foundry you can map a single application to multiple deployment URLs, and similarly, map multiple applications to the same deployment URL.   So rather than updating the application directly, we will create a new application, associate it with the existing URL, then <em>disassociate the mapping of the old application to the URL</em>, then delete the old application.</p>

<p>In the following example, the existing application is called <code>hotels</code> and its deployment URL is <code>hotels.cloudfoundry.com</code>, and you want to new user sessions to start using the new application seamlessly, without existing users losing their connection.</p>

<p>The exact steps are as follows:</p>

<ul>
<li>In your command prompt or terminal window, change to the directory that contains the updated application â€œbitsâ€.  For example:</li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hotels
</pre>

<ul>
<li>Create a new application using the <code>vmc push</code> command, call it something different from the existing application, such as <code>hotels-new</code> and also specify that its deployment URL be something different, such as <code>hotels-new.cloudfoundry.com</code>:</li>
</ul><pre class="terminal">
prompt$ vmc push hotels-new
</pre>

<pre><code>Be sure you bind any required services, such as MySQL or RabbitMQ.  Use the same service instances that the existing application is currently using.
</code></pre>

<ul>
<li>
    <p>In a browser, go to the new deployment URL to test that the newly deployed application is working correctly, and that it is indeed the updated version.</p>

    <p>In our example, the deployment URL of the new application is <code>http://hotels-new.cloudfoundry.com</code>.</p>
  </li>
  <li>
    <p>Associate the new application with the <em>existing</em> deployment URL using the <code>vmc map</code> command.  For example:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc map hotels-new hotels.cloudfoundry.com
</pre>

<pre><code>At this point, because the same deployment URL maps to two different applications, new user sessions might go to *either* the old or the new application.

You can test this by constantly refreshing the `http://hotels.cloudfoundry.com` URL; some of the time you will be directed to the old application, but some of the time to the new.  Be sure, however, that you *sometimes* are directed to the new version.

You can also see this multiple URL association by executing `vmc apps`:
</code></pre>

<pre class="terminal">
    prompt$ vmc apps

    +-------------+----+---------+-----------------------------------------+--------------+
    | Application | #  | Health  | URLS                                    | Services     |
    +-------------+----+---------+-----------------------------------------+--------------+
    | hotels      | 1  | RUNNING | hotels.cloudfoundry.com                 | mysql-hotels |
    | hotels-new  | 1  | RUNNING | hotels-new.cloudfoundry.com,            |              |
    |             |    |         |    hotels.cloudfoundry.com              | mysql-hotels |
    +-------------+----+---------+-----------------------------------------+--------------+

</pre>

<ul>
<li>Disassociate the old application from its original deployment URL using the <code>vmc unmap</code> command:</li>
</ul><pre class="terminal">
prompt$ vmc unmap hotels hotels.cloudfoundry.com
</pre>

<pre><code>Note that this unmapping does *not* drop the existing user sessions to the old application; it simply stops new traffic to the old application so that new user sessions start using the new application.
</code></pre>

<ul>
<li>
    <p>Test that the original deployment URL (<code>http://hotels.cloudfoundry.com</code> in our example) is now always directing user sessions to the new application.</p>
  </li>
  <li>
    <p>Disassociate the new application from its new deployment URL:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc unmap hotels-new hotels-new.cloudfoundry.com
</pre>

<ul>
<li>When you are sure that there are no longer any user sessions connected to the old application, you can delete it:</li>
</ul><pre class="terminal">
prompt$ vmc delete hotels
</pre>

<pre><code>Be sure you do **not** delete any shared service instances that are currently being used by the new application.

You will now have a new internal name for the application, but it maps to the existing deployment URL that users are already familiar with.  You can view this new mapping with `vmc apps`:
</code></pre>

<pre class="terminal">
        prompt$ vmc apps

        +-------------+----+---------+-------------------------+-------------+
        | Application | #  | Health  | URLS                    | Services    |
        +-------------+----+---------+-------------------------+-------------+
        | hotels-new  | 1  | RUNNING | hotels.cloudfoundry.com | mysql-hotels|
        +-------------+----+---------+-------------------------+-------------+

</pre>

<h2 id="monitoring-and-configuring-a-deployment-scaling-and-memory-management">Monitoring and Configuring A Deployment (Scaling and Memory Management)</h2>

<p>There are a number of VMC commands for configuring a deployed application, such as scaling it up or down by adding or removing instances, adding more memory, and changing its deployment URL.</p>

<p>Use the <code>vmc apps</code> command to get a list of all your deployed applications; you will use the name of the application to get more information about it and possibly configure it:</p>

<pre class="terminal">
    prompt$ vmc apps

    +-------------+----+---------+----------------------------+----------+
    | Application | #  | Health  | URLS                       | Services |
    +-------------+----+---------+----------------------------+----------+
    | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
    | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com | mysql-js |
    +-------------+----+---------+----------------------------+----------+

</pre>

<h2 id="scaling-the-application">Scaling The Application</h2>

<p>Use the <code>vmc stats &lt;appname&gt;</code> command to display the current configuration and resource utilization of an application.  For example:</p>

<pre class="terminal">
    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+---------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime        |
    +----------+-------------+----------------+--------------+---------------+
    | 0        | 0.0% (4)    | 61.7M (512M)   | 8.4M (2G)    | 0d:0h:39m:42s |
    | 1        | 7.5% (4)    | 63.8M (512M)   | 8.4M (2G)    | 0d:0h:0m:22s  |
    +----------+-------------+----------------+--------------+---------------+

</pre>

<p>The table displays a row of data for each instance of the application; in the table above, there are two instances of <code>hotels</code>.   Each row shows the CPU utilization of the instance, the memory usage and the maximum allowed, the disk usage and the maximum, and how long the instance has been running.</p>

<p>To change the maximum allowed memory, use the <code>vmc mem</code> command, passing it the name of the application and the maximum memory in MB.  This changes the maximum for all instances of the application.  For example, to lower the maximum memory of the <code>hotels</code> application to 128 MB:</p>

<pre class="terminal">
prompt$ vmc mem hotels 128
</pre>

<p>Note that Cloud Foundry must restart the application for this change to take effect.</p>

<p>Another way to scale the application up so that more user sessions can successfully and quickly connect at once, you can add more instances.  Conversely, if you want to conserve the resources associated with your Cloud Foundry account and scale <em>down</em> an application that currently has multiple instances running, you can delete instances.  For example, to specify that you want an application to have four instances running concurrently:</p>

<pre class="terminal">
prompt$ vmc instances hotels 4
</pre>

<p>Use <code>vmc stats</code> to ensure that indeed there are four instances of the application running:</p>

<pre class="terminal">
    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+--------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
    +----------+-------------+----------------+--------------+--------------+
    | 0        | 0.5% (4)    | 64.6M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 1        | 0.5% (4)    | 62.4M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 2        | 7.0% (4)    | 61.0M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    | 3        | 6.7% (4)    | 59.6M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    +----------+-------------+----------------+--------------+--------------+

</pre>

<p>Note that adding additional instances of a deployed application uses up more memory and disk space from your quota.</p>

<h2 id="changing-the-deployment-url">Changing the Deployment URL</h2>

<p>Use the <code>vmc map</code> and <code>vmc unmap</code> commands to change the deployment URL to which an application is associated.</p>

<p>For example, to associate a new  deployment URL to an existing application:</p>

<pre class="terminal">
prompt$ vmc map hotels hotels-new.cloudfoundry.com
</pre>

<p>To unmap an existing URL, use the <code>vmc unmap</code> command:</p>

<pre class="terminal">
prompt$ vmc unmap hotels hotels-new.cloudfoundry.com
</pre>

<p>See <a href="#updating-a-deployment-without-any-downtime">Updating A Deployment Without Any Downtime</a> for additional examples of using these commands in a real-life scenario.</p>

<h2 id="get-log-and-crash-information-about-an-application">Get Log and Crash Information about an Application</h2>

<p>To see the most recent activity in the stderr.log and stdout.log files of the application, use the <code>vmc logs &lt;appname&gt;</code> command:</p>

<pre class="terminal">
prompt$ vmc logs hotels
</pre>

<p>If you suspect that your application has crashed recently, run <code>vmc crashes &lt;appname&gt;</code> which will provide you with more information:</p>

<pre class="terminal">
prompt$ vmc crashes hotels
</pre>

<p>Use <code>vmc crashlogs</code> to get more detailed information about the crash:</p>

<pre class="terminal">
prompt$ vmc crashlogs hotels
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"
]In the context of Cloud Foundry, deploying an application simply means making it available for users to start using.   When you deploy an application, you push the actual application bits (such as a WAR file in the case of Spring Java) to your target cloud, specify the required application configuration such as the deployment URL and required memory, and binding any required services such as MySQL.  Cloud Foundry then stages the application, starts it, and makes it available at the specified URL so users can use it.

**Subtopics**

+ [Using VMC](#using-vmc)
+ [Using STS](#using-sts)
+ [Using Maven](#using-maven)
+ [Using Roo](#using-roo)

## Using VMC

The following user scenarios are described in this documentation:

+ [Deploying an Application That Does Not Require a Service](#deploying-an-application-that-does-not-require-a-service)
+ [Deploying an Application That Requires One Service](#deploying-an-application-that-requires-one-service)
+ [Deploying an Application That Requires Multiple Services](#deploying-an-application-that-requires-multiple-services)
+ [Deploying in Non-Interactive Mode](#deploying-in-non-interactive-mode)
+ [Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)](#managing-the-application-lifecycle-stop-start-restart-delete-rename)
+ [Updating The Deployment Bits](#updating-the-deployment-bits)
+ [Avoiding Downtime When Updating The Deployment Bits](#avoiding-downtime-when-updating-the-deployment-bits)
+ [Monitoring and Configuring A Deployment (Scaling and Memory Management)](#monitoring-and-configuring-a-deployment-scaling-and-memory-management)

## Deploying an Application That Does Not Require a Service

You use the `vmc push` command to deploy applications using VMC.  By default, `vmc` interactively prompts for the required deployment information; alternatively you can specify parameters to override the defaults or run in non-interactive mode.

The simplest deployment example is to run `vmc push` with no parameters to deploy an application that does not require any services to be bound to it.  The `vmc push` command will prompt for all required information.  The following example shows the output from deploying a very simple Spring application that is packaged in a WAR file called `hello.war`; see the text after the example for additional information:

```bash

    prompt$ vmc push

    Would you like to deploy from the current directory? [Yn]:
    Application Name: hello
    Application Deployed URL: 'hello.cloudfoundry.com'? hello-js.cloudfoundry.com
    Detected a Java SpringSource Spring Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
    Creating Application: OK
    Would you like to bind any services to 'hello'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK

    Staging Application: OK
    Starting Application: OK

```

Go to the specified deployment URL in your browser to start using the application.  In the example above, that would be:

        http://hello-js.cloudfoundry.com

Note the following about the preceding `vmc push` example:

+ The default value of yes/no prompts is shown in capital letters at the end of the prompt; for example, if the default answer is No, then the prompt ends in `[yN]`.
+ You can deploy from the current directory in which you are running VMC, or specify a different directory. This directory is the location of the actual application bits, such as the `hello.war` file.   **Note** that `vmc push` deploys ALL artifacts in the specified directory, so be sure that only those files you want deployed are physically located in the directory.
+  The name of the application is the one you use to identify it as you mange its lifecycle, such as stopping it, adding memory to it, and so on.   The scope of the name is your Cloud Foundry account, which means the name should be unique as far as your account but does not need to be unique across the entire Cloud Foundry target.
+  By default, the deployment URL is the application name along with the target (for example, `cloudfoundry.com`).  However, you must be sure to specify a deployment URL that is *unique* across the entire Cloud Foundry target, even though the name of the application must be unique only within the scope of your Cloud Foundry account.  This is why, in the example above, the deployment URL includes an identifier that makes it unique across the entire cloudfoundry.com Web site.

## Deploying an Application That Requires One Service

The following example shows how to deploy an application that requires a service (in this case a MySQL service).   The application is called `hotels.war`.

In our example, we will first create an instance of the MySQL service using the `vmc create-service` command, and then bind this service instance to the application when we deploy it with `vmc push`.u

It is important to note that you do not need to change your existing application in any way for it to "find" the MySQL instance that Cloud Foundry created and to which the application is bound.  This is because Cloud Foundry uses an auto-reconfiguration mechanism that lets typical Spring applications consume services without changing anything in the application.

* Find the name of the MySQL service by running `vmc services` and noting the first column:

```bash

        prompt$ vmc services

        ============== System Services ==============

        +------------+---------+---------------------------------------+
        | Service    | Version | Description                           |
        +------------+---------+---------------------------------------+
        | mongodb    | 2.0     | MongoDB NoSQL store                   |
        | mysql      | 5.1     | MySQL database service                |
        | postgresql | 9.0     | vFabric Postgres database service     |
        | rabbitmq   | 2.4     | RabbitMQ messaging service            |
        | redis      | 2.2     | Redis key-value store service         |
        +------------+---------+---------------------------------------+

        =========== Provisioned Services ============

```

*  Create a new instance of the `mysql` service and call it `mysql-js`:

```bash
prompt$ vmc create-service mysql mysql-js
```

*  Deploy the `hotels.war` application, but this time bind it to the `mysql-js` service instance:

```bash

        prompt$ vmc push

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        Application Deployed URL: 'hotels.cloudfoundry.com'? hotels-js.cloudfoundry.com
        Detected a Java Web Application, is this correct? [Yn]:
        Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
        Creating Application: OK
        Would you like to bind any services to 'hotels'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. mysql-js
        Please select one you wish to provision: 1
        Binding Service: OK
        Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (12K): OK
        Push Status: OK

        Staging Application: OK

        Starting Application: OK

```

You can also create a new instance of a service during the `vmc push` command by answer `N` to the prompt about using a provisioned service; in this case, the `vmc push` command prompts for information about the new service instance.

## Deploying an Application That Requires Multiple Services

The [preceding section](#deploying-an-application-that-requires-one-service) described how to deploy an application using the `vmc push` command and bind a service (MySQL) to it at the same time.  However, you were only able to bind *one* service, but what if your application requires multiple services?  This section describes how to perform that task.

This example extends the [previous example](#deploying-an-application-that-requires-one-service) in that, in addition to binding the `mysql-js` service to the `hotels` application, it will also create and bind the MongoDB and RabbitMQ services.

*  Create new instances of the `mysql`, `mongodb`, and `rabbitmq` services:

```bash

        prompt$ vmc create-service mysql mysql-js
        prompt$ vmc create-service mongodb mongodb-js
        prompt$ vmc create-service rabbitmq rabbitmq-js

```

*  Deploy the `hotels.war` application and bind the `mysql-js` service instance to it.  This time, however, be sure to specify the `--no-start` option so that Cloud Foundry does not stage or start the application:

```bash

        prompt$ vmc push --no-start

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        ...
        Uploading Application:
        ...
        Push Status: OK

```

* Use the `vmc bind-service` to bind the two remaining services to the `hotels` application:

```bash

        prompt$ vmc bind-service mongodb-js hotels
        prompt$ vmc bind-service rabbitmq-js hotels

```

*  Start the application:

```bash

        prompt$ vmc start hotels

        Staging Application: OK
        Starting Application: OK

```

## Deploying in Non-Interactive Mode

Use the `-n` option of `vmc push` to deploy an application in non-interactive mode.   The only other requirement is that you specify the name of the application.

If you specify no other options, then Cloud Foundry uses all the default values when deploying the application.  For example, if you execute the following command:

```bash

    prompt$ vmc push hotels -n

```

then Cloud Foundry does the following:

+ Deploys all artifacts in the current directory as part of the `hotels` application.
+ Uses the deployment URL`hotels.cloudfoundry.com` (assuming your target is the publicly-hosted Cloud Foundry.)
+ Creates a single instance of the deployed application.
+ Does *not* bind any services to the application.
+ Auto-detects the programming framework (such as Spring or Ruby)
+ Reserves 512 MB of memory for the application
+ Automatically starts the application after staging it.

You can use additional options to change the default values of the deployment, and still deploy in non-interactive mode.  For example, you can change the deployment URL using the `--url` option, the reserved memory using the `--mem` option, and specify that the application not start with the following command:

```bash

    prompt$ vmc push hotels -n --url hotels-js.cloudfoundry.com --mem 256 --no-start

```

See [VMC Quick Reference Guide](/tools/vmc/vmc-quick-ref.html#deploying-applications) for the full list of parameters you can specify for the `vmc push` command.

## Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)

Managing the lifecycle of your application after you have deployed it is easy; just use the appropriate VMC command to stop, start, and restart it.  For example, to stop and then start an application:

```bash

    prompt$ vmc stop hotels
    prompt$ vmc start hotels

```

Or to do the same task with one command:

```bash

    prompt$ vmc restart hotels

```

It is important to note that when Cloud Foundry restarts an application, it creates an entire new virtual infrastructure for it.   Although this is typically transparent to the application, one situation in which this is relevant is if the application created local files on disk when it was previously running.  At restart, these files will be completely lost because Cloud Foundry creates a new virtual disk.  If the application requires that these files be available, even after a restart, then your application should use a data service such as MongoDB which will ensure that the files are always available.

To rename an application, use the `vmc rename` command, specifying the existing name and then the new name.  For example:

```bash
prompt$ vmc rename hotels hotels-new-name
```

The `vmc rename` command changes the internal name of the application; it does not change the deployment URL that you use to run the application.  For that you would use `vmc map`. See [Changing the Deployment URL](#changing-the-deployment-url).

To delete an application, and free up all resources associated with the application, use the `vmc delete` command:

```bash
prompt$ vmc delete hotels
```

## Updating The Deployment Bits

Use the `vmc update <appname>` command to update the "bits" that make up an application, such as the packaged WAR file for a Java Spring applications.

When Cloud Foundry updates an application, it first stops it, makes the change, and then starts it again.  This means that the application will be unavailable for a short period of time and existing user sessions will be deleted.  During the iterative development cycle of an application, this might not be a problem, but in production scenarios this may be unaccaptable.  See [Avoiding Downtime When Updating The Deployment Bits](#avoiding-downtime-when-updating-the-deployment-bits) for a useful procedure to avoid this short downtime.

Follow these steps to update your application:

* Use `vmc apps` to get the exact name of your application; the first column of the output lists the name.  For example:

```bash

        prompt$ vmc apps

        +-------------+----+---------+----------------------------+----------+
        | Application | #  | Health  | URLS                       | Services |
        +-------------+----+---------+----------------------------+----------+
        | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
        | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com |          |
        +-------------+----+---------+----------------------------+----------+

```

* In your command prompt (Windows) or terminal window (Linux), change to the directory that contains your updated application bits.  Be sure the directory contains *only* the files and artifacts that you want to deploy because VMC pushes all files in the directory.

```bash
prompt$ cd /usr/bob/sample-apps/hotels
```

*  Use `vmc update` to update your application:

```bash
prompt$ vmc update hotels
```

    Check the output of the command to ensure the application started without errors, then start using the updated application.

## Avoiding Downtime When Updating The Deployment Bits

The method for updating an application without any downtime exploits the fact that in Cloud Foundry you can map a single application to multiple deployment URLs, and similarly, map multiple applications to the same deployment URL.   So rather than updating the application directly, we will create a new application, associate it with the existing URL, then *disassociate the mapping of the old application to the URL*, then delete the old application.

In the following example, the existing application is called `hotels` and its deployment URL is `hotels.cloudfoundry.com`, and you want to new user sessions to start using the new application seamlessly, without existing users losing their connection.

The exact steps are as follows:

* In your command prompt or terminal window, change to the directory that contains the updated application "bits".  For example:

```bash
prompt$ cd /usr/bob/sample-apps/hotels
```

*  Create a new application using the `vmc push` command, call it something different from the existing application, such as `hotels-new` and also specify that its deployment URL be something different, such as `hotels-new.cloudfoundry.com`:

```bash
prompt$ vmc push hotels-new
```

    Be sure you bind any required services, such as MySQL or RabbitMQ.  Use the same service instances that the existing application is currently using.

*  In a browser, go to the new deployment URL to test that the newly deployed application is working correctly, and that it is indeed the updated version.

    In our example, the deployment URL of the new application is `http://hotels-new.cloudfoundry.com`.

*  Associate the new application with the *existing* deployment URL using the `vmc map` command.  For example:

```bash
prompt$ vmc map hotels-new hotels.cloudfoundry.com
```

    At this point, because the same deployment URL maps to two different applications, new user sessions might go to *either* the old or the new application.

    You can test this by constantly refreshing the `http://hotels.cloudfoundry.com` URL; some of the time you will be directed to the old application, but some of the time to the new.  Be sure, however, that you *sometimes* are directed to the new version.

    You can also see this multiple URL association by executing `vmc apps`:

```bash

    prompt$ vmc apps

    +-------------+----+---------+-----------------------------------------+--------------+
    | Application | #  | Health  | URLS                                    | Services     |
    +-------------+----+---------+-----------------------------------------+--------------+
    | hotels      | 1  | RUNNING | hotels.cloudfoundry.com                 | mysql-hotels |
    | hotels-new  | 1  | RUNNING | hotels-new.cloudfoundry.com,            |              |
    |             |    |         |    hotels.cloudfoundry.com              | mysql-hotels |
    +-------------+----+---------+-----------------------------------------+--------------+

```

*  Disassociate the old application from its original deployment URL using the `vmc unmap` command:

```bash
prompt$ vmc unmap hotels hotels.cloudfoundry.com
```

    Note that this unmapping does *not* drop the existing user sessions to the old application; it simply stops new traffic to the old application so that new user sessions start using the new application.

* Test that the original deployment URL (`http://hotels.cloudfoundry.com` in our example) is now always directing user sessions to the new application.

*  Disassociate the new application from its new deployment URL:

```bash
prompt$ vmc unmap hotels-new hotels-new.cloudfoundry.com
```

*  When you are sure that there are no longer any user sessions connected to the old application, you can delete it:

```bash
prompt$ vmc delete hotels
```

    Be sure you do **not** delete any shared service instances that are currently being used by the new application.

    You will now have a new internal name for the application, but it maps to the existing deployment URL that users are already familiar with.  You can view this new mapping with `vmc apps`:

```bash

        prompt$ vmc apps

        +-------------+----+---------+-------------------------+-------------+
        | Application | #  | Health  | URLS                    | Services    |
        +-------------+----+---------+-------------------------+-------------+
        | hotels-new  | 1  | RUNNING | hotels.cloudfoundry.com | mysql-hotels|
        +-------------+----+---------+-------------------------+-------------+

```

## Monitoring and Configuring A Deployment (Scaling and Memory Management)

There are a number of VMC commands for configuring a deployed application, such as scaling it up or down by adding or removing instances, adding more memory, and changing its deployment URL.

Use the `vmc apps` command to get a list of all your deployed applications; you will use the name of the application to get more information about it and possibly configure it:

```bash

    prompt$ vmc apps

    +-------------+----+---------+----------------------------+----------+
    | Application | #  | Health  | URLS                       | Services |
    +-------------+----+---------+----------------------------+----------+
    | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
    | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com | mysql-js |
    +-------------+----+---------+----------------------------+----------+

```

## Scaling The Application

Use the `vmc stats <appname>` command to display the current configuration and resource utilization of an application.  For example:

```bash

    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+---------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime        |
    +----------+-------------+----------------+--------------+---------------+
    | 0        | 0.0% (4)    | 61.7M (512M)   | 8.4M (2G)    | 0d:0h:39m:42s |
    | 1        | 7.5% (4)    | 63.8M (512M)   | 8.4M (2G)    | 0d:0h:0m:22s  |
    +----------+-------------+----------------+--------------+---------------+

```

The table displays a row of data for each instance of the application; in the table above, there are two instances of `hotels`.   Each row shows the CPU utilization of the instance, the memory usage and the maximum allowed, the disk usage and the maximum, and how long the instance has been running.

To change the maximum allowed memory, use the `vmc mem` command, passing it the name of the application and the maximum memory in MB.  This changes the maximum for all instances of the application.  For example, to lower the maximum memory of the `hotels` application to 128 MB:

```bash
prompt$ vmc mem hotels 128
```

Note that Cloud Foundry must restart the application for this change to take effect.

Another way to scale the application up so that more user sessions can successfully and quickly connect at once, you can add more instances.  Conversely, if you want to conserve the resources associated with your Cloud Foundry account and scale *down* an application that currently has multiple instances running, you can delete instances.  For example, to specify that you want an application to have four instances running concurrently:

```bash
prompt$ vmc instances hotels 4
```

Use `vmc stats` to ensure that indeed there are four instances of the application running:

```bash

    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+--------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
    +----------+-------------+----------------+--------------+--------------+
    | 0        | 0.5% (4)    | 64.6M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 1        | 0.5% (4)    | 62.4M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 2        | 7.0% (4)    | 61.0M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    | 3        | 6.7% (4)    | 59.6M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    +----------+-------------+----------------+--------------+--------------+

```

Note that adding additional instances of a deployed application uses up more memory and disk space from your quota.

## Changing the Deployment URL

Use the `vmc map` and `vmc unmap` commands to change the deployment URL to which an application is associated.

For example, to associate a new  deployment URL to an existing application:

```bash
prompt$ vmc map hotels hotels-new.cloudfoundry.com
```

To unmap an existing URL, use the `vmc unmap` command:

```bash
prompt$ vmc unmap hotels hotels-new.cloudfoundry.com
```

See [Updating A Deployment Without Any Downtime](#updating-a-deployment-without-any-downtime) for additional examples of using these commands in a real-life scenario.

## Get Log and Crash Information about an Application

To see the most recent activity in the stderr.log and stdout.log files of the application, use the `vmc logs <appname>` command:

```bash
prompt$ vmc logs hotels
```

If you suspect that your application has crashed recently, run `vmc crashes <appname>` which will provide you with more information:

```bash
prompt$ vmc crashes hotels
```

Use `vmc crashlogs` to get more detailed information about the crash:

```bash
prompt$ vmc crashlogs hotels
```;T;
I" j<p>In the context of Cloud Foundry, deploying an application simply means making it available for users to start using.   When you deploy an application, you push the actual application bits (such as a WAR file in the case of Spring Java) to your target cloud, specify the required application configuration such as the deployment URL and required memory, and binding any required services such as MySQL.  Cloud Foundry then stages the application, starts it, and makes it available at the specified URL so users can use it.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#using-vmc">Using VMC</a></li>
  <li><a href="#using-sts">Using STS</a></li>
  <li><a href="#using-maven">Using Maven</a></li>
  <li><a href="#using-roo">Using Roo</a></li>
</ul><h2 id="using-vmc">Using VMC</h2>

<p>The following user scenarios are described in this documentation:</p>

<ul>
<li><a href="#deploying-an-application-that-does-not-require-a-service">Deploying an Application That Does Not Require a Service</a></li>
  <li><a href="#deploying-an-application-that-requires-one-service">Deploying an Application That Requires One Service</a></li>
  <li><a href="#deploying-an-application-that-requires-multiple-services">Deploying an Application That Requires Multiple Services</a></li>
  <li><a href="#deploying-in-non-interactive-mode">Deploying in Non-Interactive Mode</a></li>
  <li><a href="#managing-the-application-lifecycle-stop-start-restart-delete-rename">Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)</a></li>
  <li><a href="#updating-the-deployment-bits">Updating The Deployment Bits</a></li>
  <li><a href="#avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</a></li>
  <li><a href="#monitoring-and-configuring-a-deployment-scaling-and-memory-management">Monitoring and Configuring A Deployment (Scaling and Memory Management)</a></li>
</ul><h2 id="deploying-an-application-that-does-not-require-a-service">Deploying an Application That Does Not Require a Service</h2>

<p>You use the <code>vmc push</code> command to deploy applications using VMC.  By default, <code>vmc</code> interactively prompts for the required deployment information; alternatively you can specify parameters to override the defaults or run in non-interactive mode.</p>

<p>The simplest deployment example is to run <code>vmc push</code> with no parameters to deploy an application that does not require any services to be bound to it.  The <code>vmc push</code> command will prompt for all required information.  The following example shows the output from deploying a very simple Spring application that is packaged in a WAR file called <code>hello.war</code>; see the text after the example for additional information:</p>

<pre class="terminal">
    prompt$ vmc push

    Would you like to deploy from the current directory? [Yn]:
    Application Name: hello
    Application Deployed URL: 'hello.cloudfoundry.com'? hello-js.cloudfoundry.com
    Detected a Java SpringSource Spring Application, is this correct? [Yn]:
    Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
    Creating Application: OK
    Would you like to bind any services to 'hello'? [yN]:
    Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (4K): OK
    Push Status: OK

    Staging Application: OK
    Starting Application: OK

</pre>

<p>Go to the specified deployment URL in your browser to start using the application.  In the example above, that would be:</p>

<pre><code>    http://hello-js.cloudfoundry.com
</code></pre>

<p>Note the following about the preceding <code>vmc push</code> example:</p>

<ul>
<li>The default value of yes/no prompts is shown in capital letters at the end of the prompt; for example, if the default answer is No, then the prompt ends in <code>[yN]</code>.</li>
  <li>You can deploy from the current directory in which you are running VMC, or specify a different directory. This directory is the location of the actual application bits, such as the <code>hello.war</code> file.   <strong>Note</strong> that <code>vmc push</code> deploys ALL artifacts in the specified directory, so be sure that only those files you want deployed are physically located in the directory.</li>
  <li>The name of the application is the one you use to identify it as you mange its lifecycle, such as stopping it, adding memory to it, and so on.   The scope of the name is your Cloud Foundry account, which means the name should be unique as far as your account but does not need to be unique across the entire Cloud Foundry target.</li>
  <li>By default, the deployment URL is the application name along with the target (for example, <code>cloudfoundry.com</code>).  However, you must be sure to specify a deployment URL that is <em>unique</em> across the entire Cloud Foundry target, even though the name of the application must be unique only within the scope of your Cloud Foundry account.  This is why, in the example above, the deployment URL includes an identifier that makes it unique across the entire cloudfoundry.com Web site.</li>
</ul><h2 id="deploying-an-application-that-requires-one-service">Deploying an Application That Requires One Service</h2>

<p>The following example shows how to deploy an application that requires a service (in this case a MySQL service).   The application is called <code>hotels.war</code>.</p>

<p>In our example, we will first create an instance of the MySQL service using the <code>vmc create-service</code> command, and then bind this service instance to the application when we deploy it with <code>vmc push</code>.u</p>

<p>It is important to note that you do not need to change your existing application in any way for it to â€œfindâ€ the MySQL instance that Cloud Foundry created and to which the application is bound.  This is because Cloud Foundry uses an auto-reconfiguration mechanism that lets typical Spring applications consume services without changing anything in the application.</p>

<ul>
<li>Find the name of the MySQL service by running <code>vmc services</code> and noting the first column:</li>
</ul><pre class="terminal">
        prompt$ vmc services

        ============== System Services ==============

        +------------+---------+---------------------------------------+
        | Service    | Version | Description                           |
        +------------+---------+---------------------------------------+
        | mongodb    | 2.0     | MongoDB NoSQL store                   |
        | mysql      | 5.1     | MySQL database service                |
        | postgresql | 9.0     | vFabric Postgres database service     |
        | rabbitmq   | 2.4     | RabbitMQ messaging service            |
        | redis      | 2.2     | Redis key-value store service         |
        +------------+---------+---------------------------------------+

        =========== Provisioned Services ============

</pre>

<ul>
<li>Create a new instance of the <code>mysql</code> service and call it <code>mysql-js</code>:</li>
</ul><pre class="terminal">
prompt$ vmc create-service mysql mysql-js
</pre>

<ul>
<li>Deploy the <code>hotels.war</code> application, but this time bind it to the <code>mysql-js</code> service instance:</li>
</ul><pre class="terminal">
        prompt$ vmc push

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        Application Deployed URL: 'hotels.cloudfoundry.com'? hotels-js.cloudfoundry.com
        Detected a Java Web Application, is this correct? [Yn]:
        Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)
        Creating Application: OK
        Would you like to bind any services to 'hotels'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. mysql-js
        Please select one you wish to provision: 1
        Binding Service: OK
        Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (12K): OK
        Push Status: OK

        Staging Application: OK

        Starting Application: OK

</pre>

<p>You can also create a new instance of a service during the <code>vmc push</code> command by answer <code>N</code> to the prompt about using a provisioned service; in this case, the <code>vmc push</code> command prompts for information about the new service instance.</p>

<h2 id="deploying-an-application-that-requires-multiple-services">Deploying an Application That Requires Multiple Services</h2>

<p>The <a href="#deploying-an-application-that-requires-one-service">preceding section</a> described how to deploy an application using the <code>vmc push</code> command and bind a service (MySQL) to it at the same time.  However, you were only able to bind <em>one</em> service, but what if your application requires multiple services?  This section describes how to perform that task.</p>

<p>This example extends the <a href="#deploying-an-application-that-requires-one-service">previous example</a> in that, in addition to binding the <code>mysql-js</code> service to the <code>hotels</code> application, it will also create and bind the MongoDB and RabbitMQ services.</p>

<ul>
<li>Create new instances of the <code>mysql</code>, <code>mongodb</code>, and <code>rabbitmq</code> services:</li>
</ul><pre class="terminal">
        prompt$ vmc create-service mysql mysql-js
        prompt$ vmc create-service mongodb mongodb-js
        prompt$ vmc create-service rabbitmq rabbitmq-js

</pre>

<ul>
<li>Deploy the <code>hotels.war</code> application and bind the <code>mysql-js</code> service instance to it.  This time, however, be sure to specify the <code>--no-start</code> option so that Cloud Foundry does not stage or start the application:</li>
</ul><pre class="terminal">
        prompt$ vmc push --no-start

        Would you like to deploy from the current directory? [Yn]: y
        Application Name: hotels
        ...
        Uploading Application:
        ...
        Push Status: OK

</pre>

<ul>
<li>Use the <code>vmc bind-service</code> to bind the two remaining services to the <code>hotels</code> application:</li>
</ul><pre class="terminal">
        prompt$ vmc bind-service mongodb-js hotels
        prompt$ vmc bind-service rabbitmq-js hotels

</pre>

<ul>
<li>Start the application:</li>
</ul><pre class="terminal">
        prompt$ vmc start hotels

        Staging Application: OK
        Starting Application: OK

</pre>

<h2 id="deploying-in-non-interactive-mode">Deploying in Non-Interactive Mode</h2>

<p>Use the <code>-n</code> option of <code>vmc push</code> to deploy an application in non-interactive mode.   The only other requirement is that you specify the name of the application.</p>

<p>If you specify no other options, then Cloud Foundry uses all the default values when deploying the application.  For example, if you execute the following command:</p>

<pre class="terminal">
    prompt$ vmc push hotels -n

</pre>

<p>then Cloud Foundry does the following:</p>

<ul>
<li>Deploys all artifacts in the current directory as part of the <code>hotels</code> application.</li>
  <li>Uses the deployment URL<code>hotels.cloudfoundry.com</code> (assuming your target is the publicly-hosted Cloud Foundry.)</li>
  <li>Creates a single instance of the deployed application.</li>
  <li>Does <em>not</em> bind any services to the application.</li>
  <li>Auto-detects the programming framework (such as Spring or Ruby)</li>
  <li>Reserves 512 MB of memory for the application</li>
  <li>Automatically starts the application after staging it.</li>
</ul><p>You can use additional options to change the default values of the deployment, and still deploy in non-interactive mode.  For example, you can change the deployment URL using the <code>--url</code> option, the reserved memory using the <code>--mem</code> option, and specify that the application not start with the following command:</p>

<pre class="terminal">
    prompt$ vmc push hotels -n --url hotels-js.cloudfoundry.com --mem 256 --no-start

</pre>

<p>See <a href="/tools/vmc/vmc-quick-ref.html#deploying-applications">VMC Quick Reference Guide</a> for the full list of parameters you can specify for the <code>vmc push</code> command.</p>

<h2 id="managing-the-application-lifecycle-stop-start-restart-delete-rename">Managing the Application Lifecycle (Stop, Start, Restart, Delete, Rename)</h2>

<p>Managing the lifecycle of your application after you have deployed it is easy; just use the appropriate VMC command to stop, start, and restart it.  For example, to stop and then start an application:</p>

<pre class="terminal">
    prompt$ vmc stop hotels
    prompt$ vmc start hotels

</pre>

<p>Or to do the same task with one command:</p>

<pre class="terminal">
    prompt$ vmc restart hotels

</pre>

<p>It is important to note that when Cloud Foundry restarts an application, it creates an entire new virtual infrastructure for it.   Although this is typically transparent to the application, one situation in which this is relevant is if the application created local files on disk when it was previously running.  At restart, these files will be completely lost because Cloud Foundry creates a new virtual disk.  If the application requires that these files be available, even after a restart, then your application should use a data service such as MongoDB which will ensure that the files are always available.</p>

<p>To rename an application, use the <code>vmc rename</code> command, specifying the existing name and then the new name.  For example:</p>

<pre class="terminal">
prompt$ vmc rename hotels hotels-new-name
</pre>

<p>The <code>vmc rename</code> command changes the internal name of the application; it does not change the deployment URL that you use to run the application.  For that you would use <code>vmc map</code>. See <a href="#changing-the-deployment-url">Changing the Deployment URL</a>.</p>

<p>To delete an application, and free up all resources associated with the application, use the <code>vmc delete</code> command:</p>

<pre class="terminal">
prompt$ vmc delete hotels
</pre>

<h2 id="updating-the-deployment-bits">Updating The Deployment Bits</h2>

<p>Use the <code>vmc update &lt;appname&gt;</code> command to update the â€œbitsâ€ that make up an application, such as the packaged WAR file for a Java Spring applications.</p>

<p>When Cloud Foundry updates an application, it first stops it, makes the change, and then starts it again.  This means that the application will be unavailable for a short period of time and existing user sessions will be deleted.  During the iterative development cycle of an application, this might not be a problem, but in production scenarios this may be unaccaptable.  See <a href="#avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</a> for a useful procedure to avoid this short downtime.</p>

<p>Follow these steps to update your application:</p>

<ul>
<li>Use <code>vmc apps</code> to get the exact name of your application; the first column of the output lists the name.  For example:</li>
</ul><pre class="terminal">
        prompt$ vmc apps

        +-------------+----+---------+----------------------------+----------+
        | Application | #  | Health  | URLS                       | Services |
        +-------------+----+---------+----------------------------+----------+
        | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
        | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com |          |
        +-------------+----+---------+----------------------------+----------+

</pre>

<ul>
<li>In your command prompt (Windows) or terminal window (Linux), change to the directory that contains your updated application bits.  Be sure the directory contains <em>only</em> the files and artifacts that you want to deploy because VMC pushes all files in the directory.</li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hotels
</pre>

<ul>
<li>Use <code>vmc update</code> to update your application:</li>
</ul><pre class="terminal">
prompt$ vmc update hotels
</pre>

<pre><code>Check the output of the command to ensure the application started without errors, then start using the updated application.
</code></pre>

<h2 id="avoiding-downtime-when-updating-the-deployment-bits">Avoiding Downtime When Updating The Deployment Bits</h2>

<p>The method for updating an application without any downtime exploits the fact that in Cloud Foundry you can map a single application to multiple deployment URLs, and similarly, map multiple applications to the same deployment URL.   So rather than updating the application directly, we will create a new application, associate it with the existing URL, then <em>disassociate the mapping of the old application to the URL</em>, then delete the old application.</p>

<p>In the following example, the existing application is called <code>hotels</code> and its deployment URL is <code>hotels.cloudfoundry.com</code>, and you want to new user sessions to start using the new application seamlessly, without existing users losing their connection.</p>

<p>The exact steps are as follows:</p>

<ul>
<li>In your command prompt or terminal window, change to the directory that contains the updated application â€œbitsâ€.  For example:</li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hotels
</pre>

<ul>
<li>Create a new application using the <code>vmc push</code> command, call it something different from the existing application, such as <code>hotels-new</code> and also specify that its deployment URL be something different, such as <code>hotels-new.cloudfoundry.com</code>:</li>
</ul><pre class="terminal">
prompt$ vmc push hotels-new
</pre>

<pre><code>Be sure you bind any required services, such as MySQL or RabbitMQ.  Use the same service instances that the existing application is currently using.
</code></pre>

<ul>
<li>
    <p>In a browser, go to the new deployment URL to test that the newly deployed application is working correctly, and that it is indeed the updated version.</p>

    <p>In our example, the deployment URL of the new application is <code>http://hotels-new.cloudfoundry.com</code>.</p>
  </li>
  <li>
    <p>Associate the new application with the <em>existing</em> deployment URL using the <code>vmc map</code> command.  For example:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc map hotels-new hotels.cloudfoundry.com
</pre>

<pre><code>At this point, because the same deployment URL maps to two different applications, new user sessions might go to *either* the old or the new application.

You can test this by constantly refreshing the `http://hotels.cloudfoundry.com` URL; some of the time you will be directed to the old application, but some of the time to the new.  Be sure, however, that you *sometimes* are directed to the new version.

You can also see this multiple URL association by executing `vmc apps`:
</code></pre>

<pre class="terminal">
    prompt$ vmc apps

    +-------------+----+---------+-----------------------------------------+--------------+
    | Application | #  | Health  | URLS                                    | Services     |
    +-------------+----+---------+-----------------------------------------+--------------+
    | hotels      | 1  | RUNNING | hotels.cloudfoundry.com                 | mysql-hotels |
    | hotels-new  | 1  | RUNNING | hotels-new.cloudfoundry.com,            |              |
    |             |    |         |    hotels.cloudfoundry.com              | mysql-hotels |
    +-------------+----+---------+-----------------------------------------+--------------+

</pre>

<ul>
<li>Disassociate the old application from its original deployment URL using the <code>vmc unmap</code> command:</li>
</ul><pre class="terminal">
prompt$ vmc unmap hotels hotels.cloudfoundry.com
</pre>

<pre><code>Note that this unmapping does *not* drop the existing user sessions to the old application; it simply stops new traffic to the old application so that new user sessions start using the new application.
</code></pre>

<ul>
<li>
    <p>Test that the original deployment URL (<code>http://hotels.cloudfoundry.com</code> in our example) is now always directing user sessions to the new application.</p>
  </li>
  <li>
    <p>Disassociate the new application from its new deployment URL:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc unmap hotels-new hotels-new.cloudfoundry.com
</pre>

<ul>
<li>When you are sure that there are no longer any user sessions connected to the old application, you can delete it:</li>
</ul><pre class="terminal">
prompt$ vmc delete hotels
</pre>

<pre><code>Be sure you do **not** delete any shared service instances that are currently being used by the new application.

You will now have a new internal name for the application, but it maps to the existing deployment URL that users are already familiar with.  You can view this new mapping with `vmc apps`:
</code></pre>

<pre class="terminal">
        prompt$ vmc apps

        +-------------+----+---------+-------------------------+-------------+
        | Application | #  | Health  | URLS                    | Services    |
        +-------------+----+---------+-------------------------+-------------+
        | hotels-new  | 1  | RUNNING | hotels.cloudfoundry.com | mysql-hotels|
        +-------------+----+---------+-------------------------+-------------+

</pre>

<h2 id="monitoring-and-configuring-a-deployment-scaling-and-memory-management">Monitoring and Configuring A Deployment (Scaling and Memory Management)</h2>

<p>There are a number of VMC commands for configuring a deployed application, such as scaling it up or down by adding or removing instances, adding more memory, and changing its deployment URL.</p>

<p>Use the <code>vmc apps</code> command to get a list of all your deployed applications; you will use the name of the application to get more information about it and possibly configure it:</p>

<pre class="terminal">
    prompt$ vmc apps

    +-------------+----+---------+----------------------------+----------+
    | Application | #  | Health  | URLS                       | Services |
    +-------------+----+---------+----------------------------+----------+
    | hello       | 1  | RUNNING | hello-js.cloudfoundry.com  |          |
    | hotels      | 1  | RUNNING | hotels-js.cloudfoundry.com | mysql-js |
    +-------------+----+---------+----------------------------+----------+

</pre>

<h2 id="scaling-the-application">Scaling The Application</h2>

<p>Use the <code>vmc stats &lt;appname&gt;</code> command to display the current configuration and resource utilization of an application.  For example:</p>

<pre class="terminal">
    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+---------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime        |
    +----------+-------------+----------------+--------------+---------------+
    | 0        | 0.0% (4)    | 61.7M (512M)   | 8.4M (2G)    | 0d:0h:39m:42s |
    | 1        | 7.5% (4)    | 63.8M (512M)   | 8.4M (2G)    | 0d:0h:0m:22s  |
    +----------+-------------+----------------+--------------+---------------+

</pre>

<p>The table displays a row of data for each instance of the application; in the table above, there are two instances of <code>hotels</code>.   Each row shows the CPU utilization of the instance, the memory usage and the maximum allowed, the disk usage and the maximum, and how long the instance has been running.</p>

<p>To change the maximum allowed memory, use the <code>vmc mem</code> command, passing it the name of the application and the maximum memory in MB.  This changes the maximum for all instances of the application.  For example, to lower the maximum memory of the <code>hotels</code> application to 128 MB:</p>

<pre class="terminal">
prompt$ vmc mem hotels 128
</pre>

<p>Note that Cloud Foundry must restart the application for this change to take effect.</p>

<p>Another way to scale the application up so that more user sessions can successfully and quickly connect at once, you can add more instances.  Conversely, if you want to conserve the resources associated with your Cloud Foundry account and scale <em>down</em> an application that currently has multiple instances running, you can delete instances.  For example, to specify that you want an application to have four instances running concurrently:</p>

<pre class="terminal">
prompt$ vmc instances hotels 4
</pre>

<p>Use <code>vmc stats</code> to ensure that indeed there are four instances of the application running:</p>

<pre class="terminal">
    prompt$ vmc stats hotels

    +----------+-------------+----------------+--------------+--------------+
    | Instance | CPU (Cores) | Memory (limit) | Disk (limit) | Uptime       |
    +----------+-------------+----------------+--------------+--------------+
    | 0        | 0.5% (4)    | 64.6M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 1        | 0.5% (4)    | 62.4M (128M)   | 8.4M (2G)    | 0d:0h:5m:4s  |
    | 2        | 7.0% (4)    | 61.0M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    | 3        | 6.7% (4)    | 59.6M (128M)   | 8.4M (2G)    | 0d:0h:0m:22s |
    +----------+-------------+----------------+--------------+--------------+

</pre>

<p>Note that adding additional instances of a deployed application uses up more memory and disk space from your quota.</p>

<h2 id="changing-the-deployment-url">Changing the Deployment URL</h2>

<p>Use the <code>vmc map</code> and <code>vmc unmap</code> commands to change the deployment URL to which an application is associated.</p>

<p>For example, to associate a new  deployment URL to an existing application:</p>

<pre class="terminal">
prompt$ vmc map hotels hotels-new.cloudfoundry.com
</pre>

<p>To unmap an existing URL, use the <code>vmc unmap</code> command:</p>

<pre class="terminal">
prompt$ vmc unmap hotels hotels-new.cloudfoundry.com
</pre>

<p>See <a href="#updating-a-deployment-without-any-downtime">Updating A Deployment Without Any Downtime</a> for additional examples of using these commands in a real-life scenario.</p>

<h2 id="get-log-and-crash-information-about-an-application">Get Log and Crash Information about an Application</h2>

<p>To see the most recent activity in the stderr.log and stdout.log files of the application, use the <code>vmc logs &lt;appname&gt;</code> command:</p>

<pre class="terminal">
prompt$ vmc logs hotels
</pre>

<p>If you suspect that your application has crashed recently, run <code>vmc crashes &lt;appname&gt;</code> which will provide you with more information:</p>

<pre class="terminal">
prompt$ vmc crashes hotels
</pre>

<p>Use <code>vmc crashlogs</code> to get more detailed information about the crash:</p>

<pre class="terminal">
prompt$ vmc crashlogs hotels
</pre>;T;@I"/tools/tools-overview/;T{;{	;I"T7<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/tools-overview.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Tools' property='og:title'>
<meta content='Tools to help you be more productive on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Tools</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Tools</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Tools to help you be more productive on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/overview" rel="tag">overview</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="deployment-tools">Deployment Tools</h2>

<p>Cloud Foundry provides two tools for performing all the tasks associated with deploying and managing applications:</p>

<ul>
<li>VMC, a command-line interface delivered as a Ruby Gem.</li>
  <li>Extension to Eclipse or Spring Tool Suite (STS) if you use the Eclipse IDE to develop your Java applications.</li>
</ul><p>Both tools provide the same functionality, so the decision of which one to use is based on what type of environment you prefer: command-line or graphical IDE.  You can, of course, use both tools for different tasks.</p>

<p>You use both tools in the same way whether you are deploying to the VMware-hosted PaaS Cloud Foundry or to your local Micro Cloud Foundry; the only difference is in the initial targetting step.</p>

<p>See <a href="/tools/vmc/installing-vmc.html">Installing VMC</a> or <a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Eclipse Extension</a> for details on installing each tool.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"}## Deployment Tools

Cloud Foundry provides two tools for performing all the tasks associated with deploying and managing applications:

+ VMC, a command-line interface delivered as a Ruby Gem.
+ Extension to Eclipse or Spring Tool Suite (STS) if you use the Eclipse IDE to develop your Java applications.

Both tools provide the same functionality, so the decision of which one to use is based on what type of environment you prefer: command-line or graphical IDE.  You can, of course, use both tools for different tasks.

You use both tools in the same way whether you are deploying to the VMware-hosted PaaS Cloud Foundry or to your local Micro Cloud Foundry; the only difference is in the initial targetting step.

See [Installing VMC](/tools/vmc/installing-vmc.html) or [Installing the Cloud Foundry Eclipse Extension](/tools/STS/configuring-STS.html) for details on installing each tool.;T;
I"ä<h2 id="deployment-tools">Deployment Tools</h2>

<p>Cloud Foundry provides two tools for performing all the tasks associated with deploying and managing applications:</p>

<ul>
<li>VMC, a command-line interface delivered as a Ruby Gem.</li>
  <li>Extension to Eclipse or Spring Tool Suite (STS) if you use the Eclipse IDE to develop your Java applications.</li>
</ul><p>Both tools provide the same functionality, so the decision of which one to use is based on what type of environment you prefer: command-line or graphical IDE.  You can, of course, use both tools for different tasks.</p>

<p>You use both tools in the same way whether you are deploying to the VMware-hosted PaaS Cloud Foundry or to your local Micro Cloud Foundry; the only difference is in the initial targetting step.</p>

<p>See <a href="/tools/vmc/installing-vmc.html">Installing VMC</a> or <a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Eclipse Extension</a> for details on installing each tool.</p>;T;@%I"/tools/gallery/box/;T{;{	;I"Ø><!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/gallery/box.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Box Integration' property='og:title'>
<meta content='Sample Application Deployment via Gallery' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Box Integration</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Box Integration</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Sample Application Deployment via Gallery</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/3rd-party-service" rel="tag">3rd-party-service</a><a href="/tags/code-attached" rel="tag">code-attached</a><a href="/tags/boilerplate-sample" rel="tag">boilerplate-sample</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The <a href="https://github.com/cloudfoundry-samples/box-sample-ruby-app">Box Ruby Sample app</a> has a redesigned interface for interacting with your content on Box.
It demonstrates usage of the main functions of the API, including file upload/download,
account tree viewing, file preview, and more.</p>

<p>Box has teamed up with CloudFoundry to offer direct deployment of this sample application the Box App Editing Wizard</p>

<h2 id="getting-started">Getting Started</h2>
<ol>
<li>Register <a href="http://www.box.net/developers/services">here</a> as a Box Developer</li>
  <li>Create a first app or edit an existing one</li>
</ol><h2 id="deploying-the-box-sample-application">Deploying the Box Sample Application</h2>
<ol>
<li>From the Cloud Services menu Click the Cloud Foundry icon
  <img src="/images/screenshots/box/cloud_services.png" alt="cloud_services.png">
</li>
  <li>Click â€œCreate My Appâ€ in the popup
  <img src="/images/screenshots/box/box-cf-1.png" alt="box-cf-1.png">
</li>
  <li>Click â€œDeploy my Appâ€
  <img src="/images/screenshots/box/box-cf-2.png" alt="box-cf-2.png">
</li>
  <li>Log into Cloud Foundry
  <img src="/images/screenshots/box/cf-login.png" alt="cf-login.png">
</li>
  <li>Click orange deploy button to deploy box-sample-ruby-app
  <img src="/images/screenshots/box/box-deploy.png" alt="box-deploy.png">
</li>
  <li>After 5 second window, Box login screen should appear
  <img src="/images/screenshots/box/box-cf-success.png" alt="box-cf-success.png">
</li>
</ol><h2 id="testing-the-box-sample-application">Testing the Box Sample Application</h2>
<ol>
<li>
    <p>Authorize your sample app to access your Box data by logging into Box
  <img src="/images/screenshots/box/box-sample-app-login.png" alt="box-sample-app-login.png"></p>
  </li>
  <li>You should now see a web page with â€œAdd Folderâ€, â€œAdd Fileâ€ buttons.</li>
  <li>Drill into your folder and confirm files you tossed in are available. Add another file or two.
  <img src="/images/screenshots/box/box-add-file.png" alt="box-add-file.png">
</li>
</ol><h2 id="making-changes-to-how-the-app-works">Making changes to how the app works</h2>

<ul>
<li>Go to <a href="https://github.com/cloudfoundry-samples/box-sample-ruby-app">box-sample-ruby-app</a> on GitHub</li>
  <li>Fork it to your own GitHub repo and clone it to your machine</li>
  <li>
<a href="/tools/vmc/installing-vmc.html">Install VMC</a> if you havenâ€™t already.</li>
  <li>Make changes to code and test locally following instructions on the README inside the box-sample-ruby-app repo</li>
  <li>Deploy changes to Cloud Foundry using <code>vmc update &lt;app_name&gt;</code>
</li>
  <li>For more VMC commands see the <a href="/tools/vmc/vmc-quick-ref.html">VMC Quick reference Guide</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"“The [Box Ruby Sample app](https://github.com/cloudfoundry-samples/box-sample-ruby-app) has a redesigned interface for interacting with your content on Box.
It demonstrates usage of the main functions of the API, including file upload/download,
account tree viewing, file preview, and more.

Box has teamed up with CloudFoundry to offer direct deployment of this sample application the Box App Editing Wizard

## Getting Started
1. Register [here](http://www.box.net/developers/services) as a Box Developer
2. Create a first app or edit an existing one

## Deploying the Box Sample Application
1. From the Cloud Services menu Click the Cloud Foundry icon
  ![cloud_services.png](/images/screenshots/box/cloud_services.png)
2. Click "Create My App" in the popup
  ![box-cf-1.png](/images/screenshots/box/box-cf-1.png)
3. Click "Deploy my App"
  ![box-cf-2.png](/images/screenshots/box/box-cf-2.png)
4. Log into Cloud Foundry
  ![cf-login.png](/images/screenshots/box/cf-login.png)
5. Click orange deploy button to deploy box-sample-ruby-app
  ![box-deploy.png](/images/screenshots/box/box-deploy.png)
6. After 5 second window, Box login screen should appear
  ![box-cf-success.png](/images/screenshots/box/box-cf-success.png)

## Testing the Box Sample Application
1. Authorize your sample app to access your Box data by logging into Box
  ![box-sample-app-login.png](/images/screenshots/box/box-sample-app-login.png)

2. You should now see a web page with "Add Folder", "Add File" buttons.
3. Drill into your folder and confirm files you tossed in are available. Add another file or two.
  ![box-add-file.png](/images/screenshots/box/box-add-file.png)

## Making changes to how the app works

* Go to [box-sample-ruby-app](https://github.com/cloudfoundry-samples/box-sample-ruby-app) on GitHub
* Fork it to your own GitHub repo and clone it to your machine
* [Install VMC](/tools/vmc/installing-vmc.html) if you haven't already.
* Make changes to code and test locally following instructions on the README inside the box-sample-ruby-app repo
* Deploy changes to Cloud Foundry using `vmc update <app_name>`
* For more VMC commands see the [VMC Quick reference Guide](/tools/vmc/vmc-quick-ref.html);T;
I"×
<p>The <a href="https://github.com/cloudfoundry-samples/box-sample-ruby-app">Box Ruby Sample app</a> has a redesigned interface for interacting with your content on Box.
It demonstrates usage of the main functions of the API, including file upload/download,
account tree viewing, file preview, and more.</p>

<p>Box has teamed up with CloudFoundry to offer direct deployment of this sample application the Box App Editing Wizard</p>

<h2 id="getting-started">Getting Started</h2>
<ol>
<li>Register <a href="http://www.box.net/developers/services">here</a> as a Box Developer</li>
  <li>Create a first app or edit an existing one</li>
</ol><h2 id="deploying-the-box-sample-application">Deploying the Box Sample Application</h2>
<ol>
<li>From the Cloud Services menu Click the Cloud Foundry icon
  <img src="/images/screenshots/box/cloud_services.png" alt="cloud_services.png">
</li>
  <li>Click â€œCreate My Appâ€ in the popup
  <img src="/images/screenshots/box/box-cf-1.png" alt="box-cf-1.png">
</li>
  <li>Click â€œDeploy my Appâ€
  <img src="/images/screenshots/box/box-cf-2.png" alt="box-cf-2.png">
</li>
  <li>Log into Cloud Foundry
  <img src="/images/screenshots/box/cf-login.png" alt="cf-login.png">
</li>
  <li>Click orange deploy button to deploy box-sample-ruby-app
  <img src="/images/screenshots/box/box-deploy.png" alt="box-deploy.png">
</li>
  <li>After 5 second window, Box login screen should appear
  <img src="/images/screenshots/box/box-cf-success.png" alt="box-cf-success.png">
</li>
</ol><h2 id="testing-the-box-sample-application">Testing the Box Sample Application</h2>
<ol>
<li>
    <p>Authorize your sample app to access your Box data by logging into Box
  <img src="/images/screenshots/box/box-sample-app-login.png" alt="box-sample-app-login.png"></p>
  </li>
  <li>You should now see a web page with â€œAdd Folderâ€, â€œAdd Fileâ€ buttons.</li>
  <li>Drill into your folder and confirm files you tossed in are available. Add another file or two.
  <img src="/images/screenshots/box/box-add-file.png" alt="box-add-file.png">
</li>
</ol><h2 id="making-changes-to-how-the-app-works">Making changes to how the app works</h2>

<ul>
<li>Go to <a href="https://github.com/cloudfoundry-samples/box-sample-ruby-app">box-sample-ruby-app</a> on GitHub</li>
  <li>Fork it to your own GitHub repo and clone it to your machine</li>
  <li>
<a href="/tools/vmc/installing-vmc.html">Install VMC</a> if you havenâ€™t already.</li>
  <li>Make changes to code and test locally following instructions on the README inside the box-sample-ruby-app repo</li>
  <li>Deploy changes to Cloud Foundry using <code>vmc update &lt;app_name&gt;</code>
</li>
  <li>For more VMC commands see the <a href="/tools/vmc/vmc-quick-ref.html">VMC Quick reference Guide</a>
</li>
</ul>;T;@+I" /tools/STS/configuring-STS/;T{;{	;I"–G<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/STS/configuring-STS.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Installing Cloud Foundry Integration for Eclipse' property='og:title'>
<meta content='Installing the Cloud Foundry Integration Extension for Eclipse or STS' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Installing Cloud Foundry Integration for Eclipse</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Installing Cloud Foundry Integration for Eclipse</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Installing the Cloud Foundry Integration Extension for Eclipse or STS</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/eclipse" rel="tag">eclipse</a><a href="/tags/sts" rel="tag">sts</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>If you are developing in Java with the Eclipse IDE or STS (Spring Tool Suite), install the Cloud Foundry Integration Extension to deploy applications to Cloud Foundry. This document describes how to install the extension and how to get started deploying applications from Eclipse or STS.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#installing-the-cloud-foundry-integration-extension-in-sts">Installing the Cloud Foundry Integration Extension in STS</a></li>
  <li><a href="#installing-the-cloud-foundry-integration-extension-in-eclipse">Installing the Cloud Foundry Integration Extension in Eclipse</a></li>
</ul><h2 id="prerequisites">Prerequisites</h2>

<p>You must have Eclipse or STS installed. You can download installers from the
following Web sites:</p>

<ul>
<li>
    <p><a href="http://www.eclipse.org/downloads/">Eclipse download</a></p>

    <p>Confirm that you have <strong>Eclipse IDE for JEE Developers</strong> so that all known dependencies are satisfied.
(In Eclipse, click <strong>Help &gt; About Eclipse</strong> to view the version of Eclipse you have installed.).
The minimum supported Eclipse JEE package is <strong>Indigo</strong>.</p>
  </li>
  <li>
    <p><a href="http://www.springsource.org/sts">Spring Tool Suite download</a></p>

    <p>Install version 2.9.0 or higher.</p>
  </li>
  <li>
    <p>Cloud Foundry Integration for Eclipse 1.1.0 is currently the latest release of the integration, and is the first version to be open sourced under the
Eclipse Public License (EPL). As a consequence, earlier versions of Cloud Foundry Integration, including those with version number 2.7.0,
cannot be upgraded to the latest version, 1.1.0. Users must first uninstall older Cloud Foundry integrations prior to installing the latest
version.</p>
  </li>
</ul><h2 id="installing-the-cloud-foundry-integration-extension-in-sts">Installing the Cloud Foundry Integration Extension in STS</h2>

<p>In STS, follow these steps to install the Cloud Foundry Integration Extension.</p>

<ul>
<li>
    <p>Select <strong>Help &gt; Dashboard</strong>.</p>

    <p>The Dashboard opens.</p>
  </li>
  <li>
    <p>Click the <strong>Extensions</strong> tab.</p>

    <p>STS loads a list of extensions.</p>
  </li>
  <li>
    <p>Scroll down to the <strong>Server and Clouds</strong> category and select <strong>Cloud Foundry Integration</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-cf-extension.png" alt="STS Server and Clouds extensions"></p>
  </li>
  <li>
    <p>Click <strong>Install</strong>.</p>

    <p>An install wizard guides you through the installation steps.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_install_wizard.png" alt="STS Cloud Foundry install wizard"></p>
  </li>
  <li>Cloud Foundry offers two install options:
    <ul>
<li>
        <p><strong>Core / Cloud Foundry Integration</strong></p>

        <p>Required installation for users who wish to use the feature but not extend the Cloud Foundry Integration.</p>
      </li>
      <li>
        <p><strong>Resources / Cloud Foundry Integration</strong></p>

        <p>Optional SDK installation of Cloud Foundry Integration source files for users who wish to extend the Cloud Foundry Integration.
 Users are not required to install <strong>Core / Cloud Foundry</strong> installation with this option.</p>
      </li>
    </ul>
</li>
  <li>When the installer completes, click <strong>Yes</strong> to restart STS or Eclipse.</li>
</ul><h2 id="installing-the-cloud-foundry-integration-extension-in-eclipse">Installing the Cloud Foundry Integration Extension in Eclipse</h2>

<p>In Eclipse, follow these steps to install the Cloud Foundry Integration Extension.</p>

<ul>
<li>
    <p>Select <strong>Help &gt; Eclipse Marketplace</strong>.</p>

    <p>A panel opens showing plug-ins and add-ons.</p>
  </li>
  <li>
    <p>In the <strong>Find</strong> field, enter â€œcloud foundryâ€ and click <strong>Go</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_marketplace.png" alt="Eclipse Extension installation"></p>
  </li>
  <li>
    <p>In the search results, select â€œCloud Foundry Integration for Eclipseâ€ and click <strong>Install</strong>.</p>

    <p>Eclipse examines resources and dependencies.</p>
  </li>
  <li>
    <p>Click <strong>Next</strong> to begin the installation.</p>

    <p>An install wizard guides you through license acceptance and installation steps.</p>
  </li>
  <li>
    <p>When the installation is complete, restart Eclipse.</p>

    <p>You are ready to connect to a Cloud Foundry cloud.</p>
  </li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/tools/STS/deploying-CF-Eclipse.html">Deploying Applications and Binding Services</a></li>
  <li><a href="/tools/STS/debugging-CF-Eclipse.html">Debugging</a></li>
  <li><a href="/tools/STS/remote-CF-Eclipse.html">Remote File Access</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"úIf you are developing in Java with the Eclipse IDE or STS (Spring Tool Suite), install the Cloud Foundry Integration Extension to deploy applications to Cloud Foundry. This document describes how to install the extension and how to get started deploying applications from Eclipse or STS.

**Subtopics**

+   [Prerequisites](#prerequisites)
+   [Installing the Cloud Foundry Integration Extension in STS](#installing-the-cloud-foundry-integration-extension-in-sts)
+   [Installing the Cloud Foundry Integration Extension in Eclipse](#installing-the-cloud-foundry-integration-extension-in-eclipse)

## Prerequisites

You must have Eclipse or STS installed. You can download installers from the
following Web sites:

+   [Eclipse download](http://www.eclipse.org/downloads/)

    Confirm that you have **Eclipse IDE for JEE Developers** so that all known dependencies are satisfied.
    (In Eclipse, click **Help > About Eclipse** to view the version of Eclipse you have installed.).
    The minimum supported Eclipse JEE package is **Indigo**.

+   [Spring Tool Suite download](http://www.springsource.org/sts)

    Install version 2.9.0 or higher.

+   Cloud Foundry Integration for Eclipse 1.1.0 is currently the latest release of the integration, and is the first version to be open sourced under the
    Eclipse Public License (EPL). As a consequence, earlier versions of Cloud Foundry Integration, including those with version number 2.7.0,
    cannot be upgraded to the latest version, 1.1.0. Users must first uninstall older Cloud Foundry integrations prior to installing the latest
    version.

## Installing the Cloud Foundry Integration Extension in STS

In STS, follow these steps to install the Cloud Foundry Integration Extension.

*  Select **Help > Dashboard**.

    The Dashboard opens.

*  Click the **Extensions** tab.

    STS loads a list of extensions.

*  Scroll down to the **Server and Clouds** category and select **Cloud Foundry Integration**.

    ![STS Server and Clouds extensions](/images/screenshots/configuring-STS/sts-cf-extension.png)

*  Click **Install**.

    An install wizard guides you through the installation steps.

    ![STS Cloud Foundry install wizard](/images/screenshots/configuring-STS/cf_eclipse_install_wizard.png)

*  Cloud Foundry offers two install options:
   +  **Core / Cloud Foundry Integration**

      Required installation for users who wish to use the feature but not extend the Cloud Foundry Integration.

   + **Resources / Cloud Foundry Integration**

      Optional SDK installation of Cloud Foundry Integration source files for users who wish to extend the Cloud Foundry Integration.
      Users are not required to install **Core / Cloud Foundry** installation with this option.

*  When the installer completes, click **Yes** to restart STS or Eclipse.

## Installing the Cloud Foundry Integration Extension in Eclipse

In Eclipse, follow these steps to install the Cloud Foundry Integration Extension.

*  Select **Help > Eclipse Marketplace**.

    A panel opens showing plug-ins and add-ons.

*  In the **Find** field, enter "cloud foundry" and click **Go**.

    ![Eclipse Extension installation](/images/screenshots/configuring-STS/cf_eclipse_marketplace.png)

*  In the search results, select "Cloud Foundry Integration for Eclipse" and click **Install**.

    Eclipse examines resources and dependencies.

*  Click **Next** to begin the installation.

    An install wizard guides you through license acceptance and installation steps.

*  When the installation is complete, restart Eclipse.

    You are ready to connect to a Cloud Foundry cloud.

## Next Steps

+ [Deploying Applications and Binding Services](/tools/STS/deploying-CF-Eclipse.html)
+ [Debugging](/tools/STS/debugging-CF-Eclipse.html)
+ [Remote File Access](/tools/STS/remote-CF-Eclipse.html);T;
I"]<p>If you are developing in Java with the Eclipse IDE or STS (Spring Tool Suite), install the Cloud Foundry Integration Extension to deploy applications to Cloud Foundry. This document describes how to install the extension and how to get started deploying applications from Eclipse or STS.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#installing-the-cloud-foundry-integration-extension-in-sts">Installing the Cloud Foundry Integration Extension in STS</a></li>
  <li><a href="#installing-the-cloud-foundry-integration-extension-in-eclipse">Installing the Cloud Foundry Integration Extension in Eclipse</a></li>
</ul><h2 id="prerequisites">Prerequisites</h2>

<p>You must have Eclipse or STS installed. You can download installers from the
following Web sites:</p>

<ul>
<li>
    <p><a href="http://www.eclipse.org/downloads/">Eclipse download</a></p>

    <p>Confirm that you have <strong>Eclipse IDE for JEE Developers</strong> so that all known dependencies are satisfied.
(In Eclipse, click <strong>Help &gt; About Eclipse</strong> to view the version of Eclipse you have installed.).
The minimum supported Eclipse JEE package is <strong>Indigo</strong>.</p>
  </li>
  <li>
    <p><a href="http://www.springsource.org/sts">Spring Tool Suite download</a></p>

    <p>Install version 2.9.0 or higher.</p>
  </li>
  <li>
    <p>Cloud Foundry Integration for Eclipse 1.1.0 is currently the latest release of the integration, and is the first version to be open sourced under the
Eclipse Public License (EPL). As a consequence, earlier versions of Cloud Foundry Integration, including those with version number 2.7.0,
cannot be upgraded to the latest version, 1.1.0. Users must first uninstall older Cloud Foundry integrations prior to installing the latest
version.</p>
  </li>
</ul><h2 id="installing-the-cloud-foundry-integration-extension-in-sts">Installing the Cloud Foundry Integration Extension in STS</h2>

<p>In STS, follow these steps to install the Cloud Foundry Integration Extension.</p>

<ul>
<li>
    <p>Select <strong>Help &gt; Dashboard</strong>.</p>

    <p>The Dashboard opens.</p>
  </li>
  <li>
    <p>Click the <strong>Extensions</strong> tab.</p>

    <p>STS loads a list of extensions.</p>
  </li>
  <li>
    <p>Scroll down to the <strong>Server and Clouds</strong> category and select <strong>Cloud Foundry Integration</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-cf-extension.png" alt="STS Server and Clouds extensions"></p>
  </li>
  <li>
    <p>Click <strong>Install</strong>.</p>

    <p>An install wizard guides you through the installation steps.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_install_wizard.png" alt="STS Cloud Foundry install wizard"></p>
  </li>
  <li>Cloud Foundry offers two install options:
    <ul>
<li>
        <p><strong>Core / Cloud Foundry Integration</strong></p>

        <p>Required installation for users who wish to use the feature but not extend the Cloud Foundry Integration.</p>
      </li>
      <li>
        <p><strong>Resources / Cloud Foundry Integration</strong></p>

        <p>Optional SDK installation of Cloud Foundry Integration source files for users who wish to extend the Cloud Foundry Integration.
 Users are not required to install <strong>Core / Cloud Foundry</strong> installation with this option.</p>
      </li>
    </ul>
</li>
  <li>When the installer completes, click <strong>Yes</strong> to restart STS or Eclipse.</li>
</ul><h2 id="installing-the-cloud-foundry-integration-extension-in-eclipse">Installing the Cloud Foundry Integration Extension in Eclipse</h2>

<p>In Eclipse, follow these steps to install the Cloud Foundry Integration Extension.</p>

<ul>
<li>
    <p>Select <strong>Help &gt; Eclipse Marketplace</strong>.</p>

    <p>A panel opens showing plug-ins and add-ons.</p>
  </li>
  <li>
    <p>In the <strong>Find</strong> field, enter â€œcloud foundryâ€ and click <strong>Go</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_marketplace.png" alt="Eclipse Extension installation"></p>
  </li>
  <li>
    <p>In the search results, select â€œCloud Foundry Integration for Eclipseâ€ and click <strong>Install</strong>.</p>

    <p>Eclipse examines resources and dependencies.</p>
  </li>
  <li>
    <p>Click <strong>Next</strong> to begin the installation.</p>

    <p>An install wizard guides you through license acceptance and installation steps.</p>
  </li>
  <li>
    <p>When the installation is complete, restart Eclipse.</p>

    <p>You are ready to connect to a Cloud Foundry cloud.</p>
  </li>
</ul><h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/tools/STS/deploying-CF-Eclipse.html">Deploying Applications and Binding Services</a></li>
  <li><a href="/tools/STS/debugging-CF-Eclipse.html">Debugging</a></li>
  <li><a href="/tools/STS/remote-CF-Eclipse.html">Remote File Access</a></li>
</ul>;T;@1I"%/tools/STS/debugging-CF-Eclipse/;T{;{	;I"Õ<<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/STS/debugging-CF-Eclipse.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Debugging Applications with Cloud Foundry Integration for Eclipse' property='og:title'>
<meta content='Debugging Applications with Cloud Foundry Integration for Eclipse' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Debugging Applications with Cloud Foundry Integration for Eclipse</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Debugging Applications with Cloud Foundry Integration for Eclipse</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Debugging Applications with Cloud Foundry Integration for Eclipse</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/eclipse" rel="tag">eclipse</a><a href="/tags/sts" rel="tag">sts</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="debugging-an-application">Debugging an Application</h2>

<p>Applications deployed to Micro Cloud Foundry or local cloud with debugging support also enable debugging functionality like starting an application
   in debug mode, or connecting an application already running in debug mode to the Eclipse debugger.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_debug.png" alt="Debug from Editor"></p>

<p>For applications running in debug mode, applications can be restarted or update and restarted in either <strong>Debug</strong> or <strong>Run</strong> mode,
   through a drop down menu beside both the <strong>Restart</strong> and <strong>Update and Restart</strong> buttons.
   The button icon and hover tooltip text indicate which mode the application is currently running in.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_updaterestart_debug.png" alt="Debug Update and Restart"></p>

<p>If an application is already running in debug mode, but not connected to the local debugger, the editor allows a user to
   connect to the debugger without restarting the application through a <strong>Connect to Debugger</strong> button.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_connect_to_debugger.png" alt="Connect to Debugger"></p>

<p>If an application is disconnected from the local debugger in the Eclipse Debug view, it will still continue running in
   debug mode in the Cloud Foundry target until it is stopped or removed from the Cloud Foundry target.</p>

<p>Debugging behavior in the Cloud Foundry Integration is similar to debugging local applications, and it is integrated
   into the Eclipse Debug perspective. Users can set break points, step through code, and suspend an application.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_debugging_app.png" alt="Application Debugging"></p>

<p>Multiple applications, and application instances of the same application, can be debugged at the same time, with the Debug view differentiating each debugged application instance by the Cloud Foundry target
   name, application name, and instance ID.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"§## Debugging an Application

   Applications deployed to Micro Cloud Foundry or local cloud with debugging support also enable debugging functionality like starting an application
   in debug mode, or connecting an application already running in debug mode to the Eclipse debugger.

   ![Debug from Editor](/images/screenshots/configuring-STS/cf_eclipse_editor_debug.png)

   For applications running in debug mode, applications can be restarted or update and restarted in either **Debug** or **Run** mode,
   through a drop down menu beside both the **Restart** and **Update and Restart** buttons.
   The button icon and hover tooltip text indicate which mode the application is currently running in.

   ![Debug Update and Restart](/images/screenshots/configuring-STS/cf_eclipse_editor_updaterestart_debug.png)

   If an application is already running in debug mode, but not connected to the local debugger, the editor allows a user to
   connect to the debugger without restarting the application through a **Connect to Debugger** button.

   ![Connect to Debugger](/images/screenshots/configuring-STS/cf_eclipse_editor_connect_to_debugger.png)

   If an application is disconnected from the local debugger in the Eclipse Debug view, it will still continue running in
   debug mode in the Cloud Foundry target until it is stopped or removed from the Cloud Foundry target.

   Debugging behavior in the Cloud Foundry Integration is similar to debugging local applications, and it is integrated
   into the Eclipse Debug perspective. Users can set break points, step through code, and suspend an application.

   ![Application Debugging](/images/screenshots/configuring-STS/cf_eclipse_debugging_app.png)

   Multiple applications, and application instances of the same application, can be debugged at the same time, with the Debug view differentiating each debugged application instance by the Cloud Foundry target
   name, application name, and instance ID.;T;
I"l<h2 id="debugging-an-application">Debugging an Application</h2>

<p>Applications deployed to Micro Cloud Foundry or local cloud with debugging support also enable debugging functionality like starting an application
   in debug mode, or connecting an application already running in debug mode to the Eclipse debugger.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_debug.png" alt="Debug from Editor"></p>

<p>For applications running in debug mode, applications can be restarted or update and restarted in either <strong>Debug</strong> or <strong>Run</strong> mode,
   through a drop down menu beside both the <strong>Restart</strong> and <strong>Update and Restart</strong> buttons.
   The button icon and hover tooltip text indicate which mode the application is currently running in.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_updaterestart_debug.png" alt="Debug Update and Restart"></p>

<p>If an application is already running in debug mode, but not connected to the local debugger, the editor allows a user to
   connect to the debugger without restarting the application through a <strong>Connect to Debugger</strong> button.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_connect_to_debugger.png" alt="Connect to Debugger"></p>

<p>If an application is disconnected from the local debugger in the Eclipse Debug view, it will still continue running in
   debug mode in the Cloud Foundry target until it is stopped or removed from the Cloud Foundry target.</p>

<p>Debugging behavior in the Cloud Foundry Integration is similar to debugging local applications, and it is integrated
   into the Eclipse Debug perspective. Users can set break points, step through code, and suspend an application.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_debugging_app.png" alt="Application Debugging"></p>

<p>Multiple applications, and application instances of the same application, can be debugged at the same time, with the Debug view differentiating each debugged application instance by the Cloud Foundry target
   name, application name, and instance ID.</p>;T;@7I"/tools/STS/sts-eclipse/;T{;{	;I"h7<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/STS/sts-eclipse.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | STS and Eclipse' property='og:title'>
<meta content='Working with Spring Tool Suite and Eclipse' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | STS and Eclipse</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>STS and Eclipse</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Working with Spring Tool Suite and Eclipse</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/sts" rel="tag">sts</a><a href="/tags/spring tool suite" rel="tag">spring tool suite</a><a href="/tags/springsource tool suite" rel="tag">springsource tool suite</a><a href="/tags/eclipse" rel="tag">eclipse</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resources will help you get started using STS and Eclipse with Cloud Foundry:</p>

<ul>
<li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for Eclipse or STS</a></li>
  <li><a href="/tools/STS/deploying-CF-Eclipse.html">Deploying Applications and Binding Services using Cloud Foundry Integration for Eclipse</a></li>
  <li><a href="/tools/STS/debugging-CF-Eclipse.html">Debugging Applications with Cloud Foundry Integration for Eclipse</a></li>
  <li><a href="/tools/STS/remote-CF-Eclipse.html">Access Remote Files Using Remote Systems View</a></li>
  <li><a href="http://blog.cloudfoundry.com/2012/07/31/cloud-foundry-integration-for-eclipse-now-supports-tunneling-to-services/">Cloud Foundry Integration for Eclipse Now Supports Tunneling to Services</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÊThe following resources will help you get started using STS and Eclipse with Cloud Foundry:

+ [Installing the Cloud Foundry Integration Extension for Eclipse or STS](/tools/STS/configuring-STS.html)
+ [Deploying Applications and Binding Services using Cloud Foundry Integration for Eclipse](/tools/STS/deploying-CF-Eclipse.html)
+ [Debugging Applications with Cloud Foundry Integration for Eclipse](/tools/STS/debugging-CF-Eclipse.html)
+ [Access Remote Files Using Remote Systems View](/tools/STS/remote-CF-Eclipse.html)
+ [Cloud Foundry Integration for Eclipse Now Supports Tunneling to Services](http://blog.cloudfoundry.com/2012/07/31/cloud-foundry-integration-for-eclipse-now-supports-tunneling-to-services/);T;
I"><p>The following resources will help you get started using STS and Eclipse with Cloud Foundry:</p>

<ul>
<li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for Eclipse or STS</a></li>
  <li><a href="/tools/STS/deploying-CF-Eclipse.html">Deploying Applications and Binding Services using Cloud Foundry Integration for Eclipse</a></li>
  <li><a href="/tools/STS/debugging-CF-Eclipse.html">Debugging Applications with Cloud Foundry Integration for Eclipse</a></li>
  <li><a href="/tools/STS/remote-CF-Eclipse.html">Access Remote Files Using Remote Systems View</a></li>
  <li><a href="http://blog.cloudfoundry.com/2012/07/31/cloud-foundry-integration-for-eclipse-now-supports-tunneling-to-services/">Cloud Foundry Integration for Eclipse Now Supports Tunneling to Services</a></li>
</ul>;T;@=I""/tools/STS/remote-CF-Eclipse/;T{;{	;I"8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/STS/remote-CF-Eclipse.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Remote File Access' property='og:title'>
<meta content='Access Remote Files Using Remote Systems View' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Remote File Access</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Remote File Access</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Access Remote Files Using Remote Systems View</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/eclipse" rel="tag">eclipse</a><a href="/tags/sts" rel="tag">sts</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<h2 id="remote-file-access">Remote File Access</h2>

<p>The Cloud Foundry Integration extension provides a file browser that you can use to
view files deployed to Cloud Foundry. For example, you can view configuration
files and log files on the remote Cloud Foundry server.</p>

<p>Follow these steps to access the Remote Systems View.</p>

<ul>
<li>
    <p>Select <strong>Window &gt; Show View &gt; Servers</strong>.</p>
  </li>
  <li>
    <p>In the Servers view, expand a Cloud Foundry server and double-click on a deployed application.</p>
  </li>
  <li>
    <p>Under the Application Details pane, click <strong>Remote Systems View</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_remote_view_link.png" alt="Remote Systems View"></p>

    <p>The Remote Systems View appears in the Eclipse workbench.</p>
  </li>
  <li>
    <p>Browse the file tree and open files. Right-click a file to see the options
that are available to you.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_remote_systems_view.png" alt="Browsing Files in Remote Files view"></p>
  </li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"## Remote File Access

The Cloud Foundry Integration extension provides a file browser that you can use to
view files deployed to Cloud Foundry. For example, you can view configuration
files and log files on the remote Cloud Foundry server.

Follow these steps to access the Remote Systems View.

*  Select **Window > Show View > Servers**.

*  In the Servers view, expand a Cloud Foundry server and double-click on a deployed application.

*  Under the Application Details pane, click **Remote Systems View**.

    ![Remote Systems View](/images/screenshots/configuring-STS/cf_eclipse_remote_view_link.png)

    The Remote Systems View appears in the Eclipse workbench.

*  Browse the file tree and open files. Right-click a file to see the options
   that are available to you.

    ![Browsing Files in Remote Files view](/images/screenshots/configuring-STS/cf_eclipse_remote_systems_view.png);T;
I"[<h2 id="remote-file-access">Remote File Access</h2>

<p>The Cloud Foundry Integration extension provides a file browser that you can use to
view files deployed to Cloud Foundry. For example, you can view configuration
files and log files on the remote Cloud Foundry server.</p>

<p>Follow these steps to access the Remote Systems View.</p>

<ul>
<li>
    <p>Select <strong>Window &gt; Show View &gt; Servers</strong>.</p>
  </li>
  <li>
    <p>In the Servers view, expand a Cloud Foundry server and double-click on a deployed application.</p>
  </li>
  <li>
    <p>Under the Application Details pane, click <strong>Remote Systems View</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_remote_view_link.png" alt="Remote Systems View"></p>

    <p>The Remote Systems View appears in the Eclipse workbench.</p>
  </li>
  <li>
    <p>Browse the file tree and open files. Right-click a file to see the options
that are available to you.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_remote_systems_view.png" alt="Browsing Files in Remote Files view"></p>
  </li>
</ul>;T;@CI"%/tools/STS/deploying-CF-Eclipse/;T{;{	;I"Wc<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/STS/deploying-CF-Eclipse.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Deploying Applications using Cloud Foundry Integration for Eclipse' property='og:title'>
<meta content='Deploying Applications and Binding Services using Cloud Foundry Integration for Eclipse' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Deploying Applications using Cloud Foundry Integration for Eclipse</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Deploying Applications using Cloud Foundry Integration for Eclipse</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Deploying Applications and Binding Services using Cloud Foundry Integration for Eclipse</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/eclipse" rel="tag">eclipse</a><a href="/tags/sts" rel="tag">sts</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#define-a-new-server-for-a-cloud-foundry-target">Define a New Server for a Cloud Foundry Target</a></li>
  <li>
<a href="#deploying-applications-to-cloud-foundry-from-sts-or-eclipse">Deploying Applications to Cloud Foundry from STS or Eclipse</a>
    <ul>
<li><a href="#define-application-services">Define application services</a></li>
      <li><a href="#bind-application-services">Bind application services</a></li>
    </ul>
</li>
  <li><a href="#update-and-restart-an-application">Update and Restart an Application</a></li>
</ul><p>When deploying applications to Cloud Foundry using Cloud Foundry Integration for Eclipse, a Cloud Foundry target must first be defined.
Once defined, it will appear in the Eclipse Servers View, where users can drag and drop applications from the Eclipse Project Explorer
to deploy them to the selected Cloud Foundry target.</p>

<h2 id="define-a-new-server-for-a-cloud-foundry-target">Define a New Server for a Cloud Foundry Target</h2>

<p>In STS or Eclipse, you define a new Server to represent a Cloud Foundry target
and then deploy applications to it.</p>

<p>Follow these steps to define the new Server.</p>

<ul>
<li>
    <p>Choose <strong>Window &gt; Show View &gt; Servers</strong>.</p>
  </li>
  <li>
    <p>Either click new server wizard or right-click on an empty area in the Servers view and choose <strong>New &gt; Server</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_empty_servers_view.png" alt="STS New Server"></p>

    <p>The <strong>Define a New Server</strong> wizard starts.</p>
  </li>
  <li>
    <p>Expand the VMware folder, select Cloud Foundry.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_new_cf_server.png" alt="STS New Server Wizard"></p>
  </li>
  <li>
    <p>Specify a display name for the Cloud Foundry server instance that should be created in Server name. Server host name should
remain localhost. Click <strong>Next</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_new_server_account.png" alt="STS New Server Wizard Account"></p>
  </li>
  <li>
    <p>Select the Cloud Foundry target you want to set up from the URL list.</p>

    <ul>
<li>
        <p><strong>VMware Cloud Foundry</strong>. The VMware-hosted open platform as a service.</p>
      </li>
      <li>
        <p><strong>Local Cloud</strong>. A local installation of the VMware Cloud Application Platform (VCAP).</p>
      </li>
      <li>
        <p><strong>Microcloud</strong>. A Micro Cloud Foundry virtual machine.</p>
      </li>
    </ul>
</li>
  <li>
    <p>If you selected <strong>Microcloud</strong>, enter the domain name you registered for
your Micro Cloud Foundry at http://cloudfoundry.com/micro and a descriptive name.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-mcf-domain-name.png" alt="Create Microcloud Target"></p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
  <li>
    <p>Enter an email address and password for the Cloud Foundry target.</p>

    <ul>
<li>
        <p>For a VMware Cloud Foundry target, the email must be
 pre-registered at the Web site. A <strong>CloudFoundry.com</strong> signup button allows users to pre-register an e-mail account.</p>
      </li>
      <li>
        <p>For Local Cloud or Microcloud targets, use an email address you have
 already registered, or enter a new email and password to register, and then click
 <strong>Register Accountâ€¦</strong>.</p>
      </li>
    </ul>
<p>Click <strong>Validate Account</strong> to test whether the account is valid on the
 target Cloud Foundry.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.</p>

    <p>The new Cloud Foundry target appears in the Servers view.</p>
  </li>
</ul><h2 id="deploying-applications-to-cloud-foundry-from-sts-or-eclipse">Deploying Applications to Cloud Foundry From STS or Eclipse</h2>

<p>The Cloud Foundry Integration Extension uses the Eclipse Web Tools Project (WTP)
Server infrastructure, which is used to deploy Java web applications to remote
servers.</p>

<p>There are three steps to deploy an application.</p>

<ul>
<li><a href="#define-application-details">Define application details</a></li>
  <li><a href="#define-application-services">Define application services</a></li>
  <li><a href="#bind-application-services">Bind application services</a></li>
</ul><p>The latter two steps are only required when the application uses Cloud Foundry
services, such as a MySQL or vFabric Postgres database, or RabbitMQ messaging.</p>

<h2 id="define-application-details">Define Application Details</h2>

<ul>
<li>
    <p>In STS or Eclipse, select <strong>Windows &gt; Show View &gt; Servers</strong> to display the
 Servers view.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_servers_view_cf_server.png" alt="Show Servers"></p>

    <p>Currently deployed applications, if any, are listed beneath the servers.</p>
  </li>
  <li>
    <p>To deploy an application, drag it to the target Cloud Foundry Server in the Servers view.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_drag_drop_app.png" alt="Drag and Drop App"></p>

    <p>Alternatively, you can double click on the server and the Cloud Foundry editor will open, allowing users to drag and drop
 applications into the Applications tab.</p>

    <p>The Cloud Foundry Integration Extension examines the application to determine the application type and verify that it is
 deployable to the selected Cloud Foundry server. If so, it opens an Application details wizard, where the application can be
 configured and optional services bound. Supported application types include <strong>Spring</strong>, <strong>Grails</strong>, <strong>Lift</strong>, and <strong>Java Web</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details.png" alt="Application details"></p>
  </li>
  <li>
    <p>Change the name of the application, if desired, and select the correct
 Application Type if the integration extension incorrectly identified the
 applicationâ€™s framework, then click <strong>Next</strong>.</p>

    <p><strong>Note:</strong>
 The application name, here, is only used to identify the
 application for administration. The name exposed to users in the
 applicationâ€™s URL is set on the next page of the wizard.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details_regular_start.png" alt="Launch deployment"></p>
  </li>
  <li>
    <p>Edit the Deployed URL and change the Memory Reservation if needed.</p>

    <p>The Deployed URL must be unique at the target Cloud Foundry.</p>
  </li>
  <li>
    <p>If you need to bind services to the application, click <strong>Next</strong> to bind them prior to deployment, or unselect <strong>Start application on
deployment</strong> and bind the services after deployment through the Cloud Foundry server editor.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>, although optionally a user may select <strong>Next</strong> to bind services prior to deployment.</p>

    <p>The application is deployed. If you chose <strong>Start application on deployment</strong> it is started and can be accessed at the mapped
 URL. If deploying to a microcloud or local cloud with debugging support, an additional option for starting the application in
 <strong>Debug</strong> mode is displayed.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details_debug_start.png" alt="Launch deployment debug"></p>
  </li>
  <li>
    <p>If clicking <strong>Next</strong>, existing services can be bound to the application, or additional services can be defined and then bound.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_deployment_services.png" alt="Bind services on deployment"></p>
  </li>
  <li>
    <p>Once deployed, in the Servers view, double-click the application to open the editor and display the application stats as well as
controls to start, stop, restart, update and restart the application, and also change the applicationâ€™s configuration and bound services.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png" alt="Applications Control Panel"></p>
  </li>
</ul><h2 id="define-application-services">Define Application Services</h2>

<p>You must define a service before you bind it to a deployed application. The
Cloud Foundry Integration extension retrieves a catalog of available services
from the target Cloud Foundry. After you define a service, you can bind it to
the application. Services can be bound to an application from the Application details
wizard during deployment or from the Cloud Foundry server editor after deployment, if the application is stopped.</p>

<p>Follow these steps to define a service from the editor.</p>

<ul>
<li>
    <p>In the Servers view, double-click the application name.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png" alt="STS Applications Tab"></p>

    <p>The Applications tab shows details about the applications on the Cloud
 Foundry target.</p>
  </li>
  <li>
    <p>In the Services section, click the <strong>Add service</strong> icon.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_services_table.png" alt="STS Add Service"></p>
  </li>
  <li>
    <p>Provide a name for the new service and select the type of service.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-service-configuration.png" alt="STS Service Configuration"></p>

    <p>The <strong>Type</strong> list contains all of the service types available on the
 target Cloud Foundry.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.</p>

    <p>The plug-in requests the service from Cloud Foundry and the new service
 appears in the Services section.</p>
  </li>
</ul><h2 id="bind-application-services">Bind Application Services</h2>

<p>When you bind a service to an application, the Cloud Foundry Integration
extension updates the application configuration files to access the defined
service. The application must not be running when you bind services.</p>

<ul>
<li>
    <p>If it is running, stop the application:</p>

    <ul>
<li>In the Servers view, right-click on the application name and select <strong>Stop</strong>, or</li>
      <li>In the Applications panel in the Cloud Foundry server editor, select the application and click the <strong>Stop</strong> button.</li>
    </ul>
</li>
  <li>
    <p>In the Applications panel, select the application you want to bind a
 service to.</p>
  </li>
  <li>
    <p>Select the service you want to bind in the Services panel and drag it to the
 Application Services Panel.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_bind_service.png" alt="sts bind service"></p>
  </li>
  <li>
    <p>Click the <strong>Start</strong> button.</p>
  </li>
</ul><h2 id="update-and-restart-an-application">Update and Restart an Application</h2>

<p>The Applications Tab in the Cloud Foundry editor allows users to modify application details like memory, number of running instances, mapped application URLs, as well as starting, stopping, restarting, and update and restarting an application.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_regular_updaterestart.png" alt="Regular Update and Restart"></p>

<p>Users can restart an application without publishing changes in an application through a <strong>Restart</strong> button or context menu action
   in the Servers view, or update changes in a deployed application and restarting it using an <strong>Update and Restart</strong> option.</p>

<p><strong>Update and Restart</strong> incrementally publishes local changes in an application, and is optimized to only push resources that have
   changed since the last publish.</p>

<p>Stop and Starting an application performs a full publish.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I";&**Subtopics**

+   [Define a New Server for a Cloud Foundry Target](#define-a-new-server-for-a-cloud-foundry-target)
+   [Deploying Applications to Cloud Foundry from STS or Eclipse](#deploying-applications-to-cloud-foundry-from-sts-or-eclipse)
    +   [Define application services](#define-application-services)
    +   [Bind application services](#bind-application-services)
+   [Update and Restart an Application](#update-and-restart-an-application)

When deploying applications to Cloud Foundry using Cloud Foundry Integration for Eclipse, a Cloud Foundry target must first be defined.
Once defined, it will appear in the Eclipse Servers View, where users can drag and drop applications from the Eclipse Project Explorer
to deploy them to the selected Cloud Foundry target.

## Define a New Server for a Cloud Foundry Target

In STS or Eclipse, you define a new Server to represent a Cloud Foundry target
and then deploy applications to it.

Follow these steps to define the new Server.

*  Choose **Window > Show View > Servers**.

*  Either click new server wizard or right-click on an empty area in the Servers view and choose **New > Server**.

    ![STS New Server](/images/screenshots/configuring-STS/cf_eclipse_empty_servers_view.png)

    The **Define a New Server** wizard starts.

*  Expand the VMware folder, select Cloud Foundry.

    ![STS New Server Wizard](/images/screenshots/configuring-STS/cf_eclipse_new_cf_server.png)

*  Specify a display name for the Cloud Foundry server instance that should be created in Server name. Server host name should
   remain localhost. Click **Next**.

   ![STS New Server Wizard Account](/images/screenshots/configuring-STS/cf_eclipse_new_server_account.png)

*  Select the Cloud Foundry target you want to set up from the URL list.

    +   **VMware Cloud Foundry**. The VMware-hosted open platform as a service.

    +   **Local Cloud**. A local installation of the VMware Cloud Application Platform (VCAP).

    +   **Microcloud**. A Micro Cloud Foundry virtual machine.

*  If you selected **Microcloud**, enter the domain name you registered for
   your Micro Cloud Foundry at http://cloudfoundry.com/micro and a descriptive name.

    ![Create Microcloud Target](/images/screenshots/configuring-STS/sts-mcf-domain-name.png)

*  Click **OK**.

*  Enter an email address and password for the Cloud Foundry target.

    + For a VMware Cloud Foundry target, the email must be
    pre-registered at the Web site. A **CloudFoundry.com** signup button allows users to pre-register an e-mail account.

    + For Local Cloud or Microcloud targets, use an email address you have
    already registered, or enter a new email and password to register, and then click
    **Register Account...**.

    Click **Validate Account** to test whether the account is valid on the
    target Cloud Foundry.

* Click **Finish**.

    The new Cloud Foundry target appears in the Servers view.

## Deploying Applications to Cloud Foundry From STS or Eclipse

The Cloud Foundry Integration Extension uses the Eclipse Web Tools Project (WTP)
Server infrastructure, which is used to deploy Java web applications to remote
servers.

There are three steps to deploy an application.

+   [Define application details](#define-application-details)
+   [Define application services](#define-application-services)
+   [Bind application services](#bind-application-services)

The latter two steps are only required when the application uses Cloud Foundry
services, such as a MySQL or vFabric Postgres database, or RabbitMQ messaging.

## Define Application Details

*  In STS or Eclipse, select **Windows > Show View > Servers** to display the
    Servers view.

    ![Show Servers](/images/screenshots/configuring-STS/cf_eclipse_servers_view_cf_server.png)

    Currently deployed applications, if any, are listed beneath the servers.

*  To deploy an application, drag it to the target Cloud Foundry Server in the Servers view.

    ![Drag and Drop App](/images/screenshots/configuring-STS/cf_eclipse_drag_drop_app.png)

    Alternatively, you can double click on the server and the Cloud Foundry editor will open, allowing users to drag and drop
    applications into the Applications tab.

    The Cloud Foundry Integration Extension examines the application to determine the application type and verify that it is
    deployable to the selected Cloud Foundry server. If so, it opens an Application details wizard, where the application can be
    configured and optional services bound. Supported application types include **Spring**, **Grails**, **Lift**, and **Java Web**.

    ![Application details](/images/screenshots/configuring-STS/cf_eclipse_application_details.png)

*  Change the name of the application, if desired, and select the correct
    Application Type if the integration extension incorrectly identified the
    application's framework, then click **Next**.

    **Note:**
    The application name, here, is only used to identify the
    application for administration. The name exposed to users in the
    application's URL is set on the next page of the wizard.

    ![Launch deployment](/images/screenshots/configuring-STS/cf_eclipse_application_details_regular_start.png)

*  Edit the Deployed URL and change the Memory Reservation if needed.

    The Deployed URL must be unique at the target Cloud Foundry.

*  If you need to bind services to the application, click **Next** to bind them prior to deployment, or unselect **Start application on
   deployment** and bind the services after deployment through the Cloud Foundry server editor.

*  Click **Finish**, although optionally a user may select **Next** to bind services prior to deployment.

    The application is deployed. If you chose **Start application on deployment** it is started and can be accessed at the mapped
    URL. If deploying to a microcloud or local cloud with debugging support, an additional option for starting the application in
    **Debug** mode is displayed.

    ![Launch deployment debug](/images/screenshots/configuring-STS/cf_eclipse_application_details_debug_start.png)

*  If clicking **Next**, existing services can be bound to the application, or additional services can be defined and then bound.

    ![Bind services on deployment](/images/screenshots/configuring-STS/cf_eclipse_application_deployment_services.png)

*  Once deployed, in the Servers view, double-click the application to open the editor and display the application stats as well as
   controls to start, stop, restart, update and restart the application, and also change the application's configuration and bound services.

    ![Applications Control Panel](/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png)

## Define Application Services

You must define a service before you bind it to a deployed application. The
Cloud Foundry Integration extension retrieves a catalog of available services
from the target Cloud Foundry. After you define a service, you can bind it to
the application. Services can be bound to an application from the Application details
wizard during deployment or from the Cloud Foundry server editor after deployment, if the application is stopped.

Follow these steps to define a service from the editor.

*  In the Servers view, double-click the application name.

    ![STS Applications Tab](/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png)

    The Applications tab shows details about the applications on the Cloud
    Foundry target.

*  In the Services section, click the **Add service** icon.

    ![STS Add Service](/images/screenshots/configuring-STS/cf_eclipse_editor_services_table.png)

*  Provide a name for the new service and select the type of service.

    ![STS Service Configuration](/images/screenshots/configuring-STS/sts-service-configuration.png)

    The **Type** list contains all of the service types available on the
    target Cloud Foundry.

*  Click **Finish**.

    The plug-in requests the service from Cloud Foundry and the new service
    appears in the Services section.

## Bind Application Services

When you bind a service to an application, the Cloud Foundry Integration
extension updates the application configuration files to access the defined
service. The application must not be running when you bind services.

*  If it is running, stop the application:

   + In the Servers view, right-click on the application name and select **Stop**, or
   + In the Applications panel in the Cloud Foundry server editor, select the application and click the **Stop** button.

*  In the Applications panel, select the application you want to bind a
    service to.

*  Select the service you want to bind in the Services panel and drag it to the
    Application Services Panel.

    ![sts bind service](/images/screenshots/configuring-STS/cf_eclipse_bind_service.png)

*  Click the **Start** button.


## Update and Restart an Application

The Applications Tab in the Cloud Foundry editor allows users to modify application details like memory, number of running instances, mapped application URLs, as well as starting, stopping, restarting, and update and restarting an application.


   ![Regular Update and Restart](/images/screenshots/configuring-STS/cf_eclipse_editor_regular_updaterestart.png)

   Users can restart an application without publishing changes in an application through a **Restart** button or context menu action
   in the Servers view, or update changes in a deployed application and restarting it using an **Update and Restart** option.

   **Update and Restart** incrementally publishes local changes in an application, and is optimized to only push resources that have
   changed since the last publish.

   Stop and Starting an application performs a full publish.;T;
I"¿.<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#define-a-new-server-for-a-cloud-foundry-target">Define a New Server for a Cloud Foundry Target</a></li>
  <li>
<a href="#deploying-applications-to-cloud-foundry-from-sts-or-eclipse">Deploying Applications to Cloud Foundry from STS or Eclipse</a>
    <ul>
<li><a href="#define-application-services">Define application services</a></li>
      <li><a href="#bind-application-services">Bind application services</a></li>
    </ul>
</li>
  <li><a href="#update-and-restart-an-application">Update and Restart an Application</a></li>
</ul><p>When deploying applications to Cloud Foundry using Cloud Foundry Integration for Eclipse, a Cloud Foundry target must first be defined.
Once defined, it will appear in the Eclipse Servers View, where users can drag and drop applications from the Eclipse Project Explorer
to deploy them to the selected Cloud Foundry target.</p>

<h2 id="define-a-new-server-for-a-cloud-foundry-target">Define a New Server for a Cloud Foundry Target</h2>

<p>In STS or Eclipse, you define a new Server to represent a Cloud Foundry target
and then deploy applications to it.</p>

<p>Follow these steps to define the new Server.</p>

<ul>
<li>
    <p>Choose <strong>Window &gt; Show View &gt; Servers</strong>.</p>
  </li>
  <li>
    <p>Either click new server wizard or right-click on an empty area in the Servers view and choose <strong>New &gt; Server</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_empty_servers_view.png" alt="STS New Server"></p>

    <p>The <strong>Define a New Server</strong> wizard starts.</p>
  </li>
  <li>
    <p>Expand the VMware folder, select Cloud Foundry.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_new_cf_server.png" alt="STS New Server Wizard"></p>
  </li>
  <li>
    <p>Specify a display name for the Cloud Foundry server instance that should be created in Server name. Server host name should
remain localhost. Click <strong>Next</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_new_server_account.png" alt="STS New Server Wizard Account"></p>
  </li>
  <li>
    <p>Select the Cloud Foundry target you want to set up from the URL list.</p>

    <ul>
<li>
        <p><strong>VMware Cloud Foundry</strong>. The VMware-hosted open platform as a service.</p>
      </li>
      <li>
        <p><strong>Local Cloud</strong>. A local installation of the VMware Cloud Application Platform (VCAP).</p>
      </li>
      <li>
        <p><strong>Microcloud</strong>. A Micro Cloud Foundry virtual machine.</p>
      </li>
    </ul>
</li>
  <li>
    <p>If you selected <strong>Microcloud</strong>, enter the domain name you registered for
your Micro Cloud Foundry at http://cloudfoundry.com/micro and a descriptive name.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-mcf-domain-name.png" alt="Create Microcloud Target"></p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
  <li>
    <p>Enter an email address and password for the Cloud Foundry target.</p>

    <ul>
<li>
        <p>For a VMware Cloud Foundry target, the email must be
 pre-registered at the Web site. A <strong>CloudFoundry.com</strong> signup button allows users to pre-register an e-mail account.</p>
      </li>
      <li>
        <p>For Local Cloud or Microcloud targets, use an email address you have
 already registered, or enter a new email and password to register, and then click
 <strong>Register Accountâ€¦</strong>.</p>
      </li>
    </ul>
<p>Click <strong>Validate Account</strong> to test whether the account is valid on the
 target Cloud Foundry.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.</p>

    <p>The new Cloud Foundry target appears in the Servers view.</p>
  </li>
</ul><h2 id="deploying-applications-to-cloud-foundry-from-sts-or-eclipse">Deploying Applications to Cloud Foundry From STS or Eclipse</h2>

<p>The Cloud Foundry Integration Extension uses the Eclipse Web Tools Project (WTP)
Server infrastructure, which is used to deploy Java web applications to remote
servers.</p>

<p>There are three steps to deploy an application.</p>

<ul>
<li><a href="#define-application-details">Define application details</a></li>
  <li><a href="#define-application-services">Define application services</a></li>
  <li><a href="#bind-application-services">Bind application services</a></li>
</ul><p>The latter two steps are only required when the application uses Cloud Foundry
services, such as a MySQL or vFabric Postgres database, or RabbitMQ messaging.</p>

<h2 id="define-application-details">Define Application Details</h2>

<ul>
<li>
    <p>In STS or Eclipse, select <strong>Windows &gt; Show View &gt; Servers</strong> to display the
 Servers view.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_servers_view_cf_server.png" alt="Show Servers"></p>

    <p>Currently deployed applications, if any, are listed beneath the servers.</p>
  </li>
  <li>
    <p>To deploy an application, drag it to the target Cloud Foundry Server in the Servers view.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_drag_drop_app.png" alt="Drag and Drop App"></p>

    <p>Alternatively, you can double click on the server and the Cloud Foundry editor will open, allowing users to drag and drop
 applications into the Applications tab.</p>

    <p>The Cloud Foundry Integration Extension examines the application to determine the application type and verify that it is
 deployable to the selected Cloud Foundry server. If so, it opens an Application details wizard, where the application can be
 configured and optional services bound. Supported application types include <strong>Spring</strong>, <strong>Grails</strong>, <strong>Lift</strong>, and <strong>Java Web</strong>.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details.png" alt="Application details"></p>
  </li>
  <li>
    <p>Change the name of the application, if desired, and select the correct
 Application Type if the integration extension incorrectly identified the
 applicationâ€™s framework, then click <strong>Next</strong>.</p>

    <p><strong>Note:</strong>
 The application name, here, is only used to identify the
 application for administration. The name exposed to users in the
 applicationâ€™s URL is set on the next page of the wizard.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details_regular_start.png" alt="Launch deployment"></p>
  </li>
  <li>
    <p>Edit the Deployed URL and change the Memory Reservation if needed.</p>

    <p>The Deployed URL must be unique at the target Cloud Foundry.</p>
  </li>
  <li>
    <p>If you need to bind services to the application, click <strong>Next</strong> to bind them prior to deployment, or unselect <strong>Start application on
deployment</strong> and bind the services after deployment through the Cloud Foundry server editor.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>, although optionally a user may select <strong>Next</strong> to bind services prior to deployment.</p>

    <p>The application is deployed. If you chose <strong>Start application on deployment</strong> it is started and can be accessed at the mapped
 URL. If deploying to a microcloud or local cloud with debugging support, an additional option for starting the application in
 <strong>Debug</strong> mode is displayed.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_details_debug_start.png" alt="Launch deployment debug"></p>
  </li>
  <li>
    <p>If clicking <strong>Next</strong>, existing services can be bound to the application, or additional services can be defined and then bound.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_application_deployment_services.png" alt="Bind services on deployment"></p>
  </li>
  <li>
    <p>Once deployed, in the Servers view, double-click the application to open the editor and display the application stats as well as
controls to start, stop, restart, update and restart the application, and also change the applicationâ€™s configuration and bound services.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png" alt="Applications Control Panel"></p>
  </li>
</ul><h2 id="define-application-services">Define Application Services</h2>

<p>You must define a service before you bind it to a deployed application. The
Cloud Foundry Integration extension retrieves a catalog of available services
from the target Cloud Foundry. After you define a service, you can bind it to
the application. Services can be bound to an application from the Application details
wizard during deployment or from the Cloud Foundry server editor after deployment, if the application is stopped.</p>

<p>Follow these steps to define a service from the editor.</p>

<ul>
<li>
    <p>In the Servers view, double-click the application name.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png" alt="STS Applications Tab"></p>

    <p>The Applications tab shows details about the applications on the Cloud
 Foundry target.</p>
  </li>
  <li>
    <p>In the Services section, click the <strong>Add service</strong> icon.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_services_table.png" alt="STS Add Service"></p>
  </li>
  <li>
    <p>Provide a name for the new service and select the type of service.</p>

    <p><img src="/images/screenshots/configuring-STS/sts-service-configuration.png" alt="STS Service Configuration"></p>

    <p>The <strong>Type</strong> list contains all of the service types available on the
 target Cloud Foundry.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.</p>

    <p>The plug-in requests the service from Cloud Foundry and the new service
 appears in the Services section.</p>
  </li>
</ul><h2 id="bind-application-services">Bind Application Services</h2>

<p>When you bind a service to an application, the Cloud Foundry Integration
extension updates the application configuration files to access the defined
service. The application must not be running when you bind services.</p>

<ul>
<li>
    <p>If it is running, stop the application:</p>

    <ul>
<li>In the Servers view, right-click on the application name and select <strong>Stop</strong>, or</li>
      <li>In the Applications panel in the Cloud Foundry server editor, select the application and click the <strong>Stop</strong> button.</li>
    </ul>
</li>
  <li>
    <p>In the Applications panel, select the application you want to bind a
 service to.</p>
  </li>
  <li>
    <p>Select the service you want to bind in the Services panel and drag it to the
 Application Services Panel.</p>

    <p><img src="/images/screenshots/configuring-STS/cf_eclipse_bind_service.png" alt="sts bind service"></p>
  </li>
  <li>
    <p>Click the <strong>Start</strong> button.</p>
  </li>
</ul><h2 id="update-and-restart-an-application">Update and Restart an Application</h2>

<p>The Applications Tab in the Cloud Foundry editor allows users to modify application details like memory, number of running instances, mapped application URLs, as well as starting, stopping, restarting, and update and restarting an application.</p>

<p><img src="/images/screenshots/configuring-STS/cf_eclipse_editor_regular_updaterestart.png" alt="Regular Update and Restart"></p>

<p>Users can restart an application without publishing changes in an application through a <strong>Restart</strong> button or context menu action
   in the Servers view, or update changes in a deployed application and restarting it using an <strong>Update and Restart</strong> option.</p>

<p><strong>Update and Restart</strong> incrementally publishes local changes in an application, and is optimized to only push resources that have
   changed since the last publish.</p>

<p>Stop and Starting an application performs a full publish.</p>;T;@II"/tools/vmc/vmc-quick-ref/;T{;{	;I"#t<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/vmc-quick-ref.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | VMC Quick Reference' property='og:title'>
<meta content='All of the vmc commands available' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | VMC Quick Reference</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>VMC Quick Reference</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>All of the vmc commands available</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/vmc" rel="tag">vmc</a><a href="/tags/CLI" rel="tag">CLI</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This section groups the main VMC commands into functional categories and provides typical usage.   In the examples, text displayed like <code>&lt;this&gt;</code> indicates a variable whose value is specific to your environment.</p>

<p>Run <code>vmc help</code> to view the complete list of VMC commands, along with their parameters and a brief description.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#getting-the-latest-version-of-vmc">Getting the Latest Version of VMC</a></li>
  <li><a href="#suppressing-prompts-to-run-in-non-interactive-mode">Suppressing Prompts to Run In Non-Interactive Mode</a></li>
  <li><a href="#targeting-cloud-foundry">Targeting Cloud Foundry</a></li>
  <li><a href="#logging-in-and-managing-accounts">Logging In and Managing Accounts</a></li>
  <li><a href="#deploying-applications">Deploying Applications</a></li>
  <li><a href="#updating-a-deployment">Updating a Deployment</a></li>
  <li><a href="#managing-the-deployment-lifecycle-start-stop-delete">Managing the Deployment Lifecycle (Start, Stop, Delete)</a></li>
  <li><a href="#managing-and-binding-services">Managing and Binding Services</a></li>
  <li><a href="#getting-information-about-the-cloud-foundry-target">Getting Information about the Cloud Foundry Target</a></li>
  <li><a href="#getting-information-about-applications">Getting Information about Applications</a></li>
</ul><h2 id="getting-the-latest-version-of-vmc">Getting the Latest Version of VMC</h2>

<p><code>vmc</code> is provided as a Ruby gem, and is being constantly updated with new commands or new options to existing commands.  For this reason, be sure you have the latest version by executing the following RubyGems command:</p>

<pre class="terminal">
prompt$ gem update vmc
</pre>

<h2 id="suppressing-prompts-to-run-in-non-interactive-mode">Suppressing Prompts to Run In Non-Interactive Mode</h2>

<p>By default, <code>vmc</code> operates in interactive mode and the execution of many commands results in multiple prompts for values for specific options. To use <code>vmc</code> in non-interactive mode and provide options in the command itself, use the following syntax:</p>

<pre class="terminal">
prompt$ vmc *command* -n --options
</pre>

<p>For example, to deploy an application and take the default value for all prompts:</p>

<pre class="terminal">
prompt$ vmc push &lt;appname&gt; -n
</pre>

<p>To display all commands and options which can be used as parameters on the command line:</p>

<pre class="terminal">
prompt$ vmc help options
</pre>

<h2 id="targeting-cloud-foundry">Targeting Cloud Foundry</h2>

<p>Target Cloud Foundry in the Cloud:</p>

<pre class="terminal">
prompt$ vmc target api.cloudfoundry.com
</pre>

<p>Target a standalone a Micro Cloud Foundry running on your local virtual machine:</p>

<pre class="terminal">
prompt$ vmc target api.&lt;domain&gt;.cloudfoundry.com
</pre>

<p><strong>Note</strong>: You specified the value of <em>domain</em> when you initially installed Micro Cloud Foundry.</p>

<p>Display the current target URL:</p>

<pre class="terminal">
prompt$ vmc target
</pre>

<p>Display the list of known targets and the associated authorization tokens:</p>

<pre class="terminal">
prompt$ vmc targets
</pre>

<h2 id="logging-in-and-managing-accounts">Logging In and Managing Accounts</h2>

<p>Identify yourself to Cloud Foundry with your account information:</p>

<pre class="terminal">
prompt$ vmc login &lt;youremail@email.com&gt; --passwd &lt;yourpassword&gt;
</pre>

<p>Change your password:</p>

<pre class="terminal">
prompt$ vmc passwd
</pre>

<p>Logout from your current session:</p>

<pre class="terminal">
prompt$ vmc logout
</pre>

<p>Get information about your Cloud Foundry account, the version of VMC you are using, and the total resources you have consumed:</p>

<pre class="terminal">
prompt$ vmc info
</pre>

<p>(Micro Cloud Foundry Only) Register a new user.  Requires administrator privileges:</p>

<pre class="terminal">
prompt$ vmc add-user --email &lt;newemail@email.com&gt; --passwd &lt;newpasswd&gt;
</pre>

<p>(Micro Cloud Foundry Only) Delete a registered user and all applications and service instances associated with the user.  Requires administrator privileges:</p>

<pre class="terminal">
prompt$ vmc delete-user &lt;useremail@email.com&gt;
</pre>

<h2 id="deploying-applications">Deploying Applications</h2>

<p>Deploy an application by executing the command from the directory that contains the application artifacts (such as <code>myapp.war</code> or <code>myapp.rb</code>).  This is the interactive way to deploy an application, and the VMC command prompts you for information such as the name of the application, its deployment URL, its programming framework, memory allocation, and the service instances that will be bound to it.   The command then deploys the application to the target to which your current session is associated, stages it, and starts it so that it is immediately available.</p>

<pre class="terminal">
prompt$ vmc push
</pre>

<p>You can specify one or all of the following options to pass deployment values;  if you do not specify an option, <code>vmc push</code> will interactively prompt you for it:</p>

<pre class="terminal">
prompt$ vmc push &lt;appname&gt; --path &lt;directory&gt; --url &lt;deploymentURL&gt; --instances &lt;instance-number&gt;  --mem &lt;MB&gt; --no-start
</pre>

<p>where:</p>

<ul>
<li>
<em>appname</em> refers to the internal name you want to give to your application.</li>
  <li>
<em>directory</em> refers to the absolute or relative local directory name that contains your application.  Note that <em>all</em> files in the directory will be pushed by the <code>vmc push</code> command, so be sure you include only the files you want to deploy in the directory.</li>
  <li>
<em>deploymentURL</em> refers to the URL that you will later use to invoke your application in a browser; default is <code>&lt;appname&gt;.cloudfoundry.com</code>
</li>
  <li>
<em>instance-number</em> specifies the number of instances of the application to start; default is 1</li>
  <li>
<em>MB</em> specifies the upper memory limit of the application, in MB; default is 512 MB</li>
  <li>
<em>â€“no-start</em> specifies that you do not want Cloud Foundry to actually start the application yet, which it will do by default.</li>
</ul><p>The <code>vmc push</code> command will still prompt you for the runtime and associated service instances, even if you specify all the options above.</p>

<p>For example:</p>

<pre class="terminal">
prompt$ vmc push hello --path /usr/bob/sample-apps/hello --url hello-bob.cloudfoundry.com --instances 2 --mem 64 --no-start
</pre>

<h2 id="updating-a-deployment">Updating a Deployment</h2>

<p>Update a deployed application with the application bits in the current directory:</p>

<pre class="terminal">
prompt$ vmc update &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>The preceding command immediately ends any existing user sessions connected to the deployed application.</p>

<p>Update the memory (in MB) that has been reserved for an existing deployment; the application will be automatically restarted:</p>

<pre class="terminal">
prompt$ vmc mem &lt;appname&gt; &lt;MB&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc stats &lt;appname&gt;</code> to view the currently reserved memory for the application, as well as how much it is currently using.</p>

<p>Register a new deployment URL with an existing deployed application; this command <em>adds</em> the URL to the existing list of registered URLs:</p>

<pre class="terminal">
prompt$ vmc map &lt;appname&gt; &lt;URL&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc apps</code> to view the list of URLs currently registered for a deployed application.</p>

<p>Unregister a URL for a deployed application:</p>

<pre class="terminal">
prompt$ vmc unmap &lt;appname&gt; &lt;URL&gt;
</pre>

<p>Scale an application (both up and down) by changing the number of instances that are currently deployed:</p>

<pre class="terminal">
prompt$ vmc instances &lt;appname&gt; &lt;number-of-instances&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc apps</code> to view the current number of instances for a deployed application.</p>

<h2 id="managing-the-deployment-lifecycle-start-stop-delete">Managing the Deployment Lifecycle (Start, Stop, Delete)</h2>

<p>Stop a currently running deployment:</p>

<pre class="terminal">
prompt$ vmc stop &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>Start a currently stopped deployment:</p>

<pre class="terminal">
prompt$ vmc start &lt;appname&gt;
</pre>

<p>Restart a currently running deployment:</p>

<pre class="terminal">
prompt$ vmc restart &lt;appname&gt;
</pre>

<p>Delete an application:</p>

<pre class="terminal">
prompt$ vmc delete &lt;appname&gt;
</pre>

<p>Rename an application:</p>

<pre class="terminal">
prompt$ vmc rename &lt;appname&gt; &lt;new-appname&gt;
</pre>

<h2 id="managing-and-binding-services">Managing and Binding Services</h2>

<p>Display the supported service types and the instances of these services you have already provisioned:</p>

<pre class="terminal">
prompt$ vmc services
</pre>

<p><strong>Note</strong>: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the <code>vmc create-service</code> command.)  These are called <em>provisioned services</em>. Use  the <code>vmc apps</code> command to determine which of these service instances are currently bound to deployed applications.</p>

<p>Create a new instance of a service type and assign it a name:</p>

<pre class="terminal">
prompt$ vmc create-service &lt;service-type&gt; &lt;service-instance-name&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc services</code> to view the list of available service types for which you can create an instance.  Use the name of the service type listed in the first column of the first table.</p>

<p>Create a new instance of a service type, assign it a name, and immediately bind it to a deployed application:</p>

<pre class="terminal">
prompt$ vmc create-service &lt;service-type&gt; &lt;service-instance-name&gt; &lt;appnam&gt;
</pre>

<p>Bind a service instance to a deployed application.   Assumes that you have already deployed the application using <code>vmc push</code>:</p>

<pre class="terminal">
prompt$ vmc bind-service &lt;service-instance-name&gt; &lt;appname&gt;
</pre>

<p><strong>Note</strong>:  Use <code>vmc services</code> to view the name of your service instance (first column of second table).</p>

<p>Remove the binding between a service instance and an application:</p>

<pre class="terminal">
prompt$ vmc unbind-service &lt;service-instance-name&gt; &lt;appname&gt;
</pre>

<p>Delete an instance of a service:</p>

<pre class="terminal">
prompt$ vmc delete-service &lt;service-instance-name&gt;
</pre>

<p>To bind an existing service instance at the same time you deploy an application using <code>vmc push</code>, enter <code>y</code> at the two prompts then specify the number of the service instance from the provided list.  For example (only relevant output and prompts of the <code>vmc push</code> command shown):</p>

<pre class="terminal">
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. Insight-19ff7b1
        2. mysql-juliet
        Please select one you wish to provision: 2
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

</pre>

<p>To create a new service instance at the time you deploy an application, and then bind the new service instance to the application, specify the appropriate prompts and information about the new service instance.  For example (only relevant output and prompts of <code>vmc push</code> shown):</p>

<pre class="terminal">
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? n
        The following system services are available:
        1. mongodb
        2. mysql
        3. postgresql
        4. rabbitmq
        5. redis
        Please select one you wish to provision: 2
        Specify the name of the service [mysql-ab63]: mysql-new
        Creating Service: OK
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

</pre>

<h2 id="getting-information-about-the-cloud-foundry-target">Getting Information about the Cloud Foundry Target</h2>

<p>Display the supported programming languages:</p>

<pre class="terminal">
prompt$ vmc runtimes
</pre>

<p>Display the supported programming frameworks:</p>

<pre class="terminal">
prompt$ vmc frameworks
</pre>

<p>Display the supported service types (such as MySQL and RabbitMQ) and the instances of these service types that you have created:</p>

<pre class="terminal">
prompt$ vmc services
</pre>

<p><strong>Note</strong>: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the <code>vmc create-service</code> command.)  Use  the <code>vmc apps</code> command to determine which of these service instances are currently bound to deployed applications.</p>

<h2 id="getting-information-about-applications">Getting Information about Applications</h2>

<p>Display the list of applications that are currently deployed for your account, along with instances, health, and associated service instances:</p>

<pre class="terminal">
prompt$ vmc apps
</pre>

<p>Display the standard output log entries for an application:</p>

<pre class="terminal">
prompt$ vmc logs &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>Display the recent crashes of a particular application:</p>

<pre class="terminal">
prompt$ vmc crashes &lt;appname&gt;
</pre>

<p>Display any fatal errors that occurred for an application:</p>

<pre class="terminal">
prompt$ vmc crashlogs &lt;appname&gt;
</pre>

<p>Display resource information (such as core usage, memory, disk space and uptime) of each instance of a deployed application:</p>

<pre class="terminal">
prompt$ vmc stats &lt;appname&gt;
</pre>

<p>List the environment variables for an application:</p>

<pre class="terminal">
prompt$ vmc env &lt;appname&gt;
</pre>

<p>Add an environment variable to an application:</p>

<pre class="terminal">
prompt$ vmc env-add &lt;appname&gt; &lt;variable=value&gt;
</pre>

<p>Delete an environment variable you previously added to an application:</p>

<pre class="terminal">
prompt$ vmc env-del &lt;appname&gt; &lt;variable&gt;
</pre>

<h2 id="update-application-without-dropping-user-traffic">Update application without dropping user traffic</h2>

<p>In general, when developing and testing applications with Cloud Foundry, <strong>vmc update</strong> fits the bill quite well.</p>

<p>However, when an app is considered â€œliveâ€, like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.</p>

<p>We use the concept of a new application that will assume the URL space of the original application.</p>

<p>Here is how to update your application without any downtime:</p>

<p>NOTE: â€˜vmc updateâ€™ will drop traffic..</p>

<ul>
<li>vmc push [app]NEW (bind any shared services, like DB, Cache, etc)</li>
</ul><p>TEST [app]NEW.cloudfoundry.com</p>

<ul>
<li>vmc map [app]NEW [app].cloudfoundry.com</li>
</ul><p>TEST [app].cloudfoundry.com several times, looping through new and old now..</p>

<ul>
<li>vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic</li>
</ul><p>TEST</p>

<ul>
<li>vmc delete [app]OLD</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"š4This section groups the main VMC commands into functional categories and provides typical usage.   In the examples, text displayed like `<this>` indicates a variable whose value is specific to your environment.

Run `vmc help` to view the complete list of VMC commands, along with their parameters and a brief description.

## Subtopics

+ [Getting the Latest Version of VMC](#getting-the-latest-version-of-vmc)
+ [Suppressing Prompts to Run In Non-Interactive Mode](#suppressing-prompts-to-run-in-non-interactive-mode)
+ [Targeting Cloud Foundry](#targeting-cloud-foundry)
+ [Logging In and Managing Accounts](#logging-in-and-managing-accounts)
+ [Deploying Applications](#deploying-applications)
+ [Updating a Deployment](#updating-a-deployment)
+ [Managing the Deployment Lifecycle (Start, Stop, Delete)](#managing-the-deployment-lifecycle-start-stop-delete)
+ [Managing and Binding Services](#managing-and-binding-services)
+ [Getting Information about the Cloud Foundry Target](#getting-information-about-the-cloud-foundry-target)
+ [Getting Information about Applications](#getting-information-about-applications)

## Getting the Latest Version of VMC

`vmc` is provided as a Ruby gem, and is being constantly updated with new commands or new options to existing commands.  For this reason, be sure you have the latest version by executing the following RubyGems command:

```bash
prompt$ gem update vmc
```

##Suppressing Prompts to Run In Non-Interactive Mode

By default, `vmc` operates in interactive mode and the execution of many commands results in multiple prompts for values for specific options. To use `vmc` in non-interactive mode and provide options in the command itself, use the following syntax:

```bash
prompt$ vmc *command* -n --options
```

For example, to deploy an application and take the default value for all prompts:

```bash
prompt$ vmc push <appname> -n
```

To display all commands and options which can be used as parameters on the command line:

```bash
prompt$ vmc help options
```

## Targeting Cloud Foundry

Target Cloud Foundry in the Cloud:

```bash
prompt$ vmc target api.cloudfoundry.com
```

Target a standalone a Micro Cloud Foundry running on your local virtual machine:

```bash
prompt$ vmc target api.<domain>.cloudfoundry.com
```

**Note**: You specified the value of *domain* when you initially installed Micro Cloud Foundry.

Display the current target URL:

```bash
prompt$ vmc target
```

Display the list of known targets and the associated authorization tokens:

```bash
prompt$ vmc targets
```

## Logging In and Managing Accounts

Identify yourself to Cloud Foundry with your account information:

```bash
prompt$ vmc login <youremail@email.com> --passwd <yourpassword>
```

Change your password:

```bash
prompt$ vmc passwd
```

Logout from your current session:

```bash
prompt$ vmc logout
```

Get information about your Cloud Foundry account, the version of VMC you are using, and the total resources you have consumed:

```bash
prompt$ vmc info
```

(Micro Cloud Foundry Only) Register a new user.  Requires administrator privileges:

```bash
prompt$ vmc add-user --email <newemail@email.com> --passwd <newpasswd>
```

(Micro Cloud Foundry Only) Delete a registered user and all applications and service instances associated with the user.  Requires administrator privileges:

```bash
prompt$ vmc delete-user <useremail@email.com>
```

##Deploying Applications

Deploy an application by executing the command from the directory that contains the application artifacts (such as `myapp.war` or `myapp.rb`).  This is the interactive way to deploy an application, and the VMC command prompts you for information such as the name of the application, its deployment URL, its programming framework, memory allocation, and the service instances that will be bound to it.   The command then deploys the application to the target to which your current session is associated, stages it, and starts it so that it is immediately available.

```bash
prompt$ vmc push
```

You can specify one or all of the following options to pass deployment values;  if you do not specify an option, `vmc push` will interactively prompt you for it:

```bash
prompt$ vmc push <appname> --path <directory> --url <deploymentURL> --instances <instance-number>  --mem <MB> --no-start
```

where:

+ *appname* refers to the internal name you want to give to your application.
+ *directory* refers to the absolute or relative local directory name that contains your application.  Note that *all* files in the directory will be pushed by the `vmc push` command, so be sure you include only the files you want to deploy in the directory.
+ *deploymentURL* refers to the URL that you will later use to invoke your application in a browser; default is `<appname>.cloudfoundry.com`
* *instance-number* specifies the number of instances of the application to start; default is 1
+ *MB* specifies the upper memory limit of the application, in MB; default is 512 MB
+ *--no-start* specifies that you do not want Cloud Foundry to actually start the application yet, which it will do by default.

The `vmc push` command will still prompt you for the runtime and associated service instances, even if you specify all the options above.

For example:

```bash
prompt$ vmc push hello --path /usr/bob/sample-apps/hello --url hello-bob.cloudfoundry.com --instances 2 --mem 64 --no-start
```

##Updating a Deployment

Update a deployed application with the application bits in the current directory:

```bash
prompt$ vmc update <appname>
```

**Note**: Be sure you specify the *name* of the application (first column in the output of `vmc apps`) rather than its deployment URL.

The preceding command immediately ends any existing user sessions connected to the deployed application.

Update the memory (in MB) that has been reserved for an existing deployment; the application will be automatically restarted:

```bash
prompt$ vmc mem <appname> <MB>
```

**Note**: Use `vmc stats <appname>` to view the currently reserved memory for the application, as well as how much it is currently using.

Register a new deployment URL with an existing deployed application; this command *adds* the URL to the existing list of registered URLs:

```bash
prompt$ vmc map <appname> <URL>
```

**Note**: Use `vmc apps` to view the list of URLs currently registered for a deployed application.

Unregister a URL for a deployed application:

```bash
prompt$ vmc unmap <appname> <URL>
```

Scale an application (both up and down) by changing the number of instances that are currently deployed:

```bash
prompt$ vmc instances <appname> <number-of-instances>
```

**Note**: Use `vmc apps` to view the current number of instances for a deployed application.

##Managing the Deployment Lifecycle (Start, Stop, Delete)

Stop a currently running deployment:

```bash
prompt$ vmc stop <appname>
```

**Note**: Be sure you specify the *name* of the application (first column in the output of `vmc apps`) rather than its deployment URL.

Start a currently stopped deployment:

```bash
prompt$ vmc start <appname>
```

Restart a currently running deployment:

```bash
prompt$ vmc restart <appname>
```

Delete an application:

```bash
prompt$ vmc delete <appname>
```

Rename an application:

```bash
prompt$ vmc rename <appname> <new-appname>
```

##Managing and Binding Services

Display the supported service types and the instances of these services you have already provisioned:

```bash
prompt$ vmc services
```

**Note**: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the `vmc create-service` command.)  These are called *provisioned services*. Use  the `vmc apps` command to determine which of these service instances are currently bound to deployed applications.

Create a new instance of a service type and assign it a name:

```bash
prompt$ vmc create-service <service-type> <service-instance-name>
```

**Note**: Use `vmc services` to view the list of available service types for which you can create an instance.  Use the name of the service type listed in the first column of the first table.

Create a new instance of a service type, assign it a name, and immediately bind it to a deployed application:

```bash
prompt$ vmc create-service <service-type> <service-instance-name> <appnam>
```

Bind a service instance to a deployed application.   Assumes that you have already deployed the application using `vmc push`:

```bash
prompt$ vmc bind-service <service-instance-name> <appname>
```

**Note**:  Use `vmc services` to view the name of your service instance (first column of second table).

Remove the binding between a service instance and an application:

```bash
prompt$ vmc unbind-service <service-instance-name> <appname>
```

Delete an instance of a service:

```bash
prompt$ vmc delete-service <service-instance-name>
```

To bind an existing service instance at the same time you deploy an application using `vmc push`, enter `y` at the two prompts then specify the number of the service instance from the provided list.  For example (only relevant output and prompts of the `vmc push` command shown):

```bash
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. Insight-19ff7b1
        2. mysql-juliet
        Please select one you wish to provision: 2
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

```

To create a new service instance at the time you deploy an application, and then bind the new service instance to the application, specify the appropriate prompts and information about the new service instance.  For example (only relevant output and prompts of `vmc push` shown):

```bash
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? n
        The following system services are available:
        1. mongodb
        2. mysql
        3. postgresql
        4. rabbitmq
        5. redis
        Please select one you wish to provision: 2
        Specify the name of the service [mysql-ab63]: mysql-new
        Creating Service: OK
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

```



##Getting Information about the Cloud Foundry Target

Display the supported programming languages:

```bash
prompt$ vmc runtimes
```

Display the supported programming frameworks:

```bash
prompt$ vmc frameworks
```

Display the supported service types (such as MySQL and RabbitMQ) and the instances of these service types that you have created:

```bash
prompt$ vmc services
```

**Note**: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the `vmc create-service` command.)  Use  the `vmc apps` command to determine which of these service instances are currently bound to deployed applications.

##Getting Information about Applications

Display the list of applications that are currently deployed for your account, along with instances, health, and associated service instances:

```bash
prompt$ vmc apps
```

Display the standard output log entries for an application:

```bash
prompt$ vmc logs <appname>
```

**Note**: Be sure you specify the *name* of the application (first column in the output of `vmc apps`) rather than its deployment URL.

Display the recent crashes of a particular application:

```bash
prompt$ vmc crashes <appname>
```

Display any fatal errors that occurred for an application:

```bash
prompt$ vmc crashlogs <appname>
```

Display resource information (such as core usage, memory, disk space and uptime) of each instance of a deployed application:

```bash
prompt$ vmc stats <appname>
```

List the environment variables for an application:

```bash
prompt$ vmc env <appname>
```

Add an environment variable to an application:

```bash
prompt$ vmc env-add <appname> <variable=value>
```

Delete an environment variable you previously added to an application:

```bash
prompt$ vmc env-del <appname> <variable>
```





## Update application without dropping user traffic

In general, when developing and testing applications with Cloud Foundry, **vmc update** fits the bill quite well.

However, when an app is considered "live", like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.

We use the concept of a new application that will assume the URL space of the original application.

Here is how to update your application without any downtime:

NOTE: 'vmc update' will drop traffic..

- vmc push [app]NEW (bind any shared services, like DB, Cache, etc)

 TEST [app]NEW.cloudfoundry.com

- vmc map [app]NEW [app].cloudfoundry.com

 TEST [app].cloudfoundry.com several times, looping through new and old now..

- vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic

 TEST

- vmc delete [app]OLD;T;
I"“@<p>This section groups the main VMC commands into functional categories and provides typical usage.   In the examples, text displayed like <code>&lt;this&gt;</code> indicates a variable whose value is specific to your environment.</p>

<p>Run <code>vmc help</code> to view the complete list of VMC commands, along with their parameters and a brief description.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#getting-the-latest-version-of-vmc">Getting the Latest Version of VMC</a></li>
  <li><a href="#suppressing-prompts-to-run-in-non-interactive-mode">Suppressing Prompts to Run In Non-Interactive Mode</a></li>
  <li><a href="#targeting-cloud-foundry">Targeting Cloud Foundry</a></li>
  <li><a href="#logging-in-and-managing-accounts">Logging In and Managing Accounts</a></li>
  <li><a href="#deploying-applications">Deploying Applications</a></li>
  <li><a href="#updating-a-deployment">Updating a Deployment</a></li>
  <li><a href="#managing-the-deployment-lifecycle-start-stop-delete">Managing the Deployment Lifecycle (Start, Stop, Delete)</a></li>
  <li><a href="#managing-and-binding-services">Managing and Binding Services</a></li>
  <li><a href="#getting-information-about-the-cloud-foundry-target">Getting Information about the Cloud Foundry Target</a></li>
  <li><a href="#getting-information-about-applications">Getting Information about Applications</a></li>
</ul><h2 id="getting-the-latest-version-of-vmc">Getting the Latest Version of VMC</h2>

<p><code>vmc</code> is provided as a Ruby gem, and is being constantly updated with new commands or new options to existing commands.  For this reason, be sure you have the latest version by executing the following RubyGems command:</p>

<pre class="terminal">
prompt$ gem update vmc
</pre>

<h2 id="suppressing-prompts-to-run-in-non-interactive-mode">Suppressing Prompts to Run In Non-Interactive Mode</h2>

<p>By default, <code>vmc</code> operates in interactive mode and the execution of many commands results in multiple prompts for values for specific options. To use <code>vmc</code> in non-interactive mode and provide options in the command itself, use the following syntax:</p>

<pre class="terminal">
prompt$ vmc *command* -n --options
</pre>

<p>For example, to deploy an application and take the default value for all prompts:</p>

<pre class="terminal">
prompt$ vmc push &lt;appname&gt; -n
</pre>

<p>To display all commands and options which can be used as parameters on the command line:</p>

<pre class="terminal">
prompt$ vmc help options
</pre>

<h2 id="targeting-cloud-foundry">Targeting Cloud Foundry</h2>

<p>Target Cloud Foundry in the Cloud:</p>

<pre class="terminal">
prompt$ vmc target api.cloudfoundry.com
</pre>

<p>Target a standalone a Micro Cloud Foundry running on your local virtual machine:</p>

<pre class="terminal">
prompt$ vmc target api.&lt;domain&gt;.cloudfoundry.com
</pre>

<p><strong>Note</strong>: You specified the value of <em>domain</em> when you initially installed Micro Cloud Foundry.</p>

<p>Display the current target URL:</p>

<pre class="terminal">
prompt$ vmc target
</pre>

<p>Display the list of known targets and the associated authorization tokens:</p>

<pre class="terminal">
prompt$ vmc targets
</pre>

<h2 id="logging-in-and-managing-accounts">Logging In and Managing Accounts</h2>

<p>Identify yourself to Cloud Foundry with your account information:</p>

<pre class="terminal">
prompt$ vmc login &lt;youremail@email.com&gt; --passwd &lt;yourpassword&gt;
</pre>

<p>Change your password:</p>

<pre class="terminal">
prompt$ vmc passwd
</pre>

<p>Logout from your current session:</p>

<pre class="terminal">
prompt$ vmc logout
</pre>

<p>Get information about your Cloud Foundry account, the version of VMC you are using, and the total resources you have consumed:</p>

<pre class="terminal">
prompt$ vmc info
</pre>

<p>(Micro Cloud Foundry Only) Register a new user.  Requires administrator privileges:</p>

<pre class="terminal">
prompt$ vmc add-user --email &lt;newemail@email.com&gt; --passwd &lt;newpasswd&gt;
</pre>

<p>(Micro Cloud Foundry Only) Delete a registered user and all applications and service instances associated with the user.  Requires administrator privileges:</p>

<pre class="terminal">
prompt$ vmc delete-user &lt;useremail@email.com&gt;
</pre>

<h2 id="deploying-applications">Deploying Applications</h2>

<p>Deploy an application by executing the command from the directory that contains the application artifacts (such as <code>myapp.war</code> or <code>myapp.rb</code>).  This is the interactive way to deploy an application, and the VMC command prompts you for information such as the name of the application, its deployment URL, its programming framework, memory allocation, and the service instances that will be bound to it.   The command then deploys the application to the target to which your current session is associated, stages it, and starts it so that it is immediately available.</p>

<pre class="terminal">
prompt$ vmc push
</pre>

<p>You can specify one or all of the following options to pass deployment values;  if you do not specify an option, <code>vmc push</code> will interactively prompt you for it:</p>

<pre class="terminal">
prompt$ vmc push &lt;appname&gt; --path &lt;directory&gt; --url &lt;deploymentURL&gt; --instances &lt;instance-number&gt;  --mem &lt;MB&gt; --no-start
</pre>

<p>where:</p>

<ul>
<li>
<em>appname</em> refers to the internal name you want to give to your application.</li>
  <li>
<em>directory</em> refers to the absolute or relative local directory name that contains your application.  Note that <em>all</em> files in the directory will be pushed by the <code>vmc push</code> command, so be sure you include only the files you want to deploy in the directory.</li>
  <li>
<em>deploymentURL</em> refers to the URL that you will later use to invoke your application in a browser; default is <code>&lt;appname&gt;.cloudfoundry.com</code>
</li>
  <li>
<em>instance-number</em> specifies the number of instances of the application to start; default is 1</li>
  <li>
<em>MB</em> specifies the upper memory limit of the application, in MB; default is 512 MB</li>
  <li>
<em>â€“no-start</em> specifies that you do not want Cloud Foundry to actually start the application yet, which it will do by default.</li>
</ul><p>The <code>vmc push</code> command will still prompt you for the runtime and associated service instances, even if you specify all the options above.</p>

<p>For example:</p>

<pre class="terminal">
prompt$ vmc push hello --path /usr/bob/sample-apps/hello --url hello-bob.cloudfoundry.com --instances 2 --mem 64 --no-start
</pre>

<h2 id="updating-a-deployment">Updating a Deployment</h2>

<p>Update a deployed application with the application bits in the current directory:</p>

<pre class="terminal">
prompt$ vmc update &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>The preceding command immediately ends any existing user sessions connected to the deployed application.</p>

<p>Update the memory (in MB) that has been reserved for an existing deployment; the application will be automatically restarted:</p>

<pre class="terminal">
prompt$ vmc mem &lt;appname&gt; &lt;MB&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc stats &lt;appname&gt;</code> to view the currently reserved memory for the application, as well as how much it is currently using.</p>

<p>Register a new deployment URL with an existing deployed application; this command <em>adds</em> the URL to the existing list of registered URLs:</p>

<pre class="terminal">
prompt$ vmc map &lt;appname&gt; &lt;URL&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc apps</code> to view the list of URLs currently registered for a deployed application.</p>

<p>Unregister a URL for a deployed application:</p>

<pre class="terminal">
prompt$ vmc unmap &lt;appname&gt; &lt;URL&gt;
</pre>

<p>Scale an application (both up and down) by changing the number of instances that are currently deployed:</p>

<pre class="terminal">
prompt$ vmc instances &lt;appname&gt; &lt;number-of-instances&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc apps</code> to view the current number of instances for a deployed application.</p>

<h2 id="managing-the-deployment-lifecycle-start-stop-delete">Managing the Deployment Lifecycle (Start, Stop, Delete)</h2>

<p>Stop a currently running deployment:</p>

<pre class="terminal">
prompt$ vmc stop &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>Start a currently stopped deployment:</p>

<pre class="terminal">
prompt$ vmc start &lt;appname&gt;
</pre>

<p>Restart a currently running deployment:</p>

<pre class="terminal">
prompt$ vmc restart &lt;appname&gt;
</pre>

<p>Delete an application:</p>

<pre class="terminal">
prompt$ vmc delete &lt;appname&gt;
</pre>

<p>Rename an application:</p>

<pre class="terminal">
prompt$ vmc rename &lt;appname&gt; &lt;new-appname&gt;
</pre>

<h2 id="managing-and-binding-services">Managing and Binding Services</h2>

<p>Display the supported service types and the instances of these services you have already provisioned:</p>

<pre class="terminal">
prompt$ vmc services
</pre>

<p><strong>Note</strong>: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the <code>vmc create-service</code> command.)  These are called <em>provisioned services</em>. Use  the <code>vmc apps</code> command to determine which of these service instances are currently bound to deployed applications.</p>

<p>Create a new instance of a service type and assign it a name:</p>

<pre class="terminal">
prompt$ vmc create-service &lt;service-type&gt; &lt;service-instance-name&gt;
</pre>

<p><strong>Note</strong>: Use <code>vmc services</code> to view the list of available service types for which you can create an instance.  Use the name of the service type listed in the first column of the first table.</p>

<p>Create a new instance of a service type, assign it a name, and immediately bind it to a deployed application:</p>

<pre class="terminal">
prompt$ vmc create-service &lt;service-type&gt; &lt;service-instance-name&gt; &lt;appnam&gt;
</pre>

<p>Bind a service instance to a deployed application.   Assumes that you have already deployed the application using <code>vmc push</code>:</p>

<pre class="terminal">
prompt$ vmc bind-service &lt;service-instance-name&gt; &lt;appname&gt;
</pre>

<p><strong>Note</strong>:  Use <code>vmc services</code> to view the name of your service instance (first column of second table).</p>

<p>Remove the binding between a service instance and an application:</p>

<pre class="terminal">
prompt$ vmc unbind-service &lt;service-instance-name&gt; &lt;appname&gt;
</pre>

<p>Delete an instance of a service:</p>

<pre class="terminal">
prompt$ vmc delete-service &lt;service-instance-name&gt;
</pre>

<p>To bind an existing service instance at the same time you deploy an application using <code>vmc push</code>, enter <code>y</code> at the two prompts then specify the number of the service instance from the provided list.  For example (only relevant output and prompts of the <code>vmc push</code> command shown):</p>

<pre class="terminal">
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? y
        The following provisioned services are available:
        1. Insight-19ff7b1
        2. mysql-juliet
        Please select one you wish to provision: 2
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

</pre>

<p>To create a new service instance at the time you deploy an application, and then bind the new service instance to the application, specify the appropriate prompts and information about the new service instance.  For example (only relevant output and prompts of <code>vmc push</code> shown):</p>

<pre class="terminal">
prompt$ vmc push
        ...
        Would you like to bind any services to 'pizza-juliet'? [yN]: y
        Would you like to use an existing provisioned service [yN]? n
        The following system services are available:
        1. mongodb
        2. mysql
        3. postgresql
        4. rabbitmq
        5. redis
        Please select one you wish to provision: 2
        Specify the name of the service [mysql-ab63]: mysql-new
        Creating Service: OK
        Binding Service: OK
        Uploading Application:
        ...
        Starting Application: OK

</pre>

<h2 id="getting-information-about-the-cloud-foundry-target">Getting Information about the Cloud Foundry Target</h2>

<p>Display the supported programming languages:</p>

<pre class="terminal">
prompt$ vmc runtimes
</pre>

<p>Display the supported programming frameworks:</p>

<pre class="terminal">
prompt$ vmc frameworks
</pre>

<p>Display the supported service types (such as MySQL and RabbitMQ) and the instances of these service types that you have created:</p>

<pre class="terminal">
prompt$ vmc services
</pre>

<p><strong>Note</strong>: The output of the preceding command is split into two tables: the first table displays the available service types that you can use for your applications, the second table displays the services for which you have already created an instance (using the <code>vmc create-service</code> command.)  Use  the <code>vmc apps</code> command to determine which of these service instances are currently bound to deployed applications.</p>

<h2 id="getting-information-about-applications">Getting Information about Applications</h2>

<p>Display the list of applications that are currently deployed for your account, along with instances, health, and associated service instances:</p>

<pre class="terminal">
prompt$ vmc apps
</pre>

<p>Display the standard output log entries for an application:</p>

<pre class="terminal">
prompt$ vmc logs &lt;appname&gt;
</pre>

<p><strong>Note</strong>: Be sure you specify the <em>name</em> of the application (first column in the output of <code>vmc apps</code>) rather than its deployment URL.</p>

<p>Display the recent crashes of a particular application:</p>

<pre class="terminal">
prompt$ vmc crashes &lt;appname&gt;
</pre>

<p>Display any fatal errors that occurred for an application:</p>

<pre class="terminal">
prompt$ vmc crashlogs &lt;appname&gt;
</pre>

<p>Display resource information (such as core usage, memory, disk space and uptime) of each instance of a deployed application:</p>

<pre class="terminal">
prompt$ vmc stats &lt;appname&gt;
</pre>

<p>List the environment variables for an application:</p>

<pre class="terminal">
prompt$ vmc env &lt;appname&gt;
</pre>

<p>Add an environment variable to an application:</p>

<pre class="terminal">
prompt$ vmc env-add &lt;appname&gt; &lt;variable=value&gt;
</pre>

<p>Delete an environment variable you previously added to an application:</p>

<pre class="terminal">
prompt$ vmc env-del &lt;appname&gt; &lt;variable&gt;
</pre>

<h2 id="update-application-without-dropping-user-traffic">Update application without dropping user traffic</h2>

<p>In general, when developing and testing applications with Cloud Foundry, <strong>vmc update</strong> fits the bill quite well.</p>

<p>However, when an app is considered â€œliveâ€, like our own www site, you should follow the steps below that will ensure no user requests are drop during the transition.</p>

<p>We use the concept of a new application that will assume the URL space of the original application.</p>

<p>Here is how to update your application without any downtime:</p>

<p>NOTE: â€˜vmc updateâ€™ will drop traffic..</p>

<ul>
<li>vmc push [app]NEW (bind any shared services, like DB, Cache, etc)</li>
</ul><p>TEST [app]NEW.cloudfoundry.com</p>

<ul>
<li>vmc map [app]NEW [app].cloudfoundry.com</li>
</ul><p>TEST [app].cloudfoundry.com several times, looping through new and old now..</p>

<ul>
<li>vmc unmap [app]OLD [app].cloudfoundry.com # Does not drop traffic, just kills all new traffic</li>
</ul><p>TEST</p>

<ul>
<li>vmc delete [app]OLD</li>
</ul>;T;@OI"$/tools/vmc/vmc-non-interactive/;T{;{	;I"¥9<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/vmc-non-interactive.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using VMC in Non Interactive Mode' property='og:title'>
<meta content='How to Use vmc in Non Interactive Mode' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using VMC in Non Interactive Mode</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Using VMC in Non Interactive Mode</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>How to Use vmc in Non Interactive Mode</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/vmc" rel="tag">vmc</a><a href="/tags/non interactive" rel="tag">non interactive</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>VMC clientâ€™s default mode of operation is â€˜Interactiveâ€™.</p>

<p>It is possible to invoke VMC in non-interactive mode by using one of the following command line switches.</p>

<pre class="terminal">
    -n, --no-prompt
        --noprompt
        --non-interactive
</pre>

<p>For example : VMC in interactive mode : (clicked â€˜returnâ€™ to take the default values)</p>

<pre class="terminal">
$ vmc push hello
Would you like to deploy from the current directory? [Yn]:
Application Deployed URL: 'hello.vcap.me'?
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G)
Creating Application: OK
Would you like to bind any services to 'hello'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>VMC in non-interactive mode</p>

<pre class="terminal">
$ vmc push hello -n
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>For any of the interactive questions, if non-default value for the question is needed, that can be passed in the command line.  (For example â€“mem for memory).</p>

<p>For a list of all the options supported by VMC, please try</p>

<pre class="terminal">
$ vmc help options
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"FVMC client's default mode of operation is 'Interactive'.

It is possible to invoke VMC in non-interactive mode by using one of the following command line switches.

```bash
    -n, --no-prompt
        --noprompt
        --non-interactive
```

For example : VMC in interactive mode : (clicked 'return' to take the default values)

```bash
$ vmc push hello
Would you like to deploy from the current directory? [Yn]:
Application Deployed URL: 'hello.vcap.me'?
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G)
Creating Application: OK
Would you like to bind any services to 'hello'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
```

VMC in non-interactive mode

```bash
$ vmc push hello -n
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
```

For any of the interactive questions, if non-default value for the question is needed, that can be passed in the command line.  (For example --mem for memory).

For a list of all the options supported by VMC, please try

```bash
$ vmc help options
```;T;
I"Ã<p>VMC clientâ€™s default mode of operation is â€˜Interactiveâ€™.</p>

<p>It is possible to invoke VMC in non-interactive mode by using one of the following command line switches.</p>

<pre class="terminal">
    -n, --no-prompt
        --noprompt
        --non-interactive
</pre>

<p>For example : VMC in interactive mode : (clicked â€˜returnâ€™ to take the default values)</p>

<pre class="terminal">
$ vmc push hello
Would you like to deploy from the current directory? [Yn]:
Application Deployed URL: 'hello.vcap.me'?
Detected a Sinatra Application, is this correct? [Yn]:
Memory Reservation [Default:128M] (64M, 128M, 256M, 512M, 1G or 2G)
Creating Application: OK
Would you like to bind any services to 'hello'? [yN]:
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>VMC in non-interactive mode</p>

<pre class="terminal">
$ vmc push hello -n
Creating Application: OK
Uploading Application:
  Checking for available resources: OK
  Packing application: OK
  Uploading (0K): OK
Push Status: OK
Staging Application: OK
Starting Application: OK
</pre>

<p>For any of the interactive questions, if non-default value for the question is needed, that can be passed in the command line.  (For example â€“mem for memory).</p>

<p>For a list of all the options supported by VMC, please try</p>

<pre class="terminal">
$ vmc help options
</pre>;T;@UI"/tools/vmc/caldecott/;T{;{	;I"´N<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/caldecott.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Accessing Cloud Foundry Services' property='og:title'>
<meta content='Tunneling to a Cloud Foundry Service with Caldecott' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Accessing Cloud Foundry Services</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Accessing Cloud Foundry Services</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Tunneling to a Cloud Foundry Service with Caldecott</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/debug" rel="tag">debug</a><a href="/tags/tunneling" rel="tag">tunneling</a><a href="/tags/vmc" rel="tag">vmc</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Application services such as databases and messaging are built-in to Cloud Foundry, which helps speed development and ease application management. You do not have to install and manage servers because they are part of the Cloud Foundry platform. Your application code interacts with the Cloud Foundry services, but sometimes you need to access a service interactively. For example, you might want to run ad hoc queries, view data to help debug a problem, or import or export data.</p>

<p>An application called Caldecott, after the Caldecott Tunnel in the Berkeley Hills in California, allows you to access your services in the cloud. Caldecott uses tunneling to connect a port on your local computer to the service in the cloud. The <code>vmc tunnel</code> command uploads the Caldecott application to your Cloud Foundry instance, sets up the tunneling, and offers to start a standard client on your computer to work with the service.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Caldecott requires Ruby 1.9.2.</p>
  </li>
  <li>
    <p>You must have vmc 0.3.14 or later. Use the following command to check your version:</p>
  </li>
</ul><pre class="terminal">
$ vmc -v
</pre>

<pre><code>Enter this vmc command to update the vmc gem:
</code></pre>

<pre class="terminal">
$ gem update vmc
</pre>

<ul>
<li>Caldecott can start a client program for the service you want to access, for example <code>mysql</code> for MySQL or <code>psql</code> for PostgreSQL. The client must be installed on your computer and be on the execution PATH so that Caldecott scripts can start it. If you want to use a different client, Caldecott will display the connection information and credentials you will need to connect to the service. The following table shows the client programs Caldecott can start for each service.</li>
</ul><table class="std">
<tr>
<th>Service</th>
		<th>Client</th>
	</tr>
<tr>
<td>MongoDB</td>
		<td><tt>mongo</tt></td>
	</tr>
<tr>
<td>MySQL</td>
		<td><tt>mysql</tt></td>
	</tr>
<tr>
<td>PostgreSQL</td>
		<td><tt>psql</tt></td>
	</tr>
<tr>
<td>rabbitmq</td>
		<td><i>none</i></td>
	</tr>
<tr>
<td>Redis</td>
		<td><tt>redis-cli</tt></td>
	</tr>
</table><h2 id="setting-up-caldecott">Setting up Caldecott</h2>

<p>Install the Caldecott Ruby gem with this command:</p>

<pre class="terminal">
$ gem install caldecott
</pre>

<dl>
<dt>Note</dt>
  <dd>The Caldecott gem currently requires the eventmachine gem, which requires native compilation. We are working to simplify this.</dd>
</dl><h2 id="using-caldecott">Using Caldecott</h2>

<ul>
<li>Target the Cloud Foundry instance and log in with your Cloud Foundry credentials:</li>
</ul><pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login

</pre>

<ul>
<li>Use this command to view the existing services:</li>
</ul><pre class="terminal">
$ vmc services
</pre>

<pre><code>The command output has two parts. The first, System Services, reports services that can be provisioned in the Cloud Foundry instance. You are interested in the second section, Provisioned Services, which lists your existing services.

	=========== Provisioned Services ============

    +------------------+------------+
    | Name             | Service    |
    +------------------+------------+
    | mongodb-12345    | mongodb    |
    | mysql-12345      | mysql      |
    | postgresql-12345 | postgresql |
    | redis-12345      | redis      |
    +------------------+------------+
</code></pre>

<ul>
<li>Create a tunnel to the service. For example, to connect to the MySQL service:</li>
</ul><pre class="terminal">
$ vmc tunnel mysql-12345
	Trying to deploy Application: 'caldecott'.
	Create a password:

</pre>

<pre><code>The first time you create a tunnel, vmc uploads the Caldecott application to your Cloud Foundry instance and prompts you to set a password to protect it. You will need to provide that password each time you create a tunnel to that Cloud Foundry instance in the future.

After you provide the password, the Caldecott application is uploaded:
</code></pre>

<pre class="terminal">
Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Binding Service [mysql-12345]: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<pre><code>See [More About the Tunnel Command](#more-about-the-tunnel-command) for a complete description of the `vmc tunnel` command options.
</code></pre>

<ul>
<li>Caldecott creates the tunnel and prompts you to start a client. Here is an example of a session using <code>mysql</code> to access data on Cloud Foundry:</li>
</ul><pre class="terminal">
	Getting tunnel connection info: OK

	Service connection info:
	  username : um4rwWyhwa07B
	  password : pBiBlqjINB6cm
	  name     : dd368741dbc1945cfb62315565efcf1b5

	Starting tunnel to mysql-24e9c on port 10000.
	1: none
	2: mysql
	Which client would you like to start?: 2
	Launching 'mysql --protocol=TCP --host=localhost --port=10000
	--user=um4rwWyhwa07B --password=pBiBlqjINB6cmdd368741dbc1945cfb62315565efcf1b5'

	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
		.
		.
		.
	mysql&gt;

</pre>

<ul>
<li>
    <p>When you exit the client, the tunnel is disconnected.</p>

    <p>If you chose the <code>1: none</code> option, or if Caldecott does not have a default client for the service, start your preferred client in another window and leave this terminal window undisturbed until you are ready to close the tunnel. Then press <code>Ctrl-C</code> to exit vmc when you are done.</p>
  </li>
</ul><h2 id="more-about-the-tunnel-command">More About the Tunnel Command</h2>

<p>You can just enter the <code>vmc tunnel</code> command and respond to prompts to create a tunnel. The command allows you to select from a list of existing provisioned services, so you do not need to know the service name ahead of time.</p>

<p>The full syntax of the <code>vmc tunnel</code> command is:</p>

<pre><code>vmc tunnel [&lt;servicename&gt;] [--port &lt;portnumber&gt;] [&lt;clientcmd&gt;]
</code></pre>

<p>The <code>&lt;servicename&gt;</code> argument is the name of the service, as shown by the <code>vmc services</code> command. If you exclude <code>&lt;servicename&gt;</code>, vmc provides a list of existing services from which to choose.</p>

<p>The <code>&lt;portnumber&gt;</code> parameter is the port to use on the local machine. If omitted, vmc chooses an available port in the 10000 range.</p>

<p>The <code>&lt;clientcmd&gt;</code> argument is the name of the client program to start. Only the client names shown in the table in the <a href="#prerequisites">Prerequisites</a> section are supported for this argument.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"{Application services such as databases and messaging are built-in to Cloud Foundry, which helps speed development and ease application management. You do not have to install and manage servers because they are part of the Cloud Foundry platform. Your application code interacts with the Cloud Foundry services, but sometimes you need to access a service interactively. For example, you might want to run ad hoc queries, view data to help debug a problem, or import or export data.

An application called Caldecott, after the Caldecott Tunnel in the Berkeley Hills in California, allows you to access your services in the cloud. Caldecott uses tunneling to connect a port on your local computer to the service in the cloud. The `vmc tunnel` command uploads the Caldecott application to your Cloud Foundry instance, sets up the tunneling, and offers to start a standard client on your computer to work with the service.

## Prerequisites

+	Caldecott requires Ruby 1.9.2.

+ 	You must have vmc 0.3.14 or later. Use the following command to check your version:

```bash
$ vmc -v
```

	Enter this vmc command to update the vmc gem:

```bash
$ gem update vmc
```

+ 	Caldecott can start a client program for the service you want to access, for example `mysql` for MySQL or `psql` for PostgreSQL. The client must be installed on your computer and be on the execution PATH so that Caldecott scripts can start it. If you want to use a different client, Caldecott will display the connection information and credentials you will need to connect to the service. The following table shows the client programs Caldecott can start for each service.

<table class="std">
	<tr>
		<th>Service</th>
		<th>Client</th>
	</tr>
	<tr>
		<td>MongoDB</td>
		<td><tt>mongo</tt></td>
	</tr>
	<tr>
		<td>MySQL</td>
		<td><tt>mysql</tt></td>
	</tr>
	<tr>
		<td>PostgreSQL</td>
		<td><tt>psql</tt></td>
	</tr>
	<tr>
		<td>rabbitmq</td>
		<td><i>none</i></td>
	</tr>
	<tr>
		<td>Redis</td>
		<td><tt>redis-cli</tt></td>
	</tr>
</table>

## Setting up Caldecott

Install the Caldecott Ruby gem with this command:

```bash
$ gem install caldecott
```

Note
: The Caldecott gem currently requires the eventmachine gem, which requires native compilation. We are working to simplify this.

## Using Caldecott

* Target the Cloud Foundry instance and log in with your Cloud Foundry credentials:

```bash
$ vmc target api.cloudfoundry.com
$ vmc login

```

* Use this command to view the existing services:

```bash
$ vmc services
```

	The command output has two parts. The first, System Services, reports services that can be provisioned in the Cloud Foundry instance. You are interested in the second section, Provisioned Services, which lists your existing services.

		=========== Provisioned Services ============

	    +------------------+------------+
	    | Name             | Service    |
	    +------------------+------------+
	    | mongodb-12345    | mongodb    |
	    | mysql-12345      | mysql      |
	    | postgresql-12345 | postgresql |
	    | redis-12345      | redis      |
	    +------------------+------------+

* Create a tunnel to the service. For example, to connect to the MySQL service:

```bash
$ vmc tunnel mysql-12345
	Trying to deploy Application: 'caldecott'.
	Create a password:

```

	The first time you create a tunnel, vmc uploads the Caldecott application to your Cloud Foundry instance and prompts you to set a password to protect it. You will need to provide that password each time you create a tunnel to that Cloud Foundry instance in the future.

	After you provide the password, the Caldecott application is uploaded:

```bash
Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Binding Service [mysql-12345]: OK
    Staging Application: OK
    Starting Application: OK

```

	See [More About the Tunnel Command](#more-about-the-tunnel-command) for a complete description of the `vmc tunnel` command options.

* Caldecott creates the tunnel and prompts you to start a client. Here is an example of a session using `mysql` to access data on Cloud Foundry:

```bash

	Getting tunnel connection info: OK

	Service connection info:
	  username : um4rwWyhwa07B
	  password : pBiBlqjINB6cm
	  name     : dd368741dbc1945cfb62315565efcf1b5

	Starting tunnel to mysql-24e9c on port 10000.
	1: none
	2: mysql
	Which client would you like to start?: 2
	Launching 'mysql --protocol=TCP --host=localhost --port=10000
	--user=um4rwWyhwa07B --password=pBiBlqjINB6cmdd368741dbc1945cfb62315565efcf1b5'

	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
		.
		.
		.
	mysql>

```

* When you exit the client, the tunnel is disconnected.

	If you chose the `1: none` option, or if Caldecott does not have a default client for the service, start your preferred client in another window and leave this terminal window undisturbed until you are ready to close the tunnel. Then press `Ctrl-C` to exit vmc when you are done.

## More About the Tunnel Command

You can just enter the `vmc tunnel` command and respond to prompts to create a tunnel. The command allows you to select from a list of existing provisioned services, so you do not need to know the service name ahead of time.

The full syntax of the `vmc tunnel` command is:

	vmc tunnel [<servicename>] [--port <portnumber>] [<clientcmd>]

The `<servicename>` argument is the name of the service, as shown by the `vmc services` command. If you exclude `<servicename>`, vmc provides a list of existing services from which to choose.

The `<portnumber>` parameter is the port to use on the local machine. If omitted, vmc chooses an available port in the 10000 range.

The `<clientcmd>` argument is the name of the client program to start. Only the client names shown in the table in the [Prerequisites](#prerequisites) section are supported for this argument.;T;
I"¨<p>Application services such as databases and messaging are built-in to Cloud Foundry, which helps speed development and ease application management. You do not have to install and manage servers because they are part of the Cloud Foundry platform. Your application code interacts with the Cloud Foundry services, but sometimes you need to access a service interactively. For example, you might want to run ad hoc queries, view data to help debug a problem, or import or export data.</p>

<p>An application called Caldecott, after the Caldecott Tunnel in the Berkeley Hills in California, allows you to access your services in the cloud. Caldecott uses tunneling to connect a port on your local computer to the service in the cloud. The <code>vmc tunnel</code> command uploads the Caldecott application to your Cloud Foundry instance, sets up the tunneling, and offers to start a standard client on your computer to work with the service.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Caldecott requires Ruby 1.9.2.</p>
  </li>
  <li>
    <p>You must have vmc 0.3.14 or later. Use the following command to check your version:</p>
  </li>
</ul><pre class="terminal">
$ vmc -v
</pre>

<pre><code>Enter this vmc command to update the vmc gem:
</code></pre>

<pre class="terminal">
$ gem update vmc
</pre>

<ul>
<li>Caldecott can start a client program for the service you want to access, for example <code>mysql</code> for MySQL or <code>psql</code> for PostgreSQL. The client must be installed on your computer and be on the execution PATH so that Caldecott scripts can start it. If you want to use a different client, Caldecott will display the connection information and credentials you will need to connect to the service. The following table shows the client programs Caldecott can start for each service.</li>
</ul><table class="std">
<tr>
<th>Service</th>
		<th>Client</th>
	</tr>
<tr>
<td>MongoDB</td>
		<td><tt>mongo</tt></td>
	</tr>
<tr>
<td>MySQL</td>
		<td><tt>mysql</tt></td>
	</tr>
<tr>
<td>PostgreSQL</td>
		<td><tt>psql</tt></td>
	</tr>
<tr>
<td>rabbitmq</td>
		<td><i>none</i></td>
	</tr>
<tr>
<td>Redis</td>
		<td><tt>redis-cli</tt></td>
	</tr>
</table><h2 id="setting-up-caldecott">Setting up Caldecott</h2>

<p>Install the Caldecott Ruby gem with this command:</p>

<pre class="terminal">
$ gem install caldecott
</pre>

<dl>
<dt>Note</dt>
  <dd>The Caldecott gem currently requires the eventmachine gem, which requires native compilation. We are working to simplify this.</dd>
</dl><h2 id="using-caldecott">Using Caldecott</h2>

<ul>
<li>Target the Cloud Foundry instance and log in with your Cloud Foundry credentials:</li>
</ul><pre class="terminal">
$ vmc target api.cloudfoundry.com
$ vmc login

</pre>

<ul>
<li>Use this command to view the existing services:</li>
</ul><pre class="terminal">
$ vmc services
</pre>

<pre><code>The command output has two parts. The first, System Services, reports services that can be provisioned in the Cloud Foundry instance. You are interested in the second section, Provisioned Services, which lists your existing services.

	=========== Provisioned Services ============

    +------------------+------------+
    | Name             | Service    |
    +------------------+------------+
    | mongodb-12345    | mongodb    |
    | mysql-12345      | mysql      |
    | postgresql-12345 | postgresql |
    | redis-12345      | redis      |
    +------------------+------------+
</code></pre>

<ul>
<li>Create a tunnel to the service. For example, to connect to the MySQL service:</li>
</ul><pre class="terminal">
$ vmc tunnel mysql-12345
	Trying to deploy Application: 'caldecott'.
	Create a password:

</pre>

<pre><code>The first time you create a tunnel, vmc uploads the Caldecott application to your Cloud Foundry instance and prompts you to set a password to protect it. You will need to provide that password each time you create a tunnel to that Cloud Foundry instance in the future.

After you provide the password, the Caldecott application is uploaded:
</code></pre>

<pre class="terminal">
Uploading Application:
      Checking for available resources: OK
      Processing resources: OK
      Packing application: OK
      Uploading (1K): OK
    Push Status: OK
    Binding Service [mysql-12345]: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<pre><code>See [More About the Tunnel Command](#more-about-the-tunnel-command) for a complete description of the `vmc tunnel` command options.
</code></pre>

<ul>
<li>Caldecott creates the tunnel and prompts you to start a client. Here is an example of a session using <code>mysql</code> to access data on Cloud Foundry:</li>
</ul><pre class="terminal">
	Getting tunnel connection info: OK

	Service connection info:
	  username : um4rwWyhwa07B
	  password : pBiBlqjINB6cm
	  name     : dd368741dbc1945cfb62315565efcf1b5

	Starting tunnel to mysql-24e9c on port 10000.
	1: none
	2: mysql
	Which client would you like to start?: 2
	Launching 'mysql --protocol=TCP --host=localhost --port=10000
	--user=um4rwWyhwa07B --password=pBiBlqjINB6cmdd368741dbc1945cfb62315565efcf1b5'

	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
		.
		.
		.
	mysql&gt;

</pre>

<ul>
<li>
    <p>When you exit the client, the tunnel is disconnected.</p>

    <p>If you chose the <code>1: none</code> option, or if Caldecott does not have a default client for the service, start your preferred client in another window and leave this terminal window undisturbed until you are ready to close the tunnel. Then press <code>Ctrl-C</code> to exit vmc when you are done.</p>
  </li>
</ul><h2 id="more-about-the-tunnel-command">More About the Tunnel Command</h2>

<p>You can just enter the <code>vmc tunnel</code> command and respond to prompts to create a tunnel. The command allows you to select from a list of existing provisioned services, so you do not need to know the service name ahead of time.</p>

<p>The full syntax of the <code>vmc tunnel</code> command is:</p>

<pre><code>vmc tunnel [&lt;servicename&gt;] [--port &lt;portnumber&gt;] [&lt;clientcmd&gt;]
</code></pre>

<p>The <code>&lt;servicename&gt;</code> argument is the name of the service, as shown by the <code>vmc services</code> command. If you exclude <code>&lt;servicename&gt;</code>, vmc provides a list of existing services from which to choose.</p>

<p>The <code>&lt;portnumber&gt;</code> parameter is the port to use on the local machine. If omitted, vmc chooses an available port in the 10000 range.</p>

<p>The <code>&lt;clientcmd&gt;</code> argument is the name of the client program to start. Only the client names shown in the table in the <a href="#prerequisites">Prerequisites</a> section are supported for this argument.</p>;T;@[I"/tools/vmc/installing-vmc/;T{;{	;I"¾b<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/installing-vmc.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | VMC Installation' property='og:title'>
<meta content='Installing the Command-Line Interface (vmc)' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | VMC Installation</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>VMC Installation</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Installing the Command-Line Interface (vmc)</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/vmc" rel="tag">vmc</a><a href="/tags/install" rel="tag">install</a><a href="/tags/CLI" rel="tag">CLI</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>You use the Cloud Foundry command-line interface (known as <code>vmc</code>) at a Unix terminal or Windows command prompt to execute all the Cloud Foundry operations, such as configuring your applications and deploying them to Cloud Foundry.</p>

<p>You execute the <code>vmc</code> commands in the same way whether you are deploying your application to the PaaS Cloud Foundry (<code>cloudfoundry.com</code>), or to your own local version of Cloud Foundry (Micro Cloud Foundry).  The basic commands are the same; the only difference is that you initially specify a different target before you log in using your Cloud Foundry credentials.</p>

<p>This section describes the prerequisites for installing <code>vmc</code>, installation instructions, and how to deploy a simple application.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#prerequisite-installing-ruby-and-rubygems">Prerequisite: Installing Ruby and RubyGems</a></li>
  <li><a href="#installing-vmc-procedure">Installing vmc: Procedure</a></li>
  <li><a href="#verifying-the-installation-by-deploying-a-sample-application">Verifying the Installation by Deploying a Sample Application</a></li>
  <li><a href="#next-steps">Next Steps</a></li>
</ul><h2 id="prerequisite-installing-ruby-and-rubygems">Prerequisite: Installing Ruby and RubyGems</h2>

<p><code>vmc</code> is delivered as a Ruby gem, which means you must install Ruby and RubyGems (a Ruby package manager) on the computer on which you want to run <code>vmc</code>, if you have not already done so.</p>

<p>The following versions of Ruby are currently supported:</p>

<ul>
<li>1.8.7</li>
  <li>1.9.2</li>
</ul><p>If you have already installed Ruby and RubyGems, then you can skip to <a href="#installing-vmc-main-steps">Installing vmc: Main Steps</a>.</p>

<p>The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers:</p>

<ul>
<li><a href="/frameworks/ruby/installing-ruby.html#windows">Windows</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#mac-os-x">Mac OS X</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#ubuntu">Ubuntu</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#redhatfedora">Redhat/Fedora</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#centos">Centos</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#suse">SuSE</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#debian">Debian</a></li>
</ul><h2 id="installing-vmc-procedure">Installing vmc: Procedure</h2>

<p>Installing <code>vmc</code> is easy once you have installed <a href="#prerequisite-installing-ruby-and-rubygems">Ruby and RubyGems</a> on your computer.</p>

<ul>
<li>
    <p>If you havenâ€™t already done so, signup for your free <a href="http://cloudfoundry.com/">Cloud Foundry</a> account.  You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>Open a terminal (Linux) and execute the following command:</p>
  </li>
</ul><pre class="terminal">
prompt$ sudo gem install vmc
</pre>

<p>Consult your system administrator for any required authentication credentials for the <code>sudo</code> command.
   On Windows, open a command prompt in which Ruby is enabled and execute the following:</p>

<pre class="terminal">
prompt&gt; gem install vmc
</pre>

<ul>
<li>
    <p>Execute the <code>vmc target</code> command to specify the Cloud Foundry target to which you will deploy your applications:</p>

    <ul>
<li>To deploy on the PaaS Cloud Foundry, specify <code>api.cloudfoundry.com</code>
</li>
      <li>To deploy on your local Micro Cloud Foundry, specify <code>api.&lt;appname&gt;.cloudfoundry.me</code>, where <em>appname</em> is the domain you registered for your application at the Micro Cloud Foundry Web site.  See <a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a>.</li>
    </ul>
<p>The following command targets the PaaS Cloud Foundry:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc target api.cloudfoundry.com
</pre>

<pre><code>To determine your current target, execute the `vmc target` command without any parameters:
</code></pre>

<pre class="terminal">
prompt$ vmc target
</pre>

<ul>
<li>Login using the user credentials you received via email after you registered with Cloud Foudnry.  Your username is typically your email address.</li>
</ul><pre class="terminal">
prompt$ vmc login
</pre>

<ul>
<li>Ensure you have successfully logged in by retrieving information about your account:</li>
</ul><pre class="terminal">
prompt$ vmc info
</pre>

<ul>
<li>Change your password:</li>
</ul><pre class="terminal">
prompt$ vmc passwd
</pre>

<ul>
<li>View the full list of VMC commands, along with their parameters and a brief description, by executing the <code>vmc help</code> command:</li>
</ul><pre class="terminal">
prompt$ vmc help
</pre>

<p>You have now successfully installed <code>vmc</code> and run a few basic commands.</p>

<h2 id="verifying-the-installation-by-deploying-a-sample-application">Verifying the Installation by Deploying a Sample Application</h2>

<p>Now that you have installed VMC and logged in to your target, you can start deploying applications to the Cloud.</p>

<p>This section shows how to deploy a simple application that does not require any services (such as MySQL or RabbitMQ).  The purpose of the section is for you to quickly get a feel for VMC and Cloud Foundry by deploying and running a very basic application.  Later sections describe how to configure your application to use services that connect to databases or manage messaging.</p>

<ul>
<li>
    <p>Create a simple application that does not require any services and package it appropriately, such as into a <code>*.war</code> file for Spring applications.</p>

    <p>If you do not currently have an application, see <a href="#creating-a-simple-sinatra-application">Creating a Simple Sinatra Application</a> for instructions on how to create a basic Ruby Hello World application using Sinatra in just a few minutes.</p>
  </li>
  <li>
    <p>Open a terminal window (Linux) or command prompt (Windows) and change the directory that contains your application.</p>

    <p>For example, if you created the simple Ruby <a href="#creating-a-simple-sinatra-application">Hello World</a> application using Sintatra:</p>
  </li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hello
</pre>

<ul>
<li>Deploy your application using the <code>vmc push</code> command, which interactively prompts for deployment information:</li>
</ul><pre class="terminal">
prompt$ vmc push
</pre>

<p>For prompts that require a yes or no answer, the default value is shown using capital letters.  For example, if â€œyesâ€ is the default, youâ€™ll see <code>[Yn]</code>.</p>

<p>The following sample output also shows the responses you should provide; for clarity, default values are specified explicitly.  See further explanations about these prompts after the example:</p>

<pre class="terminal">
   Would you like to deploy from the current directory? [Yn] Yes
   Application Name: hello
   Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
   Detected a Sinatra Application, is this correct? [Yn]  Yes
   Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
   Would you like to bind any services to 'hello'? [yN]: No

</pre>

<p>After you complete the prompts, <code>vmc</code> provides the following output for a successful push (deployment):</p>

<pre class="terminal">
     Uploading Application:
       Checking for available resources: OK
       Packing application: OK
     Uploading (0K): OK
     Push Status: OK
     Staging Application: OK
     Starting Application: OK

</pre>

<p>The Application Name refers to the internal name of the application as well as the actual file you want to deploy without its file extension, <code>hello</code> in our example.  The Application Deployed URL is the URL that you use in your browser to run the application after it has successfully deployed and started on Cloud Foundry.  Be sure that you specify a unique deployment URL, or <code>vmc</code> will return an error message that the URI has already been taken or reserved.  In the example above, the URL is <code>hello-bob.cloudfoundry.com</code>.</p>

<p>Verify that your application is available by executing the <code>vmc apps</code> command:</p>

<pre class="terminal">
$ vmc apps

    +--------------+----+--------+-------------------------------+----------+
    | Application  | #  | Health | URLS                          | Services |
    +--------------+----+--------+-------------------------------+----------+
    | hello        | 1  | RUNNING| hello-bob.cloudfoundry.com    |          |
    +--------------+----+--------+-------------------------------+----------+

</pre>

<p>Run your application in your browser by going to the URL you provided to the <code>vmc push</code> command, which in the example above is <code>hello-bob.cloudfoundry.com</code>.</p>

<p>If, for example, you deployed the Hello World Sinatra application, you should see the text <code>Hello from Cloud Foundry</code> in your browser.</p>

<p><img src="/images/screenshots/installing-vmc/hello-bob-app.png" alt="hello-bob-app.png"></p>

<h2 id="updating-the-deployment">Updating the Deployment</h2>

<p>Now that you have your first application deployed, it is easy to update if you make changes to it, as describe in the following procedure.</p>

<p>Change your application in some way so that, when you run it, you will know which version it is.</p>

<p>For example, in the simple Hello World Sinatra application contained in <code>hello.rb</code>, change the text <code>Hello from Cloud Foundry</code> to <code>Hello from Cloud Foundry and VMware</code>.</p>

<p>At your command prompt or terminal, be sure you are still located in the directory that contains your application file (<code>/usr/bob/sample-apps/hello.rb</code> in our example) and execute the <code>vmc update</code> command, specifying the name of your application, which in our example is <code>hello</code>:</p>

<pre class="terminal">
$ vmc update hello

    Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (0K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<p>In your browser, refresh your application and you will see your changes:</p>

<p><img src="/images/screenshots/installing-vmc/hello-bob-app-updated.png" alt="hello-bob-app-updated.png"></p>

<h2 id="creating-a-simple-sinatra-application">Creating a Simple Sinatra Application</h2>

<p>If you have not already done so, download and install the <a href="http://www.sinatrarb.com/">Sinatra Web framework</a> on your computer.</p>

<p>Create the directory in which the new application will live.  For example:</p>

<pre class="terminal">
prompt$ mkdir /usr/bob/sample-apps/hello
</pre>

<p>Using your favorite text editor, create a file called <code>hello.rb</code> in this new directory with the following contents:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">"Hello from Cloud Foundry"</span>
<span class="k">end</span></code></pre>

<p><img src="/images/screenshots/installing-vmc/vmc_hello.jpg" alt="hello.rb" title="hello app"></p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
  <li><a href="/tools/deploying-apps.html">Deploying and Managing Applications</a></li>
  <li><a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference Guide</a></li>
  <li><a href="/tools/vmc/debugging.html">Debugging</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Â&You use the Cloud Foundry command-line interface (known as `vmc`) at a Unix terminal or Windows command prompt to execute all the Cloud Foundry operations, such as configuring your applications and deploying them to Cloud Foundry.

You execute the `vmc` commands in the same way whether you are deploying your application to the PaaS Cloud Foundry (`cloudfoundry.com`), or to your own local version of Cloud Foundry (Micro Cloud Foundry).  The basic commands are the same; the only difference is that you initially specify a different target before you log in using your Cloud Foundry credentials.

This section describes the prerequisites for installing `vmc`, installation instructions, and how to deploy a simple application.

**Subtopics**

+ [Prerequisite: Installing Ruby and RubyGems](#prerequisite-installing-ruby-and-rubygems)
+ [Installing vmc: Procedure](#installing-vmc-procedure)
+ [Verifying the Installation by Deploying a Sample Application](#verifying-the-installation-by-deploying-a-sample-application)
+ [Next Steps](#next-steps)

## Prerequisite: Installing Ruby and RubyGems

`vmc` is delivered as a Ruby gem, which means you must install Ruby and RubyGems (a Ruby package manager) on the computer on which you want to run `vmc`, if you have not already done so.

The following versions of Ruby are currently supported:

* 1.8.7
* 1.9.2

If you have already installed Ruby and RubyGems, then you can skip to [Installing vmc: Main Steps](#installing-vmc-main-steps).

The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers:

+ [Windows](/frameworks/ruby/installing-ruby.html#windows)
+ [Mac OS X](/frameworks/ruby/installing-ruby.html#mac-os-x)
+ [Ubuntu](/frameworks/ruby/installing-ruby.html#ubuntu)
+ [Redhat/Fedora](/frameworks/ruby/installing-ruby.html#redhatfedora)
+ [Centos](/frameworks/ruby/installing-ruby.html#centos)
+ [SuSE](/frameworks/ruby/installing-ruby.html#suse)
+ [Debian](/frameworks/ruby/installing-ruby.html#debian)

## Installing vmc: Procedure

Installing `vmc` is easy once you have installed [Ruby and RubyGems](#prerequisite-installing-ruby-and-rubygems) on your computer.

*  If you haven't already done so, signup for your free [Cloud Foundry](http://cloudfoundry.com/) account.  You will receive an email with your user credentials.

* Open a terminal (Linux) and execute the following command:

```bash
prompt$ sudo gem install vmc
```

   Consult your system administrator for any required authentication credentials for the `sudo` command.
   On Windows, open a command prompt in which Ruby is enabled and execute the following:

```bash
prompt> gem install vmc
```

* Execute the `vmc target` command to specify the Cloud Foundry target to which you will deploy your applications:

    + To deploy on the PaaS Cloud Foundry, specify `api.cloudfoundry.com`
    + To deploy on your local Micro Cloud Foundry, specify `api.<appname>.cloudfoundry.me`, where *appname* is the domain you registered for your application at the Micro Cloud Foundry Web site.  See [Installing Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html).

    The following command targets the PaaS Cloud Foundry:

```bash
prompt$ vmc target api.cloudfoundry.com
```

    To determine your current target, execute the `vmc target` command without any parameters:

```bash
prompt$ vmc target
```

*   Login using the user credentials you received via email after you registered with Cloud Foudnry.  Your username is typically your email address.

```bash
prompt$ vmc login
```

*  Ensure you have successfully logged in by retrieving information about your account:

```bash
prompt$ vmc info
```

*  Change your password:

```bash
prompt$ vmc passwd
```

*  View the full list of VMC commands, along with their parameters and a brief description, by executing the `vmc help` command:

```bash
prompt$ vmc help
```

You have now successfully installed `vmc` and run a few basic commands.

## Verifying the Installation by Deploying a Sample Application

Now that you have installed VMC and logged in to your target, you can start deploying applications to the Cloud.

This section shows how to deploy a simple application that does not require any services (such as MySQL or RabbitMQ).  The purpose of the section is for you to quickly get a feel for VMC and Cloud Foundry by deploying and running a very basic application.  Later sections describe how to configure your application to use services that connect to databases or manage messaging.

* Create a simple application that does not require any services and package it appropriately, such as into a `*.war` file for Spring applications.

    If you do not currently have an application, see [Creating a Simple Sinatra Application](#creating-a-simple-sinatra-application) for instructions on how to create a basic Ruby Hello World application using Sinatra in just a few minutes.

*  Open a terminal window (Linux) or command prompt (Windows) and change the directory that contains your application.

    For example, if you created the simple Ruby [Hello World](#creating-a-simple-sinatra-application) application using Sintatra:

```bash
prompt$ cd /usr/bob/sample-apps/hello
```

* Deploy your application using the `vmc push` command, which interactively prompts for deployment information:

```bash
prompt$ vmc push
```

For prompts that require a yes or no answer, the default value is shown using capital letters.  For example, if "yes" is the default, you'll see `[Yn]`.

The following sample output also shows the responses you should provide; for clarity, default values are specified explicitly.  See further explanations about these prompts after the example:

```bash

   Would you like to deploy from the current directory? [Yn] Yes
   Application Name: hello
   Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
   Detected a Sinatra Application, is this correct? [Yn]  Yes
   Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
   Would you like to bind any services to 'hello'? [yN]: No

```

After you complete the prompts, `vmc` provides the following output for a successful push (deployment):

```bash

     Uploading Application:
       Checking for available resources: OK
       Packing application: OK
     Uploading (0K): OK
     Push Status: OK
     Staging Application: OK
     Starting Application: OK

```

The Application Name refers to the internal name of the application as well as the actual file you want to deploy without its file extension, `hello` in our example.  The Application Deployed URL is the URL that you use in your browser to run the application after it has successfully deployed and started on Cloud Foundry.  Be sure that you specify a unique deployment URL, or `vmc` will return an error message that the URI has already been taken or reserved.  In the example above, the URL is `hello-bob.cloudfoundry.com`.

Verify that your application is available by executing the `vmc apps` command:

```bash
$ vmc apps

    +--------------+----+--------+-------------------------------+----------+
    | Application  | #  | Health | URLS                          | Services |
    +--------------+----+--------+-------------------------------+----------+
    | hello        | 1  | RUNNING| hello-bob.cloudfoundry.com    |          |
    +--------------+----+--------+-------------------------------+----------+

```

Run your application in your browser by going to the URL you provided to the `vmc push` command, which in the example above is `hello-bob.cloudfoundry.com`.

If, for example, you deployed the Hello World Sinatra application, you should see the text `Hello from Cloud Foundry` in your browser.

![hello-bob-app.png](/images/screenshots/installing-vmc/hello-bob-app.png)

## Updating the Deployment

Now that you have your first application deployed, it is easy to update if you make changes to it, as describe in the following procedure.

Change your application in some way so that, when you run it, you will know which version it is.

For example, in the simple Hello World Sinatra application contained in `hello.rb`, change the text `Hello from Cloud Foundry` to `Hello from Cloud Foundry and VMware`.

At your command prompt or terminal, be sure you are still located in the directory that contains your application file (`/usr/bob/sample-apps/hello.rb` in our example) and execute the `vmc update` command, specifying the name of your application, which in our example is `hello`:

```bash
$ vmc update hello

    Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (0K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK

```

In your browser, refresh your application and you will see your changes:

![hello-bob-app-updated.png](/images/screenshots/installing-vmc/hello-bob-app-updated.png)

## Creating a Simple Sinatra Application

If you have not already done so, download and install the [Sinatra Web framework](http://www.sinatrarb.com/) on your computer.

Create the directory in which the new application will live.  For example:

```bash
prompt$ mkdir /usr/bob/sample-apps/hello
```

Using your favorite text editor, create a file called `hello.rb` in this new directory with the following contents:

``` ruby
require 'sinatra'
get '/' do
  "Hello from Cloud Foundry"
end
```

![hello.rb](/images/screenshots/installing-vmc/vmc_hello.jpg "hello app")

## Next Steps

+ [Installing Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html)
+ [Deploying and Managing Applications](/tools/deploying-apps.html)
+ [Configuring Applications to Use Cloud Foundry](/frameworks.html)
+ [VMC Quick Reference Guide](/tools/vmc/vmc-quick-ref.html)
+ [Debugging](/tools/vmc/debugging.html);T;
I"õ.<p>You use the Cloud Foundry command-line interface (known as <code>vmc</code>) at a Unix terminal or Windows command prompt to execute all the Cloud Foundry operations, such as configuring your applications and deploying them to Cloud Foundry.</p>

<p>You execute the <code>vmc</code> commands in the same way whether you are deploying your application to the PaaS Cloud Foundry (<code>cloudfoundry.com</code>), or to your own local version of Cloud Foundry (Micro Cloud Foundry).  The basic commands are the same; the only difference is that you initially specify a different target before you log in using your Cloud Foundry credentials.</p>

<p>This section describes the prerequisites for installing <code>vmc</code>, installation instructions, and how to deploy a simple application.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#prerequisite-installing-ruby-and-rubygems">Prerequisite: Installing Ruby and RubyGems</a></li>
  <li><a href="#installing-vmc-procedure">Installing vmc: Procedure</a></li>
  <li><a href="#verifying-the-installation-by-deploying-a-sample-application">Verifying the Installation by Deploying a Sample Application</a></li>
  <li><a href="#next-steps">Next Steps</a></li>
</ul><h2 id="prerequisite-installing-ruby-and-rubygems">Prerequisite: Installing Ruby and RubyGems</h2>

<p><code>vmc</code> is delivered as a Ruby gem, which means you must install Ruby and RubyGems (a Ruby package manager) on the computer on which you want to run <code>vmc</code>, if you have not already done so.</p>

<p>The following versions of Ruby are currently supported:</p>

<ul>
<li>1.8.7</li>
  <li>1.9.2</li>
</ul><p>If you have already installed Ruby and RubyGems, then you can skip to <a href="#installing-vmc-main-steps">Installing vmc: Main Steps</a>.</p>

<p>The following sections provide basic information about installing Ruby and RubyGems on Windows and a variety of Linux computers:</p>

<ul>
<li><a href="/frameworks/ruby/installing-ruby.html#windows">Windows</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#mac-os-x">Mac OS X</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#ubuntu">Ubuntu</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#redhatfedora">Redhat/Fedora</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#centos">Centos</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#suse">SuSE</a></li>
  <li><a href="/frameworks/ruby/installing-ruby.html#debian">Debian</a></li>
</ul><h2 id="installing-vmc-procedure">Installing vmc: Procedure</h2>

<p>Installing <code>vmc</code> is easy once you have installed <a href="#prerequisite-installing-ruby-and-rubygems">Ruby and RubyGems</a> on your computer.</p>

<ul>
<li>
    <p>If you havenâ€™t already done so, signup for your free <a href="http://cloudfoundry.com/">Cloud Foundry</a> account.  You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>Open a terminal (Linux) and execute the following command:</p>
  </li>
</ul><pre class="terminal">
prompt$ sudo gem install vmc
</pre>

<p>Consult your system administrator for any required authentication credentials for the <code>sudo</code> command.
   On Windows, open a command prompt in which Ruby is enabled and execute the following:</p>

<pre class="terminal">
prompt&gt; gem install vmc
</pre>

<ul>
<li>
    <p>Execute the <code>vmc target</code> command to specify the Cloud Foundry target to which you will deploy your applications:</p>

    <ul>
<li>To deploy on the PaaS Cloud Foundry, specify <code>api.cloudfoundry.com</code>
</li>
      <li>To deploy on your local Micro Cloud Foundry, specify <code>api.&lt;appname&gt;.cloudfoundry.me</code>, where <em>appname</em> is the domain you registered for your application at the Micro Cloud Foundry Web site.  See <a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a>.</li>
    </ul>
<p>The following command targets the PaaS Cloud Foundry:</p>
  </li>
</ul><pre class="terminal">
prompt$ vmc target api.cloudfoundry.com
</pre>

<pre><code>To determine your current target, execute the `vmc target` command without any parameters:
</code></pre>

<pre class="terminal">
prompt$ vmc target
</pre>

<ul>
<li>Login using the user credentials you received via email after you registered with Cloud Foudnry.  Your username is typically your email address.</li>
</ul><pre class="terminal">
prompt$ vmc login
</pre>

<ul>
<li>Ensure you have successfully logged in by retrieving information about your account:</li>
</ul><pre class="terminal">
prompt$ vmc info
</pre>

<ul>
<li>Change your password:</li>
</ul><pre class="terminal">
prompt$ vmc passwd
</pre>

<ul>
<li>View the full list of VMC commands, along with their parameters and a brief description, by executing the <code>vmc help</code> command:</li>
</ul><pre class="terminal">
prompt$ vmc help
</pre>

<p>You have now successfully installed <code>vmc</code> and run a few basic commands.</p>

<h2 id="verifying-the-installation-by-deploying-a-sample-application">Verifying the Installation by Deploying a Sample Application</h2>

<p>Now that you have installed VMC and logged in to your target, you can start deploying applications to the Cloud.</p>

<p>This section shows how to deploy a simple application that does not require any services (such as MySQL or RabbitMQ).  The purpose of the section is for you to quickly get a feel for VMC and Cloud Foundry by deploying and running a very basic application.  Later sections describe how to configure your application to use services that connect to databases or manage messaging.</p>

<ul>
<li>
    <p>Create a simple application that does not require any services and package it appropriately, such as into a <code>*.war</code> file for Spring applications.</p>

    <p>If you do not currently have an application, see <a href="#creating-a-simple-sinatra-application">Creating a Simple Sinatra Application</a> for instructions on how to create a basic Ruby Hello World application using Sinatra in just a few minutes.</p>
  </li>
  <li>
    <p>Open a terminal window (Linux) or command prompt (Windows) and change the directory that contains your application.</p>

    <p>For example, if you created the simple Ruby <a href="#creating-a-simple-sinatra-application">Hello World</a> application using Sintatra:</p>
  </li>
</ul><pre class="terminal">
prompt$ cd /usr/bob/sample-apps/hello
</pre>

<ul>
<li>Deploy your application using the <code>vmc push</code> command, which interactively prompts for deployment information:</li>
</ul><pre class="terminal">
prompt$ vmc push
</pre>

<p>For prompts that require a yes or no answer, the default value is shown using capital letters.  For example, if â€œyesâ€ is the default, youâ€™ll see <code>[Yn]</code>.</p>

<p>The following sample output also shows the responses you should provide; for clarity, default values are specified explicitly.  See further explanations about these prompts after the example:</p>

<pre class="terminal">
   Would you like to deploy from the current directory? [Yn] Yes
   Application Name: hello
   Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
   Detected a Sinatra Application, is this correct? [Yn]  Yes
   Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
   Would you like to bind any services to 'hello'? [yN]: No

</pre>

<p>After you complete the prompts, <code>vmc</code> provides the following output for a successful push (deployment):</p>

<pre class="terminal">
     Uploading Application:
       Checking for available resources: OK
       Packing application: OK
     Uploading (0K): OK
     Push Status: OK
     Staging Application: OK
     Starting Application: OK

</pre>

<p>The Application Name refers to the internal name of the application as well as the actual file you want to deploy without its file extension, <code>hello</code> in our example.  The Application Deployed URL is the URL that you use in your browser to run the application after it has successfully deployed and started on Cloud Foundry.  Be sure that you specify a unique deployment URL, or <code>vmc</code> will return an error message that the URI has already been taken or reserved.  In the example above, the URL is <code>hello-bob.cloudfoundry.com</code>.</p>

<p>Verify that your application is available by executing the <code>vmc apps</code> command:</p>

<pre class="terminal">
$ vmc apps

    +--------------+----+--------+-------------------------------+----------+
    | Application  | #  | Health | URLS                          | Services |
    +--------------+----+--------+-------------------------------+----------+
    | hello        | 1  | RUNNING| hello-bob.cloudfoundry.com    |          |
    +--------------+----+--------+-------------------------------+----------+

</pre>

<p>Run your application in your browser by going to the URL you provided to the <code>vmc push</code> command, which in the example above is <code>hello-bob.cloudfoundry.com</code>.</p>

<p>If, for example, you deployed the Hello World Sinatra application, you should see the text <code>Hello from Cloud Foundry</code> in your browser.</p>

<p><img src="/images/screenshots/installing-vmc/hello-bob-app.png" alt="hello-bob-app.png"></p>

<h2 id="updating-the-deployment">Updating the Deployment</h2>

<p>Now that you have your first application deployed, it is easy to update if you make changes to it, as describe in the following procedure.</p>

<p>Change your application in some way so that, when you run it, you will know which version it is.</p>

<p>For example, in the simple Hello World Sinatra application contained in <code>hello.rb</code>, change the text <code>Hello from Cloud Foundry</code> to <code>Hello from Cloud Foundry and VMware</code>.</p>

<p>At your command prompt or terminal, be sure you are still located in the directory that contains your application file (<code>/usr/bob/sample-apps/hello.rb</code> in our example) and execute the <code>vmc update</code> command, specifying the name of your application, which in our example is <code>hello</code>:</p>

<pre class="terminal">
$ vmc update hello

    Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (0K): OK
    Push Status: OK
    Stopping Application: OK
    Staging Application: OK
    Starting Application: OK

</pre>

<p>In your browser, refresh your application and you will see your changes:</p>

<p><img src="/images/screenshots/installing-vmc/hello-bob-app-updated.png" alt="hello-bob-app-updated.png"></p>

<h2 id="creating-a-simple-sinatra-application">Creating a Simple Sinatra Application</h2>

<p>If you have not already done so, download and install the <a href="http://www.sinatrarb.com/">Sinatra Web framework</a> on your computer.</p>

<p>Create the directory in which the new application will live.  For example:</p>

<pre class="terminal">
prompt$ mkdir /usr/bob/sample-apps/hello
</pre>

<p>Using your favorite text editor, create a file called <code>hello.rb</code> in this new directory with the following contents:</p>

<pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'sinatra'</span>
<span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
  <span class="s2">"Hello from Cloud Foundry"</span>
<span class="k">end</span></code></pre>

<p><img src="/images/screenshots/installing-vmc/vmc_hello.jpg" alt="hello.rb" title="hello app"></p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
  <li><a href="/tools/deploying-apps.html">Deploying and Managing Applications</a></li>
  <li><a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference Guide</a></li>
  <li><a href="/tools/vmc/debugging.html">Debugging</a></li>
</ul>;T;@aI"/tools/vmc/debugging/;T{;{	;I"<<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/debugging.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Debugging with VMC' property='og:title'>
<meta content='Debugging Problems With Your Applications' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Debugging with VMC</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>Debugging with VMC</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Debugging Problems With Your Applications</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/debug" rel="tag">debug</a><a href="/tags/vmc" rel="tag">vmc</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This chapter includes the following topics to help you debug problems with your application:</p>

<ul>
<li><a href="#viewing-log-files">Viewing Log Files</a></li>
  <li><a href="#attaching-a-debugger-to-your-application">Attaching a Debugger to Your Application</a></li>
</ul><h2 id="viewing-log-files">Viewing Log Files</h2>

<p>If you get errors when attempting to deploy, start, or run your application, it is helpful to view the various log files which will likely contain error codes or exceptions that can help you pinpoint what the problem is.</p>

<p>Use the <code>vmc files</code> command to get a list of available log files and to view recent entries in a particular log file.</p>

<p>For example, to get a list of all the log files related to the <code>hotels</code> application, and see which ones are non-zero in size and thus contain information, execute the following VMC commands (with sample output shown):</p>

<pre class="terminal">
prompt$ vmc files hotels logs

  stderr.log                                2.2K
  stdout.log                                5.3K

prompt$ vmc files hotels tomcat/logs

  catalina.2011-10-18.log                   2.2K
  host-manager.2011-10-18.log                 0B
  localhost.2011-10-18.log                  247B
  manager.2011-10-18.log                      0B

</pre>

<p>To view the contents of the files in the <code>logs</code> directory (such as <code>stderr.log</code>), use the following command:</p>

<pre class="terminal">
prompt$ vmc files hotels logs/stderr.log
</pre>

<p>To view the contents of the Tomcat log files (such as <code>catalina.2011-10-18.log</code>) file, use the following command:</p>

<pre class="terminal">
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log
</pre>

<p>Both of these commands display the information to the terminal, so you must redirect the output to a file if you want to send it to support:</p>

<pre class="terminal">
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log  &gt; catalina.log
</pre>

<h2 id="attaching-a-debugger-to-your-application">Attaching a Debugger to Your Application</h2>

<p>Documentation not yet available.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"6This chapter includes the following topics to help you debug problems with your application:

+ [Viewing Log Files](#viewing-log-files)
+ [Attaching a Debugger to Your Application](#attaching-a-debugger-to-your-application)

##Viewing Log Files

If you get errors when attempting to deploy, start, or run your application, it is helpful to view the various log files which will likely contain error codes or exceptions that can help you pinpoint what the problem is.

Use the `vmc files` command to get a list of available log files and to view recent entries in a particular log file.

For example, to get a list of all the log files related to the `hotels` application, and see which ones are non-zero in size and thus contain information, execute the following VMC commands (with sample output shown):

```bash

prompt$ vmc files hotels logs

  stderr.log                                2.2K
  stdout.log                                5.3K

prompt$ vmc files hotels tomcat/logs

  catalina.2011-10-18.log                   2.2K
  host-manager.2011-10-18.log                 0B
  localhost.2011-10-18.log                  247B
  manager.2011-10-18.log                      0B

```

To view the contents of the files in the `logs` directory (such as `stderr.log`), use the following command:

```bash
prompt$ vmc files hotels logs/stderr.log
```

To view the contents of the Tomcat log files (such as `catalina.2011-10-18.log`) file, use the following command:

```bash
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log
```

Both of these commands display the information to the terminal, so you must redirect the output to a file if you want to send it to support:

```bash
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log  > catalina.log
```

##Attaching a Debugger to Your Application

Documentation not yet available.;T;
I"q<p>This chapter includes the following topics to help you debug problems with your application:</p>

<ul>
<li><a href="#viewing-log-files">Viewing Log Files</a></li>
  <li><a href="#attaching-a-debugger-to-your-application">Attaching a Debugger to Your Application</a></li>
</ul><h2 id="viewing-log-files">Viewing Log Files</h2>

<p>If you get errors when attempting to deploy, start, or run your application, it is helpful to view the various log files which will likely contain error codes or exceptions that can help you pinpoint what the problem is.</p>

<p>Use the <code>vmc files</code> command to get a list of available log files and to view recent entries in a particular log file.</p>

<p>For example, to get a list of all the log files related to the <code>hotels</code> application, and see which ones are non-zero in size and thus contain information, execute the following VMC commands (with sample output shown):</p>

<pre class="terminal">
prompt$ vmc files hotels logs

  stderr.log                                2.2K
  stdout.log                                5.3K

prompt$ vmc files hotels tomcat/logs

  catalina.2011-10-18.log                   2.2K
  host-manager.2011-10-18.log                 0B
  localhost.2011-10-18.log                  247B
  manager.2011-10-18.log                      0B

</pre>

<p>To view the contents of the files in the <code>logs</code> directory (such as <code>stderr.log</code>), use the following command:</p>

<pre class="terminal">
prompt$ vmc files hotels logs/stderr.log
</pre>

<p>To view the contents of the Tomcat log files (such as <code>catalina.2011-10-18.log</code>) file, use the following command:</p>

<pre class="terminal">
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log
</pre>

<p>Both of these commands display the information to the terminal, so you must redirect the output to a file if you want to send it to support:</p>

<pre class="terminal">
prompt$ vmc files hotels tomcat/logs/catalina.2011-10-18.log  &gt; catalina.log
</pre>

<h2 id="attaching-a-debugger-to-your-application">Attaching a Debugger to Your Application</h2>

<p>Documentation not yet available.</p>;T;@gI"/tools/vmc/vmc/;T{;{	;I"Å5<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/tools/vmc/vmc.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | VMC' property='og:title'>
<meta content='Working with vmc' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | VMC</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Tools</h1>
<p class='sub-head'>VMC</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Working with vmc</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/vmc" rel="tag">vmc</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>The following resources will help you get started using vmc on Cloud Foundry:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">VMC Installation</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></li>
  <li><a href="/tools/vmc/debugging.html">Debugging with VMC</a></li>
  <li><a href="/tools/vmc/caldecott.html">Tunneling to a Service</a></li>
  <li><a href="/tools/vmc/vmc-non-interactive.html">Using VMC in Non Interactive Mode</a></li>
  <li><a href="http://blog.cloudfoundry.com/post/13481010498/simplified-application-deployment-with-cloud-foundry-manifest">Simplified Application Deployment with VMCâ€™s new application Manifest feature</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I",The following resources will help you get started using vmc on Cloud Foundry:

+ [VMC Installation](/tools/vmc/installing-vmc.html)
+ [VMC Quick Reference](/tools/vmc/vmc-quick-ref.html)
+ [Debugging with VMC](/tools/vmc/debugging.html)
+ [Tunneling to a Service](/tools/vmc/caldecott.html)
+ [Using VMC in Non Interactive Mode](/tools/vmc/vmc-non-interactive.html)
+ [Simplified Application Deployment with VMC's new application Manifest feature](http://blog.cloudfoundry.com/post/13481010498/simplified-application-deployment-with-cloud-foundry-manifest);T;
I"¶<p>The following resources will help you get started using vmc on Cloud Foundry:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">VMC Installation</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a></li>
  <li><a href="/tools/vmc/debugging.html">Debugging with VMC</a></li>
  <li><a href="/tools/vmc/caldecott.html">Tunneling to a Service</a></li>
  <li><a href="/tools/vmc/vmc-non-interactive.html">Using VMC in Non Interactive Mode</a></li>
  <li><a href="http://blog.cloudfoundry.com/post/13481010498/simplified-application-deployment-with-cloud-foundry-manifest">Simplified Application Deployment with VMCâ€™s new application Manifest feature</a></li>
</ul>;T;@mI"/quick-start/;T{;{	;I"“A<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/quick-start.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Quick Start' property='og:title'>
<meta content='A Hello World tutorial for Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Quick Start</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Quick Start</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>A Hello World tutorial for Cloud Foundry</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-03
</span>
</p>
<div id='social-share'></div>
<p>This tutorial takes you through the process of creating a simple Ruby application and deploying it on Cloud Foundry.</p>

<p><img src="/images/screenshots/spring-insight/insight-cf-app.png" alt="alt text" title="sample"><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<ul>
<li>
    <p>Sign up for a Cloud Foundry account from the <a href="http://www.cloudfoundry.com/">Cloud Foundry Web page</a>. You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>If needed, install Ruby and Ruby Gems on your computer.</p>

    <p>See <a href="/frameworks/ruby/installing-ruby.html">Installing Ruby and RubyGems</a>.</p>
  </li>
  <li>
    <p>Install the vmc gem, using the following command:</p>
  </li>
</ul><pre class="terminal">
$ sudo gem install vmc
</pre>

<pre><code>Note that `sudo` is not needed on all operating systems.
</code></pre>

<ul>
<li>This example uses Sinatra, so install the Sinatra gem:</li>
</ul><pre class="terminal">
$ sudo gem install sinatra
</pre>

<ul>
<li>Target the Cloud Foundry and log in using the credentials you recieved in email:</li>
</ul><pre class="terminal">
$ vmc target api.cloudfoundry.com
    $ vmc login

</pre>

<ul>
<li>The first time you log in, you should change your password:</li>
</ul><pre class="terminal">
$ vmc passwd
</pre>

<ul>
<li>Create a directory for your application and change into it.</li>
</ul><pre class="terminal">
$ mkdir my-first-app
	$ cd my-first-app
</pre>

<ul>
<li>
    <p>Create a new file, <code>hello.rb</code>, with the following contents:</p>

    <pre><code>  require 'sinatra'
  get '/' do
      "Hello from Cloud Foundry"
  end
</code></pre>
  </li>
  <li>
    <p>Deploy your application using the <code>vmc push</code> command:</p>
  </li>
</ul><pre class="terminal">
$ vmc push
</pre>

<pre><code>You can accept most defaults by pressing `Enter` at the prompts.  But be sure to enter a unique URL at the `Application Deployed URL` prompt. The name of the application needs to be unique only among your set of applications.

The following is an example of interacting with the `vmc push` command:

    Would you like to deploy from the current directory? [Yn]
    Application Name: hello
    Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
    Detected a Sinatra Application, is this correct? [Yn]
    Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
    Would you like to bind any services to 'hello'? [yN]:

    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</code></pre>

<ul>
<li>Invoke your application in a browser using the deployment URL you specified, for example, <code>http://hello-bob.cloudfoundry.com</code>.</li>
</ul><h1 id="next-steps">Next Steps</h1>

<ul>
<li><a href="/infrastructure/overview.html">Read more about Cloud Foundry</a></li>
  <li><a href="/infrastructure/micro/installing-mcf.html">Install Micro Cloud Foundry on your local computer</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Install the Cloud Foundry Extension in STS or Eclipse</a></li>
  <li><a href="/frameworks/java/spring/spring.html">Configure your Spring applications to use Cloud Foundry services</a></li>
  <li><a href="/frameworks/ruby/rails.html">Configure your Ruby on Rails applications to use Cloud Foundry services</a></li>
  <li><a href="/tools/deploying-apps.html">Deploy and manage applications with more complicated requirements</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">Read the VMC Quick Reference guide</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"This tutorial takes you through the process of creating a simple Ruby application and deploying it on Cloud Foundry.

![alt text](/images/screenshots/spring-insight/insight-cf-app.png "sample")
![todolist-usecase.png](/images/play/todolist-usecase.png)

* Sign up for a Cloud Foundry account from the [Cloud Foundry Web page](http://www.cloudfoundry.com/). You will receive an email with your user credentials.

* If needed, install Ruby and Ruby Gems on your computer.

    See [Installing Ruby and RubyGems](/frameworks/ruby/installing-ruby.html).

* 	Install the vmc gem, using the following command:

```bash
$ sudo gem install vmc
```

	Note that `sudo` is not needed on all operating systems.

* This example uses Sinatra, so install the Sinatra gem:

```bash
$ sudo gem install sinatra
```

* 	Target the Cloud Foundry and log in using the credentials you recieved in email:

```bash
$ vmc target api.cloudfoundry.com
    $ vmc login

```

* The first time you log in, you should change your password:

```bash
$ vmc passwd
```

* Create a directory for your application and change into it.

```bash
$ mkdir my-first-app
	$ cd my-first-app
```

* Create a new file, `hello.rb`, with the following contents:

		require 'sinatra'
		get '/' do
			"Hello from Cloud Foundry"
		end

* Deploy your application using the `vmc push` command:

```bash
$ vmc push
```

    You can accept most defaults by pressing `Enter` at the prompts.  But be sure to enter a unique URL at the `Application Deployed URL` prompt. The name of the application needs to be unique only among your set of applications.

    The following is an example of interacting with the `vmc push` command:

        Would you like to deploy from the current directory? [Yn]
        Application Name: hello
        Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
        Detected a Sinatra Application, is this correct? [Yn]
        Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
        Would you like to bind any services to 'hello'? [yN]:

        Uploading Application:
          Checking for available resources: OK
          Packing application: OK
          Uploading (0K): OK
        Push Status: OK
        Staging Application: OK
        Starting Application: OK

* Invoke your application in a browser using the deployment URL you specified, for example, `http://hello-bob.cloudfoundry.com`.

# Next Steps

+ [Read more about Cloud Foundry](/infrastructure/overview.html)
+ [Install Micro Cloud Foundry on your local computer](/infrastructure/micro/installing-mcf.html)
+ [Install the Cloud Foundry Extension in STS or Eclipse](/tools/STS/configuring-STS.html)
+ [Configure your Spring applications to use Cloud Foundry services](/frameworks/java/spring/spring.html)
+ [Configure your Ruby on Rails applications to use Cloud Foundry services](/frameworks/ruby/rails.html)
+ [Deploy and manage applications with more complicated requirements](/tools/deploying-apps.html)
+ [Read the VMC Quick Reference guide](/tools/vmc/vmc-quick-ref.html);T;
I"‚<p>This tutorial takes you through the process of creating a simple Ruby application and deploying it on Cloud Foundry.</p>

<p><img src="/images/screenshots/spring-insight/insight-cf-app.png" alt="alt text" title="sample"><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<ul>
<li>
    <p>Sign up for a Cloud Foundry account from the <a href="http://www.cloudfoundry.com/">Cloud Foundry Web page</a>. You will receive an email with your user credentials.</p>
  </li>
  <li>
    <p>If needed, install Ruby and Ruby Gems on your computer.</p>

    <p>See <a href="/frameworks/ruby/installing-ruby.html">Installing Ruby and RubyGems</a>.</p>
  </li>
  <li>
    <p>Install the vmc gem, using the following command:</p>
  </li>
</ul><pre class="terminal">
$ sudo gem install vmc
</pre>

<pre><code>Note that `sudo` is not needed on all operating systems.
</code></pre>

<ul>
<li>This example uses Sinatra, so install the Sinatra gem:</li>
</ul><pre class="terminal">
$ sudo gem install sinatra
</pre>

<ul>
<li>Target the Cloud Foundry and log in using the credentials you recieved in email:</li>
</ul><pre class="terminal">
$ vmc target api.cloudfoundry.com
    $ vmc login

</pre>

<ul>
<li>The first time you log in, you should change your password:</li>
</ul><pre class="terminal">
$ vmc passwd
</pre>

<ul>
<li>Create a directory for your application and change into it.</li>
</ul><pre class="terminal">
$ mkdir my-first-app
	$ cd my-first-app
</pre>

<ul>
<li>
    <p>Create a new file, <code>hello.rb</code>, with the following contents:</p>

    <pre><code>  require 'sinatra'
  get '/' do
      "Hello from Cloud Foundry"
  end
</code></pre>
  </li>
  <li>
    <p>Deploy your application using the <code>vmc push</code> command:</p>
  </li>
</ul><pre class="terminal">
$ vmc push
</pre>

<pre><code>You can accept most defaults by pressing `Enter` at the prompts.  But be sure to enter a unique URL at the `Application Deployed URL` prompt. The name of the application needs to be unique only among your set of applications.

The following is an example of interacting with the `vmc push` command:

    Would you like to deploy from the current directory? [Yn]
    Application Name: hello
    Application Deployed URL: 'hello.cloudfoundry.com'?  hello-bob.cloudfoundry.com
    Detected a Sinatra Application, is this correct? [Yn]
    Memory Reservation [Default:128M]  (64M, 128M, 256M, 512M or 1G) (Press Enter to take default)
    Would you like to bind any services to 'hello'? [yN]:

    Uploading Application:
      Checking for available resources: OK
      Packing application: OK
      Uploading (0K): OK
    Push Status: OK
    Staging Application: OK
    Starting Application: OK
</code></pre>

<ul>
<li>Invoke your application in a browser using the deployment URL you specified, for example, <code>http://hello-bob.cloudfoundry.com</code>.</li>
</ul><h1 id="next-steps">Next Steps</h1>

<ul>
<li><a href="/infrastructure/overview.html">Read more about Cloud Foundry</a></li>
  <li><a href="/infrastructure/micro/installing-mcf.html">Install Micro Cloud Foundry on your local computer</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Install the Cloud Foundry Extension in STS or Eclipse</a></li>
  <li><a href="/frameworks/java/spring/spring.html">Configure your Spring applications to use Cloud Foundry services</a></li>
  <li><a href="/frameworks/ruby/rails.html">Configure your Ruby on Rails applications to use Cloud Foundry services</a></li>
  <li><a href="/tools/deploying-apps.html">Deploy and manage applications with more complicated requirements</a></li>
  <li><a href="/tools/vmc/vmc-quick-ref.html">Read the VMC Quick Reference guide</a></li>
</ul>;T;@sI"/infrastructure/micro/mcf/;T{;{	;I"4<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/infrastructure/micro/mcf.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Micro Cloud Foundry' property='og:title'>
<meta content='Get Started with the Micro Cloud Foundry VM' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Micro Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Infrastructure</h1>
<p class='sub-head'>Micro Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Get Started with the Micro Cloud Foundry VM</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mcf" rel="tag">mcf</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>These documents will help you get started with the Micro Cloud Foundry VM:</p>

<ul>
<li><a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
  <li><a href="/infrastructure/micro/using-mcf.html">Using Micro Cloud Foundry</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"İThese documents will help you get started with the Micro Cloud Foundry VM:

+ [Installing Micro Cloud Foundry](/infrastructure/micro/installing-mcf.html)
+ [Using Micro Cloud Foundry](/infrastructure/micro/using-mcf.html);T;
I"<p>These documents will help you get started with the Micro Cloud Foundry VM:</p>

<ul>
<li><a href="/infrastructure/micro/installing-mcf.html">Installing Micro Cloud Foundry</a></li>
  <li><a href="/infrastructure/micro/using-mcf.html">Using Micro Cloud Foundry</a></li>
</ul>;T;@yI"*/infrastructure/micro/installing-mcf/;T{;{	;I"áX<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/infrastructure/micro/installing-mcf.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Installing Micro Cloud Foundry' property='og:title'>
<meta content='Get the Micro Cloud Foundry VM Installed and Running' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Installing Micro Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Infrastructure</h1>
<p class='sub-head'>Installing Micro Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Get the Micro Cloud Foundry VM Installed and Running</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/mcf" rel="tag">mcf</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>This document helps you to download and get the Micro Cloud Foundry VM installed and
running. When you complete these tasks, you can begin publishing your
application to Micro Cloud Foundry.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#about-micro-cloud-foundry">About Micro Cloud Foundry</a></li>
  <li><a href="#installation-overview">Installation Overview</a></li>
  <li><a href="#downloading-the-micro-cloud-foundry-virtual-machine">Downloading the Micro Cloud Foundry Virtual Machine</a></li>
  <li><a href="#starting-and-configuring-the-micro-cloud-foundry-virtual-machine">Starting and Configuring the Micro Cloud Foundry Virtual Machine</a></li>
  <li><a href="#registering-a-micro-cloud-foundry-user-with-vmc">Registering a Micro Cloud Foundry User with vmc</a></li>
  <li><a href="#next-steps">Next Steps</a></li>
</ul><h2 id="about-micro-cloud-foundry">About Micro Cloud Foundry</h2>

<p>Micro Cloud Foundry provides the VMware open platform as a service in a
standalone environment running in a virtual machine. It is a self-contained
local development environment as similar as possible to the Cloud Foundry cloud,
making application development for the cloud and the transition from
development to production much more seamless.</p>

<p>When you use Micro Cloud Foundry, you run a local virtual machine that provides
the same services Cloud Foundry provides your application. The virtual machine
connects with VMware servers to set up DNS for your application. You develop on
your local computer and then use the <code>vmc</code> Ruby command line utility, or the
Eclipse/Spring Tool Suite (STS) Cloud Foundry plug-in, to publish your
application to your Micro Cloud Foundry. You and others on your network, can
then test your application at
http://api.<em>appname</em>.cloudfoundry.me.</p>

<p>When you are ready to move the application to production, you use <code>vmc</code> or STS
to publish the application to a local or hosted Cloud Foundry instance.</p>

<h2 id="installation-overview">Installation Overview</h2>

<p>Installing Micro Cloud Foundry includes downloading the virtual machine and then
running it in <a href="http://www.vmware.com/products/workstation/overview.html">VMware Workstation</a>, <a href="http://www.vmware.com/products/fusion/overview.html">VMware Fusion</a> (Mac), or
<a href="http://www.vmware.com/products/player/overview.html">VMware Player</a> and configuring it. While you are at the Micro Cloud Foundry
Web site, you register a unique application name (<em>appname</em>) for your
application.</p>

<p>The Micro Cloud Foundry virtual machine connects to VMware servers
to set up DNS for your application. This is accomplished by using a
configuration token, which is generated for you when you visit the Micro Cloud
Foundry Web site at https://www.cloudfoundry.com/micro/dns. The generated DNS
token is good for one use; if your network changes, you must return to the Micro
Cloud Foundry Web site, generate a new token, and, in the Micro Cloud Foundry
virtual machine, select option 4 to reconfigure your domain.</p>

<p>Before you begin, be sure you have these items:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/">Cloud Foundry</a> account.</p>
  </li>
  <li>
    <p><a href="http://www.vmware.com/products/workstation/overview.html">VMware Workstation</a>, <a href="http://www.vmware.com/products/fusion/overview.html">VMware Fusion</a> (Mac), or <a href="http://www.vmware.com/products/player/overview.html">VMware Player</a> installed.</p>
  </li>
  <li>
    <p>Ruby and the <a href="/tools/vmc/installing-vmc.html">vmc</a> gem installed.</p>
  </li>
  <li>
    <p>If you develop in Java, [Spring Tool Suite (STS)] or Eclipse with
the VMware Cloud Foundry plug-in installed. See <a href="/tools/STS/configuring-STS.html">Configuring Spring Tool Suite or Eclipse for Cloud Foundry</a>.</p>
  </li>
</ul><h2 id="downloading-the-micro-cloud-foundry-virtual-machine">Downloading the Micro Cloud Foundry Virtual Machine</h2>

<ol>
<li>
    <p>In your Web browser, go to <a href="https://cloudfoundry.com/micro">Micro Cloud Foundry</a>.</p>
  </li>
  <li>
    <p>Click on â€˜Get Micro Cloud Foundryâ€™ and then log in with your Cloud Foundry email and password. (Click <strong>Get an Account</strong> if you need an account.)</p>
  </li>
  <li>
    <p>Check the box to accept the End User License Agreement, and click <strong>Accept</strong>.</p>
  </li>
  <li>
    <p>Enter a unique domain name for your Micro Cloud Foundry. The name you enter is checked in real-time so you can see if it is available.</p>

    <p><img src="/images/screenshots/installing-mcf/micro_dns.jpg" alt="Create Domain" title="Micro DNS"></p>
  </li>
  <li>
    <p>Click <strong>Create</strong>.</p>

    <p>Your new domain name is reserved and a configuration token is created for you.</p>

    <p><img src="/images/screenshots/installing-mcf/micro_reserved.png" alt="Domain Reserved" title="Domain Reserved"></p>
  </li>
  <li>
    <p>Write down the configuration token. You will need it in a later step.</p>
  </li>
  <li>
    <p>Click <strong>Download Micro Cloud Foundry VM</strong> and save the file.</p>
  </li>
</ol><h2 id="starting-and-configuring-the-micro-cloud-foundry-virtual-machine">Starting and Configuring the Micro Cloud Foundry Virtual Machine</h2>

<ol>
<li>
    <p>Unzip/tar the compressed Micro Cloud Foundry VM. This creates the folder
<code>micro</code> containing the virtual machine files.</p>
  </li>
  <li>
    <p>Start VMware Workstation, VMware Fusion, or VMware Player and open the <code>micro/micro.vmx</code> file.</p>
  </li>
  <li>
    <p>Power on the virtual machine.</p>
  </li>
  <li>
    <p>At the Welcome screen, select <strong>1</strong> to configure.</p>
  </li>
  <li>
    <p>Set a password for Micro Cloud Foundry by entering and confirming the new password.</p>
  </li>
  <li>
    <p>At the <em>Select network:</em> prompt, enter <strong>1</strong> to configure networking with DHCP.</p>
  </li>
  <li>
    <p>At the <em>HTTP proxy:</em> prompt, press Enter to choose <strong>none</strong> for HTTP proxy.</p>

    <p>If you are behind an HTTP proxy, enter the URL for the proxy server, for example <code>http://192.168.1.125:8023</code>.</p>
  </li>
  <li>
    <p>Enter the configuration token from the Micro Cloud Foundry Web site.</p>
  </li>
</ol><pre class="terminal">
              Welcome to VMware Micro Cloud Foundry version 1.2.0

Network up
Micro Cloud Foundry not configured

1. configure
2. refresh console
3. help
4. shutdown VM

select option: 1

set password Micro Cloud Foundry VM user
Password: ********
Confirmation: ********
Password changed!

1. DHCP
2. Static
Select network: 1

HTTP proxy: |none|

Enter Micro Cloud Foundry configuration token or offline domain name: shock-throw-caption
</pre>

<p>The Micro Cloud Foundry virtual machine verifies your DNS and configures the Micro Cloud.</p>

<dl>
<dt><strong>Note</strong></dt>
  <dd>If you plan to use Micro Cloud Foundry without an Internet connection, enter a fictious domain name instead of the DNS configuration token. This is an advanced configuration option described in <a href="/infrastructure/micro/using-mcf.html#working-offline-with-micro-cloud-foundry">Using Micro Cloud Foundry</a>.</dd>
</dl><h2 id="registering-a-micro-cloud-foundry-user-with-vmc">Registering a Micro Cloud Foundry User with vmc</h2>

<p>Registering a user creates a user account on the Micro Cloud Foundry virtual
machine. You log in with this account to publish and manage applications.</p>

<dl>
<dt><em>Notes:</em></dt>
  <dd>See <a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Interface (vmc)</a> for
  help installing <code>vmc</code>.</dd>
  <dd>
    <p>See <a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a> for additional information
  about using the <code>vmc</code> command.</p>
  </dd>
  <dd>
    <p>See <a href="/tools/STS/configuring-STS.html">Configuring Spring Tool Suite or Eclipse for Cloud
  Foundry</a> for help setting up the Cloud Foundry
  Integration plug-in in STS or Eclipse and for registering a Micro Cloud
  Foundry user from within the plug-in.</p>
  </dd>
</dl><p>In the steps that follow, <em>appname</em> is the domain you registered for
your application at the Micro Cloud Foundry Web site.</p>

<p>Target your Micro Cloud Foundry. In a shell, enter the following command:</p>

<pre class="terminal">
$ vmc target api.appname.cloudfoundry.me
</pre>

<p>Create a new account using the <code>vmc register</code> command:</p>

<pre class="terminal">
$ vmc register
</pre>

<p>Enter your email address.</p>

<p>Enter a password and confirm it when requested.</p>

<pre class="terminal">
$ vmc target api.pubs.cloudfoundry.me
Successfully targeted to [http://api.pubs.cloudfoundry.me]

$ vmc register
Email: myemail@mydomain.com
Password: ********
Verify Password: ********
Creating New User: OK
Successfully logged into [http://api.pubs.cloudfoundry.me]
</pre>

<p>You are now ready to log in with <code>vmc</code> or set up Spring Tool Suite to deploy your
applications to Micro Cloud Foundry.</p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="using-mcf.html#using-microcloud-foundry-vmc">Log in to your Micro Cloud Foundry with vmc</a></li>
  <li><a href="using-mcf.html#using-micro-cloud-foundry-sts">Log in to your Micro Cloud Foundry with Spring Tool Suite (STS)</a></li>
  <li><a href="using-mcf.html">Day-to-day Micro Cloud Foundry Management</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"This document helps you to download and get the Micro Cloud Foundry VM installed and
running. When you complete these tasks, you can begin publishing your
application to Micro Cloud Foundry.

**Subtopics**

+   [About Micro Cloud Foundry](#about-micro-cloud-foundry)
+   [Installation Overview](#installation-overview)
+   [Downloading the Micro Cloud Foundry Virtual Machine](#downloading-the-micro-cloud-foundry-virtual-machine)
+   [Starting and Configuring the Micro Cloud Foundry Virtual Machine](#starting-and-configuring-the-micro-cloud-foundry-virtual-machine)
+   [Registering a Micro Cloud Foundry User with vmc](#registering-a-micro-cloud-foundry-user-with-vmc)
+   [Next Steps](#next-steps)

## About Micro Cloud Foundry

Micro Cloud Foundry provides the VMware open platform as a service in a
standalone environment running in a virtual machine. It is a self-contained
local development environment as similar as possible to the Cloud Foundry cloud,
making application development for the cloud and the transition from
development to production much more seamless.

When you use Micro Cloud Foundry, you run a local virtual machine that provides
the same services Cloud Foundry provides your application. The virtual machine
connects with VMware servers to set up DNS for your application. You develop on
your local computer and then use the `vmc` Ruby command line utility, or the
Eclipse/Spring Tool Suite (STS) Cloud Foundry plug-in, to publish your
application to your Micro Cloud Foundry. You and others on your network, can
then test your application at
http://api.*appname*.cloudfoundry.me.

When you are ready to move the application to production, you use `vmc` or STS
to publish the application to a local or hosted Cloud Foundry instance.

## Installation Overview

Installing Micro Cloud Foundry includes downloading the virtual machine and then
running it in [VMware Workstation][1], [VMware Fusion][2] (Mac), or
[VMware Player][3] and configuring it. While you are at the Micro Cloud Foundry
Web site, you register a unique application name (*appname*) for your
application.

The Micro Cloud Foundry virtual machine connects to VMware servers
to set up DNS for your application. This is accomplished by using a
configuration token, which is generated for you when you visit the Micro Cloud
Foundry Web site at https://www.cloudfoundry.com/micro/dns. The generated DNS
token is good for one use; if your network changes, you must return to the Micro
Cloud Foundry Web site, generate a new token, and, in the Micro Cloud Foundry
virtual machine, select option 4 to reconfigure your domain.

Before you begin, be sure you have these items:

+   A [Cloud Foundry](http://cloudfoundry.com/) account.

+   [VMware Workstation][1], [VMware Fusion][2] (Mac), or [VMware Player][3] installed.

+   Ruby and the [vmc](/tools/vmc/installing-vmc.html) gem installed.

+   If you develop in Java, [Spring Tool Suite (STS)] or Eclipse with
the VMware Cloud Foundry plug-in installed. See [Configuring Spring Tool Suite or Eclipse for Cloud Foundry](/tools/STS/configuring-STS.html).

[1]: http://www.vmware.com/products/workstation/overview.html
[2]: http://www.vmware.com/products/fusion/overview.html
[3]: http://www.vmware.com/products/player/overview.html

## Downloading the Micro Cloud Foundry Virtual Machine

1.  In your Web browser, go to [Micro Cloud Foundry](https://cloudfoundry.com/micro).

2.  Click on 'Get Micro Cloud Foundry' and then log in with your Cloud Foundry email and password. (Click **Get an Account** if you need an account.)

2.  Check the box to accept the End User License Agreement, and click **Accept**.

3.  Enter a unique domain name for your Micro Cloud Foundry. The name you enter is checked in real-time so you can see if it is available.

	![Create Domain](/images/screenshots/installing-mcf/micro_dns.jpg "Micro DNS")

4.  Click **Create**.

    Your new domain name is reserved and a configuration token is created for you.

	![Domain Reserved](/images/screenshots/installing-mcf/micro_reserved.png "Domain Reserved")

5.  Write down the configuration token. You will need it in a later step.

6.  Click **Download Micro Cloud Foundry VM** and save the file.

## Starting and Configuring the Micro Cloud Foundry Virtual Machine

1.  Unzip/tar the compressed Micro Cloud Foundry VM. This creates the folder
    `micro` containing the virtual machine files.

2.  Start VMware Workstation, VMware Fusion, or VMware Player and open the `micro/micro.vmx` file.

3.  Power on the virtual machine.

4.  At the Welcome screen, select **1** to configure.

5.  Set a password for Micro Cloud Foundry by entering and confirming the new password.

6.  At the *Select network:* prompt, enter **1** to configure networking with DHCP.

7.  At the *HTTP proxy:* prompt, press Enter to choose **none** for HTTP proxy.

    If you are behind an HTTP proxy, enter the URL for the proxy server, for example `http://192.168.1.125:8023`.

8.  Enter the configuration token from the Micro Cloud Foundry Web site.

```bash
              Welcome to VMware Micro Cloud Foundry version 1.2.0

Network up
Micro Cloud Foundry not configured

1. configure
2. refresh console
3. help
4. shutdown VM

select option: 1

set password Micro Cloud Foundry VM user
Password: ********
Confirmation: ********
Password changed!

1. DHCP
2. Static
Select network: 1

HTTP proxy: |none|

Enter Micro Cloud Foundry configuration token or offline domain name: shock-throw-caption
```
The Micro Cloud Foundry virtual machine verifies your DNS and configures the Micro Cloud.

**Note**
: If you plan to use Micro Cloud Foundry without an Internet connection, enter a fictious domain name instead of the DNS configuration token. This is an advanced configuration option described in [Using Micro Cloud Foundry](/infrastructure/micro/using-mcf.html#working-offline-with-micro-cloud-foundry).


## Registering a Micro Cloud Foundry User with vmc

Registering a user creates a user account on the Micro Cloud Foundry virtual
machine. You log in with this account to publish and manage applications.

*Notes:*
: See [Installing the Command-Line Interface (vmc)](/tools/vmc/installing-vmc.html) for
    help installing `vmc`.

: See [VMC Quick Reference](/tools/vmc/vmc-quick-ref.html) for additional information
    about using the `vmc` command.

: See [Configuring Spring Tool Suite or Eclipse for Cloud
    Foundry](/tools/STS/configuring-STS.html) for help setting up the Cloud Foundry
    Integration plug-in in STS or Eclipse and for registering a Micro Cloud
    Foundry user from within the plug-in.

In the steps that follow, *appname* is the domain you registered for
your application at the Micro Cloud Foundry Web site.

Target your Micro Cloud Foundry. In a shell, enter the following command:

```bash
$ vmc target api.appname.cloudfoundry.me
```
Create a new account using the `vmc register` command:

```bash
$ vmc register
```

Enter your email address.

Enter a password and confirm it when requested.

```bash
$ vmc target api.pubs.cloudfoundry.me
Successfully targeted to [http://api.pubs.cloudfoundry.me]

$ vmc register
Email: myemail@mydomain.com
Password: ********
Verify Password: ********
Creating New User: OK
Successfully logged into [http://api.pubs.cloudfoundry.me]
```

You are now ready to log in with `vmc` or set up Spring Tool Suite to deploy your
applications to Micro Cloud Foundry.

## Next Steps

+ [Log in to your Micro Cloud Foundry with vmc](using-mcf.html#using-microcloud-foundry-vmc)
+ [Log in to your Micro Cloud Foundry with Spring Tool Suite (STS)](using-mcf.html#using-micro-cloud-foundry-sts)
+ [Day-to-day Micro Cloud Foundry Management](using-mcf.html);T;
I"%<p>This document helps you to download and get the Micro Cloud Foundry VM installed and
running. When you complete these tasks, you can begin publishing your
application to Micro Cloud Foundry.</p>

<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#about-micro-cloud-foundry">About Micro Cloud Foundry</a></li>
  <li><a href="#installation-overview">Installation Overview</a></li>
  <li><a href="#downloading-the-micro-cloud-foundry-virtual-machine">Downloading the Micro Cloud Foundry Virtual Machine</a></li>
  <li><a href="#starting-and-configuring-the-micro-cloud-foundry-virtual-machine">Starting and Configuring the Micro Cloud Foundry Virtual Machine</a></li>
  <li><a href="#registering-a-micro-cloud-foundry-user-with-vmc">Registering a Micro Cloud Foundry User with vmc</a></li>
  <li><a href="#next-steps">Next Steps</a></li>
</ul><h2 id="about-micro-cloud-foundry">About Micro Cloud Foundry</h2>

<p>Micro Cloud Foundry provides the VMware open platform as a service in a
standalone environment running in a virtual machine. It is a self-contained
local development environment as similar as possible to the Cloud Foundry cloud,
making application development for the cloud and the transition from
development to production much more seamless.</p>

<p>When you use Micro Cloud Foundry, you run a local virtual machine that provides
the same services Cloud Foundry provides your application. The virtual machine
connects with VMware servers to set up DNS for your application. You develop on
your local computer and then use the <code>vmc</code> Ruby command line utility, or the
Eclipse/Spring Tool Suite (STS) Cloud Foundry plug-in, to publish your
application to your Micro Cloud Foundry. You and others on your network, can
then test your application at
http://api.<em>appname</em>.cloudfoundry.me.</p>

<p>When you are ready to move the application to production, you use <code>vmc</code> or STS
to publish the application to a local or hosted Cloud Foundry instance.</p>

<h2 id="installation-overview">Installation Overview</h2>

<p>Installing Micro Cloud Foundry includes downloading the virtual machine and then
running it in <a href="http://www.vmware.com/products/workstation/overview.html">VMware Workstation</a>, <a href="http://www.vmware.com/products/fusion/overview.html">VMware Fusion</a> (Mac), or
<a href="http://www.vmware.com/products/player/overview.html">VMware Player</a> and configuring it. While you are at the Micro Cloud Foundry
Web site, you register a unique application name (<em>appname</em>) for your
application.</p>

<p>The Micro Cloud Foundry virtual machine connects to VMware servers
to set up DNS for your application. This is accomplished by using a
configuration token, which is generated for you when you visit the Micro Cloud
Foundry Web site at https://www.cloudfoundry.com/micro/dns. The generated DNS
token is good for one use; if your network changes, you must return to the Micro
Cloud Foundry Web site, generate a new token, and, in the Micro Cloud Foundry
virtual machine, select option 4 to reconfigure your domain.</p>

<p>Before you begin, be sure you have these items:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/">Cloud Foundry</a> account.</p>
  </li>
  <li>
    <p><a href="http://www.vmware.com/products/workstation/overview.html">VMware Workstation</a>, <a href="http://www.vmware.com/products/fusion/overview.html">VMware Fusion</a> (Mac), or <a href="http://www.vmware.com/products/player/overview.html">VMware Player</a> installed.</p>
  </li>
  <li>
    <p>Ruby and the <a href="/tools/vmc/installing-vmc.html">vmc</a> gem installed.</p>
  </li>
  <li>
    <p>If you develop in Java, [Spring Tool Suite (STS)] or Eclipse with
the VMware Cloud Foundry plug-in installed. See <a href="/tools/STS/configuring-STS.html">Configuring Spring Tool Suite or Eclipse for Cloud Foundry</a>.</p>
  </li>
</ul><h2 id="downloading-the-micro-cloud-foundry-virtual-machine">Downloading the Micro Cloud Foundry Virtual Machine</h2>

<ol>
<li>
    <p>In your Web browser, go to <a href="https://cloudfoundry.com/micro">Micro Cloud Foundry</a>.</p>
  </li>
  <li>
    <p>Click on â€˜Get Micro Cloud Foundryâ€™ and then log in with your Cloud Foundry email and password. (Click <strong>Get an Account</strong> if you need an account.)</p>
  </li>
  <li>
    <p>Check the box to accept the End User License Agreement, and click <strong>Accept</strong>.</p>
  </li>
  <li>
    <p>Enter a unique domain name for your Micro Cloud Foundry. The name you enter is checked in real-time so you can see if it is available.</p>

    <p><img src="/images/screenshots/installing-mcf/micro_dns.jpg" alt="Create Domain" title="Micro DNS"></p>
  </li>
  <li>
    <p>Click <strong>Create</strong>.</p>

    <p>Your new domain name is reserved and a configuration token is created for you.</p>

    <p><img src="/images/screenshots/installing-mcf/micro_reserved.png" alt="Domain Reserved" title="Domain Reserved"></p>
  </li>
  <li>
    <p>Write down the configuration token. You will need it in a later step.</p>
  </li>
  <li>
    <p>Click <strong>Download Micro Cloud Foundry VM</strong> and save the file.</p>
  </li>
</ol><h2 id="starting-and-configuring-the-micro-cloud-foundry-virtual-machine">Starting and Configuring the Micro Cloud Foundry Virtual Machine</h2>

<ol>
<li>
    <p>Unzip/tar the compressed Micro Cloud Foundry VM. This creates the folder
<code>micro</code> containing the virtual machine files.</p>
  </li>
  <li>
    <p>Start VMware Workstation, VMware Fusion, or VMware Player and open the <code>micro/micro.vmx</code> file.</p>
  </li>
  <li>
    <p>Power on the virtual machine.</p>
  </li>
  <li>
    <p>At the Welcome screen, select <strong>1</strong> to configure.</p>
  </li>
  <li>
    <p>Set a password for Micro Cloud Foundry by entering and confirming the new password.</p>
  </li>
  <li>
    <p>At the <em>Select network:</em> prompt, enter <strong>1</strong> to configure networking with DHCP.</p>
  </li>
  <li>
    <p>At the <em>HTTP proxy:</em> prompt, press Enter to choose <strong>none</strong> for HTTP proxy.</p>

    <p>If you are behind an HTTP proxy, enter the URL for the proxy server, for example <code>http://192.168.1.125:8023</code>.</p>
  </li>
  <li>
    <p>Enter the configuration token from the Micro Cloud Foundry Web site.</p>
  </li>
</ol><pre class="terminal">
              Welcome to VMware Micro Cloud Foundry version 1.2.0

Network up
Micro Cloud Foundry not configured

1. configure
2. refresh console
3. help
4. shutdown VM

select option: 1

set password Micro Cloud Foundry VM user
Password: ********
Confirmation: ********
Password changed!

1. DHCP
2. Static
Select network: 1

HTTP proxy: |none|

Enter Micro Cloud Foundry configuration token or offline domain name: shock-throw-caption
</pre>

<p>The Micro Cloud Foundry virtual machine verifies your DNS and configures the Micro Cloud.</p>

<dl>
<dt><strong>Note</strong></dt>
  <dd>If you plan to use Micro Cloud Foundry without an Internet connection, enter a fictious domain name instead of the DNS configuration token. This is an advanced configuration option described in <a href="/infrastructure/micro/using-mcf.html#working-offline-with-micro-cloud-foundry">Using Micro Cloud Foundry</a>.</dd>
</dl><h2 id="registering-a-micro-cloud-foundry-user-with-vmc">Registering a Micro Cloud Foundry User with vmc</h2>

<p>Registering a user creates a user account on the Micro Cloud Foundry virtual
machine. You log in with this account to publish and manage applications.</p>

<dl>
<dt><em>Notes:</em></dt>
  <dd>See <a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Interface (vmc)</a> for
  help installing <code>vmc</code>.</dd>
  <dd>
    <p>See <a href="/tools/vmc/vmc-quick-ref.html">VMC Quick Reference</a> for additional information
  about using the <code>vmc</code> command.</p>
  </dd>
  <dd>
    <p>See <a href="/tools/STS/configuring-STS.html">Configuring Spring Tool Suite or Eclipse for Cloud
  Foundry</a> for help setting up the Cloud Foundry
  Integration plug-in in STS or Eclipse and for registering a Micro Cloud
  Foundry user from within the plug-in.</p>
  </dd>
</dl><p>In the steps that follow, <em>appname</em> is the domain you registered for
your application at the Micro Cloud Foundry Web site.</p>

<p>Target your Micro Cloud Foundry. In a shell, enter the following command:</p>

<pre class="terminal">
$ vmc target api.appname.cloudfoundry.me
</pre>

<p>Create a new account using the <code>vmc register</code> command:</p>

<pre class="terminal">
$ vmc register
</pre>

<p>Enter your email address.</p>

<p>Enter a password and confirm it when requested.</p>

<pre class="terminal">
$ vmc target api.pubs.cloudfoundry.me
Successfully targeted to [http://api.pubs.cloudfoundry.me]

$ vmc register
Email: myemail@mydomain.com
Password: ********
Verify Password: ********
Creating New User: OK
Successfully logged into [http://api.pubs.cloudfoundry.me]
</pre>

<p>You are now ready to log in with <code>vmc</code> or set up Spring Tool Suite to deploy your
applications to Micro Cloud Foundry.</p>

<h2 id="next-steps">Next Steps</h2>

<ul>
<li><a href="using-mcf.html#using-microcloud-foundry-vmc">Log in to your Micro Cloud Foundry with vmc</a></li>
  <li><a href="using-mcf.html#using-micro-cloud-foundry-sts">Log in to your Micro Cloud Foundry with Spring Tool Suite (STS)</a></li>
  <li><a href="using-mcf.html">Day-to-day Micro Cloud Foundry Management</a></li>
</ul>;T;@I"%/infrastructure/micro/using-mcf/;T{;{	;I"…<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/infrastructure/micro/using-mcf.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Using Micro Cloud Foundry' property='og:title'>
<meta content='Using the Micro Cloud Foundry Console' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Using Micro Cloud Foundry</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Infrastructure</h1>
<p class='sub-head'>Using Micro Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Using the Micro Cloud Foundry Console</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/overview" rel="tag">overview</a><a href="/tags/mcf" rel="tag">mcf</a><a href="/tags/mongodb" rel="tag">mongodb</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#micro-cloud-foundry-default-configuration">Micro Cloud Foundry Default Configuration</a></li>
  <li><a href="#using-the-micro-cloud-foundry-console">Using the Micro Cloud Foundry Console</a></li>
  <li><a href="#micro-cloud-foundry-resource-limits">Micro Cloud Foundry Resource Limits</a></li>
  <li><a href="#increasing-micro-cloud-foundry-virtual-machine-memory">Increasing Micro Cloud Foundry Virtual Machine Memory</a></li>
  <li><a href="#logging-in-to-micro-cloud-foundry">Logging in to Micro Cloud Foundry</a></li>
  <li><a href="#configuring-micro-cloud-foundry-networking">Configuring Micro Cloud Foundry Networking</a></li>
  <li><a href="#working-offline-with-micro-cloud-foundry">Working Offline With Micro Cloud Foundry</a></li>
  <li><a href="#troubleshooting-micro-cloud-foundry">Troubleshooting Micro Cloud Foundry</a></li>
</ul><h2 id="micro-cloud-foundry-default-configuration">Micro Cloud Foundry Default Configuration</h2>

<p>This section describes the Micro Cloud Foundry version 1.2 default configuration.</p>

<h3 id="virtual-machine-configuration">Virtual Machine Configuration</h3>

<ul>
<li>RAM: 1GB</li>
  <li>Disk: 16GB</li>
  <li>vCPUs: 2</li>
</ul><h3 id="service-limits">Service Limits</h3>

<ul>
<li>MySQL: 2GB storage, maximum 256MB storage per instance</li>
  <li>Postgres: 2GB storage, maximum 256MB storage per instance</li>
  <li>Mongo DB: 256MB per instance</li>
  <li>Redis: 256MB per instance</li>
</ul><h3 id="runtime-versions">Runtime Versions</h3>

<ul>
<li>ruby18: Ruby 1.8, version 1.8.7</li>
  <li>ruby19: Ruby 1.9, version 1.9.2p180</li>
  <li>java: Java 6, version 1.6</li>
  <li>node: Node.js, version 0.4.12</li>
  <li>node06: Node.js, version 6.0.8</li>
</ul><h3 id="frameworks">Frameworks</h3>

<ul>
<li>rails3</li>
  <li>sinatra</li>
  <li>grails</li>
  <li>node</li>
  <li>java_web</li>
  <li>lift</li>
  <li>spring</li>
</ul><h3 id="service-versions">Service Versions</h3>

<ul>
<li>mongodb:  MongoDB NoSQL store, version 2.0</li>
  <li>mysql: MySQL database service, version 5.1</li>
  <li>postgresql: vFabric PostgreSQL database service, version 9.0</li>
  <li>rabbitmq: RabbitMQ messaging service, version 2.4</li>
  <li>redis: Redis key-value store service, version 2.2</li>
</ul><h2 id="using-the-micro-cloud-foundry-console">Using the Micro Cloud Foundry Console</h2>

<p>When you power on the Micro Cloud Foundry virtual machine, Linux boots and the
console text menu displays. The console menu is the primary administrative
interface for the micro cloud.</p>

<p>The console displays status information at the top, including the Micro Cloud
Foundry version, the host name (Identity), Cloud Foundry account email address (Admin),
and the IP address assigned to the virtual machine.</p>

<p>Choose options from the menu by entering the number and pressing <enter>. The
console prompts for any information required to perform the task.</enter></p>

<ol>
<li>
    <p><strong>refresh console</strong>. Choose this option to redraw the console display, for
example when messages cause the menu to scroll off the display.</p>
  </li>
  <li>
    <p><strong>refresh DNS</strong>. Update the Micro Cloud Foundry IP address in the DNS
records.</p>
  </li>
  <li>
    <p><strong>reconfigure vcap password</strong>. Choose this option to change the password for the <code>root</code> and <code>vcap</code> users.</p>
  </li>
  <li>
    <p><strong>reconfigure domain</strong>. Choose this option when you create a new domain or
generate a new token for your Micro Cloud Foundry domain. Log in to the <a href="https://my.cloudfoundry.com/micro">Micro
Cloud Foundry website</a> to manage domains and
retrieve a token to enter at the prompt.</p>
  </li>
  <li>
    <p><strong>reconfigure network</strong>. Use this option to choose between DHCP and static
network configurations. If you choose <strong>static</strong>, the console prompts for an IP
address, gateway, network mask, and DNS servers.</p>
  </li>
  <li>
    <p><strong>enable offline mode</strong>. Choose this option to toggle the virtual machine between online and offline modes.</p>
  </li>
  <li>
    <p><strong>reconfigure proxy</strong>. If you are on a network that requires a proxy, choose
this option and enter the address and port of the proxy, for example: <code>192.168.1.128:4000</code>.</p>
  </li>
  <li>
    <p><strong>services</strong>. Displays the status of the services on the micro cloud.</p>
  </li>
  <li>
    <p><strong>restart network</strong>. Restart network services on the virtual machine.</p>
  </li>
  <li>
    <p><strong>restore defaults</strong>.</p>
  </li>
  <li>
    <p><strong>expert menu</strong>. Displays the Expert menu, where you can set the debug level, display logs, and perform other advanced configurations on your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p><strong>Help</strong>. Displays a URL for online installation and setup documentation and
the default configuration limits for the virtual machine and services.</p>
  </li>
  <li>
    <p><strong>shutdown VM</strong>. Shut down the Micro Cloud Foundry virtual machine.</p>
  </li>
</ol><h2 id="micro-cloud-foundry-resource-limits">Micro Cloud Foundry Resource Limits</h2>

<p>Micro Cloud Foundry has the following default resource limits:</p>

<ul>
<li>VM: 1 GB RAM, 16 GB disk</li>
  <li>MySQL: 2 GB disk, max 256 MB per instance</li>
  <li>MongoDB: 256 MB per instance</li>
  <li>Redis: 256 MB per instance</li>
</ul><p>The admin user has the following limits:</p>

<ul>
<li>1.0 G memory</li>
  <li>Up to 16 provisioned services</li>
  <li>Up to 16 applications</li>
</ul><h2 id="increasing-micro-cloud-foundry-virtual-machine-memory">Increasing Micro Cloud Foundry Virtual Machine Memory</h2>

<p>The Micro Cloud Foundry virtual machine is initially configured with 1GB memory.
If you need more memory for your applications, follow these steps:</p>

<ol>
<li>
    <p>Shut down the Micro Cloud Foundry virtual machine.</p>
  </li>
  <li>
    <p>In VMware Workstation for VMware Player, right-click the Micro Cloud Foundry virtual machine, and choose Settings.</p>
  </li>
  <li>
    <p>Click Memory and specify the new memory size in the right panel.</p>
  </li>
  <li>
    <p>Click OK.</p>
  </li>
  <li>
    <p>Start the virtual machine.</p>
  </li>
  <li>
    <p>Select the new highlighted item, <strong>reconfigure memory</strong> from the console menu.</p>
  </li>
</ol><p>The Micro Cloud Foundry reconfigures the virtual machine and services for the new memory size.</p>

<h2 id="switching-between-networks">Switching between Networks</h2>

<p>If you switch between networks often and do not need to make your Micro Cloud Foundry VM available to other users, it is easier to configure the VM networking to use NAT instead of the bridged mode. Beginning with version 1.2, NAT is the default mode for the Micro Cloud Foundry VM. If you want to share your cloud with others, you will have to enable bridged mode.</p>

<h2 id="logging-in-to-micro-cloud-foundry">Logging in to Micro Cloud Foundry</h2>

<p>Micro Cloud Foundry is a virtual machine with an Ubuntu Linux operating system
and the Cloud Foundry software layer and application services. There is no
graphical desktop environment installed, but you can log in to the virtual
machine and get a bash shell using <code>ssh</code>.</p>

<p>It is not a good idea to customize the Cloud Foundry services in any way, since
this introduces a dependency that may not be satisfied when you move
applications to another Cloud Foundry instance.</p>

<p>Some reasons you might log in to Micro Cloud Foundry are:</p>

<ul>
<li>View server log files</li>
  <li>Check process status or loads, for example, using <code>top</code>
</li>
  <li>Troubleshoot DNS problems on your local network</li>
</ul><p>You can log in as <code>root</code> or <code>vcap</code> using the password you set when you initially
start and configure the Micro Cloud Foundry virtual machine.</p>

<p>From a computer with <code>ssh</code> installed, log in to Micro Cloud foundry using a
command like the following:</p>

<pre><code>    $ssh root@domain.cloudfoundry.me
</code></pre>

<p>where <em>domain</em> is the domain name you registered for the Micro Cloud Foundry.
You can also use the IP address assigned to the virtual machine, which is
displayed on the console.</p>

<h2 id="configuring-micro-cloud-foundry-networking">Configuring Micro Cloud Foundry Networking</h2>

<p>Micro Cloud Foundry provides a network environment similar to Cloud Foundry.
URLs are resolved using DNS to locate the host computer running
your application, the Micro Cloud Foundry virtual machine. The application
processes the request, including parsing the remainder of the URL and the HTTP
request and returning a response to the client. The client browser and
application interact with the network in exactly the same way they do in
production, except the cloud is running on the same host.</p>

<p>Development and deployment tools - <code>vmc</code> and STS - also work with Micro Cloud
Foundry just as they work with CloudFoundry.com or any local or hosted Cloud
Foundry instance.</p>

<p>To provide a production-like network environment, Micro Cloud Foundry associates
the virtual machineâ€™s IP address with <em>domain</em>.cloudfoundry.me in DNS. This
requires an Internet connection so that Micro Cloud Foundry can update its
address at <code>cloudfoundry.me</code> and so that the URL can be resolved when you access
the application with your browser. When the virtual machine is assigned a new IP
address, for example if you move to a different location, it updates the DNS
records.</p>

<p>If your browser uses a proxy and the DNS lookup is not working, you may have to
exclude <code>.cloudfoundry.me</code> from the proxy.</p>

<p>The way you configure the network adaptor in the Micro Cloud Foundry virtual
machine determines who can reach your micro cloud:</p>

<ul>
<li>
    <p>If you choose the Bridged network connection option, your micro cloud gets an
address on the LAN from a DHCP server on the LAN. It can be accessed from other
hosts on the LAN.</p>
  </li>
  <li>
    <p>If you choose the NAT network connection option, your micro cloud gets an
address on a network that exists only on the host running the virtual machine.
Your cloud can only be accessed from a browser on the host running the virtual
machine.</p>
  </li>
</ul><p>Unlike the Bridged network option, with the NAT connection option, you do not
get a new address when you change locations. If you are not sharing your micro
cloud with others and you move around frequently, use the NAT option to avoid
the possibility of lagging DNS updates.</p>

<h2 id="working-offline-with-micro-cloud-foundry">Working Offline With Micro Cloud Foundry</h2>

<p>When you install Micro Cloud Foundry using a token from the Cloud Foundry website, it uses dynamic DNS functionality to allow any Internet-connected computer that is on the same network with the VM to connect to it. That is, to get the local network address for the VM requires Internet access, even if you are accessing the VM from the same computer on which it is running. This is called online mode and it requires Internet access.</p>

<p>If you have to work without an Internet connection, you must put Micro Cloud Foundry into offline mode and configure your host to route DNS requests to your Micro Cloud Foundry VM. Also, if you initially configure Micro Cloud Foundry with a domain name instead of a configuration token, you must <em>always</em> use offline mode.</p>

<p>Offline mode is only supported with the VM network adapter set to NAT. This means it can only be accessed from the host it is running on. To share your Micro Cloud Foundry with others, you must set the network adapter to Bridged mode and run Micro Cloud Foundry in online mode.</p>

<p>If you use Micro Cloud Foundry in offline mode and still have an active Internet connection, you may experience problems accessing sites on the Internet.</p>

<h3 id="configuring-micro-cloud-foundry-for-offline-mode">Configuring Micro Cloud Foundry for Offline Mode</h3>

<p>You can configure offline mode manually or use the <code>vmc micro</code> command. VMC version 0.3.16.beta4 or higher is required to use the <code>vmc micro</code> command. See <a href="#using-the-vmc-micro-command">Using the VMC micro Command</a> for instructions.</p>

<p>The remainder of this section describes how to configure offline mode manually.</p>

<p>There are three tasks to complete to put Cloud Foundry in offline mode.</p>

<p><strong>Step 1</strong>. In the VMâ€™s Virtual Machine Settings, select Network Adapter and make sure that NAT is selected. If you have to change the setting, restart the virtual machine.</p>

<p><strong>Step 2</strong>. In the Micro Cloud Foundry console menu, select option 6 to toggle to offline mode.</p>

<p><strong>Step 3</strong>. Configure your host computer to route DNS requests to the Micro Cloud Foundry VM. This is accomplished in differing ways depending on the OS and whether you use DHCP or a static IP address.  In the instructions that follow, replace the IP number 172.16.52.136 with the IP number shown on the Micro Cloud Foundry console. Replace mydomain.micro with your offline domain name.</p>

<h3 id="linux">Linux</h3>

<p>If you are using DHCP, edit the file <code>/etc/dhcp3/dhclient.conf</code> and add this line:</p>

<pre class="terminal">
prepend domain-name-servers 172.16.52.136
</pre>

<p>If the VM is configured with a static IP, edit the file <code>/etc/resolv.conf</code> and add the following line before the rest of the name servers:</p>

<pre class="terminal">
nameserver 172.16.52.136
</pre>

<h3 id="mac-os-x">Mac OS X</h3>

<p>If you are using DHCP, create the directory <code>/etc/resolver</code>, and then create a file with your offline domain name, for example <code>mydomain.micro</code>. Add the following line to this file:</p>

<pre class="terminal">
nameserver 172.16.52.136
</pre>

<p>If you configured the Micro Cloud Foundry with a static IP, open the Network Preferences and add 172.16.52.136 first in the list of DNS servers.</p>

<h3 id="windows">Windows</h3>

<p>Follow these steps  whether you configured Micro Cloud Foundry with DHCP or a static IP address:</p>

<ul>
<li>Open the Network and Sharing control panel.</li>
  <li>Choose Change adapter settings.</li>
  <li>Right-click VMware Virtual Ethernet Adapter for VMnet8, and choose Properties.</li>
  <li>Set the preferred DNS server to 172.16.52.136.</li>
</ul><h2 id="using-the-vmc-micro-command">Using the VMC Micro Command</h2>

<p>The <code>vmc micro</code> command automates the steps described in the previous section. Review that section to understand how the command changes your configuration.</p>

<p>Install the vmc gem, or upgrade it if needed. You need version 0.3.16.beta4 or greater. See <a href="/tools/vmc/installing-vmc.html">VMC Installation</a> for instructions.</p>

<p>Here is the syntax for the <code>vmc micro</code> command:</p>

<pre class="terminal">
Usage: vmc micro [options] command

Options
  --password          VCAP user password
  --vmrun             /path/to/vmrun
  --vmx               /path/to/micro.vmx
  --save              Save VCAP password

Commands
  offline             Run Micro Cloud in offline mode
  online              Run Micro Cloud in online mode
  status              Display current status
</pre>

<p>To reconfigure and control the virtual machine, vmc needs paths to the .vmx file and the vmrun command. It may find the vmrun command on your path, but the first time you run it you must provide the path to the micro.vmx file using the â€“vmx option. The paths are saved in the .vmc_micro file in your home directory so you do not have to specify the options agai on future runs.</p>

<p>In the following example, the path to the micro.vmx file is specified. vmc discovers that the VM is not running and offers to start it. It reports the status and asks whether to save the password for future runs.</p>

<pre class="terminal">
$ vmc micro --vmx /home/mcf/micro.vmx status
Please enter your Micro Cloud Foundry VM password (vcap user)
Password: ********
Confirmation: ********
Micro Cloud Foundry is not running. Do you want to start it? y
Micro Cloud Foundry currently in online mode
VMX Path: /home/mcf/micro.vmx
Domain: mydomain.cloudfoundry.me
IP Address: 192.168.255.134
Do you want to save your password? n
</pre>

<p>Execute <code>vmc micro offline</code> to work offline.</p>

<pre class="terminal">
$ vmc micro offline
</pre>

<p>This puts the VM in offline mode (the same as selecting option 6 from the menu) and sets the DNS on your host to query the VM. For actions that require administrative or root privilege, you may be prompted to authenticate.</p>

<p>Execute <code>vmc micro online</code> to work online.</p>

<pre class="terminal">
$ vmc micro online
</pre>

<p>This puts the VM in online mode and reverses the DNS configuration change on your host computer. For actions that require administrative or root privilege, you may be prompted to authenticate.</p>

<h2 id="troubleshooting-micro-cloud-foundry">Troubleshooting Micro Cloud Foundry</h2>

<h3 id="gathering-debugging-info">Gathering Debugging Info</h3>

<p>If you encounter problems and need help debugging, please do the following:</p>

<ol>
<li>
    <p>In the Micro Cloud Foundry console menu, enter 11 to display the Expert menu.</p>
  </li>
  <li>
    <p>Enter 1 to set the debug level to DEBUG.</p>
  </li>
  <li>
    <p>Retrieve the <code>/var/vcap/sys/log/micro/micro.log</code> file from the VM and attach it to the support ticket. To retrieve the file, log into the VM as vcap, using the password set when the VM was configured. For example, using scp and the IP address shown on the console:</p>
  </li>
</ol><pre class="terminal">
$ scp vcap@92.168.1.215:/var/vcap/sys/log/micro/micro.log .
</pre>

<h3 id="proxy-problems">Proxy Problems</h3>

<p>If you use a proxy, keep in mind that the proxy may not be able to access your Micro Cloud Foundry VM. For example, if you set the VMâ€™s network adaptor to use NAT, there is no way for the proxy to find the VM, so you must exclude your domain systemâ€™s proxy settings.</p>

<p>Another proxy related problem occurs when the VMâ€™s network adaptor uses bridged mode and you have a VPN on your host. The Micro Cloud Foundry VM traffic wonâ€™t enter the tunnel, and thus cannot reach the proxy.</p>

<h3 id="problems-accessing-your-instance">Problems Accessing Your Instance</h3>

<p>If the DNS entry for you Micro Cloud Foundry VM is not up-to-date, accessing your instance can fail. For example:</p>

<pre class="terminal">
$ vmc target api.martin.cloudfoundry.me
Host is not valid: 'http://api.martin.cloudfoundry.me'
Would you like see the response [yN]? y
HTTP exception: Errno::ETIMEDOUT:Operation timed out - connect(2)
</pre>

<p>Check the Micro Cloud Foundry console. Choose â€œ1â€ to refresh the screen. If you see a â€œDNS out of syncâ€ message like the following:</p>

<pre class="terminal">
Current Configuration:
 Identity:   martin.cloudfoundry.me (DNS out of sync)
 Admin:      martin@englund.nu
 IP Address: 10.21.164.29 (network up)
</pre>

<p>choose â€œ2â€ to force a DNS update.</p>

<p>If the console DNS status is â€œokâ€, then the IP address of the VM matches the IP in DNS. Validate that you do not have a cached entry on your local system with the host command:</p>

<pre class="terminal">
$ host api.martin.cloudfoundry.me
api.martin.cloudfoundry.me is an alias for martin.cloudfoundry.me.
martin.cloudfoundry.me has address 10.21.165.53

</pre>

<p>If the two differ, then you need to flush the DNS cache:</p>

<p><strong>Mac OS X</strong></p>

<pre class="terminal">
dscacheutil -flushcache
</pre>

<p><strong>Linux (Ubuntu)</strong></p>

<pre class="terminal">
sudo /etc/init.d/nscd restart
</pre>

<p><strong>Windows</strong></p>

<pre class="terminal">
ipconfig /flushdns
</pre>

<h3 id="cannot-connect-to-cloudfoundrycom-message-when-configuring-micro-cloud-vm">â€œCannot connect to cloudfoundry.comâ€ Message When Configuring Micro Cloud VM</h3>

<p>When you configure the Micro Cloud VM to use DHCP it is assigned an address from the networkâ€™s DHCP pool. If you continuously create/destroy VMs, for example in a testing environment, and your DHCP addresses have a lease life of 12 to 24 hours, it is possible to exhaust the DHCP pool. You will see a message during the configuration process that you cannot connect to cloudfoundry.com, although you are able to reach cloudfoundry.com with a browser. Restarting your DHCP server should return unused leases to the pool so they can be reused before the lease life expires.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"
D**Subtopics**

- [Micro Cloud Foundry Default Configuration](#micro-cloud-foundry-default-configuration)
- [Using the Micro Cloud Foundry Console](#using-the-micro-cloud-foundry-console)
- [Micro Cloud Foundry Resource Limits](#micro-cloud-foundry-resource-limits)
- [Increasing Micro Cloud Foundry Virtual Machine Memory](#increasing-micro-cloud-foundry-virtual-machine-memory)
- [Logging in to Micro Cloud Foundry](#logging-in-to-micro-cloud-foundry)
- [Configuring Micro Cloud Foundry Networking](#configuring-micro-cloud-foundry-networking)
- [Working Offline With Micro Cloud Foundry](#working-offline-with-micro-cloud-foundry)
- [Troubleshooting Micro Cloud Foundry](#troubleshooting-micro-cloud-foundry)


## Micro Cloud Foundry Default Configuration

This section describes the Micro Cloud Foundry version 1.2 default configuration.

### Virtual Machine Configuration

+ RAM: 1GB
+ Disk: 16GB
+ vCPUs: 2

### Service Limits

+ MySQL: 2GB storage, maximum 256MB storage per instance
+ Postgres: 2GB storage, maximum 256MB storage per instance
+ Mongo DB: 256MB per instance
+ Redis: 256MB per instance

### Runtime Versions

+ ruby18: Ruby 1.8, version 1.8.7
+ ruby19: Ruby 1.9, version 1.9.2p180
+ java: Java 6, version 1.6
+ node: Node.js, version 0.4.12
+ node06: Node.js, version 6.0.8

### Frameworks

+ rails3
+ sinatra
+ grails
+ node
+ java_web
+ lift
+ spring

### Service Versions

+ mongodb:  MongoDB NoSQL store, version 2.0
+ mysql: MySQL database service, version 5.1
+ postgresql: vFabric PostgreSQL database service, version 9.0
+ rabbitmq: RabbitMQ messaging service, version 2.4
+ redis: Redis key-value store service, version 2.2

## Using the Micro Cloud Foundry Console

When you power on the Micro Cloud Foundry virtual machine, Linux boots and the
console text menu displays. The console menu is the primary administrative
interface for the micro cloud.

The console displays status information at the top, including the Micro Cloud
Foundry version, the host name (Identity), Cloud Foundry account email address (Admin),
and the IP address assigned to the virtual machine.

Choose options from the menu by entering the number and pressing <Enter>. The
console prompts for any information required to perform the task.

1. **refresh console**. Choose this option to redraw the console display, for
example when messages cause the menu to scroll off the display.

2. **refresh DNS**. Update the Micro Cloud Foundry IP address in the DNS
records.

3. **reconfigure vcap password**. Choose this option to change the password for the `root` and `vcap` users.

4. **reconfigure domain**. Choose this option when you create a new domain or
generate a new token for your Micro Cloud Foundry domain. Log in to the [Micro
Cloud Foundry website](https://my.cloudfoundry.com/micro) to manage domains and
retrieve a token to enter at the prompt.

5. **reconfigure network**. Use this option to choose between DHCP and static
network configurations. If you choose **static**, the console prompts for an IP
address, gateway, network mask, and DNS servers.

6. **enable offline mode**. Choose this option to toggle the virtual machine between online and offline modes.

7. **reconfigure proxy**. If you are on a network that requires a proxy, choose
this option and enter the address and port of the proxy, for example: `192.168.1.128:4000`.

8. **services**. Displays the status of the services on the micro cloud.

9. **restart network**. Restart network services on the virtual machine.

10. **restore defaults**.

11. **expert menu**. Displays the Expert menu, where you can set the debug level, display logs, and perform other advanced configurations on your Micro Cloud Foundry.

12. **Help**. Displays a URL for online installation and setup documentation and
the default configuration limits for the virtual machine and services.

13. **shutdown VM**. Shut down the Micro Cloud Foundry virtual machine.

## Micro Cloud Foundry Resource Limits

Micro Cloud Foundry has the following default resource limits:

+ VM: 1 GB RAM, 16 GB disk
+ MySQL: 2 GB disk, max 256 MB per instance
+ MongoDB: 256 MB per instance
+ Redis: 256 MB per instance

The admin user has the following limits:

+ 1.0 G memory
+ Up to 16 provisioned services
+ Up to 16 applications

## Increasing Micro Cloud Foundry Virtual Machine Memory

The Micro Cloud Foundry virtual machine is initially configured with 1GB memory.
If you need more memory for your applications, follow these steps:

1. Shut down the Micro Cloud Foundry virtual machine.

2. In VMware Workstation for VMware Player, right-click the Micro Cloud Foundry virtual machine, and choose Settings.

3. Click Memory and specify the new memory size in the right panel.

4. Click OK.

5. Start the virtual machine.

6. Select the new highlighted item, **reconfigure memory** from the console menu.

The Micro Cloud Foundry reconfigures the virtual machine and services for the new memory size.



## Switching between Networks

If you switch between networks often and do not need to make your Micro Cloud Foundry VM available to other users, it is easier to configure the VM networking to use NAT instead of the bridged mode. Beginning with version 1.2, NAT is the default mode for the Micro Cloud Foundry VM. If you want to share your cloud with others, you will have to enable bridged mode.

## Logging in to Micro Cloud Foundry

Micro Cloud Foundry is a virtual machine with an Ubuntu Linux operating system
and the Cloud Foundry software layer and application services. There is no
graphical desktop environment installed, but you can log in to the virtual
machine and get a bash shell using `ssh`.

It is not a good idea to customize the Cloud Foundry services in any way, since
this introduces a dependency that may not be satisfied when you move
applications to another Cloud Foundry instance.

Some reasons you might log in to Micro Cloud Foundry are:

+   View server log files
+   Check process status or loads, for example, using `top`
+   Troubleshoot DNS problems on your local network

You can log in as `root` or `vcap` using the password you set when you initially
start and configure the Micro Cloud Foundry virtual machine.

From a computer with `ssh` installed, log in to Micro Cloud foundry using a
command like the following:

        $ssh root@domain.cloudfoundry.me

where *domain* is the domain name you registered for the Micro Cloud Foundry.
You can also use the IP address assigned to the virtual machine, which is
displayed on the console.

## Configuring Micro Cloud Foundry Networking

Micro Cloud Foundry provides a network environment similar to Cloud Foundry.
URLs are resolved using DNS to locate the host computer running
your application, the Micro Cloud Foundry virtual machine. The application
processes the request, including parsing the remainder of the URL and the HTTP
request and returning a response to the client. The client browser and
application interact with the network in exactly the same way they do in
production, except the cloud is running on the same host.

Development and deployment tools - `vmc` and STS - also work with Micro Cloud
Foundry just as they work with CloudFoundry.com or any local or hosted Cloud
Foundry instance.

To provide a production-like network environment, Micro Cloud Foundry associates
the virtual machine's IP address with *domain*.cloudfoundry.me in DNS. This
requires an Internet connection so that Micro Cloud Foundry can update its
address at `cloudfoundry.me` and so that the URL can be resolved when you access
the application with your browser. When the virtual machine is assigned a new IP
address, for example if you move to a different location, it updates the DNS
records.

If your browser uses a proxy and the DNS lookup is not working, you may have to
exclude `.cloudfoundry.me` from the proxy.

The way you configure the network adaptor in the Micro Cloud Foundry virtual
machine determines who can reach your micro cloud:

- If you choose the Bridged network connection option, your micro cloud gets an
address on the LAN from a DHCP server on the LAN. It can be accessed from other
hosts on the LAN.

- If you choose the NAT network connection option, your micro cloud gets an
address on a network that exists only on the host running the virtual machine.
Your cloud can only be accessed from a browser on the host running the virtual
machine.

Unlike the Bridged network option, with the NAT connection option, you do not
get a new address when you change locations. If you are not sharing your micro
cloud with others and you move around frequently, use the NAT option to avoid
the possibility of lagging DNS updates.

## Working Offline With Micro Cloud Foundry

When you install Micro Cloud Foundry using a token from the Cloud Foundry website, it uses dynamic DNS functionality to allow any Internet-connected computer that is on the same network with the VM to connect to it. That is, to get the local network address for the VM requires Internet access, even if you are accessing the VM from the same computer on which it is running. This is called online mode and it requires Internet access.

If you have to work without an Internet connection, you must put Micro Cloud Foundry into offline mode and configure your host to route DNS requests to your Micro Cloud Foundry VM. Also, if you initially configure Micro Cloud Foundry with a domain name instead of a configuration token, you must *always* use offline mode.

Offline mode is only supported with the VM network adapter set to NAT. This means it can only be accessed from the host it is running on. To share your Micro Cloud Foundry with others, you must set the network adapter to Bridged mode and run Micro Cloud Foundry in online mode.

If you use Micro Cloud Foundry in offline mode and still have an active Internet connection, you may experience problems accessing sites on the Internet.

### Configuring Micro Cloud Foundry for Offline Mode

You can configure offline mode manually or use the `vmc micro` command. VMC version 0.3.16.beta4 or higher is required to use the `vmc micro` command. See [Using the VMC micro Command](#using-the-vmc-micro-command) for instructions.

The remainder of this section describes how to configure offline mode manually.

There are three tasks to complete to put Cloud Foundry in offline mode.

**Step 1**. In the VM's Virtual Machine Settings, select Network Adapter and make sure that NAT is selected. If you have to change the setting, restart the virtual machine.

**Step 2**. In the Micro Cloud Foundry console menu, select option 6 to toggle to offline mode.

**Step 3**. Configure your host computer to route DNS requests to the Micro Cloud Foundry VM. This is accomplished in differing ways depending on the OS and whether you use DHCP or a static IP address.  In the instructions that follow, replace the IP number 172.16.52.136 with the IP number shown on the Micro Cloud Foundry console. Replace mydomain.micro with your offline domain name.

### Linux

If you are using DHCP, edit the file `/etc/dhcp3/dhclient.conf` and add this line:

```bash
prepend domain-name-servers 172.16.52.136
```

If the VM is configured with a static IP, edit the file `/etc/resolv.conf` and add the following line before the rest of the name servers:

```bash
nameserver 172.16.52.136
```

### Mac OS X

If you are using DHCP, create the directory `/etc/resolver`, and then create a file with your offline domain name, for example `mydomain.micro`. Add the following line to this file:

```bash
nameserver 172.16.52.136
```

If you configured the Micro Cloud Foundry with a static IP, open the Network Preferences and add 172.16.52.136 first in the list of DNS servers.

### Windows

Follow these steps  whether you configured Micro Cloud Foundry with DHCP or a static IP address:

+ Open the Network and Sharing control panel.
+ Choose Change adapter settings.
+ Right-click VMware Virtual Ethernet Adapter for VMnet8, and choose Properties.
+ Set the preferred DNS server to 172.16.52.136.

## Using the VMC Micro Command

The `vmc micro` command automates the steps described in the previous section. Review that section to understand how the command changes your configuration.

Install the vmc gem, or upgrade it if needed. You need version 0.3.16.beta4 or greater. See [VMC Installation](/tools/vmc/installing-vmc.html) for instructions.

Here is the syntax for the `vmc micro` command:

```bash
Usage: vmc micro [options] command

Options
  --password          VCAP user password
  --vmrun             /path/to/vmrun
  --vmx               /path/to/micro.vmx
  --save              Save VCAP password

Commands
  offline             Run Micro Cloud in offline mode
  online              Run Micro Cloud in online mode
  status              Display current status
```

To reconfigure and control the virtual machine, vmc needs paths to the .vmx file and the vmrun command. It may find the vmrun command on your path, but the first time you run it you must provide the path to the micro.vmx file using the --vmx option. The paths are saved in the .vmc_micro file in your home directory so you do not have to specify the options agai on future runs.

In the following example, the path to the micro.vmx file is specified. vmc discovers that the VM is not running and offers to start it. It reports the status and asks whether to save the password for future runs.

```bash
$ vmc micro --vmx /home/mcf/micro.vmx status
Please enter your Micro Cloud Foundry VM password (vcap user)
Password: ********
Confirmation: ********
Micro Cloud Foundry is not running. Do you want to start it? y
Micro Cloud Foundry currently in online mode
VMX Path: /home/mcf/micro.vmx
Domain: mydomain.cloudfoundry.me
IP Address: 192.168.255.134
Do you want to save your password? n
```

Execute `vmc micro offline` to work offline.

```bash
$ vmc micro offline
```

This puts the VM in offline mode (the same as selecting option 6 from the menu) and sets the DNS on your host to query the VM. For actions that require administrative or root privilege, you may be prompted to authenticate.

Execute `vmc micro online` to work online.

```bash
$ vmc micro online
```

This puts the VM in online mode and reverses the DNS configuration change on your host computer. For actions that require administrative or root privilege, you may be prompted to authenticate.


## Troubleshooting Micro Cloud Foundry

### Gathering Debugging Info

If you encounter problems and need help debugging, please do the following:

1.  In the Micro Cloud Foundry console menu, enter 11 to display the Expert menu.

2.  Enter 1 to set the debug level to DEBUG.

3.  Retrieve the `/var/vcap/sys/log/micro/micro.log` file from the VM and attach it to the support ticket. To retrieve the file, log into the VM as vcap, using the password set when the VM was configured. For example, using scp and the IP address shown on the console:

```bash
$ scp vcap@92.168.1.215:/var/vcap/sys/log/micro/micro.log .
```

### Proxy Problems

If you use a proxy, keep in mind that the proxy may not be able to access your Micro Cloud Foundry VM. For example, if you set the VM's network adaptor to use NAT, there is no way for the proxy to find the VM, so you must exclude your domain system's proxy settings.

Another proxy related problem occurs when the VM's network adaptor uses bridged mode and you have a VPN on your host. The Micro Cloud Foundry VM traffic won't enter the tunnel, and thus cannot reach the proxy.

### Problems Accessing Your Instance

If the DNS entry for you Micro Cloud Foundry VM is not up-to-date, accessing your instance can fail. For example:

```bash
$ vmc target api.martin.cloudfoundry.me
Host is not valid: 'http://api.martin.cloudfoundry.me'
Would you like see the response [yN]? y
HTTP exception: Errno::ETIMEDOUT:Operation timed out - connect(2)
```

Check the Micro Cloud Foundry console. Choose "1" to refresh the screen. If you see a "DNS out of sync" message like the following:

```bash
Current Configuration:
 Identity:   martin.cloudfoundry.me (DNS out of sync)
 Admin:      martin@englund.nu
 IP Address: 10.21.164.29 (network up)
```

choose "2" to force a DNS update.

If the console DNS status is "ok", then the IP address of the VM matches the IP in DNS. Validate that you do not have a cached entry on your local system with the host command:

```bash
$ host api.martin.cloudfoundry.me
api.martin.cloudfoundry.me is an alias for martin.cloudfoundry.me.
martin.cloudfoundry.me has address 10.21.165.53

```

If the two differ, then you need to flush the DNS cache:

**Mac OS X**

```bash
dscacheutil -flushcache
```

**Linux (Ubuntu)**

```bash
sudo /etc/init.d/nscd restart
```

**Windows**

```bash
ipconfig /flushdns
```

### "Cannot connect to cloudfoundry.com" Message When Configuring Micro Cloud VM

When you configure the Micro Cloud VM to use DHCP it is assigned an address from the network's DHCP pool. If you continuously create/destroy VMs, for example in a testing environment, and your DHCP addresses have a lease life of 12 to 24 hours, it is possible to exhaust the DHCP pool. You will see a message during the configuration process that you cannot connect to cloudfoundry.com, although you are able to reach cloudfoundry.com with a browser. Restarting your DHCP server should return unused leases to the pool so they can be reused before the lease life expires.;T;
I" Q<p><strong>Subtopics</strong></p>

<ul>
<li><a href="#micro-cloud-foundry-default-configuration">Micro Cloud Foundry Default Configuration</a></li>
  <li><a href="#using-the-micro-cloud-foundry-console">Using the Micro Cloud Foundry Console</a></li>
  <li><a href="#micro-cloud-foundry-resource-limits">Micro Cloud Foundry Resource Limits</a></li>
  <li><a href="#increasing-micro-cloud-foundry-virtual-machine-memory">Increasing Micro Cloud Foundry Virtual Machine Memory</a></li>
  <li><a href="#logging-in-to-micro-cloud-foundry">Logging in to Micro Cloud Foundry</a></li>
  <li><a href="#configuring-micro-cloud-foundry-networking">Configuring Micro Cloud Foundry Networking</a></li>
  <li><a href="#working-offline-with-micro-cloud-foundry">Working Offline With Micro Cloud Foundry</a></li>
  <li><a href="#troubleshooting-micro-cloud-foundry">Troubleshooting Micro Cloud Foundry</a></li>
</ul><h2 id="micro-cloud-foundry-default-configuration">Micro Cloud Foundry Default Configuration</h2>

<p>This section describes the Micro Cloud Foundry version 1.2 default configuration.</p>

<h3 id="virtual-machine-configuration">Virtual Machine Configuration</h3>

<ul>
<li>RAM: 1GB</li>
  <li>Disk: 16GB</li>
  <li>vCPUs: 2</li>
</ul><h3 id="service-limits">Service Limits</h3>

<ul>
<li>MySQL: 2GB storage, maximum 256MB storage per instance</li>
  <li>Postgres: 2GB storage, maximum 256MB storage per instance</li>
  <li>Mongo DB: 256MB per instance</li>
  <li>Redis: 256MB per instance</li>
</ul><h3 id="runtime-versions">Runtime Versions</h3>

<ul>
<li>ruby18: Ruby 1.8, version 1.8.7</li>
  <li>ruby19: Ruby 1.9, version 1.9.2p180</li>
  <li>java: Java 6, version 1.6</li>
  <li>node: Node.js, version 0.4.12</li>
  <li>node06: Node.js, version 6.0.8</li>
</ul><h3 id="frameworks">Frameworks</h3>

<ul>
<li>rails3</li>
  <li>sinatra</li>
  <li>grails</li>
  <li>node</li>
  <li>java_web</li>
  <li>lift</li>
  <li>spring</li>
</ul><h3 id="service-versions">Service Versions</h3>

<ul>
<li>mongodb:  MongoDB NoSQL store, version 2.0</li>
  <li>mysql: MySQL database service, version 5.1</li>
  <li>postgresql: vFabric PostgreSQL database service, version 9.0</li>
  <li>rabbitmq: RabbitMQ messaging service, version 2.4</li>
  <li>redis: Redis key-value store service, version 2.2</li>
</ul><h2 id="using-the-micro-cloud-foundry-console">Using the Micro Cloud Foundry Console</h2>

<p>When you power on the Micro Cloud Foundry virtual machine, Linux boots and the
console text menu displays. The console menu is the primary administrative
interface for the micro cloud.</p>

<p>The console displays status information at the top, including the Micro Cloud
Foundry version, the host name (Identity), Cloud Foundry account email address (Admin),
and the IP address assigned to the virtual machine.</p>

<p>Choose options from the menu by entering the number and pressing <enter>. The
console prompts for any information required to perform the task.</enter></p>

<ol>
<li>
    <p><strong>refresh console</strong>. Choose this option to redraw the console display, for
example when messages cause the menu to scroll off the display.</p>
  </li>
  <li>
    <p><strong>refresh DNS</strong>. Update the Micro Cloud Foundry IP address in the DNS
records.</p>
  </li>
  <li>
    <p><strong>reconfigure vcap password</strong>. Choose this option to change the password for the <code>root</code> and <code>vcap</code> users.</p>
  </li>
  <li>
    <p><strong>reconfigure domain</strong>. Choose this option when you create a new domain or
generate a new token for your Micro Cloud Foundry domain. Log in to the <a href="https://my.cloudfoundry.com/micro">Micro
Cloud Foundry website</a> to manage domains and
retrieve a token to enter at the prompt.</p>
  </li>
  <li>
    <p><strong>reconfigure network</strong>. Use this option to choose between DHCP and static
network configurations. If you choose <strong>static</strong>, the console prompts for an IP
address, gateway, network mask, and DNS servers.</p>
  </li>
  <li>
    <p><strong>enable offline mode</strong>. Choose this option to toggle the virtual machine between online and offline modes.</p>
  </li>
  <li>
    <p><strong>reconfigure proxy</strong>. If you are on a network that requires a proxy, choose
this option and enter the address and port of the proxy, for example: <code>192.168.1.128:4000</code>.</p>
  </li>
  <li>
    <p><strong>services</strong>. Displays the status of the services on the micro cloud.</p>
  </li>
  <li>
    <p><strong>restart network</strong>. Restart network services on the virtual machine.</p>
  </li>
  <li>
    <p><strong>restore defaults</strong>.</p>
  </li>
  <li>
    <p><strong>expert menu</strong>. Displays the Expert menu, where you can set the debug level, display logs, and perform other advanced configurations on your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p><strong>Help</strong>. Displays a URL for online installation and setup documentation and
the default configuration limits for the virtual machine and services.</p>
  </li>
  <li>
    <p><strong>shutdown VM</strong>. Shut down the Micro Cloud Foundry virtual machine.</p>
  </li>
</ol><h2 id="micro-cloud-foundry-resource-limits">Micro Cloud Foundry Resource Limits</h2>

<p>Micro Cloud Foundry has the following default resource limits:</p>

<ul>
<li>VM: 1 GB RAM, 16 GB disk</li>
  <li>MySQL: 2 GB disk, max 256 MB per instance</li>
  <li>MongoDB: 256 MB per instance</li>
  <li>Redis: 256 MB per instance</li>
</ul><p>The admin user has the following limits:</p>

<ul>
<li>1.0 G memory</li>
  <li>Up to 16 provisioned services</li>
  <li>Up to 16 applications</li>
</ul><h2 id="increasing-micro-cloud-foundry-virtual-machine-memory">Increasing Micro Cloud Foundry Virtual Machine Memory</h2>

<p>The Micro Cloud Foundry virtual machine is initially configured with 1GB memory.
If you need more memory for your applications, follow these steps:</p>

<ol>
<li>
    <p>Shut down the Micro Cloud Foundry virtual machine.</p>
  </li>
  <li>
    <p>In VMware Workstation for VMware Player, right-click the Micro Cloud Foundry virtual machine, and choose Settings.</p>
  </li>
  <li>
    <p>Click Memory and specify the new memory size in the right panel.</p>
  </li>
  <li>
    <p>Click OK.</p>
  </li>
  <li>
    <p>Start the virtual machine.</p>
  </li>
  <li>
    <p>Select the new highlighted item, <strong>reconfigure memory</strong> from the console menu.</p>
  </li>
</ol><p>The Micro Cloud Foundry reconfigures the virtual machine and services for the new memory size.</p>

<h2 id="switching-between-networks">Switching between Networks</h2>

<p>If you switch between networks often and do not need to make your Micro Cloud Foundry VM available to other users, it is easier to configure the VM networking to use NAT instead of the bridged mode. Beginning with version 1.2, NAT is the default mode for the Micro Cloud Foundry VM. If you want to share your cloud with others, you will have to enable bridged mode.</p>

<h2 id="logging-in-to-micro-cloud-foundry">Logging in to Micro Cloud Foundry</h2>

<p>Micro Cloud Foundry is a virtual machine with an Ubuntu Linux operating system
and the Cloud Foundry software layer and application services. There is no
graphical desktop environment installed, but you can log in to the virtual
machine and get a bash shell using <code>ssh</code>.</p>

<p>It is not a good idea to customize the Cloud Foundry services in any way, since
this introduces a dependency that may not be satisfied when you move
applications to another Cloud Foundry instance.</p>

<p>Some reasons you might log in to Micro Cloud Foundry are:</p>

<ul>
<li>View server log files</li>
  <li>Check process status or loads, for example, using <code>top</code>
</li>
  <li>Troubleshoot DNS problems on your local network</li>
</ul><p>You can log in as <code>root</code> or <code>vcap</code> using the password you set when you initially
start and configure the Micro Cloud Foundry virtual machine.</p>

<p>From a computer with <code>ssh</code> installed, log in to Micro Cloud foundry using a
command like the following:</p>

<pre><code>    $ssh root@domain.cloudfoundry.me
</code></pre>

<p>where <em>domain</em> is the domain name you registered for the Micro Cloud Foundry.
You can also use the IP address assigned to the virtual machine, which is
displayed on the console.</p>

<h2 id="configuring-micro-cloud-foundry-networking">Configuring Micro Cloud Foundry Networking</h2>

<p>Micro Cloud Foundry provides a network environment similar to Cloud Foundry.
URLs are resolved using DNS to locate the host computer running
your application, the Micro Cloud Foundry virtual machine. The application
processes the request, including parsing the remainder of the URL and the HTTP
request and returning a response to the client. The client browser and
application interact with the network in exactly the same way they do in
production, except the cloud is running on the same host.</p>

<p>Development and deployment tools - <code>vmc</code> and STS - also work with Micro Cloud
Foundry just as they work with CloudFoundry.com or any local or hosted Cloud
Foundry instance.</p>

<p>To provide a production-like network environment, Micro Cloud Foundry associates
the virtual machineâ€™s IP address with <em>domain</em>.cloudfoundry.me in DNS. This
requires an Internet connection so that Micro Cloud Foundry can update its
address at <code>cloudfoundry.me</code> and so that the URL can be resolved when you access
the application with your browser. When the virtual machine is assigned a new IP
address, for example if you move to a different location, it updates the DNS
records.</p>

<p>If your browser uses a proxy and the DNS lookup is not working, you may have to
exclude <code>.cloudfoundry.me</code> from the proxy.</p>

<p>The way you configure the network adaptor in the Micro Cloud Foundry virtual
machine determines who can reach your micro cloud:</p>

<ul>
<li>
    <p>If you choose the Bridged network connection option, your micro cloud gets an
address on the LAN from a DHCP server on the LAN. It can be accessed from other
hosts on the LAN.</p>
  </li>
  <li>
    <p>If you choose the NAT network connection option, your micro cloud gets an
address on a network that exists only on the host running the virtual machine.
Your cloud can only be accessed from a browser on the host running the virtual
machine.</p>
  </li>
</ul><p>Unlike the Bridged network option, with the NAT connection option, you do not
get a new address when you change locations. If you are not sharing your micro
cloud with others and you move around frequently, use the NAT option to avoid
the possibility of lagging DNS updates.</p>

<h2 id="working-offline-with-micro-cloud-foundry">Working Offline With Micro Cloud Foundry</h2>

<p>When you install Micro Cloud Foundry using a token from the Cloud Foundry website, it uses dynamic DNS functionality to allow any Internet-connected computer that is on the same network with the VM to connect to it. That is, to get the local network address for the VM requires Internet access, even if you are accessing the VM from the same computer on which it is running. This is called online mode and it requires Internet access.</p>

<p>If you have to work without an Internet connection, you must put Micro Cloud Foundry into offline mode and configure your host to route DNS requests to your Micro Cloud Foundry VM. Also, if you initially configure Micro Cloud Foundry with a domain name instead of a configuration token, you must <em>always</em> use offline mode.</p>

<p>Offline mode is only supported with the VM network adapter set to NAT. This means it can only be accessed from the host it is running on. To share your Micro Cloud Foundry with others, you must set the network adapter to Bridged mode and run Micro Cloud Foundry in online mode.</p>

<p>If you use Micro Cloud Foundry in offline mode and still have an active Internet connection, you may experience problems accessing sites on the Internet.</p>

<h3 id="configuring-micro-cloud-foundry-for-offline-mode">Configuring Micro Cloud Foundry for Offline Mode</h3>

<p>You can configure offline mode manually or use the <code>vmc micro</code> command. VMC version 0.3.16.beta4 or higher is required to use the <code>vmc micro</code> command. See <a href="#using-the-vmc-micro-command">Using the VMC micro Command</a> for instructions.</p>

<p>The remainder of this section describes how to configure offline mode manually.</p>

<p>There are three tasks to complete to put Cloud Foundry in offline mode.</p>

<p><strong>Step 1</strong>. In the VMâ€™s Virtual Machine Settings, select Network Adapter and make sure that NAT is selected. If you have to change the setting, restart the virtual machine.</p>

<p><strong>Step 2</strong>. In the Micro Cloud Foundry console menu, select option 6 to toggle to offline mode.</p>

<p><strong>Step 3</strong>. Configure your host computer to route DNS requests to the Micro Cloud Foundry VM. This is accomplished in differing ways depending on the OS and whether you use DHCP or a static IP address.  In the instructions that follow, replace the IP number 172.16.52.136 with the IP number shown on the Micro Cloud Foundry console. Replace mydomain.micro with your offline domain name.</p>

<h3 id="linux">Linux</h3>

<p>If you are using DHCP, edit the file <code>/etc/dhcp3/dhclient.conf</code> and add this line:</p>

<pre class="terminal">
prepend domain-name-servers 172.16.52.136
</pre>

<p>If the VM is configured with a static IP, edit the file <code>/etc/resolv.conf</code> and add the following line before the rest of the name servers:</p>

<pre class="terminal">
nameserver 172.16.52.136
</pre>

<h3 id="mac-os-x">Mac OS X</h3>

<p>If you are using DHCP, create the directory <code>/etc/resolver</code>, and then create a file with your offline domain name, for example <code>mydomain.micro</code>. Add the following line to this file:</p>

<pre class="terminal">
nameserver 172.16.52.136
</pre>

<p>If you configured the Micro Cloud Foundry with a static IP, open the Network Preferences and add 172.16.52.136 first in the list of DNS servers.</p>

<h3 id="windows">Windows</h3>

<p>Follow these steps  whether you configured Micro Cloud Foundry with DHCP or a static IP address:</p>

<ul>
<li>Open the Network and Sharing control panel.</li>
  <li>Choose Change adapter settings.</li>
  <li>Right-click VMware Virtual Ethernet Adapter for VMnet8, and choose Properties.</li>
  <li>Set the preferred DNS server to 172.16.52.136.</li>
</ul><h2 id="using-the-vmc-micro-command">Using the VMC Micro Command</h2>

<p>The <code>vmc micro</code> command automates the steps described in the previous section. Review that section to understand how the command changes your configuration.</p>

<p>Install the vmc gem, or upgrade it if needed. You need version 0.3.16.beta4 or greater. See <a href="/tools/vmc/installing-vmc.html">VMC Installation</a> for instructions.</p>

<p>Here is the syntax for the <code>vmc micro</code> command:</p>

<pre class="terminal">
Usage: vmc micro [options] command

Options
  --password          VCAP user password
  --vmrun             /path/to/vmrun
  --vmx               /path/to/micro.vmx
  --save              Save VCAP password

Commands
  offline             Run Micro Cloud in offline mode
  online              Run Micro Cloud in online mode
  status              Display current status
</pre>

<p>To reconfigure and control the virtual machine, vmc needs paths to the .vmx file and the vmrun command. It may find the vmrun command on your path, but the first time you run it you must provide the path to the micro.vmx file using the â€“vmx option. The paths are saved in the .vmc_micro file in your home directory so you do not have to specify the options agai on future runs.</p>

<p>In the following example, the path to the micro.vmx file is specified. vmc discovers that the VM is not running and offers to start it. It reports the status and asks whether to save the password for future runs.</p>

<pre class="terminal">
$ vmc micro --vmx /home/mcf/micro.vmx status
Please enter your Micro Cloud Foundry VM password (vcap user)
Password: ********
Confirmation: ********
Micro Cloud Foundry is not running. Do you want to start it? y
Micro Cloud Foundry currently in online mode
VMX Path: /home/mcf/micro.vmx
Domain: mydomain.cloudfoundry.me
IP Address: 192.168.255.134
Do you want to save your password? n
</pre>

<p>Execute <code>vmc micro offline</code> to work offline.</p>

<pre class="terminal">
$ vmc micro offline
</pre>

<p>This puts the VM in offline mode (the same as selecting option 6 from the menu) and sets the DNS on your host to query the VM. For actions that require administrative or root privilege, you may be prompted to authenticate.</p>

<p>Execute <code>vmc micro online</code> to work online.</p>

<pre class="terminal">
$ vmc micro online
</pre>

<p>This puts the VM in online mode and reverses the DNS configuration change on your host computer. For actions that require administrative or root privilege, you may be prompted to authenticate.</p>

<h2 id="troubleshooting-micro-cloud-foundry">Troubleshooting Micro Cloud Foundry</h2>

<h3 id="gathering-debugging-info">Gathering Debugging Info</h3>

<p>If you encounter problems and need help debugging, please do the following:</p>

<ol>
<li>
    <p>In the Micro Cloud Foundry console menu, enter 11 to display the Expert menu.</p>
  </li>
  <li>
    <p>Enter 1 to set the debug level to DEBUG.</p>
  </li>
  <li>
    <p>Retrieve the <code>/var/vcap/sys/log/micro/micro.log</code> file from the VM and attach it to the support ticket. To retrieve the file, log into the VM as vcap, using the password set when the VM was configured. For example, using scp and the IP address shown on the console:</p>
  </li>
</ol><pre class="terminal">
$ scp vcap@92.168.1.215:/var/vcap/sys/log/micro/micro.log .
</pre>

<h3 id="proxy-problems">Proxy Problems</h3>

<p>If you use a proxy, keep in mind that the proxy may not be able to access your Micro Cloud Foundry VM. For example, if you set the VMâ€™s network adaptor to use NAT, there is no way for the proxy to find the VM, so you must exclude your domain systemâ€™s proxy settings.</p>

<p>Another proxy related problem occurs when the VMâ€™s network adaptor uses bridged mode and you have a VPN on your host. The Micro Cloud Foundry VM traffic wonâ€™t enter the tunnel, and thus cannot reach the proxy.</p>

<h3 id="problems-accessing-your-instance">Problems Accessing Your Instance</h3>

<p>If the DNS entry for you Micro Cloud Foundry VM is not up-to-date, accessing your instance can fail. For example:</p>

<pre class="terminal">
$ vmc target api.martin.cloudfoundry.me
Host is not valid: 'http://api.martin.cloudfoundry.me'
Would you like see the response [yN]? y
HTTP exception: Errno::ETIMEDOUT:Operation timed out - connect(2)
</pre>

<p>Check the Micro Cloud Foundry console. Choose â€œ1â€ to refresh the screen. If you see a â€œDNS out of syncâ€ message like the following:</p>

<pre class="terminal">
Current Configuration:
 Identity:   martin.cloudfoundry.me (DNS out of sync)
 Admin:      martin@englund.nu
 IP Address: 10.21.164.29 (network up)
</pre>

<p>choose â€œ2â€ to force a DNS update.</p>

<p>If the console DNS status is â€œokâ€, then the IP address of the VM matches the IP in DNS. Validate that you do not have a cached entry on your local system with the host command:</p>

<pre class="terminal">
$ host api.martin.cloudfoundry.me
api.martin.cloudfoundry.me is an alias for martin.cloudfoundry.me.
martin.cloudfoundry.me has address 10.21.165.53

</pre>

<p>If the two differ, then you need to flush the DNS cache:</p>

<p><strong>Mac OS X</strong></p>

<pre class="terminal">
dscacheutil -flushcache
</pre>

<p><strong>Linux (Ubuntu)</strong></p>

<pre class="terminal">
sudo /etc/init.d/nscd restart
</pre>

<p><strong>Windows</strong></p>

<pre class="terminal">
ipconfig /flushdns
</pre>

<h3 id="cannot-connect-to-cloudfoundrycom-message-when-configuring-micro-cloud-vm">â€œCannot connect to cloudfoundry.comâ€ Message When Configuring Micro Cloud VM</h3>

<p>When you configure the Micro Cloud VM to use DHCP it is assigned an address from the networkâ€™s DHCP pool. If you continuously create/destroy VMs, for example in a testing environment, and your DHCP addresses have a lease life of 12 to 24 hours, it is possible to exhaust the DHCP pool. You will see a message during the configuration process that you cannot connect to cloudfoundry.com, although you are able to reach cloudfoundry.com with a browser. Restarting your DHCP server should return unused leases to the pool so they can be reused before the lease life expires.</p>;T;@…I"/infrastructure/overview/;T{;{	;I"æ:<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/infrastructure/overview.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Overview' property='og:title'>
<meta content='An Overview of Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Overview</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Infrastructure</h1>
<p class='sub-head'>Overview</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>An Overview of Cloud Foundry</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p>Cloud Foundry is a modern application platform built specifically to simplify the end-to-end development, deployment, and operation of cloud era applications.
Cloud Foundry orchestrates heterogeneous application services and applications built in multiple frameworks and automates deployment of applications and their underlying infrastructure across diverse cloud infrastructures.</p>

<p>There are three main delivery models for Cloud Foundry:</p>

<ul>
<li>
    <p><a href="http://cloudfoundry.com/">Cloudfoundry.com</a> is a full-function public Platform-as-a-Service (PaaS) operated by VMware.</p>

    <p>Developers can use this multi-tenant PaaS environment to deploy and cloud-scale their applications in seconds, as well as manage their complete lifecycle.  The PaaS supports a number of programming languages and frameworks and provides a set of application services, such as database and messaging.</p>
  </li>
  <li>
    <p><a href="http://cloudfoundry.com/micro">Micro Cloud Foundry</a> is a complete, downloadable instance of Cloud Foundry contained within a virtual machine on your desktop.</p>

    <p>As with the PaaS, it enables simplified development and testing of applications.
 This unique model allows you to build and test applications on your own computers and ensure that applications running locally will also run in production,
 without modification on any Cloud Foundry-based private or public cloud.  You can get started with Micro Cloud Foundry using <a href="micro/installing-mcf.html">these steps</a></p>
  </li>
  <li>
    <p><a href="http://cloudfoundry.org/">CloudFoundry.org </a> is an open-source project and community under Apache 2 license which enables you to inspect, evaluate and modify Cloud Foundry software based on your own needs, while also minimizing the risk of lock-in.  This model provides the highest degree of extensibility, allowing the community to extend and integrate Cloud Foundry with any framework, application service or infrastructure cloud.</p>
  </li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"YCloud Foundry is a modern application platform built specifically to simplify the end-to-end development, deployment, and operation of cloud era applications.
Cloud Foundry orchestrates heterogeneous application services and applications built in multiple frameworks and automates deployment of applications and their underlying infrastructure across diverse cloud infrastructures.

There are three main delivery models for Cloud Foundry:

+ [Cloudfoundry.com](http://cloudfoundry.com/) is a full-function public Platform-as-a-Service (PaaS) operated by VMware.

    Developers can use this multi-tenant PaaS environment to deploy and cloud-scale their applications in seconds, as well as manage their complete lifecycle.  The PaaS supports a number of programming languages and frameworks and provides a set of application services, such as database and messaging.

+  [Micro Cloud Foundry](http://cloudfoundry.com/micro) is a complete, downloadable instance of Cloud Foundry contained within a virtual machine on your desktop.

    As with the PaaS, it enables simplified development and testing of applications.
    This unique model allows you to build and test applications on your own computers and ensure that applications running locally will also run in production,
    without modification on any Cloud Foundry-based private or public cloud.  You can get started with Micro Cloud Foundry using [these steps](micro/installing-mcf.html)

+ [CloudFoundry.org ](http://cloudfoundry.org/) is an open-source project and community under Apache 2 license which enables you to inspect, evaluate and modify Cloud Foundry software based on your own needs, while also minimizing the risk of lock-in.  This model provides the highest degree of extensibility, allowing the community to extend and integrate Cloud Foundry with any framework, application service or infrastructure cloud.;T;
I"é<p>Cloud Foundry is a modern application platform built specifically to simplify the end-to-end development, deployment, and operation of cloud era applications.
Cloud Foundry orchestrates heterogeneous application services and applications built in multiple frameworks and automates deployment of applications and their underlying infrastructure across diverse cloud infrastructures.</p>

<p>There are three main delivery models for Cloud Foundry:</p>

<ul>
<li>
    <p><a href="http://cloudfoundry.com/">Cloudfoundry.com</a> is a full-function public Platform-as-a-Service (PaaS) operated by VMware.</p>

    <p>Developers can use this multi-tenant PaaS environment to deploy and cloud-scale their applications in seconds, as well as manage their complete lifecycle.  The PaaS supports a number of programming languages and frameworks and provides a set of application services, such as database and messaging.</p>
  </li>
  <li>
    <p><a href="http://cloudfoundry.com/micro">Micro Cloud Foundry</a> is a complete, downloadable instance of Cloud Foundry contained within a virtual machine on your desktop.</p>

    <p>As with the PaaS, it enables simplified development and testing of applications.
 This unique model allows you to build and test applications on your own computers and ensure that applications running locally will also run in production,
 without modification on any Cloud Foundry-based private or public cloud.  You can get started with Micro Cloud Foundry using <a href="micro/installing-mcf.html">these steps</a></p>
  </li>
  <li>
    <p><a href="http://cloudfoundry.org/">CloudFoundry.org </a> is an open-source project and community under Apache 2 license which enables you to inspect, evaluate and modify Cloud Foundry software based on your own needs, while also minimizing the risk of lock-in.  This model provides the highest degree of extensibility, allowing the community to extend and integrate Cloud Foundry with any framework, application service or infrastructure cloud.</p>
  </li>
</ul>;T;@‹I"/samples/cool-apps/;T{;{	;I"õ;<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/samples/cool-apps.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Cool Apps' property='og:title'>
<meta content='Cool Apps on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Cool Apps</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Samples</h1>
<p class='sub-head'>Cool Apps</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Cool Apps on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/samples" rel="tag">samples</a><a href="/tags/examples" rel="tag">examples</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<p><a href="http://inflickr.cloudfoundry.com/">Inflikr</a> is a Flikr Explorer that has a cool UI (In beta for Chrome and Safari browsers only)</p>

<p><a href="http://vaadin.cloudfoundry.com/">Vaadin</a> is a Framework that does Server side rendering (Primarily Java Focused)</p>

<p><a href="http://word-mindmap.cloudfoundry.com/">Word MindMap</a> provides an interesting way to look at Synonyms through a MindMap style UI</p>

<p><a href="http://taxireceipt.cloudfoundry.com/">TaxiReceipt</a> is an experimental node.js application for tracking Taxi Receipts.
(Source : <a href="https://github.com/olemartin/taxireceipt">https://github.com/olemartin/taxireceipt</a> | Node.js &amp; MongoDB based)</p>

<p><a href="http://infinigram.cloudfoundry.com/">Infinigram</a> is an Infinite scrolling Node.js Powered App.
(Source : <a href="https://github.com/nulltask/infinigram">https://github.com/nulltask/infinigram</a>)</p>

<p><a href="http://mongo.cloudfoundry.com/">Mongo</a> is a Sinatra/JQuery based console Demo for MongoDB.
(Source : <a href="https://github.com/banker/mongulator">https://github.com/banker/mongulator</a>)</p>

<p><a href="http://scaffolding.cloudfoundry.com/">Scaffolding</a> is a sample project for prototyping changes to Grails scaffolding.
(Source : <a href="https://github.com/robfletcher/grails-scaffolding">https://github.com/robfletcher/grails-scaffolding</a>)</p>

<p><a href="http://graphflow.cloudfoundry.com/">Graphflow</a> is a Spring, Neo4J, HTML5, and JQuery based Application.
(Source : <a href="https://github.com/oxlade39/graphflow">https://github.com/oxlade39/graphflow</a> )</p>

<p><a href="http://hackback.cloudfoundry.com">Hackback</a> is a well designed Node.js app for HackerNews links.
(Source : <a href="https://github.com/rjyo/hackback">https://github.com/rjyo/hackback</a>)</p>

<p><a href="http://spkihash.cloudfoundry.com/">Spkihash</a> is a public key fingerprint calculator for Chrome.
(Source : <a href="https://github.com/nahi/spkihash">https://github.com/nahi/spkihash</a> )</p>

<p><a href="http://functionsource.com/">Functionsource</a> is a Rails/Node.js Site for Developer News and a Cloud Foundry launch partner.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"v[Inflikr](http://inflickr.cloudfoundry.com/) is a Flikr Explorer that has a cool UI (In beta for Chrome and Safari browsers only)


[Vaadin](http://vaadin.cloudfoundry.com/) is a Framework that does Server side rendering (Primarily Java Focused)


[Word MindMap](http://word-mindmap.cloudfoundry.com/) provides an interesting way to look at Synonyms through a MindMap style UI


[TaxiReceipt](http://taxireceipt.cloudfoundry.com/) is an experimental node.js application for tracking Taxi Receipts.
(Source : [https://github.com/olemartin/taxireceipt](https://github.com/olemartin/taxireceipt) | Node.js & MongoDB based)


[Infinigram](http://infinigram.cloudfoundry.com/) is an Infinite scrolling Node.js Powered App.
(Source : [https://github.com/nulltask/infinigram](https://github.com/nulltask/infinigram))


[Mongo](http://mongo.cloudfoundry.com/) is a Sinatra/JQuery based console Demo for MongoDB.
(Source : [https://github.com/banker/mongulator](https://github.com/banker/mongulator))


[Scaffolding](http://scaffolding.cloudfoundry.com/) is a sample project for prototyping changes to Grails scaffolding.
(Source : [https://github.com/robfletcher/grails-scaffolding](https://github.com/robfletcher/grails-scaffolding))


[Graphflow](http://graphflow.cloudfoundry.com/) is a Spring, Neo4J, HTML5, and JQuery based Application.
(Source : [https://github.com/oxlade39/graphflow](https://github.com/oxlade39/graphflow) )


[Hackback](http://hackback.cloudfoundry.com) is a well designed Node.js app for HackerNews links.
(Source : [https://github.com/rjyo/hackback](https://github.com/rjyo/hackback))


[Spkihash](http://spkihash.cloudfoundry.com/) is a public key fingerprint calculator for Chrome.
(Source : [https://github.com/nahi/spkihash](https://github.com/nahi/spkihash) )


[Functionsource](http://functionsource.com/) is a Rails/Node.js Site for Developer News and a Cloud Foundry launch partner.;T;
I"ƒ<p><a href="http://inflickr.cloudfoundry.com/">Inflikr</a> is a Flikr Explorer that has a cool UI (In beta for Chrome and Safari browsers only)</p>

<p><a href="http://vaadin.cloudfoundry.com/">Vaadin</a> is a Framework that does Server side rendering (Primarily Java Focused)</p>

<p><a href="http://word-mindmap.cloudfoundry.com/">Word MindMap</a> provides an interesting way to look at Synonyms through a MindMap style UI</p>

<p><a href="http://taxireceipt.cloudfoundry.com/">TaxiReceipt</a> is an experimental node.js application for tracking Taxi Receipts.
(Source : <a href="https://github.com/olemartin/taxireceipt">https://github.com/olemartin/taxireceipt</a> | Node.js &amp; MongoDB based)</p>

<p><a href="http://infinigram.cloudfoundry.com/">Infinigram</a> is an Infinite scrolling Node.js Powered App.
(Source : <a href="https://github.com/nulltask/infinigram">https://github.com/nulltask/infinigram</a>)</p>

<p><a href="http://mongo.cloudfoundry.com/">Mongo</a> is a Sinatra/JQuery based console Demo for MongoDB.
(Source : <a href="https://github.com/banker/mongulator">https://github.com/banker/mongulator</a>)</p>

<p><a href="http://scaffolding.cloudfoundry.com/">Scaffolding</a> is a sample project for prototyping changes to Grails scaffolding.
(Source : <a href="https://github.com/robfletcher/grails-scaffolding">https://github.com/robfletcher/grails-scaffolding</a>)</p>

<p><a href="http://graphflow.cloudfoundry.com/">Graphflow</a> is a Spring, Neo4J, HTML5, and JQuery based Application.
(Source : <a href="https://github.com/oxlade39/graphflow">https://github.com/oxlade39/graphflow</a> )</p>

<p><a href="http://hackback.cloudfoundry.com">Hackback</a> is a well designed Node.js app for HackerNews links.
(Source : <a href="https://github.com/rjyo/hackback">https://github.com/rjyo/hackback</a>)</p>

<p><a href="http://spkihash.cloudfoundry.com/">Spkihash</a> is a public key fingerprint calculator for Chrome.
(Source : <a href="https://github.com/nahi/spkihash">https://github.com/nahi/spkihash</a> )</p>

<p><a href="http://functionsource.com/">Functionsource</a> is a Rails/Node.js Site for Developer News and a Cloud Foundry launch partner.</p>;T;@‘I"!/static/js/documentation.js/;T{;{ I"//static/js/jquery.social.share.1.2.min.js/;T{;{ I"!/static/js/jquery.easing.js/;T{;{ I"$/static/js/jquery-1.6.4.min.js/;T{;{ I"/static/images/vmware.png/;T{;{ I"1/static/images/logo_header_cloudfoundry.png/;T{;{ I"%/static/images/BG_DeployApp.png/;T{;{ I"$/static/images/page_header.png/;T{;{ I"&/static/images/nav_separator.gif/;T{;{ I"%/static/images/icon_magnify.png/;T{;{ I"+/static/images/cloud_foundry_logo.png/;T{;{ I"B/static/images/screenshots/spring-insight/insight-cf-app.png/;T{;{ I"B/static/images/screenshots/spring-insight/insight-cf-env.png/;T{;{ I"=/static/images/screenshots/installing-vmc/vmc_hello.jpg/;T{;{ I"A/static/images/screenshots/installing-vmc/hello-bob-app.png/;T{;{ I"I/static/images/screenshots/installing-vmc/hello-bob-app-updated.png/;T{;{ I"</static/images/screenshots/nodejs-rabbitmq/rmq-app.png/;T{;{ I"C/static/images/screenshots/configuring-STS/sts_helloworld.jpg/;T{;{ I"S/static/images/screenshots/configuring-STS/cf_eclipse_application_details.png/;T{;{ I"S/static/images/screenshots/configuring-STS/cf_eclipse_remote_systems_view.png/;T{;{ I"Z/static/images/screenshots/configuring-STS/cf_eclipse_editor_connect_to_debugger.png/;T{;{ I"?/static/images/screenshots/configuring-STS/sts_micsvr.jpg/;T{;{ I"@/static/images/screenshots/configuring-STS/sts_add_app.jpg/;T{;{ I"C/static/images/screenshots/configuring-STS/sts_new_micsvr.jpg/;T{;{ I"L/static/images/screenshots/configuring-STS/cf_eclipse_editor_debug.png/;T{;{ I"P/static/images/screenshots/configuring-STS/cf_eclipse_remote_view_link.png/;T{;{ I"D/static/images/screenshots/configuring-STS/sts_spring_proj.jpg/;T{;{ I"K/static/images/screenshots/configuring-STS/cf_eclipse_marketplace.png/;T{;{ I"N/static/images/screenshots/configuring-STS/cf_eclipse_install_wizard.png/;T{;{ I"C/static/images/screenshots/configuring-STS/sts_deploy_url.jpg/;T{;{ I"\/static/images/screenshots/configuring-STS/cf_eclipse_editor_regular_updaterestart.png/;T{;{ I"U/static/images/screenshots/configuring-STS/cf_eclipse_editor_services_table.png/;T{;{ I"N/static/images/screenshots/configuring-STS/sts-service-configuration.png/;T{;{ I"L/static/images/screenshots/configuring-STS/cf_eclipse_bind_service.png/;T{;{ I"H/static/images/screenshots/configuring-STS/sts-mcf-domain-name.png/;T{;{ I"_/static/images/screenshots/configuring-STS/cf_eclipse_application_deployment_services.png/;T{;{ I"D/static/images/screenshots/configuring-STS/sts_app_details.jpg/;T{;{ I"R/static/images/screenshots/configuring-STS/cf_eclipse_new_server_account.png/;T{;{ I"E/static/images/screenshots/configuring-STS/sts_servtype_mic.jpg/;T{;{ I"M/static/images/screenshots/configuring-STS/cf_eclipse_drag_drop_app.png/;T{;{ I"E/static/images/screenshots/configuring-STS/sts-cf-extension.png/;T{;{ I"B/static/images/screenshots/configuring-STS/sts_proj_name.jpg/;T{;{ I"D/static/images/screenshots/configuring-STS/sts_cred_micsvr.jpg/;T{;{ I"V/static/images/screenshots/configuring-STS/cf_eclipse_servers_view_cf_server.png/;T{;{ I"_/static/images/screenshots/configuring-STS/cf_eclipse_application_details_debug_start.png/;T{;{ I"B/static/images/screenshots/configuring-STS/sts_micro_dns.jpg/;T{;{ I"I/static/images/screenshots/configuring-STS/cf_eclipse_cf_editor.png/;T{;{ I"M/static/images/screenshots/configuring-STS/cf_eclipse_new_cf_server.png/;T{;{ I"Z/static/images/screenshots/configuring-STS/cf_eclipse_editor_updaterestart_debug.png/;T{;{ I"R/static/images/screenshots/configuring-STS/cf_eclipse_empty_servers_view.png/;T{;{ I"M/static/images/screenshots/configuring-STS/cf_eclipse_debugging_app.png/;T{;{ I"a/static/images/screenshots/configuring-STS/cf_eclipse_application_details_regular_start.png/;T{;{ I"?/static/images/screenshots/play/play-helloworld-scala.png/;T{;{ I"B/static/images/screenshots/play/play-helloworld-scala-cf.png/;T{;{ I"A/static/images/screenshots/play/play-helloworld-java-cf.png/;T{;{ I">/static/images/screenshots/play/play-helloworld-java.png/;T{;{ I"?/static/images/screenshots/play/play-local-java-mysql.png/;T{;{ I"</static/images/screenshots/play/play-cf-java-mysql.png/;T{;{ I"K/static/images/screenshots/play/play-local-java-mysql-applyscript.png/;T{;{ I"3/static/images/screenshots/play/play-help.png/;T{;{ I";/static/images/screenshots/play/default-play-home.png/;T{;{ I"F/static/images/screenshots/installing-mcf/micro-vmc-register.png/;T{;{ I"=/static/images/screenshots/installing-mcf/micro_dns.jpg/;T{;{ I"@/static/images/screenshots/installing-mcf/micro_vm_cfg.png/;T{;{ I"B/static/images/screenshots/installing-mcf/micro_reserved.png/;T{;{ I"1/static/images/screenshots/box/cf-login.png/;T{;{ I"5/static/images/screenshots/box/box-add-file.png/;T{;{ I"7/static/images/screenshots/box/box-cf-success.png/;T{;{ I"1/static/images/screenshots/box/box-cf-2.png/;T{;{ I"=/static/images/screenshots/box/box-sample-app-login.png/;T{;{ I"3/static/images/screenshots/box/box-deploy.png/;T{;{ I"7/static/images/screenshots/box/cloud_services.png/;T{;{ I"1/static/images/screenshots/box/box-cf-1.png/;T{;{ I"%/static/images/active-arrow.png/;T{;{ I"./static/images/play/todolist-usecase.png/;T{;{ I")/static/images/0000010234-BG_CF.png/;T{;{ I"#/static/images/logo-small.png/;T{;{ I"%/static/images/social_icons.png/;T{;{ I"/static/images/cf100.png/;T{;{ I",/static/images/0000010234-Badge_CF.png/;T{;{ I"/static/images/dots.png/;T{;{ I"+/static/stylesheets/documentation.css/;T{;{ I" /static/stylesheets/ie.css/;T{;{ I"#/static/stylesheets/print.css/;T{;{ I"$/static/stylesheets/master.css/;T{;{ I"!/static/stylesheets/ie7.css/;T{;{ I"&/static/stylesheets/pygments.css/;T{;{ I")/static/stylesheets/uv_active4d.css/;T{;{ I"'/static/stylesheets/master-cf.css/;T{;{ I"(/static/stylesheets/developers.css/;T{;{ I"/static/PIE.htc/;T{;{ I"/static/favicon.ico/;T{;{ I"/spring_tutoiral_intro/;T{;{	;I"Ô7<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutoiral_intro.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Development' property='og:title'>
<meta content='Tutorial to develop simple spring application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Development</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Development</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Tutorial to develop simple spring application</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-08-30
</span>
</p>
<div id='social-share'></div>
<ul>
<li>Introduction</li>
</ul><p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="www.springsource.org/spring-framework">for more details visit</a></p>

<ul>
<li>Prerequisites</li>
</ul><p>Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.</p>

<ul>
<li><a href="/frameworks/java/spring/spring.html">Spring Applications</a></li>
  <li><a href="/frameworks/java/spring/grails.html">Grails Applications</a></li>
  <li><a href="/frameworks/nodejs/nodejs.html">Node.js Applications</a></li>
  <li><a href="/frameworks/ruby/ruby-rails-sinatra.html">Ruby, Rails and Sinatra</a></li>
</ul><p>For a list of available Services see <a href="/services.html">Services</a>.</p>

<p>After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"-+ Introduction

The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the "plumbing" of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.[for more details visit](www.springsource.org/spring-framework)

+ Prerequisites

Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.

+ [Spring Applications](/frameworks/java/spring/spring.html)
+ [Grails Applications](/frameworks/java/spring/grails.html)
+ [Node.js Applications](/frameworks/nodejs/nodejs.html)
+ [Ruby, Rails and Sinatra](/frameworks/ruby/ruby-rails-sinatra.html)

For a list of available Services see [Services](/services.html).

After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See [Deploying Applications](/tools/deploying-apps.html) for details on how to use these tools.;T;
I"å<ul>
<li>Introduction</li>
</ul><p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="www.springsource.org/spring-framework">for more details visit</a></p>

<ul>
<li>Prerequisites</li>
</ul><p>Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.</p>

<ul>
<li><a href="/frameworks/java/spring/spring.html">Spring Applications</a></li>
  <li><a href="/frameworks/java/spring/grails.html">Grails Applications</a></li>
  <li><a href="/frameworks/nodejs/nodejs.html">Node.js Applications</a></li>
  <li><a href="/frameworks/ruby/ruby-rails-sinatra.html">Ruby, Rails and Sinatra</a></li>
</ul><p>For a list of available Services see <a href="/services.html">Services</a>.</p>

<p>After you configure your application to integrate with Cloud Foundry services, you use standard Cloud Foundry tools (VMC, Spring Tool Suite, or the Eclipse plugin) to create instances of these services and bind them to your applications when you deploy them to Cloud Foundry. See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</p>;T;@«I"/spring_tutorial_intro/;T{;{	;I"6<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_intro.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Development' property='og:title'>
<meta content='Tutorial to develop simple spring application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Development</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Development</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Tutorial to develop simple spring application</h2>
<p class='tags'>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<ul>
<li>Introduction</li>
</ul><p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="http://www.springsource.org/spring-framework">for more details visit</a>.</p>

<ul>
<li>Prerequisites</li>
</ul><p>Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"„+ Introduction

The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the "plumbing" of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.[for more details visit](http://www.springsource.org/spring-framework).

+ Prerequisites

Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.;T;
I"Á<ul>
<li>Introduction</li>
</ul><p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="http://www.springsource.org/spring-framework">for more details visit</a>.</p>

<ul>
<li>Prerequisites</li>
</ul><p>Please make sure you have Jdk1.5 or above ,Spring3.0 or above,Spring Tool Suite(STS) or Eclipse IDE and Maven3.0.</p>;T;@±I"#/spring_tutorial_spring_mvc_1/;T{;{	;I"8<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_spring_mvc_1.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='Create SpringMVC Template Project' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Create SpringMVC Template Project</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/STS" rel="tag">STS</a><a href="/tags/Spring MVC" rel="tag">Spring MVC</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -&gt; Dashboard.</p>

<p>From the dashboard view select Spring Template Project.This will open like this.
<img src="/images/spring_tutorial/spring_mvc_1.png" alt="Spring MVC Template Project"></p>

<p>then choose Spring MVC Project.
The first time you do it, STS might ask you to download some extra elements from the Internet. Let it download.
Youâ€™ll need to give your project a name and a top-level package:</p>

<p>Click on finish â€“ and STS will create the project. To run the project,right click the project and select Run on Server it will open new window like this,</p>

<p>STS itself has Fabric tc server,select and add your project to server now click finish.</p>

<p>Once server starts completed,STS will open the home page for the project which dispalys Hello world message with the current server time.
<img src="/images/spring_tutorial/spring_mvc_2.png" alt="Hello World Output"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÜThis section provides how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -> Dashboard.

From the dashboard view select Spring Template Project.This will open like this.
![Spring MVC Template Project](/images/spring_tutorial/spring_mvc_1.png)


then choose Spring MVC Project.
The first time you do it, STS might ask you to download some extra elements from the Internet. Let it download.
Youâ€™ll need to give your project a name and a top-level package:


Click on finish â€“ and STS will create the project. To run the project,right click the project and select Run on Server it will open new window like this,


STS itself has Fabric tc server,select and add your project to server now click finish.


Once server starts completed,STS will open the home page for the project which dispalys Hello world message with the current server time.
![Hello World Output](/images/spring_tutorial/spring_mvc_2.png);T;
I"!<p>This section provides how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -&gt; Dashboard.</p>

<p>From the dashboard view select Spring Template Project.This will open like this.
<img src="/images/spring_tutorial/spring_mvc_1.png" alt="Spring MVC Template Project"></p>

<p>then choose Spring MVC Project.
The first time you do it, STS might ask you to download some extra elements from the Internet. Let it download.
Youâ€™ll need to give your project a name and a top-level package:</p>

<p>Click on finish â€“ and STS will create the project. To run the project,right click the project and select Run on Server it will open new window like this,</p>

<p>STS itself has Fabric tc server,select and add your project to server now click finish.</p>

<p>Once server starts completed,STS will open the home page for the project which dispalys Hello world message with the current server time.
<img src="/images/spring_tutorial/spring_mvc_2.png" alt="Hello World Output"></p>;T;@·I"&/spring_tutoiral_spring_security/;T{;{	;I"Ù7<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutoiral_spring_security.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='To add Spring security to Application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>To add Spring security to Application</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/STS" rel="tag">STS</a><a href="/tags/Spring MVC" rel="tag">Spring MVC</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-03
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to get integrate Spring Security to your existing application and get the user details from database.
Before start,add the following dependencies in your pom.xml,
  - spring-security-core.jar
  - spring-security-web.jar
  - spring-security-config.jar</p>

<p>User Authentication:
    Create Spring security configuration file </p>

<p>create login.jsp with two input elements.j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>

<p>Integrate Spring Security to Existing Spring MVC Project:</p>

<p>To enable Spring security we need to add the following steps:
 1.Add a DelegatingFilterProxy in the web.xml
 2.Declare a custom XML config named spring-security.xml</p>

<p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<p>Define dataSource bean,</p>

<p>Add authentication-provider tag as like this,</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"This section provides how to get integrate Spring Security to your existing application and get the user details from database.
Before start,add the following dependencies in your pom.xml,
  - spring-security-core.jar
  - spring-security-web.jar
  - spring-security-config.jar

User Authentication:
    Create Spring security configuration file 


create login.jsp with two input elements.j_username and j_password.These are spring's placeholder for the username and password respectively.

when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.

Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.

Integrate Spring Security to Existing Spring MVC Project:

 To enable Spring security we need to add the following steps:
 1.Add a DelegatingFilterProxy in the web.xml
 2.Declare a custom XML config named spring-security.xml

 In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.


 In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.


 Define dataSource bean,


 Add authentication-provider tag as like this,;T;
I"S<p>This section provides how to get integrate Spring Security to your existing application and get the user details from database.
Before start,add the following dependencies in your pom.xml,
  - spring-security-core.jar
  - spring-security-web.jar
  - spring-security-config.jar</p>

<p>User Authentication:
    Create Spring security configuration file </p>

<p>create login.jsp with two input elements.j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>

<p>Integrate Spring Security to Existing Spring MVC Project:</p>

<p>To enable Spring security we need to add the following steps:
 1.Add a DelegatingFilterProxy in the web.xml
 2.Declare a custom XML config named spring-security.xml</p>

<p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<p>Define dataSource bean,</p>

<p>Add authentication-provider tag as like this,</p>;T;@½I"&/spring_tutorial_spring_security/;T{;{	;I"<K<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_spring_security.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='To Integrate Spring MVC with Spring Application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>To Integrate Spring MVC with Spring Application</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring MVC" rel="tag">Spring MVC</a><a href="/tags/Spring Security" rel="tag">Spring Security</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to get integrate Spring MVC Application with Spring Security.
Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="integrate-spring-security-to-existing-spring-mvc-project">Integrate Spring Security to Existing Spring MVC Project:</h2>

<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in the web.xml</p>
  </li>
  <li>
    <p>Declare a custom XML config named spring-security.xml</p>
  </li>
</ol><p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>
<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<pre><code class="language-xml"><span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/index.jsp"</span> <span class="na">access=</span><span class="s">"hasAnyRole		('ROLE_USER','ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/welcome"</span>
			<span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/http&gt;</span></code></pre>

<p>Create Logincontroller and add the mapping for login,logout,loginfailed.</p>

<p>Define dataSource bean,to get database connection</p>
<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.SimpleDriverDataSource"</span><span class="nt">&gt;</span>
 
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"org.postgresql.Driver"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:postgresql://192.168.6.30:5432/postgres"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="err">/</span></code></pre>

<p>In Spring Security configuration file,add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;authentication-manager&gt;</span>
	   <span class="nt">&lt;authentication-provider&gt;</span>
		<span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
		   <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">		      select username,password, enabled </span>
<span class="s">		      from users where username=?"</span> 
 
		   <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">		      select u.username, ur.authority from users u, user_roles ur </span>
<span class="s">		      where u.user_id = ur.user_id and u.username =?  "</span> 
 
		<span class="nt">/&gt;</span>
	   <span class="nt">&lt;/authentication-provider&gt;</span>
	<span class="nt">&lt;/authentication-manager&gt;</span></code></pre>

<p>Modify the <context-param> section of your web.xml, to add a reference to this file(spring-security), causing it to be loaded as part of Spring's application context:</context-param></p>

<pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
   <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
   <span class="nt">&lt;param-value&gt;</span>
       classpath:applicationContext-servlet.xml
       /WEB-INF/spring-security.xml
   <span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span></code></pre>

<p>create custom login.jsp with two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ŠThis section provides how to get integrate Spring MVC Application with Spring Security.
Before start,add the following dependencies in your pom.xml,

  + spring-security-core.jar
  + spring-security-web.jar
  + spring-security-config.jar

## Integrate Spring Security to Existing Spring MVC Project:

 To enable Spring security we need to add the following steps:

 1.      Add a DelegatingFilterProxy in the web.xml

 2.      Declare a custom XML config named spring-security.xml

 In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.
```xml
<filter>
    <filter-name>springSecurityFilterChain</filter-name>
    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
</filter>
<filter-mapping>
    <filter-name>springSecurityFilterChain</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

 In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.

```xml
<http auto-config="true" use-expressions="true">
		<intercept-url pattern="/index.jsp" access="hasAnyRole		('ROLE_USER','ROLE_MANAGER')" />
		<form-login login-page="/login" default-target-url="/welcome"
			authentication-failure-url="/loginfailed" />
		<logout logout-success-url="/logout" />
</http>

```

Create Logincontroller and add the mapping for login,logout,loginfailed.

 Define dataSource bean,to get database connection
```xml
<bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
 
			<property name="driverClass" value="org.postgresql.Driver" />
			<property name="url" value="jdbc:postgresql://192.168.6.30:5432/postgres" />
			<property name="username" value="postgres" />
		<property name="password" value="postgres" /
```


In Spring Security configuration file,add "jdbc-user service" tag and define the query to get the data from database.

```xml
<authentication-manager>
	   <authentication-provider>
		<jdbc-user-service data-source-ref="dataSource"
 
		   users-by-username-query="
		      select username,password, enabled 
		      from users where username=?" 
 
		   authorities-by-username-query="
		      select u.username, ur.authority from users u, user_roles ur 
		      where u.user_id = ur.user_id and u.username =?  " 
 
		/>
	   </authentication-provider>
	</authentication-manager>
```


Modify the <context-param> section of your web.xml, to add a reference to this file(spring-security), causing it to be loaded as part of Spring's application context:

```xml
<context-param>
   <param-name>contextConfigLocation</param-name>
   <param-value>
       classpath:applicationContext-servlet.xml
       /WEB-INF/spring-security.xml
   </param-value>
</context-param>
```

create custom login.jsp with two input elements for username and password as j_username and j_password.These are spring's placeholder for the username and password respectively.

when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.

Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.;T;
I"<p>This section provides how to get integrate Spring MVC Application with Spring Security.
Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="integrate-spring-security-to-existing-spring-mvc-project">Integrate Spring Security to Existing Spring MVC Project:</h2>

<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in the web.xml</p>
  </li>
  <li>
    <p>Declare a custom XML config named spring-security.xml</p>
  </li>
</ol><p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>
<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<pre><code class="language-xml"><span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/index.jsp"</span> <span class="na">access=</span><span class="s">"hasAnyRole		('ROLE_USER','ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/welcome"</span>
			<span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/http&gt;</span></code></pre>

<p>Create Logincontroller and add the mapping for login,logout,loginfailed.</p>

<p>Define dataSource bean,to get database connection</p>
<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.SimpleDriverDataSource"</span><span class="nt">&gt;</span>
 
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"org.postgresql.Driver"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:postgresql://192.168.6.30:5432/postgres"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="err">/</span></code></pre>

<p>In Spring Security configuration file,add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;authentication-manager&gt;</span>
	   <span class="nt">&lt;authentication-provider&gt;</span>
		<span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
		   <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">		      select username,password, enabled </span>
<span class="s">		      from users where username=?"</span> 
 
		   <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">		      select u.username, ur.authority from users u, user_roles ur </span>
<span class="s">		      where u.user_id = ur.user_id and u.username =?  "</span> 
 
		<span class="nt">/&gt;</span>
	   <span class="nt">&lt;/authentication-provider&gt;</span>
	<span class="nt">&lt;/authentication-manager&gt;</span></code></pre>

<p>Modify the <context-param> section of your web.xml, to add a reference to this file(spring-security), causing it to be loaded as part of Spring's application context:</context-param></p>

<pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
   <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
   <span class="nt">&lt;param-value&gt;</span>
       classpath:applicationContext-servlet.xml
       /WEB-INF/spring-security.xml
   <span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span></code></pre>

<p>create custom login.jsp with two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>;T;@ÃI"#/spring_tutorial_spring_jpa_3/;T{;{	;I"¢m<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_spring_jpa_3.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='Create Domain Objects,Services,Controller' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Create Domain Objects,Services,Controller</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring MVC" rel="tag">Spring MVC</a><a href="/tags/Spring Application Configuration" rel="tag">Spring Application Configuration</a><a href="/tags/JPA" rel="tag">JPA</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to add domain class,controllers and data accessing using JPA.
Before start,add the following dependencies in your pom.xml,
  + postgresql.jar
  + spring-jdbc.jar
  + spring-orm.jar
  + spring-tx.jar</p>

<h2 id="use-case-for-expensereport-application">Use Case for ExpenseReport Application.</h2>

<pre><code>In our expensereport application,we are using two roles. 1.   Noraml User - can create expense,view status of expense,edit expense,delete expense.
</code></pre>

<ol>
<li>
    <p>Admin User - approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submitted his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p>Find below a class diagram of our Expense Report application</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="class-diagram.png"></p>

<h2 id="add-business-class">Add business class</h2>

<pre><code>  For our application we need to create Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties and annotate your business class with @Entity.By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property.
</code></pre>

<pre><code class="language-java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Expenses"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
<span class="nd">@Id</span>
<span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

<span class="n">String</span> <span class="n">description</span><span class="o">;</span>


<span class="o">}</span></code></pre>

<h2 id="create-controller-classes">Create Controller Classes</h2>

<pre><code>Controller is reponsible for mapping the request.create methods to map the URL request.
</code></pre>

<pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>
	

	<span class="nd">@Autowired</span>
	<span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"4"</span><span class="o">;</span>
		
	<span class="o">}</span></code></pre>

<h2 id="create-service-classes">Create Service Classes</h2>

<p>Create ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.</p>

<pre><code class="language-java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseService</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@PersistenceContext</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Transactional</span>
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Expense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span><span class="n">amount</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
		<span class="n">ExpenseReport</span> <span class="n">report</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">report</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">expense</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="configuring-spring-application">Configuring Spring application:</h2>

<p>To make our application ready we have to configure our application.Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation.</p>

<pre><code class="language-java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span><span class="o">{</span>
	
<span class="o">}</span></code></pre>

<p>To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name. The following is a simple example of a @Bean method declaration for DataSource bean:</p>
<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="mi">5432</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span></code></pre>

<p>Then define bean for EntityManagerFactory and TransactionManager.</p>

<pre><code class="language-java">	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">())</span>
	    <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
	    <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
	        <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>
	    <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
	<span class="o">}</span></code></pre>

<p>To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.</p>
<pre><code class="language-java">		<span class="n">AnnotationConfigWebApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigWebApplicationContext</span><span class="o">();</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">setServletContext</span><span class="o">(</span><span class="n">sc</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"şThis section provides how to add domain class,controllers and data accessing using JPA.
Before start,add the following dependencies in your pom.xml,
  + postgresql.jar
  + spring-jdbc.jar
  + spring-orm.jar
  + spring-tx.jar

## Use Case for ExpenseReport Application.

    In our expensereport application,we are using two roles.
1.   Noraml User - can create expense,view status of expense,edit expense,delete expense.

2.   Admin User - approve expense,reject expense which are created by normal user.

     Once Normal User submitted his expense it will go to admin work items.Admin can approve or reject the expense.

Find below a class diagram of our Expense Report application

![class-diagram.png](/images/spring_tutorial/class_diagram.png)

## Add business class

      For our application we need to create Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties
and annotate your business class with @Entity.By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property.

```java
@Entity
@Table(name = "Expenses")
public class Expense implements Serializable{
@Id
Long id;

String description;


}

```


## Create Controller Classes

    Controller is reponsible for mapping the request.create methods to map the URL request.

```java
@Controller
public class ExpenseController {
	

	@Autowired
	ExpenseService expenseService;
	
	public ExpenseService getExpenseService() {
		return expenseService;
	}

	public void setExpenseService(ExpenseService expenseService) {
		this.expenseService = expenseService;
	}

	@RequestMapping(value="/loadApprovalExpenses" ,method = RequestMethod.GET)
	public String loadApprovedExpenses(ModelMap model){
		List<Expense> approvedExpenseList = getExpenseService().getPendingExpensesList();
		model.addAttribute("approvedExpenseList", approvedExpenseList);
		return "4";
		
	}
	

```

## Create Service Classes

   Create ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.

```java
@Service
public class JpaExpenseServiceImpl implements ExpenseService {
	
	private EntityManager entityManager;
	
	public EntityManager getEntityManager() {
		return entityManager;
	}

	@PersistenceContext
	public void setEntityManager(EntityManager entityManager) {
		this.entityManager = entityManager;
	}

	@Transactional
	public Long createExpense(String description,ExpenseType expenseType,Date expenseDate,
			Double amount,User user,Attachment attachment) {
		// TODO Auto-generated method stub
		Expense expense = new Expense(description,expenseType,expenseDate,amount,user,attachment);
		ExpenseReport report = new ExpenseReport(expense);
		entityManager.persist(expense);
		entityManager.persist(report);
		return expense.getId();
	}
}
```

   
##Configuring Spring application:

 To make our application ready we have to configure our application.Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation.

```java
@Configuration
public class AppConfig{
	
}
```

 To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the method's return value. By default, the bean name will be the same as the method name. The following is a simple example of a @Bean method declaration for DataSource bean:
```java
    @Bean
    public DataSource dataSource()  {
        SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
        dataSource.setUrl(String.format("jdbc:postgresql://%s:%s/%s", "localhost", 5432, "postgres"));
        dataSource.setDriverClass(org.postgresql.Driver.class);
        dataSource.setUsername("postgres");
        dataSource.setPassword("postgres");
        return dataSource;
    }
```
Then define bean for EntityManagerFactory and TransactionManager.

```java
	@Bean
	public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
	    LocalContainerEntityManagerFactoryBean emfb = new LocalContainerEntityManagerFactoryBean();
	    emfb.setJpaVendorAdapter( jpaAdapter())
	    return emfb;
	}

	@Bean
	public PlatformTransactionManager transactionManager() {
	    final JpaTransactionManager transactionManager =
	        new JpaTransactionManager();
	    transactionManager.setEntityManagerFactory(entityManagerFactory().getObject());
	    transactionManager.setJpaPropertyMap(jpaProperties);
	    return transactionManager;
	}
```

To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Spring's annotation-driven transaction management capability, similar to the support found in Spring's <tx:*> XML namespace. 


Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XML's <context:component-scan> element and pass one of basePackageClasses(), basePackages() value.


Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.
```java
		AnnotationConfigWebApplicationContext applicationContext = new AnnotationConfigWebApplicationContext();
		applicationContext.setServletContext(sc);
		applicationContext.register(AppConfig.class);
		applicationContext.refresh();
```;T;
I"I9<p>This section provides how to add domain class,controllers and data accessing using JPA.
Before start,add the following dependencies in your pom.xml,
  + postgresql.jar
  + spring-jdbc.jar
  + spring-orm.jar
  + spring-tx.jar</p>

<h2 id="use-case-for-expensereport-application">Use Case for ExpenseReport Application.</h2>

<pre><code>In our expensereport application,we are using two roles. 1.   Noraml User - can create expense,view status of expense,edit expense,delete expense.
</code></pre>

<ol>
<li>
    <p>Admin User - approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submitted his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p>Find below a class diagram of our Expense Report application</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="class-diagram.png"></p>

<h2 id="add-business-class">Add business class</h2>

<pre><code>  For our application we need to create Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties and annotate your business class with @Entity.By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property.
</code></pre>

<pre><code class="language-java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Expenses"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
<span class="nd">@Id</span>
<span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

<span class="n">String</span> <span class="n">description</span><span class="o">;</span>


<span class="o">}</span></code></pre>

<h2 id="create-controller-classes">Create Controller Classes</h2>

<pre><code>Controller is reponsible for mapping the request.create methods to map the URL request.
</code></pre>

<pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>
	

	<span class="nd">@Autowired</span>
	<span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"4"</span><span class="o">;</span>
		
	<span class="o">}</span></code></pre>

<h2 id="create-service-classes">Create Service Classes</h2>

<p>Create ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.</p>

<pre><code class="language-java"><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseService</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@PersistenceContext</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Transactional</span>
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Expense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span><span class="n">amount</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
		<span class="n">ExpenseReport</span> <span class="n">report</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">report</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">expense</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="configuring-spring-application">Configuring Spring application:</h2>

<p>To make our application ready we have to configure our application.Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation.</p>

<pre><code class="language-java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span><span class="o">{</span>
	
<span class="o">}</span></code></pre>

<p>To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name. The following is a simple example of a @Bean method declaration for DataSource bean:</p>
<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="mi">5432</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span></code></pre>

<p>Then define bean for EntityManagerFactory and TransactionManager.</p>

<pre><code class="language-java">	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">())</span>
	    <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
	    <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
	        <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>
	    <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
	<span class="o">}</span></code></pre>

<p>To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.</p>
<pre><code class="language-java">		<span class="n">AnnotationConfigWebApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigWebApplicationContext</span><span class="o">();</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">setServletContext</span><span class="o">(</span><span class="n">sc</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span></code></pre>;T;@ÉI"6/static/images/spring_tutorial/class-diagram.png/;T{;{ I""/spring_tutorial_4_using_STS/;T{;{	;I"ÑL<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_4_using_STS.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='Explains how to push your application to Cloudfoundry using STS' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Explains how to push your application to Cloudfoundry using STS</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring Application" rel="tag">Spring Application</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/Cloud Foundry" rel="tag">Cloud Foundry</a><a href="/tags/Micro Cloud" rel="tag">Micro Cloud</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to push your application to Cloudfoundry and access the services.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Create an account in Cloudfoundry.com and get register your domain.</p>
  </li>
  <li>
    <p>Get VMware player and install it.</p>
  </li>
  <li>
    <p>Get Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Before start,make sure you have installed Cloudfoundry plugin for STS.If not installed go to STS -&gt; Help -&gt;Dashboard.Scroll down to the Server and Clouds  section and choose the Cloud Foundry integration plug-in from there. Click Install.</p>
  </li>
  <li>
    <p>To access Cloud Foundry PostgreSQL service in your local machine,you have PostgreSQL server in your machine.</p>
  </li>
</ul><h2 id="configure-micro-cloud-foundry">Configure Micro Cloud Foundry</h2>

<ol>
<li>
    <p>Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.</p>
  </li>
  <li>
    <p>Now click play virtual machine.</p>
  </li>
  <li>
    <p>Once VM started,select 1 to configure.</p>
  </li>
  <li>
    <p>Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.</p>
  </li>
  <li>
    <p>Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall give proxy ip like http://172.168.76.176:8083 otherwise give none.</p>
  </li>
  <li>
    <p>Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.</p>
  </li>
  <li>
    <p>Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Now go to your browser and enter your url Identity you will get this message <strong>Welcome to VMwareâ€™s Cloud Application Platform</strong>.If you are not getting this message your configuration might be wrong please reconfigure it.</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-micro-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Micro Cloud Foundry:</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose Microcloud - http://api.{mycloud}.cloudfoundry.com from the URL.It will open a window to create Micocloud Target.Enter your cloud name to replace mycloud.</p>
  </li>
  <li>
    <p>Now give your Micro Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added our application it will open new window with application name and application type.You can enter your application name.</p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..</p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.</p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.</p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.</p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..</p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.</p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>
  </li>
</ol><h2 id="database-tunnel">Database Tunnel</h2>

<ol>
<li>
    <p>Go to servers view,then double click VMware Cloud Foundry.It will open Overview window then select applications tab.Now you can able to see our application in List of currently deployed applications.</p>
  </li>
  <li>
    <p>Go to services section,select psotgresql service which we binded into our application and right click, now select Open Caldecott Tunnel.</p>
  </li>
  <li>
    <p>It will get the tunnel information from cloudfoundry.Once tunneling process completed ,select the service and right click,now select Show Caldecott Tunnel info.Now you can see Username,Database name,Password,Port.</p>
  </li>
  <li>
    <p>Now go to your postgresql client,and enter database name,username,password,port from tunnel information and provide Host as localhost.Now you can able to access your cloudfoundry postgresql service in your local machine.</p>
  </li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"¸This section provides how to push your application to Cloudfoundry and access the services.

## Prerequisites

+ Create an account in Cloudfoundry.com and get register your domain.

+ Get VMware player and install it.

+ Get Micro Cloud Foundry.

+ Before start,make sure you have installed Cloudfoundry plugin for STS.If not installed go to STS -> Help ->Dashboard.Scroll down to the Server and Clouds  section and choose the Cloud Foundry integration plug-in from there. Click Install.

+ To access Cloud Foundry PostgreSQL service in your local machine,you have PostgreSQL server in your machine.

## Configure Micro Cloud Foundry

1.     Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.

2.     Now click play virtual machine.

3.     Once VM started,select 1 to configure.

4.     Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.

5.     Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall give proxy ip like http://172.168.76.176:8083 otherwise give none.

6.    Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.

7.    Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.

8.    Now go to your browser and enter your url Identity you will get this message **Welcome to VMware's Cloud Application Platform**.If you are not getting this message your configuration might be wrong please reconfigure it.


## Add CloudFoundry Server to deploy your Spring application to Micro Cloud Foundry:

1.     Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose Microcloud - http://api.{mycloud}.cloudfoundry.com from the URL.It will open a window to create Micocloud Target.Enter your cloud name to replace mycloud.

2.     Now give your Micro Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.

3.     Click next it will show you add and remove view.Now you can select our spring application.Once you added our application it will open new window with application name and application type.You can enter your application name.

4.     Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..

5.     Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.

6.     Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.


## Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:

1.     Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.

2.     Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.

3.     Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.

4.     Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..

5.     Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.

6.     Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.

##Database Tunnel

1.      Go to servers view,then double click VMware Cloud Foundry.It will open Overview window then select applications tab.Now you can able to see our application in List of currently deployed applications.

2.      Go to services section,select psotgresql service which we binded into our application and right click, now select Open Caldecott Tunnel.

3.      It will get the tunnel information from cloudfoundry.Once tunneling process completed ,select the service and right click,now select Show Caldecott Tunnel info.Now you can see Username,Database name,Password,Port.

4.      Now go to your postgresql client,and enter database name,username,password,port from tunnel information and provide Host as localhost.Now you can able to access your cloudfoundry postgresql service in your local machine.;T;
I".<p>This section provides how to push your application to Cloudfoundry and access the services.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Create an account in Cloudfoundry.com and get register your domain.</p>
  </li>
  <li>
    <p>Get VMware player and install it.</p>
  </li>
  <li>
    <p>Get Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Before start,make sure you have installed Cloudfoundry plugin for STS.If not installed go to STS -&gt; Help -&gt;Dashboard.Scroll down to the Server and Clouds  section and choose the Cloud Foundry integration plug-in from there. Click Install.</p>
  </li>
  <li>
    <p>To access Cloud Foundry PostgreSQL service in your local machine,you have PostgreSQL server in your machine.</p>
  </li>
</ul><h2 id="configure-micro-cloud-foundry">Configure Micro Cloud Foundry</h2>

<ol>
<li>
    <p>Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.</p>
  </li>
  <li>
    <p>Now click play virtual machine.</p>
  </li>
  <li>
    <p>Once VM started,select 1 to configure.</p>
  </li>
  <li>
    <p>Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.</p>
  </li>
  <li>
    <p>Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall give proxy ip like http://172.168.76.176:8083 otherwise give none.</p>
  </li>
  <li>
    <p>Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.</p>
  </li>
  <li>
    <p>Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Now go to your browser and enter your url Identity you will get this message <strong>Welcome to VMwareâ€™s Cloud Application Platform</strong>.If you are not getting this message your configuration might be wrong please reconfigure it.</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-micro-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Micro Cloud Foundry:</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose Microcloud - http://api.{mycloud}.cloudfoundry.com from the URL.It will open a window to create Micocloud Target.Enter your cloud name to replace mycloud.</p>
  </li>
  <li>
    <p>Now give your Micro Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added our application it will open new window with application name and application type.You can enter your application name.</p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..</p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.</p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.</p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.</p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..</p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click finish.</p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>
  </li>
</ol><h2 id="database-tunnel">Database Tunnel</h2>

<ol>
<li>
    <p>Go to servers view,then double click VMware Cloud Foundry.It will open Overview window then select applications tab.Now you can able to see our application in List of currently deployed applications.</p>
  </li>
  <li>
    <p>Go to services section,select psotgresql service which we binded into our application and right click, now select Open Caldecott Tunnel.</p>
  </li>
  <li>
    <p>It will get the tunnel information from cloudfoundry.Once tunneling process completed ,select the service and right click,now select Show Caldecott Tunnel info.Now you can see Username,Database name,Password,Port.</p>
  </li>
  <li>
    <p>Now go to your postgresql client,and enter database name,username,password,port from tunnel information and provide Host as localhost.Now you can able to access your cloudfoundry postgresql service in your local machine.</p>
  </li>
</ol>;T;@ÒI""/spring_tutorial_5_using_VMC/;T{;{	;I"ËK<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/spring_tutorial_5_using_VMC.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring Application Developement Tutorial' property='og:title'>
<meta content='Explains how to push your application to Cloudfoundry using VMC' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring Application Developement Tutorial</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Documentation</h1>
<p class='sub-head'>Spring Application Developement Tutorial</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Explains how to push your application to Cloudfoundry using VMC</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring Application" rel="tag">Spring Application</a><a href="/tags/VMC" rel="tag">VMC</a><a href="/tags/Cloud Foundry" rel="tag">Cloud Foundry</a><a href="/tags/Micro Cloud" rel="tag">Micro Cloud</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides how to push your application to Cloudfoundry and access the services using VMC.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Create an account in Cloudfoundry.com and get register your domain.</p>
  </li>
  <li>
    <p>Get VMware player and install it.</p>
  </li>
  <li>
    <p>Get Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>To use VMC,get install latest Ruby and install VMC gem.</p>
  </li>
  <li>
    <p>To access Cloud Foundry PostgreSQL service in your local machine,you should have PostgreSQL server in your machine.</p>
  </li>
</ul><h2 id="configure-micro-cloud-foundry">Configure Micro Cloud Foundry</h2>

<ol>
<li>
    <p>Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.</p>
  </li>
  <li>
    <p>Now click play virtual machine.</p>
  </li>
  <li>
    <p>Once VM started,select 1 to configure.</p>
  </li>
  <li>
    <p>Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.</p>
  </li>
  <li>
    <p>Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall like http://172.168.76.176:8083 otherwise give none.</p>
  </li>
  <li>
    <p>Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.</p>
  </li>
  <li>
    <p>Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Now go to your browser and enter your url Identity you will get this message <strong>Welcome to VMwareâ€™s Cloud Application Platform</strong>.If you are not getting this message your configuration might be wrong please reconfigure it.</p>
  </li>
</ol><h2 id="to-deploy-your-spring-application-to-micro-cloud-foundry-using-vmc">To deploy your Spring application to Micro Cloud Foundry using VMC:</h2>

<ol>
<li>Go to terminal and issue vmc target to your micro cloud.</li>
</ol><pre class="terminal">
prompt$ vmc target http://api.{mycloud}.cloudfoundry.me
</pre>

<ol>
<li>Now create new user to access Micro Cloud Foundry by typing</li>
</ol><pre class="terminal">
prompt$ vmc register
</pre>

<ol>
<li>Now login to Micro Cloud Foundry with your credentials.</li>
</ol><pre class="terminal">
prompt$ vmc login
</pre>

<ol>
<li>Then give vmc push to push your application.</li>
</ol><p><code>bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
</code>Enter NO and give your application path</p>

<ol>
<li>
    <p>Next Enter Application Name:</p>
  </li>
  <li>
    <p>Then enter your application type as spring since we are pushing Spring application.</p>
  </li>
  <li>
    <p>Then you can see application deployed url and press enter</p>
  </li>
  <li>
    <p>Next select Memory reservation,by default Micro Cloud Foundry will give 512M.</p>
  </li>
  <li>
    <p>Select instances 1.</p>
  </li>
  <li>
    <p>Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter â€˜Yâ€ and select postgresql and press Enter.</p>
  </li>
  <li>
    <p>Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into
      Micro Cloud Foundry</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:</h2>

<ol>
<li>Go to terminal and issue vmc target to your Cloud Foundry.</li>
</ol><pre class="terminal">
prompt$ vmc target http://api.cloudfoundry.com
</pre>

<ol>
<li>Now login to Cloud Foundry with your credentials.</li>
</ol><pre class="terminal">
prompt$ vmc login
</pre>

<ol>
<li>Then give vmc push to push your application.</li>
</ol><p><code>bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
</code>Enter NO  and give your application path</p>

<ol>
<li>
    <p>Next Enter Application Name:</p>
  </li>
  <li>
    <p>Then enter your application type as spring since we are pushing Spring application.</p>
  </li>
  <li>
    <p>Then you can see application deployed url and press enter</p>
  </li>
  <li>
    <p>Next select Memory reservation,by default Micro Cloud Foundry will give 512M.</p>
  </li>
  <li>
    <p>Select instances 1.</p>
  </li>
  <li>
    <p>Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter â€˜Yâ€ and select postgresql and press Enter.</p>
  </li>
  <li>
    <p>Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into Micro Cloud Foundry</p>
  </li>
</ol><h2 id="database-tunnel">Database Tunnel</h2>

<ol>
<li>Go to terminal and type vmc tunnel</li>
</ol><pre class="terminal">
prompt$ vmc tunnel
</pre>

<ol>
<li>
    <p>Then vmc will list the availble services to Cloud Foundry.Now select the service which you bind to our application.</p>
  </li>
  <li>
    <p>Then vmc will start to deploy caldecott and you will get database information like this.</p>
  </li>
</ol><pre class="terminal">
Deploying tunnel application 'caldecott'.
Uploading Application:
Checking for available resources: OK
Packing application: OK
Uploading (1K): OK   
Push Status: OK
Binding Service [postgres]: OK
Staging Application 'caldecott':OK                                             
Starting Application 'caldecott': .
Starting Application 'caldecott':OK 
Getting tunnel connection info: OK
Service connection info: 
username : uca03bb911e9d4c5f818c7554763e59e9
password : p8637c62f6bd8428391029dedd4133411
name     : dfeb4299178dd47a5b9a00fb26ce0bbe4
Starting tunnel to postgres on port 10000.
1: none
2: psql
</pre>

<ol>
<li>Now select option 2 to open your psql client.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ÁThis section provides how to push your application to Cloudfoundry and access the services using VMC.

## Prerequisites

+ Create an account in Cloudfoundry.com and get register your domain.

+ Get VMware player and install it.

+ Get Micro Cloud Foundry.

+ To use VMC,get install latest Ruby and install VMC gem.

+ To access Cloud Foundry PostgreSQL service in your local machine,you should have PostgreSQL server in your machine.

## Configure Micro Cloud Foundry

1.     Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.

2.     Now click play virtual machine.

3.     Once VM started,select 1 to configure.

4.     Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.

5.     Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall like http://172.168.76.176:8083 otherwise give none.

6.    Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.

7.    Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.

8.    Now go to your browser and enter your url Identity you will get this message **Welcome to VMware's Cloud Application Platform**.If you are not getting this message your configuration might be wrong please reconfigure it.


## To deploy your Spring application to Micro Cloud Foundry using VMC:

1.     Go to terminal and issue vmc target to your micro cloud.

```bash
prompt$ vmc target http://api.{mycloud}.cloudfoundry.me
```

2.     Now create new user to access Micro Cloud Foundry by typing

```bash
prompt$ vmc register
```

3.     Now login to Micro Cloud Foundry with your credentials.

```bash
prompt$ vmc login
```

4.     Then give vmc push to push your application.

```bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
```Enter NO and give your application path

5.     Next Enter Application Name:

6.     Then enter your application type as spring since we are pushing Spring application.

7.     Then you can see application deployed url and press enter

8.     Next select Memory reservation,by default Micro Cloud Foundry will give 512M.

9.     Select instances 1.

10.   Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter 'Y" and select postgresql and press Enter.

11.    Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into
      Micro Cloud Foundry


## Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:

1.     Go to terminal and issue vmc target to your Cloud Foundry.

```bash
prompt$ vmc target http://api.cloudfoundry.com
```

2.     Now login to Cloud Foundry with your credentials.

```bash
prompt$ vmc login
```

3.    Then give vmc push to push your application.

```bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
```Enter NO  and give your application path

4.      Next Enter Application Name:

5.      Then enter your application type as spring since we are pushing Spring application.

6.      Then you can see application deployed url and press enter

7.      Next select Memory reservation,by default Micro Cloud Foundry will give 512M.

8.      Select instances 1.

9.      Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter 'Y" and select postgresql and press Enter.

10.     Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into Micro Cloud Foundry


##Database Tunnel

1.     Go to terminal and type vmc tunnel

```bash
prompt$ vmc tunnel
```

2.     Then vmc will list the availble services to Cloud Foundry.Now select the service which you bind to our application.

3.     Then vmc will start to deploy caldecott and you will get database information like this.

```bash
Deploying tunnel application 'caldecott'.
Uploading Application:
Checking for available resources: OK
Packing application: OK
Uploading (1K): OK   
Push Status: OK
Binding Service [postgres]: OK
Staging Application 'caldecott':OK                                             
Starting Application 'caldecott': .
Starting Application 'caldecott':OK 
Getting tunnel connection info: OK
Service connection info: 
username : uca03bb911e9d4c5f818c7554763e59e9
password : p8637c62f6bd8428391029dedd4133411
name     : dfeb4299178dd47a5b9a00fb26ce0bbe4
Starting tunnel to postgres on port 10000.
1: none
2: psql
```

4.   Now select option 2 to open your psql client.;T;
I"(<p>This section provides how to push your application to Cloudfoundry and access the services using VMC.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>
    <p>Create an account in Cloudfoundry.com and get register your domain.</p>
  </li>
  <li>
    <p>Get VMware player and install it.</p>
  </li>
  <li>
    <p>Get Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>To use VMC,get install latest Ruby and install VMC gem.</p>
  </li>
  <li>
    <p>To access Cloud Foundry PostgreSQL service in your local machine,you should have PostgreSQL server in your machine.</p>
  </li>
</ul><h2 id="configure-micro-cloud-foundry">Configure Micro Cloud Foundry</h2>

<ol>
<li>
    <p>Open your VMware player,click open a new virtual machine,now select micro cloud foundry location and click finish.</p>
  </li>
  <li>
    <p>Now click play virtual machine.</p>
  </li>
  <li>
    <p>Once VM started,select 1 to configure.</p>
  </li>
  <li>
    <p>Press Enter. It will ask to create VCAP root password .choose your password and re-enter to verify it.</p>
  </li>
  <li>
    <p>Then next select your network option in that case select DHCP and give PROXY information ,if you are behind firewall like http://172.168.76.176:8083 otherwise give none.</p>
  </li>
  <li>
    <p>Enter your mail-id and  agree terms of services then Micro Cloud Foundry will start install in your machine.</p>
  </li>
  <li>
    <p>Once installation process completed,you can see your Identity is ok in green color and you will get one IP address to access your Micro Cloud Foundry.</p>
  </li>
  <li>
    <p>Now go to your browser and enter your url Identity you will get this message <strong>Welcome to VMwareâ€™s Cloud Application Platform</strong>.If you are not getting this message your configuration might be wrong please reconfigure it.</p>
  </li>
</ol><h2 id="to-deploy-your-spring-application-to-micro-cloud-foundry-using-vmc">To deploy your Spring application to Micro Cloud Foundry using VMC:</h2>

<ol>
<li>Go to terminal and issue vmc target to your micro cloud.</li>
</ol><pre class="terminal">
prompt$ vmc target http://api.{mycloud}.cloudfoundry.me
</pre>

<ol>
<li>Now create new user to access Micro Cloud Foundry by typing</li>
</ol><pre class="terminal">
prompt$ vmc register
</pre>

<ol>
<li>Now login to Micro Cloud Foundry with your credentials.</li>
</ol><pre class="terminal">
prompt$ vmc login
</pre>

<ol>
<li>Then give vmc push to push your application.</li>
</ol><p><code>bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
</code>Enter NO and give your application path</p>

<ol>
<li>
    <p>Next Enter Application Name:</p>
  </li>
  <li>
    <p>Then enter your application type as spring since we are pushing Spring application.</p>
  </li>
  <li>
    <p>Then you can see application deployed url and press enter</p>
  </li>
  <li>
    <p>Next select Memory reservation,by default Micro Cloud Foundry will give 512M.</p>
  </li>
  <li>
    <p>Select instances 1.</p>
  </li>
  <li>
    <p>Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter â€˜Yâ€ and select postgresql and press Enter.</p>
  </li>
  <li>
    <p>Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into
      Micro Cloud Foundry</p>
  </li>
</ol><h2 id="add-cloudfoundry-server-to-deploy-your-spring-application-to-cloud-foundry">Add CloudFoundry Server to deploy your Spring application to Cloud Foundry:</h2>

<ol>
<li>Go to terminal and issue vmc target to your Cloud Foundry.</li>
</ol><pre class="terminal">
prompt$ vmc target http://api.cloudfoundry.com
</pre>

<ol>
<li>Now login to Cloud Foundry with your credentials.</li>
</ol><pre class="terminal">
prompt$ vmc login
</pre>

<ol>
<li>Then give vmc push to push your application.</li>
</ol><p><code>bash
prompt$ vmc push
Would you like to deploy from the current directory? [Yn]:
</code>Enter NO  and give your application path</p>

<ol>
<li>
    <p>Next Enter Application Name:</p>
  </li>
  <li>
    <p>Then enter your application type as spring since we are pushing Spring application.</p>
  </li>
  <li>
    <p>Then you can see application deployed url and press enter</p>
  </li>
  <li>
    <p>Next select Memory reservation,by default Micro Cloud Foundry will give 512M.</p>
  </li>
  <li>
    <p>Select instances 1.</p>
  </li>
  <li>
    <p>Next VMC will ask you to create any services to bind your application since we are using postgresql services.Enter â€˜Yâ€ and select postgresql and press Enter.</p>
  </li>
  <li>
    <p>Once this completed VMC will ask you to save configuration,select default value and enter.Now VMC starts to push our application into Micro Cloud Foundry</p>
  </li>
</ol><h2 id="database-tunnel">Database Tunnel</h2>

<ol>
<li>Go to terminal and type vmc tunnel</li>
</ol><pre class="terminal">
prompt$ vmc tunnel
</pre>

<ol>
<li>
    <p>Then vmc will list the availble services to Cloud Foundry.Now select the service which you bind to our application.</p>
  </li>
  <li>
    <p>Then vmc will start to deploy caldecott and you will get database information like this.</p>
  </li>
</ol><pre class="terminal">
Deploying tunnel application 'caldecott'.
Uploading Application:
Checking for available resources: OK
Packing application: OK
Uploading (1K): OK   
Push Status: OK
Binding Service [postgres]: OK
Staging Application 'caldecott':OK                                             
Starting Application 'caldecott': .
Starting Application 'caldecott':OK 
Getting tunnel connection info: OK
Service connection info: 
username : uca03bb911e9d4c5f818c7554763e59e9
password : p8637c62f6bd8428391029dedd4133411
name     : dfeb4299178dd47a5b9a00fb26ce0bbe4
Starting tunnel to postgres on port 10000.
1: none
2: psql
</pre>

<ol>
<li>Now select option 2 to open your psql client.</li>
</ol>;T;@ØI"6/static/images/spring_tutorial/class_diagram.png/;T{;{ I"5/static/images/spring_tutorial/spring_mvc_1.png/;T{;{ I"5/static/images/spring_tutorial/spring_mvc_2.png/;T{;{ I"-/frameworks/java/spring/spring_tutorial/;T{;{	;I"m<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring_tutorial.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-17
</span>
</p>
<div id='social-share'></div>
<p>This section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.</p>

<p>(If youâ€™re interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read <a href="/frameworks/java/spring/spring-insight.html">this</a>.)</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse</a></li>
  <li><a href="http://www.springsource.org/get-started">Getting Started With Spring</a></li>
</ul><h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</a></li>
  <li><a href="#using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</a></li>
  <li><a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a></li>
  <li><a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a></li>
  <li><a href="#sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</a></li>
  <li><a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a></li>
</ul><h2 id="programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</h2>

<p>In general, you do not have to do anything â€œspecialâ€ when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.</p>

<p>It is usually best to package your Spring application in a <code>*.war</code> file so that <code>vmc push</code> will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.</p>

<p>There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:</p>

<ul>
<li>
    <p>Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is <em>able</em> to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.</p>
  </li>
  <li>
    <p>Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the <code>root</code> context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the <code>*.war</code> file in which the application is packaged.</p>
  </li>
  <li>
    <p>HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.</p>
  </li>
  <li>
    <p>External users can access your application only via the URL provided by the <code>vmc push</code> command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.</p>
  </li>
</ul><h2 id="using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</h2>

<p>If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry <em>without changing a single line of code</em>.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See <a href="#determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</a> for details.</p>

<p>If your Spring application cannot take advantage of Cloud Foundryâ€™s auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</p>

<h2 id="determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</h2>

<p>You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small <a href="#limitations-of-auto-reconfiguration">set of limitations</a>, Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.</p>

<p>With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single <code>javax.sql.DataSource</code> bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesnâ€™t use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesnâ€™t really care what the specific properties are that created the database.</p>

<p>The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.</p>

<h2 id="relational-database-mysql-and-vfabric-postgres">Relational Database (MySQL and vFabric Postgres)</h2>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>javax.sql.DataSource</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">id=</span><span class="s">"dataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:mem:"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"sa"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.</p>

<p>Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.</p>

<h2 id="mongodb">MongoDB</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.document.mongodb.MongoDbFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;mongo:db-factory</span>
    <span class="na">id=</span><span class="s">"mongoDbFactory"</span>
    <span class="na">dbname=</span><span class="s">"pwdtest"</span>
    <span class="na">host=</span><span class="s">"127.0.0.1"</span>
    <span class="na">port=</span><span class="s">"1234"</span>
    <span class="na">username=</span><span class="s">"test_user"</span>
    <span class="na">password=</span><span class="s">"test_pass"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>SimpleMOngoDbFactory</code> with its own values for the following properties:  host, port, username, password, dbname.</p>

<h2 id="redis">Redis</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/redis">Spring Data Redis</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.redis.connection.RedisConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redis"</span>
      <span class="na">class=</span><span class="s">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>
      <span class="na">p:hostName=</span><span class="s">"localhost"</span> <span class="na">p:port=</span><span class="s">"6379"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>JedisConnectionFactory</code> with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.</p>

<h2 id="rabbitmq">RabbitMQ</h2>

<p>You must be using <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.amqp.rabbit.connection.ConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;rabbit:connection-factory</span>
    <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span>
    <span class="na">host=</span><span class="s">"localhost"</span>
    <span class="na">password=</span><span class="s">"testpwd"</span>
    <span class="na">port=</span><span class="s">"1238"</span>
    <span class="na">username=</span><span class="s">"testuser"</span>
    <span class="na">virtual-host=</span><span class="s">"virthost"</span> <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>org.springframework.amqp.rabbit.connection.CachingConnectionFactory</code> with its own values for the following properties:  host, virtual-host, port, username, password.</p>

<h2 id="limitations-of-auto-reconfiguration">Limitations of Auto-Reconfiguration</h2>

<p>Cloud Foundry auto-reconfigures applications only if the following items are true for your application:</p>

<ul>
<li>You bind only <em>one</em> service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will <em>not</em> occur.</li>
  <li>You include only <em>one</em> bean of a matching type in your Spring application context file.  For example, you can have only one bean of type <code>javax.sql.DataSource</code>.</li>
</ul><p>Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.</p>

<h2 id="opting-out-of-auto-reconfiguration">Opting Out of Auto-Reconfiguration</h2>

<p>Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:</p>

<ul>
<li>When you deploy your application using VMC or STS, specify that the framework is <code>JavaWeb</code> instead of <code>Spring</code>.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.</li>
  <li>Use the <code>&lt;cloud:&gt;</code> namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</li>
</ul><h2 id="explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</h2>

<p>This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See <a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a> for the complete list of supported Cloud Foundry services.</p>

<p>The easiest way to use Cloud Foundry services in your Spring applications is to declare the <code>&lt;cloud:&gt;</code> namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the <code>&lt;cloud&gt;</code> namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the <code>&lt;cloud:&gt;</code> namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.</p>

<p>The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:</p>

<ul>
<li>Update your application build process to include a dependency on the <code>org.cloudfoundry.cloudfoundry-runtime</code> artifact.  For example, if you use Maven to build your application, the following <code>pom.xml</code> snippet shows how to add this dependency:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- additional dependency declarations --&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>

<ul>
<li>Update your application build process to include the Spring Framework Milestone repository.  The following <code>pom.xml</code> snippet shows how to do this in Maven:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
           <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
           <span class="nt">&lt;snapshots&gt;</span>
                   <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
           <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

    <span class="c">&lt;!-- additional repository declarations --&gt;</span>
<span class="nt">&lt;/repositories&gt;</span></code></pre>

<ul>
<li>In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the <code>&lt;cloud:&gt;</code> namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
        <span class="err">http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
        <span class="err">http://www.springframework.org/schema/context</span>
        <span class="err">http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
        <span class="err">http://schema.cloudfoundry.org/spring</span>
        <span class="err">http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
        <span class="nt">&gt;</span>

    <span class="c">&lt;!-- bean declarations --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<ul>
<li>
    <p>You can now specify the Cloud Foundry services in the Spring application context file by using the <code>&lt;cloud:&gt;</code> namespace along with the name of specific elements, such as <code>data-source</code>.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.</p>

    <p>The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the <code>&lt;cloud:data-source&gt;</code> element.</p>
  </li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">        http://www.springframework.org/schema/context</span>
<span class="s">        http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
<span class="s">        http://schema.cloudfoundry.org/spring</span>
<span class="s">        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">        &gt;</span>

<span class="s">    &lt;cloud:data-source id="</span><span class="err">dataSource"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

        <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as <code>driverClassName</code> or <code>url</code> or <code>username</code> - this is because Cloud Foundry automatically takes care of those properties for you.</p>

<p>For complete information about all the <code>&lt;cloud:&gt;</code> elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:</p>

<ul>
<li><a href="#clouddata-source">&lt;cloud:data-source&gt;: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases</a></li>
  <li><a href="#cloudmongo-db-factory">&lt;cloud:mongo-db-factory&gt;: Configure a MongoDB Connection Factory</a></li>
  <li><a href="#cloudredis-connection-factory">&lt;cloud:redis-connection-factory&gt;: Configure a Redis Connection Factory</a></li>
  <li><a href="#cloudrabbit-connection-factory">&lt;cloud:rabbit-connection-factory&gt;: Configure a RabbitMQ Connection Factory</a></li>
  <li><a href="#cloudservice-scan">&lt;cloud:service-scan&gt; Injecting Services Into @Autowired Beans </a></li>
  <li>
    <p><a href="#cloudproperties">&lt;cloud:properties&gt; Get Cloud Foundry Service Information</a></p>
  </li>
  <li>After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</li>
</ul><h2 id="clouddata-source">&lt;cloud:data-source&gt;</h2>

<p>The <code>&lt;cloud:data-source&gt;</code> element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.</p>

<p>The following example shows a simple way to configure a JDBC data source that will be injected into a <code>org.springframework.jdbc.core.JdbcTemplate</code> bean:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:data-source&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Data Source Configuration</strong></p>

<p>The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of <code>&lt;cloud:data-source&gt;</code>:  <code>&lt;cloud:connection&gt;</code> and <code>&lt;cloud:pool&gt;</code>.</p>

<p>The <code>&lt;cloud:connection&gt;</code> child element takes a single String attribute (<code>properties</code>) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (<code>[propertyName=property;]</code>).</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced data source configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"mydatasource"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:connection</span> <span class="na">properties=</span><span class="s">"charset=utf-8"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:data-source&gt;</span></code></pre>

<p>In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.</p>

<h2 id="cloudmongo-db-factory-">&lt;cloud:mongo-db-factory &gt;</h2>

<p>The <code>&lt;cloud:mongo-db-factory&gt;</code> provides a simple way for you to configure a MongoDB connection factory for your Spring application.</p>

<p>The following example shows a MongoDbFactory configuration that will be injected into a <code>org.springframework.data.mongodb.core.MongoTemplate</code> object:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:mongo-db-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
<li>
<b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li>
<b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li>
<b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li>
<b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
</td>
   <td>String</td>
 </tr>
</table><h2 id="advanced-mongodb-configuration">Advanced MongoDB Configuration</h2>

<p>The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional <code>&lt;cloud:mongo-options&gt;</code> child element of <code>&lt;cloud:mongo-db-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:mongo-options&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table><p>The following example shows how to use the advanced MongoDB options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">write-concern=</span><span class="s">"FSYNC_SAFE"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:mongo-options</span> <span class="na">connections-per-host=</span><span class="s">"12"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:mongo-db-factory&gt;</span></code></pre>

<p>In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (<code>FSYNC_SAFE</code>).</p>

<h2 id="cloudredis-connection-factory-">&lt;cloud:redis-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:redis-connection-factory&gt;</code> provides a simple way for you to configure a Redis connection factory for your Spring application.</p>

<p>The following example shows a <code>RedisConnectionFactory</code> configuration that will be injected into a <code>org.springframework.data.redis.core.StringRedisTemplate</code> object:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"redisConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redisTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.redis.core.StringRedisTemplate"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection-factory"</span> <span class="na">ref=</span><span class="s">"redisConnectionFactory"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:redis-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Redis Configuration</strong></p>

<p>The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:pool&gt;</code> child element of <code>&lt;cloud:redis-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced Redis configuration options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"myRedisConnectionFactory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:redis-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.</p>

<h2 id="cloudrabbit-connection-factory-">&lt;cloud:rabbit-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:rabbit-connection-factory&gt;</code> provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.</p>

<p>The following complete example of a Spring application contenxt file shows a <code>RabbitConnectionFactory</code> configuration that will be injected into a <code>rabbitTemplate</code> object.  The example also uses the <code>&lt;rabbit:&gt;</code> namespace to perform RabbitMQ-specific configurations, as explained after the example:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">"rabbitTemplate"</span>
        <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the preceding example, note the definition and location of the <code>&lt;rabbit:&gt;</code> namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called <code>messages</code> within the RabbitMQ broker.</p>

<p>See <a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a> for additional information about using RabbitMQ in your Spring applications.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:rabbit-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced RabbitMQ Configuration</strong></p>

<p>The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:rabbit-options&gt;</code> child element of <code>&lt;cloud:rabbit-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:rabbit-options&gt;</code> child element defines one attribute called <code>channel-cache-size</code> which you can set to specify the size of the channel cache size.  The default value is 1.</p>

<p>The following example shows how to use these advanced RabbitMQ configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:rabbit-options</span> <span class="na">channel-cache-size=</span><span class="s">"10"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:rabbit-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.</p>

<h2 id="cloudservice-scan">&lt;cloud:service-scan&gt;</h2>

<p>The <code>&lt;cloud:service-scan&gt;</code> element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the <code>@org.springframework.beans.factory.annotation.Autowired</code> annotation.  The <code>&lt;cloud:service-scan&gt;</code> element acts as a cloud equivalent of <code>&lt;context:component-scan&gt;</code> in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a <code>&lt;cloud:&gt;</code> element to your Spring application context file for each new service that you bind.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> element has no attributes or child elements; for example:</p>

<pre><code class="language-xml">         <span class="nt">&lt;cloud:service-scan</span> <span class="nt">/&gt;</span></code></pre>

<p>In your Java code, you must annotate each dependency with <code>@Autowired</code> so that a bean of the corresponding service is automatically created.  For example:</p>

<pre><code class="language-java">  <span class="kn">package</span> <span class="n">cf</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

  <span class="o">....</span>

  <span class="nd">@Autowired</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">ConnectionFactory</span> <span class="n">rabbitConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">MongoDbFactory</span> <span class="n">mongoDbFactory</span><span class="o">;</span>

  <span class="o">...</span></code></pre>

<p>Use of only the <code>@Autowired</code> annotation is adequate if you have bound only <em>one</em> service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the <code>@Qualifier</code> annotation to match the Spring bean with the specific service instance.</p>

<p>For example, assume you bound two MySQL services (named <code>inventory-db</code> and <code>pricing-db</code>) to your application; use the <code>@Qualifier</code> annotation as shown in the following example to specify which service instance applies to which Spring bean:</p>

<pre><code class="language-java">  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"inventory-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">inventoryDataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"pricing-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">pricingDataSource</span><span class="o">;</span></code></pre>

<h2 id="cloudproperties">&lt;cloud:properties&gt;</h2>

<p>The <code>&lt;cloud:properties&gt;</code> element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.</p>

<p>The <code>&lt;cloud:properties&gt;</code> element has just a single attribute (<code>id</code>) which specifies the name of the Properties bean.  Use this ID as a reference to <code>&lt;context:property-placeholder&gt;</code> which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.</p>

<p>Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include <code>&lt;cloud:properties&gt;</code> in your application context file.</p>

<p>The following example shows how to use this element in your Spring application context file:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:properties</span> <span class="na">id=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;context:property-placeholder</span> <span class="na">properties-ref=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span>
                  <span class="na">value=</span><span class="s">"${cloud.services.mysql.connection.username}"</span> <span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, <code>cloud.services.mysql.connection.username</code> is one of the properties exposed by Cloud Foundry.</p>

<p>For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see <a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a>.</p>

<h2 id="rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</h2>

<p>This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:</p>

<ul>
<li>
<a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a>, cover the basics of creating messaging in your applications.</li>
  <li>
<a href="http://www.rabbitmq.com/download.html">Download</a>, <a href="http://www.rabbitmq.com/install.html">install</a> and <a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ</li>
  <li><a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMPQ reference documentation</a></li>
</ul><p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP protocol</a> (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.</p>

<p>The following sample <code>pom.xml</code> file shows RabbitMQ dependencies and repositories in addition to the <code>cloudfoundry-runtime</code> dependency described above:</p>

<pre><code class="language-xml">    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
              <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                       <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span></code></pre>

<p>Then update your application controller/logic as follows:</p>

<ul>
<li>Include the messaging libraries:</li>
</ul><pre><code class="language-java">   <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
   <span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span></code></pre>

<ul>
<li>Read and write messages as shown in the following Java code snippets:</li>
</ul><pre><code class="language-java">   <span class="nd">@Controller</span>
   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
       <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
           <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Send a message to the "messages" queue</span>
           <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Receive a message from the "messages" queue</span>
           <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
           <span class="k">else</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
   <span class="o">}</span></code></pre>

<h2 id="using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</h2>

<p>The preceding sections describe how to use the <code>&lt;cloud:&gt;</code> namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to <em>conditionalize</em> the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring <em>profiles</em> feature, available in Spring Framework 3.1 or later.</p>

<p>The basic idea is that you group the configuration for a specific environment using the <code>profile</code> attribute of a nested <code>&lt;beans&gt;</code> element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are <code>default</code> and <code>cloud</code>.</p>

<p>When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the <code>cloud</code> profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the <code>&lt;cloud:&gt;</code> namespace within the <code>cloud</code> profile block to allow the application to run outside of Cloud Foundry environments.  You then use the <code>default</code> profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.</p>

<p>Here is an example of a Spring <code>MongoTemplate</code> being populated from two alternately configured connection factories. When running on Cloud Foundry (<code>cloud</code> profile), the connection factory is automatically configured. When not running on Cloud Foundry (<code>default</code> profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
        <span class="na">xmlns:jdbc=</span><span class="s">"http://www.springframework.org/schema/jdbc"</span>
        <span class="na">xmlns:util=</span><span class="s">"http://www.springframework.org/schema/util"</span>
        <span class="na">xmlns:mongo=</span><span class="s">"http://www.springframework.org/schema/data/mongo"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/data/mongo</span>
<span class="s">          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd</span>
<span class="s">          http://www.springframework.org/schema/jdbc</span>
<span class="s">          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd</span>
<span class="s">          http://schema.cloudfoundry.org/spring</span>
<span class="s">          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">          http://www.springframework.org/schema/beans</span>
<span class="s">          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">          http://www.springframework.org/schema/util</span>
<span class="s">          http://www.springframework.org/schema/util/spring-util-3.1.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"default"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;mongo:db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">dbname=</span><span class="s">"pwdtest"</span> <span class="na">host=</span><span class="s">"127.0.0.1"</span> <span class="na">port=</span><span class="s">"27017"</span> <span class="na">username=</span><span class="s">"test_user"</span> <span class="na">password=</span><span class="s">"efgh"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Note that the <code>&lt;beans profile="value"&gt;</code> element is nested inside the standard root <code>&lt;beans&gt;</code> element.  The MongoDB connection factory in the <code>cloud</code> profile uses the <code>&lt;cloud:&gt;</code> namespace, the connection factory configuration in the <code>default</code> profile uses the <code>&lt;mongo:&gt;</code> namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.</p>

<p>See the <a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">SpringSource Blog</a> for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.</p>

<h2 id="sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</h2>

<p>In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.</p>

<p>Service providers, such as <a href="http://sendgrid.com">SendGrid</a>, can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Spring Profiles</a> to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.</p>

<p>The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the <code>cloud</code> profile:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>

    <span class="err">...</span>

    <span class="err">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">"mailSender"</span> <span class="na">class=</span><span class="s">"example.SendGridMailSender"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiUser"</span> <span class="na">value=</span><span class="s">"youremail@domain.com"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiKey"</span> <span class="na">value=</span><span class="s">"secureSecret"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/beans&gt;</span>

   ...

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the example, <code>example.SendGridMailSender</code> is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.</p>

<h2 id="accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</h2>

<p>Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.</p>

<p>Service properties generally take one of the following forms:</p>

<pre><code>    cloud.services.{service-name}.connection.{property}
    cloud.services.{service-name}.{property}
</code></pre>

<p>where <code>{service-name}</code> refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.</p>

<p>For example, assume that in VMC you created a vFabric Postgres service called <code>my-postgres</code> and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:</p>

<pre><code>    cloud.services.my-postgres.connection.host
    cloud.services.my-postgres.connection.hostname
    cloud.services.my-postgres.connection.name
    cloud.services.my-postgres.connection.password
    cloud.services.my-postgres.connection.port
    cloud.services.my-postgres.connection.user
    cloud.services.my-postgres.connection.username
    cloud.services.my-postgres.plan
    cloud.services.my-postgres.type
</code></pre>

<p>For convenience, if you have bound just <em>one</em> service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form <code>cloud.services.mysql.connection.{property}</code>.   Cloud Foundry uses the following aliases in this case:</p>

<ul>
<li><code>mysql</code></li>
  <li><code>mongodb</code></li>
  <li><code>postgresql</code></li>
  <li><code>rabbitmq</code></li>
  <li><code>redis</code></li>
</ul><p>If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a <code>cloud</code> profile; Spring profiles are briefly described in <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a>.</p>

<p>For example, assume that you have bound a MySQL service called <code>spring-mysql</code> to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"c3p0DataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span>
                <span class="na">value=</span><span class="s">"jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.username}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.password}"</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, <code>{service-name}</code> refers to the actual name of the bound service.</p>

<table class="std">
<tr>
<th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
<tr>
<td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
<tr>
<td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr></tt>
</td>
</tr></tt>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"HâThis section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.

(If you're interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read [this](/frameworks/java/spring/spring-insight.html).)

(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: [https://github.com/SpringSource/cloudfoundry-samples/wiki](https://github.com/SpringSource/cloudfoundry-samples/wiki) )

## Prerequisites

It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:

+ [Installing the Command-Line Utility (VMC)](/tools/vmc/installing-vmc.html)
+ [Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse](/tools/STS/configuring-STS.html)
+ [Getting Started With Spring](http://www.springsource.org/get-started)

## Subtopics

+ [Programming and Packaging Spring Applications](#programming-and-packaging-spring-applications)
+ [Using Cloud Foundry Services In Spring Applications](#using-cloud-foundry-services-in-spring-applications)
+ [RabbitMQ And Spring: Additional Programming Information](#rabbitmq-and-spring-additional-programming-information)
+ [Using Spring Profiles to Conditionalize Cloud Foundry Configuration](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration)
+ [Sending Email From Spring Applications Deployed to Cloud Foundry](#sending-email-from-spring-applications-deployed-to-cloud-foundry)
+ [Accessing Cloud Foundry Properties](#accessing-cloud-foundry-properties)

## Programming and Packaging Spring Applications

In general, you do not have to do anything "special" when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.

It is usually best to package your Spring application in a `*.war` file so that `vmc push` will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.

There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:

+  Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is *able* to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.

+ Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the `root` context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the `*.war` file in which the application is packaged.

+ HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.

+ External users can access your application only via the URL provided by the `vmc push` command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.

## Using Cloud Foundry Services In Spring Applications

If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry *without changing a single line of code*.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See [Determining Whether Your Application Can Be Auto-Configured](#determining-whether-your-application-can-be-auto-configured) for details.

If your Spring application cannot take advantage of Cloud Foundry's auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See [Explicitly Configuring Your Application to Use Cloud Foundry Services](#explicitly-configuring-your-application-to-use-cloud-foundry-services).

## Determining Whether Your Application Can Be Auto-Configured

You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small [set of limitations](#limitations-of-auto-reconfiguration), Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.

With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single `javax.sql.DataSource` bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesn't use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesn't really care what the specific properties are that created the database.

The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.

## Relational Database (MySQL and vFabric Postgres)

Auto-reconfiguration occurs if Cloud Foundry detects a `javax.sql.DataSource` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<bean class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close" id="dataSource">
    <property name="driverClassName" value="org.h2.Driver" />
    <property name="url" value="jdbc:h2:mem:" />
    <property name="username" value="sa" />
    <property name="password" value="" />
</bean>
```

The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.

Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.

## MongoDB

You must be using [Spring Data MongoDB](http://www.springsource.org/spring-data/mongodb) 1.0 M4 or later for auto-reconfiguration to work.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.data.document.mongodb.MongoDbFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<mongo:db-factory
    id="mongoDbFactory"
    dbname="pwdtest"
    host="127.0.0.1"
    port="1234"
    username="test_user"
    password="test_pass"  />
```

Cloud Foundry will create a `SimpleMOngoDbFactory` with its own values for the following properties:  host, port, username, password, dbname.

## Redis

You must be using [Spring Data Redis](http://www.springsource.org/spring-data/redis) 1.0 M4 or later for auto-reconfiguration to work.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.data.redis.connection.RedisConnectionFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<bean id="redis"
      class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"
      p:hostName="localhost" p:port="6379"  />
```
Cloud Foundry will create a `JedisConnectionFactory` with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.

## RabbitMQ

You must be using [Spring AMQP](http://www.springsource.org/spring-amqp) 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.

Auto-reconfiguration occurs if Cloud Foundry detects a `org.springframework.amqp.rabbit.connection.ConnectionFactory` bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:

```xml
<rabbit:connection-factory
    id="rabbitConnectionFactory"
    host="localhost"
    password="testpwd"
    port="1238"
    username="testuser"
    virtual-host="virthost" />
```

Cloud Foundry will create a `org.springframework.amqp.rabbit.connection.CachingConnectionFactory` with its own values for the following properties:  host, virtual-host, port, username, password.

## Limitations of Auto-Reconfiguration

Cloud Foundry auto-reconfigures applications only if the following items are true for your application:

+ You bind only *one* service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will *not* occur.
+ You include only *one* bean of a matching type in your Spring application context file.  For example, you can have only one bean of type `javax.sql.DataSource`.

Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.

## Opting Out of Auto-Reconfiguration

Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:

+ When you deploy your application using VMC or STS, specify that the framework is `JavaWeb` instead of `Spring`.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.
+ Use the `<cloud:>` namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See [Explicitly Configuring Your Application to Use Cloud Foundry Services](#explicitly-configuring-your-application-to-use-cloud-foundry-services).

## Explicitly Configuring Your Application to Use Cloud Foundry Services

This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See [Configuring Applications to Use Cloud Foundry](/frameworks.html) for the complete list of supported Cloud Foundry services.

The easiest way to use Cloud Foundry services in your Spring applications is to declare the `<cloud:>` namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the `<cloud>` namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the `<cloud:>` namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.

The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:

* Update your application build process to include a dependency on the `org.cloudfoundry.cloudfoundry-runtime` artifact.  For example, if you use Maven to build your application, the following `pom.xml` snippet shows how to add this dependency:

```xml
<dependencies>
    <dependency>
        <groupId>org.cloudfoundry</groupId>
        <artifactId>cloudfoundry-runtime</artifactId>
        <version>0.8.1</version>
    </dependency>

    <!-- additional dependency declarations -->
</dependencies>
```

*  Update your application build process to include the Spring Framework Milestone repository.  The following `pom.xml` snippet shows how to do this in Maven:

```xml
<repositories>
    <repository>
          <id>org.springframework.maven.milestone</id>
           <name>Spring Maven Milestone Repository</name>
           <url>http://maven.springframework.org/milestone</url>
           <snapshots>
                   <enabled>false</enabled>
           </snapshots>
    </repository>

    <!-- additional repository declarations -->
</repositories>
```

*  In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the `<cloud:>` namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:

```xml

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:cloud="http://schema.cloudfoundry.org/spring"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.1.xsd
        http://schema.cloudfoundry.org/spring
        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
        >

    <!-- bean declarations -->

</beans>
```

*  You can now specify the Cloud Foundry services in the Spring application context file by using the `<cloud:>` namespace along with the name of specific elements, such as `data-source`.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.

    The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the `<cloud:data-source>` element.

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:cloud="http://schema.cloudfoundry.org/spring"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.1.xsd
        http://schema.cloudfoundry.org/spring
        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
        >

    <cloud:data-source id="dataSource" />

    <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
      <property name="dataSource" ref="dataSource" />
    </bean>

        <!-- additional beans in your application -->

</beans>
```

When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as `driverClassName` or `url` or `username` - this is because Cloud Foundry automatically takes care of those properties for you.

For complete information about all the `<cloud:>` elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:

+ [\<cloud:data-source\>: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases](#clouddata-source)
+ [\<cloud:mongo-db-factory\>: Configure a MongoDB Connection Factory](#cloudmongo-db-factory)
+ [\<cloud:redis-connection-factory\>: Configure a Redis Connection Factory](#cloudredis-connection-factory)
+ [\<cloud:rabbit-connection-factory\>: Configure a RabbitMQ Connection Factory](#cloudrabbit-connection-factory)
+ [\<cloud:service-scan\> Injecting Services Into @Autowired Beans ](#cloudservice-scan)
+ [\<cloud:properties\> Get Cloud Foundry Service Information](#cloudproperties)

* After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See [Deploying Applications](/tools/deploying-apps.html) for details on how to use these tools.

## \<cloud:data-source\>

The `<cloud:data-source>` element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.

The following example shows a simple way to configure a JDBC data source that will be injected into a `org.springframework.jdbc.core.JdbcTemplate` bean:

```xml
<cloud:data-source id="dataSource" />

<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
  <property name="dataSource" ref="dataSource" />
</bean>
```
In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.

**Attributes**

The following table lists the attributes of the `<cloud:data-source>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced Data Source Configuration**

The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of `<cloud:data-source>`:  `<cloud:connection>` and `<cloud:pool>`.

The `<cloud:connection>` child element takes a single String attribute (`properties`) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (`[propertyName=property;]`).

The `<cloud:pool>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table>

The following example shows how to use these advanced data source configuration options:

```xml
        <cloud:data-source id="mydatasource">
            <cloud:connection properties="charset=utf-8" />
            <cloud:pool pool-size="5-10" max-wait-time="2000" />
        </cloud:data-source>
```
In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.

## \<cloud:mongo-db-factory \>

The `<cloud:mongo-db-factory>` provides a simple way for you to configure a MongoDB connection factory for your Spring application.

The following example shows a MongoDbFactory configuration that will be injected into a `org.springframework.data.mongodb.core.MongoTemplate` object:

```xml
<cloud:mongo-db-factory id="mongoDbFactory" />

<bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
    <constructor-arg ref="mongoDbFactory"/>
</bean>
```

**Attributes**

The following table lists the attributes of the `<cloud:mongo-db-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
	  <li><b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li><b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li><b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li><b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
    </td>
   <td>String</td>
 </tr>
</table>

## Advanced MongoDB Configuration

The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional `<cloud:mongo-options>` child element of `<cloud:mongo-db-factory>`.

The `<cloud:mongo-options>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table>

The following example shows how to use the advanced MongoDB options:

```xml
    <cloud:mongo-db-factory id="mongoDbFactory" write-concern="FSYNC_SAFE">
        <cloud:mongo-options connections-per-host="12" max-wait-time="2000" />
    </cloud:mongo-db-factory>
```

In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (`FSYNC_SAFE`).

## \<cloud:redis-connection-factory \>

The `<cloud:redis-connection-factory>` provides a simple way for you to configure a Redis connection factory for your Spring application.

The following example shows a `RedisConnectionFactory` configuration that will be injected into a `org.springframework.data.redis.core.StringRedisTemplate` object:

``` xml
    <cloud:redis-connection-factory id="redisConnectionFactory" />

    <bean id="redisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate">
        <property name="connection-factory" ref="redisConnectionFactory"/>
    </bean>
```

**Attributes**

The following table lists the attributes of the `<cloud:redis-connection-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced Redis Configuration**

The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the`<cloud:pool>` child element of `<cloud:redis-connection-factory>`.

The `<cloud:pool>` child element takes the following two attributes:

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
 <tr>
   <td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
 <tr>
   <td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table>

The following example shows how to use these advanced Redis configuration options:

``` xml
    <cloud:redis-connection-factory id="myRedisConnectionFactory">
        <cloud:pool pool-size="5-10" max-wait-time="2000" />
    </cloud:redis-connection-factory>
```

In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.

## \<cloud:rabbit-connection-factory \>

The `<cloud:rabbit-connection-factory>` provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.

The following complete example of a Spring application contenxt file shows a `RabbitConnectionFactory` configuration that will be injected into a `rabbitTemplate` object.  The example also uses the `<rabbit:>` namespace to perform RabbitMQ-specific configurations, as explained after the example:

``` xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:cloud="http://schema.cloudfoundry.org/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd
           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd">

    <!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: -->
    <cloud:rabbit-connection-factory id="rabbitConnectionFactory" />

    <!-- Set up the AmqpTemplate/RabbitTemplate: -->
    <rabbit:template id="rabbitTemplate"
        connection-factory="rabbitConnectionFactory" />

    <!-- Request that queues, exchanges and bindings be automatically declared on the broker: -->
    <rabbit:admin connection-factory="rabbitConnectionFactory"/>

    <!-- Declare the "messages" queue: -->
    <rabbit:queue name="messages" durable="true"/>

    <!-- additional beans in your application -->

</beans>
```

In the preceding example, note the definition and location of the `<rabbit:>` namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called `messages` within the RabbitMQ broker.

See [RabbitMQ And Spring: Additional Programming Information](#rabbitmq-and-spring-additional-programming-information) for additional information about using RabbitMQ in your Spring applications.

**Attributes**

The following table lists the attributes of the `<cloud:rabbit-connection-factory>` element.

<table class="std">
 <tr>
   <th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
 <tr>
   <td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
 <tr>
   <td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table>

**Advanced RabbitMQ Configuration**

The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the`<cloud:rabbit-options>` child element of `<cloud:rabbit-connection-factory>`.

The `<cloud:rabbit-options>` child element defines one attribute called `channel-cache-size` which you can set to specify the size of the channel cache size.  The default value is 1.

The following example shows how to use these advanced RabbitMQ configuration options:

``` xml
        <cloud:rabbit-connection-factory id="rabbitConnectionFactory" >
            <cloud:rabbit-options channel-cache-size="10" />
        </cloud:rabbit-connection-factory>
```

In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.

## \<cloud:service-scan\>

The `<cloud:service-scan>` element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the `@org.springframework.beans.factory.annotation.Autowired` annotation.  The `<cloud:service-scan>` element acts as a cloud equivalent of `<context:component-scan>` in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.

The `<cloud:service-scan>` is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a `<cloud:>` element to your Spring application context file for each new service that you bind.

The `<cloud:service-scan>` element has no attributes or child elements; for example:

``` xml
         <cloud:service-scan />
```

In your Java code, you must annotate each dependency with `@Autowired` so that a bean of the corresponding service is automatically created.  For example:

``` java
  package cf.examples;

  import org.springframework.beans.factory.annotation.Autowired;

  ....

  @Autowired DataSource dataSource;
  @Autowired ConnectionFactory rabbitConnectionFactory;
  @Autowired RedisConnectionFactory redisConnectionFactory;
  @Autowired MongoDbFactory mongoDbFactory;

  ...
```

Use of only the `@Autowired` annotation is adequate if you have bound only *one* service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the `@Qualifier` annotation to match the Spring bean with the specific service instance.

For example, assume you bound two MySQL services (named `inventory-db` and `pricing-db`) to your application; use the `@Qualifier` annotation as shown in the following example to specify which service instance applies to which Spring bean:

``` java
  @Autowired @Qualifier("inventory-db") DataSource inventoryDataSource;
  @Autowired @Qualifier("pricing-db") DataSource pricingDataSource;
```

## \<cloud:properties\>

The `<cloud:properties>` element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.

The `<cloud:properties>` element has just a single attribute (`id`) which specifies the name of the Properties bean.  Use this ID as a reference to `<context:property-placeholder>` which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.

Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include `<cloud:properties>` in your application context file.

The following example shows how to use this element in your Spring application context file:

``` xml
    <cloud:properties id="cloudProperties" />

    <context:property-placeholder properties-ref="cloudProperties" />

    <bean class="com.mchange.v2.c3p0.ComboPooledDataSource">
        <property name="user"
                  value="${cloud.services.mysql.connection.username}" />
    ...
    </bean>
```

In the preceding example, `cloud.services.mysql.connection.username` is one of the properties exposed by Cloud Foundry.

For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see [Accessing Cloud Foundry Properties](#accessing-cloud-foundry-properties).

## RabbitMQ And Spring: Additional Programming Information

This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:

+	[RabbitMQ Tutorials](http://www.rabbitmq.com/getstarted.html), cover the basics of creating messaging in your applications.
+	[Download](http://www.rabbitmq.com/download.html), [install](http://www.rabbitmq.com/install.html) and [configure](http://www.rabbitmq.com/configure.html) RabbitMQ
+       [Spring AMPQ reference documentation](http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/)

The RabbitMQ service is accessed through the [AMQP protocol](http://www.amqp.org/) (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.

The following sample `pom.xml` file shows RabbitMQ dependencies and repositories in addition to the `cloudfoundry-runtime` dependency described above:

```xml
    <repositories>
        <repository>
              <id>org.springframework.maven.milestone</id>
               <name>Spring Maven Milestone Repository</name>
               <url>http://maven.springframework.org/milestone</url>
               <snapshots>
                       <enabled>false</enabled>
               </snapshots>
        </repository>
    </repositories>

    <dependency>
        <groupId>cglib</groupId>
        <artifactId>cglib-nodep</artifactId>
        <version>2.2</version>
    </dependency>

    <dependency>
        <groupId>org.springframework.amqp</groupId>
        <artifactId>spring-rabbit</artifactId>
        <version>1.0.0.RC2</version>
    </dependency>

    <dependency>
        <groupId>org.cloudfoundry</groupId>
        <artifactId>cloudfoundry-runtime</artifactId>
        <version>0.7.1</version>
    </dependency>
```

Then update your application controller/logic as follows:

* Include the messaging libraries:

```java
   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.amqp.core.AmqpTemplate;
```

* Read and write messages as shown in the following Java code snippets:

``` java
   @Controller
   public class HomeController {
       @Autowired AmqpTemplate amqpTemplate;

       @RequestMapping(value = "/")
       public String home(Model model) {
           model.addAttribute(new Message());
           return "WEB-INF/views/home.jsp";
       }

       @RequestMapping(value = "/publish", method=RequestMethod.POST)
       public String publish(Model model, Message message) {
           // Send a message to the "messages" queue
           amqpTemplate.convertAndSend("messages", message.getValue());
           model.addAttribute("published", true);
           return home(model);
       }

       @RequestMapping(value = "/get", method=RequestMethod.POST)
       public String get(Model model) {
           // Receive a message from the "messages" queue
           String message = (String)amqpTemplate.receiveAndConvert("messages");
           if (message != null)
               model.addAttribute("got", message);
           else
               model.addAttribute("got_queue_empty", true);

           return home(model);
   }
```

## Using Spring Profiles to Conditionalize Cloud Foundry Configuration

The preceding sections describe how to use the `<cloud:>` namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to *conditionalize* the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring *profiles* feature, available in Spring Framework 3.1 or later.

The basic idea is that you group the configuration for a specific environment using the `profile` attribute of a nested `<beans>` element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are `default` and `cloud`.

When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the `cloud` profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the `<cloud:>` namespace within the `cloud` profile block to allow the application to run outside of Cloud Foundry environments.  You then use the `default` profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.

Here is an example of a Spring `MongoTemplate` being populated from two alternately configured connection factories. When running on Cloud Foundry (`cloud` profile), the connection factory is automatically configured. When not running on Cloud Foundry (`default` profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:cloud="http://schema.cloudfoundry.org/spring"
        xmlns:jdbc="http://www.springframework.org/schema/jdbc"
        xmlns:util="http://www.springframework.org/schema/util"
        xmlns:mongo="http://www.springframework.org/schema/data/mongo"
        xsi:schemaLocation="http://www.springframework.org/schema/data/mongo
          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
          http://www.springframework.org/schema/jdbc
          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd
          http://schema.cloudfoundry.org/spring
          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd
          http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
          http://www.springframework.org/schema/util
          http://www.springframework.org/schema/util/spring-util-3.1.xsd">

        <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
           <constructor-arg ref="mongoDbFactory" />
        </bean>

        <beans profile="default">
           <mongo:db-factory id="mongoDbFactory" dbname="pwdtest" host="127.0.0.1" port="27017" username="test_user" password="efgh" />
        </beans>

        <beans profile="cloud">
           <cloud:mongo-db-factory id="mongoDbFactory" />
        </beans>

</beans>
```

Note that the `<beans profile="value">` element is nested inside the standard root `<beans>` element.  The MongoDB connection factory in the `cloud` profile uses the `<cloud:>` namespace, the connection factory configuration in the `default` profile uses the `<mongo:>` namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.

See the [SpringSource Blog](http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/) for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.

## Sending Email From Spring Applications Deployed to Cloud Foundry

In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.

Service providers, such as [SendGrid](http://sendgrid.com), can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using [Spring Profiles](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration) to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.

The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the `cloud` profile:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:cloud="http://schema.cloudfoundry.org/spring"

    ...

    <beans profile="cloud">
       <bean name="mailSender" class="example.SendGridMailSender">
          <property name="apiUser" value="youremail@domain.com" />
          <property name="apiKey" value="secureSecret" />
       </bean>
    </beans>

   ...

    <!-- additional beans in your application -->

</beans>
```

In the example, `example.SendGridMailSender` is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.

## Accessing Cloud Foundry Properties

Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.

Service properties generally take one of the following forms:

        cloud.services.{service-name}.connection.{property}
        cloud.services.{service-name}.{property}

where `{service-name}` refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.

For example, assume that in VMC you created a vFabric Postgres service called `my-postgres` and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:

        cloud.services.my-postgres.connection.host
        cloud.services.my-postgres.connection.hostname
        cloud.services.my-postgres.connection.name
        cloud.services.my-postgres.connection.password
        cloud.services.my-postgres.connection.port
        cloud.services.my-postgres.connection.user
        cloud.services.my-postgres.connection.username
        cloud.services.my-postgres.plan
        cloud.services.my-postgres.type

For convenience, if you have bound just *one* service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form `cloud.services.mysql.connection.{property}`.   Cloud Foundry uses the following aliases in this case:

+ `mysql`
+ `mongodb`
+ `postgresql`
+ `rabbitmq`
+ `redis`

If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a `cloud` profile; Spring profiles are briefly described in [Using Spring Profiles to Conditionalize Cloud Foundry Configuration](#using-spring-profiles-to-conditionalize-cloud-foundry-configuration).

For example, assume that you have bound a MySQL service called `spring-mysql` to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:

```xml
<beans profile="cloud">
   <bean id="c3p0DataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close">
      <property name="driverClass" value="com.mysql.jdbc.Driver" />
      <property name="jdbcUrl"
                value="jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}" />
      <property name="user" value="${cloud.services.spring-mysql.connection.username}" />
      <property name="password" value="${cloud.services.spring-mysql.connection.password}" />
   </bean>
</beans>
```

The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, `{service-name}` refers to the actual name of the bound service.

<table class="std">
 <tr>
   <th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
 <tr>
   <td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
 <tr>
   <td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free</td>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free</td>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
 <tr>
   <td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr>
</table>;T;
I"ù8<p>This section provides practical information for Spring developers who are using Cloud Foundry to deploy their applications.  In particular, the section describes Spring programming and packaging topics that are specific to the Cloud Foundry environment, and what you need to do to use the provided services, such as MySQL and RabbitMQ.</p>

<p>(If youâ€™re interested in using Spring Insight to monitor your Java applications on Cloud Foundry, read <a href="/frameworks/java/spring/spring-insight.html">this</a>.)</p>

<p>(If you are working Spring, Roo or Grails and would like to see some code samples, check out this useful link: <a href="https://github.com/SpringSource/cloudfoundry-samples/wiki">https://github.com/SpringSource/cloudfoundry-samples/wiki</a> )</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>It is assumed that you have already installed either VMC, SpringSource STS, or Eclipse and that you have used one of these tools to deploy a simple HelloWorld application to Cloud Foundry, either to your local Micro version or to the service hosted at cloudfoundry.com.  It is also assumed that you are already a proficient Spring application developer.  For additional information, see:</p>

<ul>
<li><a href="/tools/vmc/installing-vmc.html">Installing the Command-Line Utility (VMC)</a></li>
  <li><a href="/tools/STS/configuring-STS.html">Installing the Cloud Foundry Integration Extension for SpringSource Tool Suite (STS) and Eclipse</a></li>
  <li><a href="http://www.springsource.org/get-started">Getting Started With Spring</a></li>
</ul><h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</a></li>
  <li><a href="#using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</a></li>
  <li><a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a></li>
  <li><a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a></li>
  <li><a href="#sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</a></li>
  <li><a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a></li>
</ul><h2 id="programming-and-packaging-spring-applications">Programming and Packaging Spring Applications</h2>

<p>In general, you do not have to do anything â€œspecialâ€ when programming or packaging Spring applications that you want to deploy to Cloud Foundry.  In other words, if your Spring application runs on tc Server or Apache Tomcat, then it will also run on Cloud Foundry without any changes.</p>

<p>It is usually best to package your Spring application in a <code>*.war</code> file so that <code>vmc push</code> will automatically detect that it is a Spring application, but you can also deploy it as an exploded directory if you want.</p>

<p>There are, however, a few things about the Cloud Foundry environment that you should be aware of that might affect how your deployed application runs:</p>

<ul>
<li>
    <p>Local disk storage is ephemeral.  In other words, local disk storage is not guaranteed to persist for the entire life of the application.  This is because Cloud Foundry creates a new virtual disk every time you restart your application.  Additionally, Cloud Foundry restarts all applications after it updates its own environment.  This means that, although your application is <em>able</em> to write local files while it is running, the files will disappear after the application restarts.   If the files your application is writing are temporary, then this should not be a problem.  However, if your application needs the data in the files to persist, then you must use one of the data services to manage the data.  In this scenario, MongoDB is a good choice because it is a document-oriented database.</p>
  </li>
  <li>
    <p>Cloud Foundry uses Apache Tomcat as its application server, and it runs your application within the <code>root</code> context.   This is different from normal Apache Tomcat in which the context path is determined by the name of the <code>*.war</code> file in which the application is packaged.</p>
  </li>
  <li>
    <p>HTTP sessions are not replicated, but HTTP traffic is sticky.  This means that if a your application crashes or restarts, the HTTP sessions are lost.</p>
  </li>
  <li>
    <p>External users can access your application only via the URL provided by the <code>vmc push</code> command (or equivalent STS command).  Although your application might be able to internally listen to other ports (such as the JMX port for the MBean server), external users of your application will not be able to listen on these ports.</p>
  </li>
</ul><h2 id="using-cloud-foundry-services-in-spring-applications">Using Cloud Foundry Services In Spring Applications</h2>

<p>If your Spring application requires services (such as a database or RabbitMQ), you might be able to deploy your application to Cloud Foundry <em>without changing a single line of code</em>.  In this case, Cloud Foundry automatically re-configures the relevant bean definitions to bind them to cloud services.  See <a href="#determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</a> for details.</p>

<p>If your Spring application cannot take advantage of Cloud Foundryâ€™s auto-reconfiguration feature, or you want more control over the configuration, the additional steps you must take are very simple and easy.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</p>

<h2 id="determining-whether-your-application-can-be-auto-configured">Determining Whether Your Application Can Be Auto-Configured</h2>

<p>You will likely be able to deploy many of your existing Spring applications to Cloud Foundry without changing a single line of code, even in the case that your application requires a service such as a relational database or RabbitMQ. This is because Cloud Foundry automatically detects the type of service your application needs, and if its configuration falls within a small <a href="#limitations-of-auto-reconfiguration">set of limitations</a>, Cloud Foundry will automatically reconfigure it so that it binds to service instances that Cloud Foundry creates and maintains itself.</p>

<p>With auto-reconfiguration, Cloud Foundry creates the database or connection factory itself, using its own values for properties such as host, port, username and so on.  For example, if you have a single <code>javax.sql.DataSource</code> bean in your application context that Cloud Foundry reconfigures and binds to its own database service, Cloud Foundry doesnâ€™t use the username and password and driver URL you originally specified.  Rather, it uses its own internal values.  This is transparent to the application, which really only cares about having a relational database to which it can write data but doesnâ€™t really care what the specific properties are that created the database.</p>

<p>The following sections describe, for each supported service, the type of bean that Cloud Foundry detects if auto-configuration occurs.</p>

<h2 id="relational-database-mysql-and-vfabric-postgres">Relational Database (MySQL and vFabric Postgres)</h2>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>javax.sql.DataSource</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">id=</span><span class="s">"dataSource"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:mem:"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"sa"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>The relational database that Cloud Foundry actually uses depends on the service instance you explicitly bind to your application when you deploy it: MySQL or vFabric Postgres.  Cloud Foundry creates either a commons DBCP or Tomcat datasource.</p>

<p>Cloud Foundry will internally generate values for the following properties:  driverClassName, url, username, password, validationQuery.</p>

<h2 id="mongodb">MongoDB</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/mongodb">Spring Data MongoDB</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.document.mongodb.MongoDbFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;mongo:db-factory</span>
    <span class="na">id=</span><span class="s">"mongoDbFactory"</span>
    <span class="na">dbname=</span><span class="s">"pwdtest"</span>
    <span class="na">host=</span><span class="s">"127.0.0.1"</span>
    <span class="na">port=</span><span class="s">"1234"</span>
    <span class="na">username=</span><span class="s">"test_user"</span>
    <span class="na">password=</span><span class="s">"test_pass"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>SimpleMOngoDbFactory</code> with its own values for the following properties:  host, port, username, password, dbname.</p>

<h2 id="redis">Redis</h2>

<p>You must be using <a href="http://www.springsource.org/spring-data/redis">Spring Data Redis</a> 1.0 M4 or later for auto-reconfiguration to work.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.data.redis.connection.RedisConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redis"</span>
      <span class="na">class=</span><span class="s">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>
      <span class="na">p:hostName=</span><span class="s">"localhost"</span> <span class="na">p:port=</span><span class="s">"6379"</span>  <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>JedisConnectionFactory</code> with its own values for the following properties:  host, port, password.   This means that you must package the Jedis JAR in your application.  Cloud Foundry does not currently support the JRedis and RJC implementations.</p>

<h2 id="rabbitmq">RabbitMQ</h2>

<p>You must be using <a href="http://www.springsource.org/spring-amqp">Spring AMQP</a> 1.0 or later for auto-reconfiguration to work.  Spring AMQP provides publishing, multi-threaded consumer generation, and message converters.  It also facilitates management of AMQP resources while promoting dependency injection and declarative configuration.</p>

<p>Auto-reconfiguration occurs if Cloud Foundry detects a <code>org.springframework.amqp.rabbit.connection.ConnectionFactory</code> bean.   The following snippet of a Spring application context file shows an example of defining this type of bean which Cloud Foundry will in turn detect and potentially auto-reconfigure:</p>

<pre><code class="language-xml"><span class="nt">&lt;rabbit:connection-factory</span>
    <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span>
    <span class="na">host=</span><span class="s">"localhost"</span>
    <span class="na">password=</span><span class="s">"testpwd"</span>
    <span class="na">port=</span><span class="s">"1238"</span>
    <span class="na">username=</span><span class="s">"testuser"</span>
    <span class="na">virtual-host=</span><span class="s">"virthost"</span> <span class="nt">/&gt;</span></code></pre>

<p>Cloud Foundry will create a <code>org.springframework.amqp.rabbit.connection.CachingConnectionFactory</code> with its own values for the following properties:  host, virtual-host, port, username, password.</p>

<h2 id="limitations-of-auto-reconfiguration">Limitations of Auto-Reconfiguration</h2>

<p>Cloud Foundry auto-reconfigures applications only if the following items are true for your application:</p>

<ul>
<li>You bind only <em>one</em> service instance of a given service type to your application.  In this context, MySQL and vFabric Postgres are considered the same service type (relational database), so if you have bound both a MySQL and a vFabric Postgres service to your application, auto-reconfiguration will <em>not</em> occur.</li>
  <li>You include only <em>one</em> bean of a matching type in your Spring application context file.  For example, you can have only one bean of type <code>javax.sql.DataSource</code>.</li>
</ul><p>Also note that if auto-reconfiguration occurs, but you have customized the configuration of the service (such as the pool size or connection properties), Cloud Foundry ignores the customizations.</p>

<h2 id="opting-out-of-auto-reconfiguration">Opting Out of Auto-Reconfiguration</h2>

<p>Sometimes you may not want Cloud Foundry to auto-reconfigure your Spring application in the ways described in this section.  There are two ways to opt out:</p>

<ul>
<li>When you deploy your application using VMC or STS, specify that the framework is <code>JavaWeb</code> instead of <code>Spring</code>.  Note that in this case your application will not be able to take advantage of the Spring Profiles feature.</li>
  <li>Use the <code>&lt;cloud:&gt;</code> namespace elements in your Spring application context file to explicitly create a bean that represents a service.  This makes auto-reconfiguration unnecessary.  See <a href="#explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</a>.</li>
</ul><h2 id="explicitly-configuring-your-application-to-use-cloud-foundry-services">Explicitly Configuring Your Application to Use Cloud Foundry Services</h2>

<p>This section describes the simple configuration steps you must perform in your Spring applications so they can use the Cloud Foundry services.  See <a href="/frameworks.html">Configuring Applications to Use Cloud Foundry</a> for the complete list of supported Cloud Foundry services.</p>

<p>The easiest way to use Cloud Foundry services in your Spring applications is to declare the <code>&lt;cloud:&gt;</code> namespace, point it to the Cloud Foundry Schema, then use the service-specific elements defined in the <code>&lt;cloud&gt;</code> namespace.  For example, with just a single line of XML in your application context file you can create a JDBC data source or a RabbitMQ connection factory that you can use in your specific bean definitions.  You can configure multiple data sources or connection factories if your application requires it.   You can also further configure these cloud services if you want, although it is completely optional because Cloud Foundry uses common-place configuration values to create typical service instances that are adequate for most uses.  In sum, using the <code>&lt;cloud:&gt;</code> namespace provides you with as much control as you want over the number and type of Cloud Foundry services that your application uses.</p>

<p>The basic steps to update your Spring application to use any of the Cloud Foundry services are as follows:</p>

<ul>
<li>Update your application build process to include a dependency on the <code>org.cloudfoundry.cloudfoundry-runtime</code> artifact.  For example, if you use Maven to build your application, the following <code>pom.xml</code> snippet shows how to add this dependency:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.8.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- additional dependency declarations --&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>

<ul>
<li>Update your application build process to include the Spring Framework Milestone repository.  The following <code>pom.xml</code> snippet shows how to do this in Maven:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
          <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
           <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
           <span class="nt">&lt;snapshots&gt;</span>
                   <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
           <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>

    <span class="c">&lt;!-- additional repository declarations --&gt;</span>
<span class="nt">&lt;/repositories&gt;</span></code></pre>

<ul>
<li>In your Spring application, update all application context files that will include the Cloud Foundry service declarations, such as a data source, by adding the <code>&lt;cloud:&gt;</code> namespace declaration and the location of the Cloud Foundry services Schema, as shown in the following snippet:</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
        <span class="err">http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
        <span class="err">http://www.springframework.org/schema/context</span>
        <span class="err">http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
        <span class="err">http://schema.cloudfoundry.org/spring</span>
        <span class="err">http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
        <span class="nt">&gt;</span>

    <span class="c">&lt;!-- bean declarations --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<ul>
<li>
    <p>You can now specify the Cloud Foundry services in the Spring application context file by using the <code>&lt;cloud:&gt;</code> namespace along with the name of specific elements, such as <code>data-source</code>.  Cloud Foundry provides elements for each of the supported services:  database (MySQL and vFabric Postgres), Redis, MongoDB, and RabbitMQ.</p>

    <p>The following example shows a simple data source configuration that will be injected into a JdbcTemplate using the <code>&lt;cloud:data-source&gt;</code> element.</p>
  </li>
</ul><pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
    <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">        http://www.springframework.org/schema/context</span>
<span class="s">        http://www.springframework.org/schema/context/spring-context-3.1.xsd</span>
<span class="s">        http://schema.cloudfoundry.org/spring</span>
<span class="s">        http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">        &gt;</span>

<span class="s">    &lt;cloud:data-source id="</span><span class="err">dataSource"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

        <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>When you later deploy the application using VMC or STS, you bind a specific data service (such as MySQL or vFabric Postgres) to it and Cloud Foundry creates an instance of the service.  Note that in the example above, you did not specify typical data source properties such as <code>driverClassName</code> or <code>url</code> or <code>username</code> - this is because Cloud Foundry automatically takes care of those properties for you.</p>

<p>For complete information about all the <code>&lt;cloud:&gt;</code> elements you can use in your Spring application context file to access Cloud Foundry services, see the following sections:</p>

<ul>
<li><a href="#clouddata-source">&lt;cloud:data-source&gt;: Configure a JDBC Data Source for Either MySQL or vFabric Postgres Databases</a></li>
  <li><a href="#cloudmongo-db-factory">&lt;cloud:mongo-db-factory&gt;: Configure a MongoDB Connection Factory</a></li>
  <li><a href="#cloudredis-connection-factory">&lt;cloud:redis-connection-factory&gt;: Configure a Redis Connection Factory</a></li>
  <li><a href="#cloudrabbit-connection-factory">&lt;cloud:rabbit-connection-factory&gt;: Configure a RabbitMQ Connection Factory</a></li>
  <li><a href="#cloudservice-scan">&lt;cloud:service-scan&gt; Injecting Services Into @Autowired Beans </a></li>
  <li>
    <p><a href="#cloudproperties">&lt;cloud:properties&gt; Get Cloud Foundry Service Information</a></p>
  </li>
  <li>After you have finished specifying all the Cloud Foundry services you are going to use in your application, you use the standard Cloud Foundry client commands (VMC, SpringSource Tool Suite, or the Eclipse plugin) to create instances of these services, bind them to your applications, then deploy your applications to the hosted Cloud Foundry (cloudfoundry.com) or to your local Micro Cloud Foundry instance.  See <a href="/tools/deploying-apps.html">Deploying Applications</a> for details on how to use these tools.</li>
</ul><h2 id="clouddata-source">&lt;cloud:data-source&gt;</h2>

<p>The <code>&lt;cloud:data-source&gt;</code> element provides an easy way for you to configure a JDBC data source for your Spring application.    Later, when you actually deploy the application, you bind a particular database service instance to it, such as MySQL or vFabric Postgres.</p>

<p>The following example shows a simple way to configure a JDBC data source that will be injected into a <code>org.springframework.jdbc.core.JdbcTemplate</code> bean:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jdbcTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.core.JdbcTemplate"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, note that no specific information about the datasource is supplied, such as the JDBC driver classname, the specific URL to access the database, and the database users.  Instead, Cloud Foundry will take care of all of that at runtime, using appropriate information from the specific type of database service instance you bind to your application.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:data-source&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this data source.  The JdbcTemplate bean uses this ID when it references the data source. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the data source service. <br>You specify this attribute only if you are binding multiple database services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Data Source Configuration</strong></p>

<p>The section above showed how to configure a very simple JDBC data source; Cloud Foundry uses the most common configuration options when it actually creates the data source at runtime.  You can, however, specify some of these configuration options using the following two child elements of <code>&lt;cloud:data-source&gt;</code>:  <code>&lt;cloud:connection&gt;</code> and <code>&lt;cloud:pool&gt;</code>.</p>

<p>The <code>&lt;cloud:connection&gt;</code> child element takes a single String attribute (<code>properties</code>) that you use to specify connection properties you want to send to the JDBC driver when establishing new database connections.  The format of the string must be semi-colon separated name/value pairs  (<code>[propertyName=property;]</code>).</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced data source configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:data-source</span> <span class="na">id=</span><span class="s">"mydatasource"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:connection</span> <span class="na">properties=</span><span class="s">"charset=utf-8"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:data-source&gt;</span></code></pre>

<p>In the preceding example, the JDBC driver is passed the property that specifies that it should use the UTF-8 character set.  The minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the JDBC connection pool throws an exception.</p>

<h2 id="cloudmongo-db-factory-">&lt;cloud:mongo-db-factory &gt;</h2>

<p>The <code>&lt;cloud:mongo-db-factory&gt;</code> provides a simple way for you to configure a MongoDB connection factory for your Spring application.</p>

<p>The following example shows a MongoDbFactory configuration that will be injected into a <code>org.springframework.data.mongodb.core.MongoTemplate</code> object:</p>

<pre><code class="language-xml"><span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:mongo-db-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this MongoDB connection factory.  The MongoTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the MongoDB service. <br>You specify this attribute only if you are binding multiple MongoDB services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>write-concern</td>
   <td>Controls the behavior of writes to the data store.  The values of this attribute correspond to the values of the `com.mongodb.WriteConcern` class.
   <p>If you do not specify this attribute, then no `WriteConcern` is set for the database connections and all writes default to NORMAL.  </p>
   <p>The possible values for this attribute are as follows:</p>
	<ul>
<li>
<b>NONE</b>: No exceptions are raised, even for network issues.</li>
	  <li>
<b>NORMAL</b>: Exceptions are raised for network issues, but not server errors.</li>
	  <li>
<b>SAFE</b>: MongoDB service waits on a server before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	  <li>
<b>FSYNC_SAVE</b>: MongoDB service waits for the server to flush the data to disk before performing a write operation.  Exceptions are raised for both network and server errors.</li>
	</ul>
</td>
   <td>String</td>
 </tr>
</table><h2 id="advanced-mongodb-configuration">Advanced MongoDB Configuration</h2>

<p>The preceding section shows how to configure a simple MongoDB connection factory using default values for the options.   This is adequate for many environments.  However, you can further configure the connection factory by specifying the optional <code>&lt;cloud:mongo-options&gt;</code> child element of <code>&lt;cloud:mongo-db-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:mongo-options&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>connections-per-host</td>
   <td>Specifies the maximum number of connections allowed per host for the MongoDB instance. Those connections will be kept in a pool when idle. Once the pool is exhausted, any operation requiring a connection will block while waiting for an available connection.</td>
   <td>int</td>
   <td>10</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>Specifies the maximum wait time (in milliseconds) that a thread waits for a connection to become available.</td>
   <td>int</td>
   <td>120,000 (2 minutes)</td>
 </tr>
</table><p>The following example shows how to use the advanced MongoDB options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">write-concern=</span><span class="s">"FSYNC_SAFE"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:mongo-options</span> <span class="na">connections-per-host=</span><span class="s">"12"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:mongo-db-factory&gt;</span></code></pre>

<p>In the preceding example, the maximum number of connections is set to 12 and the maximum amount of time that a thread waits for a connection is 1 second.  The WriteConcern is also specified to be the safest possible (<code>FSYNC_SAFE</code>).</p>

<h2 id="cloudredis-connection-factory-">&lt;cloud:redis-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:redis-connection-factory&gt;</code> provides a simple way for you to configure a Redis connection factory for your Spring application.</p>

<p>The following example shows a <code>RedisConnectionFactory</code> configuration that will be injected into a <code>org.springframework.data.redis.core.StringRedisTemplate</code> object:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"redisConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"redisTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.redis.core.StringRedisTemplate"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection-factory"</span> <span class="na">ref=</span><span class="s">"redisConnectionFactory"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:redis-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this Redis connection factory.  The RedisTemplate bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the Redis service. <br>You specify this attribute only if you are binding multiple Redis services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced Redis Configuration</strong></p>

<p>The preceding section shows how to configure a very simple Redis connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:pool&gt;</code> child element of <code>&lt;cloud:redis-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:pool&gt;</code> child element takes the following two attributes:</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
   <th>Default</th>
 </tr>
<tr>
<td>pool-size</td>
   <td>Specifies the size of the connection pool.  Set the value to either the maximum number of connections in the pool, or a range of the minimum and maximum number of connections separated by a dash.</td>
   <td>int</td>
   <td>Default minimum is 0.  Default maximum is 8. These are the same defaults as the Apache Commons Pool.</td>
 </tr>
<tr>
<td>max-wait-time</td>
   <td>In the event that there are no available connections, this attribute specifies the maximum number of milliseconds that the connection pool waits for a connection to be returned before throwing an exception. Specify `-1` to indicate that the connection pool should wait forever. </td>
   <td>int</td>
   <td>Default value is `-1` (forever).</td>
 </tr>
</table><p>The following example shows how to use these advanced Redis configuration options:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:redis-connection-factory</span> <span class="na">id=</span><span class="s">"myRedisConnectionFactory"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cloud:pool</span> <span class="na">pool-size=</span><span class="s">"5-10"</span> <span class="na">max-wait-time=</span><span class="s">"2000"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cloud:redis-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the minimum and maximum number of connections in the pool at any given time is 5 and 10, respectively.  The maximum amount of time that the connection pool waits for a returned connection if there are none available is 2000 milliseconds (2 seconds), after which the Redis connection pool throws an exception.</p>

<h2 id="cloudrabbit-connection-factory-">&lt;cloud:rabbit-connection-factory &gt;</h2>

<p>The <code>&lt;cloud:rabbit-connection-factory&gt;</code> provides a simple way for you to configure a RabbitMQ connection factory for your Spring application.</p>

<p>The following complete example of a Spring application contenxt file shows a <code>RabbitConnectionFactory</code> configuration that will be injected into a <code>rabbitTemplate</code> object.  The example also uses the <code>&lt;rabbit:&gt;</code> namespace to perform RabbitMQ-specific configurations, as explained after the example:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xmlns:rabbit=</span><span class="s">"http://www.springframework.org/schema/rabbit"</span>
       <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/mvc   http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">           http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd</span>
<span class="s">           http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd"</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Obtain a connection to the RabbitMQ via cloudfoundry-runtime: --&gt;</span>
    <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Set up the AmqpTemplate/RabbitTemplate: --&gt;</span>
    <span class="nt">&lt;rabbit:template</span> <span class="na">id=</span><span class="s">"rabbitTemplate"</span>
        <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Request that queues, exchanges and bindings be automatically declared on the broker: --&gt;</span>
    <span class="nt">&lt;rabbit:admin</span> <span class="na">connection-factory=</span><span class="s">"rabbitConnectionFactory"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Declare the "messages" queue: --&gt;</span>
    <span class="nt">&lt;rabbit:queue</span> <span class="na">name=</span><span class="s">"messages"</span> <span class="na">durable=</span><span class="s">"true"</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the preceding example, note the definition and location of the <code>&lt;rabbit:&gt;</code> namespace at the top of the XML file.  This namespace is then used to configure RabbitTemplate and RabbitAdmin objects as the main entry points to Spring AMQP and to declare a queue called <code>messages</code> within the RabbitMQ broker.</p>

<p>See <a href="#rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</a> for additional information about using RabbitMQ in your Spring applications.</p>

<p><strong>Attributes</strong></p>

<p>The following table lists the attributes of the <code>&lt;cloud:rabbit-connection-factory&gt;</code> element.</p>

<table class="std">
<tr>
<th>Attribute</th>
   <th>Description</th>
   <th>Type</th>
 </tr>
<tr>
<td>id</td>
   <td>The ID of this RabbitMQ connection factory.  The RabbitTempalte bean uses this ID when it references the connection factory. <br>Default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
<tr>
<td>service-name</td>
   <td>The name of the RabbitMQ service. <br>You specify this attribute only if you are binding multiple RabbitMQ services to your application and you want to specify which particular service instance binds to a particular Spring bean.  The default value is the name of the bound service instance.</td>
   <td>String</td>
 </tr>
</table><p><strong>Advanced RabbitMQ Configuration</strong></p>

<p>The preceding section shows how to configure a very simple RabbitMQ connection factory; Cloud Foundry uses the most common configuration options when it actually creates the factory at runtime.  You can, however, change some of these configuration options using the<code>&lt;cloud:rabbit-options&gt;</code> child element of <code>&lt;cloud:rabbit-connection-factory&gt;</code>.</p>

<p>The <code>&lt;cloud:rabbit-options&gt;</code> child element defines one attribute called <code>channel-cache-size</code> which you can set to specify the size of the channel cache size.  The default value is 1.</p>

<p>The following example shows how to use these advanced RabbitMQ configuration options:</p>

<pre><code class="language-xml">        <span class="nt">&lt;cloud:rabbit-connection-factory</span> <span class="na">id=</span><span class="s">"rabbitConnectionFactory"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;cloud:rabbit-options</span> <span class="na">channel-cache-size=</span><span class="s">"10"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/cloud:rabbit-connection-factory&gt;</span></code></pre>

<p>In the preceding example, the channel cache size of the RabbitMQ connection factory is set to 10.</p>

<h2 id="cloudservice-scan">&lt;cloud:service-scan&gt;</h2>

<p>The <code>&lt;cloud:service-scan&gt;</code> element scans all services bound to the application and creates a Spring bean of an appropriate type for each one that has been annoted with the <code>@org.springframework.beans.factory.annotation.Autowired</code> annotation.  The <code>&lt;cloud:service-scan&gt;</code> element acts as a cloud equivalent of <code>&lt;context:component-scan&gt;</code> in core Spring, which scans the CLASSPATH for beans with certain annotations and creates a bean for each.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> is especially useful during the initial phases of application development, because you can get immediate access to service beans without explicitly adding a <code>&lt;cloud:&gt;</code> element to your Spring application context file for each new service that you bind.</p>

<p>The <code>&lt;cloud:service-scan&gt;</code> element has no attributes or child elements; for example:</p>

<pre><code class="language-xml">         <span class="nt">&lt;cloud:service-scan</span> <span class="nt">/&gt;</span></code></pre>

<p>In your Java code, you must annotate each dependency with <code>@Autowired</code> so that a bean of the corresponding service is automatically created.  For example:</p>

<pre><code class="language-java">  <span class="kn">package</span> <span class="n">cf</span><span class="o">.</span><span class="na">examples</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

  <span class="o">....</span>

  <span class="nd">@Autowired</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">ConnectionFactory</span> <span class="n">rabbitConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">RedisConnectionFactory</span> <span class="n">redisConnectionFactory</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="n">MongoDbFactory</span> <span class="n">mongoDbFactory</span><span class="o">;</span>

  <span class="o">...</span></code></pre>

<p>Use of only the <code>@Autowired</code> annotation is adequate if you have bound only <em>one</em> service of each service type to your application.  If you bind more than one (for example, you bind two different MySQL service instances to the same application) then you must also use the <code>@Qualifier</code> annotation to match the Spring bean with the specific service instance.</p>

<p>For example, assume you bound two MySQL services (named <code>inventory-db</code> and <code>pricing-db</code>) to your application; use the <code>@Qualifier</code> annotation as shown in the following example to specify which service instance applies to which Spring bean:</p>

<pre><code class="language-java">  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"inventory-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">inventoryDataSource</span><span class="o">;</span>
  <span class="nd">@Autowired</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"pricing-db"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">pricingDataSource</span><span class="o">;</span></code></pre>

<h2 id="cloudproperties">&lt;cloud:properties&gt;</h2>

<p>The <code>&lt;cloud:properties&gt;</code> element exposes basic information about the application and its bound services as properties.  Your application can then consume these properties using the Spring property placeholder support.</p>

<p>The <code>&lt;cloud:properties&gt;</code> element has just a single attribute (<code>id</code>) which specifies the name of the Properties bean.  Use this ID as a reference to <code>&lt;context:property-placeholder&gt;</code> which you can use to hold all the properties exposed by Cloud Foundry.  You can then use these properties in your other bean defintions.</p>

<p>Note that if you are using Spring Framework 3.1 (or later), these properties are automatically available without having to include <code>&lt;cloud:properties&gt;</code> in your application context file.</p>

<p>The following example shows how to use this element in your Spring application context file:</p>

<pre><code class="language-xml">    <span class="nt">&lt;cloud:properties</span> <span class="na">id=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;context:property-placeholder</span> <span class="na">properties-ref=</span><span class="s">"cloudProperties"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span>
                  <span class="na">value=</span><span class="s">"${cloud.services.mysql.connection.username}"</span> <span class="nt">/&gt;</span>
    ...
    <span class="nt">&lt;/bean&gt;</span></code></pre>

<p>In the preceding example, <code>cloud.services.mysql.connection.username</code> is one of the properties exposed by Cloud Foundry.</p>

<p>For a complete list of properties exposed by Cloud Foundry, as well as a more detailed example, see <a href="#accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</a>.</p>

<h2 id="rabbitmq-and-spring-additional-programming-information">RabbitMQ And Spring: Additional Programming Information</h2>

<p>This section provides additional information about using RabbitMQ in your Spring applications that you deploy to Cloud Foundry. This section is not intended to be a complete tutorial on RabbitMQ and Spring; for that, see the following resources:</p>

<ul>
<li>
<a href="http://www.rabbitmq.com/getstarted.html">RabbitMQ Tutorials</a>, cover the basics of creating messaging in your applications.</li>
  <li>
<a href="http://www.rabbitmq.com/download.html">Download</a>, <a href="http://www.rabbitmq.com/install.html">install</a> and <a href="http://www.rabbitmq.com/configure.html">configure</a> RabbitMQ</li>
  <li><a href="http://static.springsource.org/spring-amqp/docs/1.0.x/reference/html/">Spring AMPQ reference documentation</a></li>
</ul><p>The RabbitMQ service is accessed through the <a href="http://www.amqp.org/">AMQP protocol</a> (versions 0.8 and 0.9.1) and your application will need access to a AMQP client library in order to use the service. The Spring AMQP project enables AMQP applications to be built using Spring constructs.</p>

<p>The following sample <code>pom.xml</code> file shows RabbitMQ dependencies and repositories in addition to the <code>cloudfoundry-runtime</code> dependency described above:</p>

<pre><code class="language-xml">    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
              <span class="nt">&lt;id&gt;</span>org.springframework.maven.milestone<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>Spring Maven Milestone Repository<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>http://maven.springframework.org/milestone<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                       <span class="nt">&lt;enabled&gt;</span>false<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cglib-nodep<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.amqp<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0.0.RC2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.cloudfoundry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloudfoundry-runtime<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>0.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span></code></pre>

<p>Then update your application controller/logic as follows:</p>

<ul>
<li>Include the messaging libraries:</li>
</ul><pre><code class="language-java">   <span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
   <span class="kn">import</span> <span class="nn">org.springframework.amqp.core.AmqpTemplate</span><span class="o">;</span></code></pre>

<ul>
<li>Read and write messages as shown in the following Java code snippets:</li>
</ul><pre><code class="language-java">   <span class="nd">@Controller</span>
   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>
       <span class="nd">@Autowired</span> <span class="n">AmqpTemplate</span> <span class="n">amqpTemplate</span><span class="o">;</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/"</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">());</span>
           <span class="k">return</span> <span class="s">"WEB-INF/views/home.jsp"</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/publish"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">publish</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">Message</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Send a message to the "messages" queue</span>
           <span class="n">amqpTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"messages"</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
           <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"published"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/get"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
           <span class="c1">// Receive a message from the "messages" queue</span>
           <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">amqpTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">(</span><span class="s">"messages"</span><span class="o">);</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
           <span class="k">else</span>
               <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"got_queue_empty"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

           <span class="k">return</span> <span class="nf">home</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
   <span class="o">}</span></code></pre>

<h2 id="using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</h2>

<p>The preceding sections describe how to use the <code>&lt;cloud:&gt;</code> namespace to easily configure services (such as data sources and RabbitMQ connection factories) for Spring applications deployed to Cloud Foundry.   However, you might not always want to deploy your applications to Cloud Foundry; for example, you might sometimes want to use a local environment to test the application during iterative development.  In this case, it would be useful to <em>conditionalize</em> the application configuration so that only specific fragments are activated when a certain condition is true.   Setting up such conditionalized configuration makes your application portable to many different environments so that you do not have to manually change the configuration when you deploy it to, for example, your local environment and then to Cloud Foundry.   To enable this, use the Spring <em>profiles</em> feature, available in Spring Framework 3.1 or later.</p>

<p>The basic idea is that you group the configuration for a specific environment using the <code>profile</code> attribute of a nested <code>&lt;beans&gt;</code> element in the appropriate Spring application context file.  You can create your own custom profiles, but the ones that are most relevant in the context of Cloud Foundry are <code>default</code> and <code>cloud</code>.</p>

<p>When you deploy a Spring application to Cloud Foundry, Cloud Foundry automatically enables the <code>cloud</code> profile. This allows for a pre-defined, convenient location for Cloud Foundry-specific application configuration. You should then group all specific usages of the <code>&lt;cloud:&gt;</code> namespace within the <code>cloud</code> profile block to allow the application to run outside of Cloud Foundry environments.  You then use the <code>default</code> profile (or a custom profile) to group the non-Cloud Foundry configuration that will be used if you deploy your application to a non-Cloud Foundry environment.</p>

<p>Here is an example of a Spring <code>MongoTemplate</code> being populated from two alternately configured connection factories. When running on Cloud Foundry (<code>cloud</code> profile), the connection factory is automatically configured. When not running on Cloud Foundry (<code>default</code> profile), the connection factory is manually configured with the connection settings to a running MongoDB instance.</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>
        <span class="na">xmlns:jdbc=</span><span class="s">"http://www.springframework.org/schema/jdbc"</span>
        <span class="na">xmlns:util=</span><span class="s">"http://www.springframework.org/schema/util"</span>
        <span class="na">xmlns:mongo=</span><span class="s">"http://www.springframework.org/schema/data/mongo"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/data/mongo</span>
<span class="s">          http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd</span>
<span class="s">          http://www.springframework.org/schema/jdbc</span>
<span class="s">          http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd</span>
<span class="s">          http://schema.cloudfoundry.org/spring</span>
<span class="s">          http://schema.cloudfoundry.org/spring/cloudfoundry-spring.xsd</span>
<span class="s">          http://www.springframework.org/schema/beans</span>
<span class="s">          http://www.springframework.org/schema/beans/spring-beans-3.1.xsd</span>
<span class="s">          http://www.springframework.org/schema/util</span>
<span class="s">          http://www.springframework.org/schema/util/spring-util-3.1.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mongoTemplate"</span> <span class="na">class=</span><span class="s">"org.springframework.data.mongodb.core.MongoTemplate"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"default"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;mongo:db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="na">dbname=</span><span class="s">"pwdtest"</span> <span class="na">host=</span><span class="s">"127.0.0.1"</span> <span class="na">port=</span><span class="s">"27017"</span> <span class="na">username=</span><span class="s">"test_user"</span> <span class="na">password=</span><span class="s">"efgh"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

        <span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
           <span class="nt">&lt;cloud:mongo-db-factory</span> <span class="na">id=</span><span class="s">"mongoDbFactory"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/beans&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>Note that the <code>&lt;beans profile="value"&gt;</code> element is nested inside the standard root <code>&lt;beans&gt;</code> element.  The MongoDB connection factory in the <code>cloud</code> profile uses the <code>&lt;cloud:&gt;</code> namespace, the connection factory configuration in the <code>default</code> profile uses the <code>&lt;mongo:&gt;</code> namespace.   You can now deploy this application to the two different environments without making any manual changes to its configuration when you switch from one to the other.</p>

<p>See the <a href="http://blog.springsource.com/2011/02/11/spring-framework-3-1-m1-released/">SpringSource Blog</a> for additional information about using Spring Profiles, a new feature in Spring Framework 3.1.</p>

<h2 id="sending-email-from-spring-applications-deployed-to-cloud-foundry">Sending Email From Spring Applications Deployed to Cloud Foundry</h2>

<p>In order to prevent spam and other abuse, SMTP is blocked from applications running in Cloud Foundry.  However, your applications can still send email when deployed to Cloud Foundry, as described in this section.</p>

<p>Service providers, such as <a href="http://sendgrid.com">SendGrid</a>, can send email on your behalf via HTTP web services, which is an option you can use when deploying your application to Cloud Foundry.  If, however, you also run your application inside your datacenter, you might want to use your corporate SMTP servers in that case.  This is a good example of using <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Spring Profiles</a> to conditionalize how your application sends email, depending on where exactly the application happens to be deployed.  This makes your application portable to different environments without you having to manually update its configuration.</p>

<p>The following snippet of a Spring application context shows how to specify that your application should use SendGrid to send email when the application is running in Cloud Foundry; note the use of the <code>cloud</code> profile:</p>

<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span>  <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xmlns:cloud=</span><span class="s">"http://schema.cloudfoundry.org/spring"</span>

    <span class="err">...</span>

    <span class="err">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;bean</span> <span class="na">name=</span><span class="s">"mailSender"</span> <span class="na">class=</span><span class="s">"example.SendGridMailSender"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiUser"</span> <span class="na">value=</span><span class="s">"youremail@domain.com"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"apiKey"</span> <span class="na">value=</span><span class="s">"secureSecret"</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/beans&gt;</span>

   ...

    <span class="c">&lt;!-- additional beans in your application --&gt;</span>

<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>In the example, <code>example.SendGridMailSender</code> is the Spring bean that sends email using the SendGrid service provider; however, this bean will only be activated when your application is deployed to Cloud Foundry.  If your application is actually running inside your datacenter, then your default email server is used.</p>

<h2 id="accessing-cloud-foundry-properties">Accessing Cloud Foundry Properties</h2>

<p>Cloud Foundry exposes a number of application and service properties directly into its deployed applications.  Your deployed application can in turn consume these properties.   The properties exposed by Cloud Foundry include basic information about the application, such as its name and the Cloud provider, and detailed connection information for all services currently bound to the application.</p>

<p>Service properties generally take one of the following forms:</p>

<pre><code>    cloud.services.{service-name}.connection.{property}
    cloud.services.{service-name}.{property}
</code></pre>

<p>where <code>{service-name}</code> refers to the name you gave the service when you bound it to your application at deploy time.  The specific connection properties that are available depend on the type of service; see the table at the end of this section for the complete list.</p>

<p>For example, assume that in VMC you created a vFabric Postgres service called <code>my-postgres</code> and then bound it to your application; Cloud Foundry exposes the following properties about this service that your application in turn can consume:</p>

<pre><code>    cloud.services.my-postgres.connection.host
    cloud.services.my-postgres.connection.hostname
    cloud.services.my-postgres.connection.name
    cloud.services.my-postgres.connection.password
    cloud.services.my-postgres.connection.port
    cloud.services.my-postgres.connection.user
    cloud.services.my-postgres.connection.username
    cloud.services.my-postgres.plan
    cloud.services.my-postgres.type
</code></pre>

<p>For convenience, if you have bound just <em>one</em> service of a given type to your application, Cloud Foundry creates an alias based on the service type instead of the service name. For example, if only one MySQL service is bound to an application, the properties will take the form <code>cloud.services.mysql.connection.{property}</code>.   Cloud Foundry uses the following aliases in this case:</p>

<ul>
<li><code>mysql</code></li>
  <li><code>mongodb</code></li>
  <li><code>postgresql</code></li>
  <li><code>rabbitmq</code></li>
  <li><code>redis</code></li>
</ul><p>If you want to use these Cloud Foundry properties in your application, use a Spring property placholder inside of a <code>cloud</code> profile; Spring profiles are briefly described in <a href="#using-spring-profiles-to-conditionalize-cloud-foundry-configuration">Using Spring Profiles to Conditionalize Cloud Foundry Configuration</a>.</p>

<p>For example, assume that you have bound a MySQL service called <code>spring-mysql</code> to your application, but your application requires a c3p0 connection pool instead of the connection pool provided by Cloud Foundry.   But you still want to use the same connection properties defined by Cloud Foundry for the MySQL service, in particular the username and password and JDBC URL.  The following Spring application context snippet shows how you might implement this:</p>

<pre><code class="language-xml"><span class="nt">&lt;beans</span> <span class="na">profile=</span><span class="s">"cloud"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"c3p0DataSource"</span> <span class="na">class=</span><span class="s">"com.mchange.v2.c3p0.ComboPooledDataSource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"com.mysql.jdbc.Driver"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span>
                <span class="na">value=</span><span class="s">"jdbc:mysql://${cloud.services.spring-mysql.connection.host}:${cloud.services.spring-mysql.connection.port}/${cloud.services.spring-mysql.connection.name}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.username}"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${cloud.services.spring-mysql.connection.password}"</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>

<p>The following table lists all the application and service properties that Cloud Foundry exposes to deployed applications.  In the property names, <code>{service-name}</code> refers to the actual name of the bound service.</p>

<table class="std">
<tr>
<th>Property</th>
   <th>Associated Service Type</th>
   <th>Description</th>
 </tr>
<tr>
<td>cloud.application.name</td>
   <td>Not applicable.</td>
   <td>The name of the application.</td>
 </tr>
<tr>
<td>cloud.provider.url</td>
   <td>Not applicable.</td>
   <td>The URL of the cloud hosting your application, such as <tt>cloudfoundry.com</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.db</td>
   <td>MongoDB</td>
   <td>Name of the database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MongoDB</td>
   <td>Name or IP address of the host on which the MongoDB server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MongoDB</td>
   <td>Password of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MongoDB</td>
   <td>Listen port of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MongoDB</td>
   <td>Name of the user that connects to the MongoDB database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MongoDB</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MongoDB</td>
   <td>Name and version of the MongoDB server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>MySQL</td>
   <td>Name of the MySQL database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>MySQL</td>
   <td>Name or IP address of the host on which the MySQL server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>MySQL</td>
   <td>Listen port of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>MySQL</td>
   <td>Name of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>MySQL</td>
   <td>Password of the user that connects to the MySQL database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>MySQL</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>MySQL</td>
   <td>Name and version of the MySQL server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>vFabric Postgres</td>
   <td>Name of the vFabric Postgres database that Cloud Foundry created.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>vFabric Postgres</td>
   <td>Name or IP address of the host on which the vFabric Postgres server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>vFabric Postgres</td>
   <td>Listen port of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.user</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.username</td>
   <td>vFabric Postgres</td>
   <td>Name of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>vFabric Postgres</td>
   <td>Password of the user that connects to the vFabric Postgres database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>vFabric Postgres</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>vFabric Postgres</td>
   <td>Name and version of the vFabric Postgres server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.url</td>
   <td>RabbitMQ</td>
   <td>URL used to connect to the AMPQ broker.  URL includes the host, port, username, and so on.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>RabbitMQ</td>
   <td>Pay plan for the service, such as <tt>free.
 
 <tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>RabbitMQ</td>
   <td>Name and version of the RabbitMQ server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.host</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.hostname</td>
   <td>Redis</td>
   <td>Name or IP address of the host on which the Redis server is running.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.port</td>
   <td>Redis</td>
   <td>Listen port of the Redis server.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.name</td>
   <td>Redis</td>
   <td>Name of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.connection.password</td>
   <td>Redis</td>
   <td>Password of the user that connects to the Redis database.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.plan</td>
   <td>Redis</td>
   <td>Pay plan for the service, such as <tt>free</tt>.</td>
 </tr>
<tr>
<td>cloud.services.{<i>service-name</i>}.type</td>
   <td>Redis</td>
   <td>Name and version of the Redis server.</td>
 </tr></tt>
</td>
</tr></tt>
</td>
</tr>
</table>;T;@çI"5/frameworks/java/spring/spring_tutorial_pramati/;T{;{	;I"?<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring_tutorial_pramati.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-09-24
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A Cloud Foundry plugin for STS.</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take the following user case.</p>

<p>Create and Deploy an Expense Reporting App on Cloud Foundry.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#create-spring-mvc-template-project">Create Spring MVC Template Project</a></li>
  <li><a href="#expensereport-app">ExpenseReport App</a></li>
  <li><a href="#add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</a></li>
  <li><a href="#build-and-run-the-app-locally">Build and Run the App Locally</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</a></li>
</ul><h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>

<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -&gt; Dashboard.</p>

<p>From the dashboard view select Spring Template Project.This will open like this.
<img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS might ask you to download some extra elements from the Internet. 
<img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project a name and a top-level package:</p>

<p>Click on finish â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed,STS will open the home page for the project which displays Hello world message with the current server time.
<img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<h2 id="expensereport-app">ExpenseReport App</h2>

<p>ExpenseReport is used to create and manage expenses.</p>

<p>In our expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in underlying PostgreSQl database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>postgresql-9.1-901.jdbc4.jar</li>
  <li>hibernate-envers-3.5.0-Final.jar</li>
  <li>commons-fileupload-1.2.1.jar</li>
  <li>commons-io-1.3.jar</li>
</ul><h2 id="add-entities">Add Entities</h2>

<p>For our application we need to add Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties
and annotate your business class with @Entity. By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property. Create a package for entities as com.springsource.html5expense.model and add all entities.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Cascade</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.CascadeType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="nd">@Cascade</span><span class="o">(</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">DELETE_ORPHAN</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Expense</span><span class="o">(){</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Expense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="n">State</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">state</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseType</span><span class="o">(</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">getAmount</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">amount</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getExpenseDate</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseDate</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachment</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Attachment</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
	


	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
	
	<span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"org.hibernate.type.BinaryType"</span><span class="o">)</span> 
	<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">contentType</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">contentType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentType</span><span class="o">(</span><span class="n">String</span> <span class="n">contentType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
	<span class="o">}</span>
	
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileNmae</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileNmae</span><span class="o">(</span><span class="n">String</span> <span class="n">fileNmae</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileNmae</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(){</span>
		
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">contentType</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseReport</span> <span class="o">{</span>
	
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">;</span>
	
	
	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">Expense</span> <span class="n">expense</span><span class="o">;</span>
	
	<span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(){</span>
		
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getExpenseReportId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseReportId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseReportId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseReportId</span> <span class="o">=</span> <span class="n">expenseReportId</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpense</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseType</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	
	
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">roleId</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="n">Long</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoleName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleName</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleName</span> <span class="o">=</span> <span class="n">roleName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">roleName</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>

	<span class="n">NEW</span><span class="o">,</span>
	
	<span class="n">OPEN</span><span class="o">,</span>
	
	<span class="n">IN_REVIEW</span><span class="o">,</span>
	
	<span class="n">REJECTED</span><span class="o">,</span>
	
	<span class="n">APPROVED</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USERS"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">emailId</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">enabled</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">Role</span> <span class="n">role</span><span class="o">;</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">role</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRole</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">enabled</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserId</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">password</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmailId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">emailId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmailId</span><span class="o">(</span><span class="n">String</span> <span class="n">emailId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">emailId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

	<span class="o">}</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">mailId</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="create-controller-classes">Create controller classes</h2>

<p>Controller is reponsible for mapping the request.create methods to map the URL request. Create a package for controllers as com.springsource.html5expense.controller and add the following controller classes.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>


	<span class="nd">@Autowired</span>
	<span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

	<span class="nd">@Autowired</span> 
	<span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

	<span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/deleteExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">deleteExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/editExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">editExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expense"</span><span class="o">,</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"isEdit"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/changeState"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">changeState</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"action"</span><span class="o">);</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">changeExpenseStatus</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">action</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/updateExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"expense Id "</span><span class="o">+</span><span class="n">expenseTypeVal</span><span class="o">);</span>
		<span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">getExpenseTypeService</span><span class="o">().</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
		<span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">updateExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">description</span><span class="o">,</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">),</span><span class="n">expenseType</span><span class="o">);</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpenseReport"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpenseReport</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
		<span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
		<span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
		<span class="n">Date</span> <span class="n">expenseDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
		<span class="n">Double</span> <span class="n">amountVal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
		<span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
			<span class="k">try</span><span class="o">{</span>
                            <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                            <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span>  <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
                            <span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">.</span><span class="na">createExpense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span>
    				<span class="n">amountVal</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
			<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>

			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpense"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpense</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>

		<span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.FileCopyUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>



<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileAttachmentController</span> <span class="o">{</span>

	    <span class="nd">@Autowired</span>
	    <span class="kd">private</span> <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

	    <span class="nd">@Autowired</span>
	    <span class="kd">private</span> <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

	    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	    <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
	        <span class="k">try</span> <span class="o">{</span>

	            <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
	            <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
	            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
	            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
	        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
	        <span class="o">}</span>
	        <span class="k">return</span> <span class="s">"redirect:/index.html"</span><span class="o">;</span>
	    <span class="o">}</span>

	    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/download"</span><span class="o">)</span>
	    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
	    	<span class="n">String</span> <span class="n">attachmentId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attachmentId"</span><span class="o">);</span>
	    	         <span class="n">Attachment</span>  <span class="n">attachment</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span><span class="o">.</span><span class="na">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">));</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">attachment</span><span class="o">.</span><span class="na">getFileName</span><span class="o">()</span> <span class="o">+</span><span class="s">"\""</span><span class="o">);</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"cache-control"</span><span class="o">,</span> <span class="s">"must-revalidate"</span><span class="o">);</span>
	    	         <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
	    	         <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
	    	         <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

	    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"></code></pre>

<h2 id="add-service-interfaces">Add Service Interfaces</h2>

<p>Add ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttachmentService</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseReportService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expensReportId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">();</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseTypeService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RoleService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">);</span>

<span class="o">}</span></code></pre>

<h2 id="configuring-spring-application">Configuring Spring application:</h2>

<p>To make our application ready we have to configure our application. Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation. To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.map.HashedMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ImportResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.SimpleDriverDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaDialect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.FileAttachmentController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.LoginController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>


	<span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setPersistenceUnitName</span><span class="o">(</span><span class="s">"sample"</span><span class="o">);</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
	    <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
	<span class="o">{</span>
		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">map</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaAdapter</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">POSTGRESQL</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setGenerateDdl</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
	    <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
	        <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>

	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
	    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">jpaProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
	    <span class="n">jpaProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"transactionTimeout"</span><span class="o">,</span><span class="s">"43200"</span><span class="o">);</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>

	    <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multiPartResolver</span><span class="o">(){</span>
		<span class="n">CommonsMultipartResolver</span> <span class="n">multiPartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
		<span class="n">multiPartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">multiPartResolver</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodReturnValueHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.ExpenseController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">ComponentConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"/config.properties"</span><span class="o">)</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span>
 <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${debug}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">debug</span><span class="o">;</span>

    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">baseNames</span> <span class="o">=</span> <span class="s">"messages,errors"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="n">ResourceBundleMessageSource</span> <span class="n">resourceBundleMessageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">resourceBundleMessageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="n">baseNames</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resourceBundleMessageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertySourcesPlaceholderConfigurer</span> <span class="nf">placeholderConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PropertySourcesPlaceholderConfigurer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addReturnValueHandlers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodReturnValueHandler</span><span class="o">&gt;</span> <span class="n">returnValueHandlers</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>


<span class="o">}</span></code></pre>

<p>To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.</p>
<pre><code class="language-java">		<span class="n">AnnotationConfigWebApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigWebApplicationContext</span><span class="o">();</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">setServletContext</span><span class="o">(</span><span class="n">sc</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span></code></pre>

<h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>

<p>This section provides how to get integrate ExpenseReport App with Spring Security.
Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>

<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in the web.xml</p>
  </li>
  <li>
    <p>Declare a custom XML config named spring-security.xml</p>
  </li>
</ol><p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>
<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<pre><code class="language-xml"><span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/index.jsp"</span> <span class="na">access=</span><span class="s">"hasAnyRole		('ROLE_USER','ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/welcome"</span>
			<span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/http&gt;</span></code></pre>

<p>Create Logincontroller and add the mapping for login,logout,loginfailed.</p>

<p>Define dataSource bean,to get database connection</p>
<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.SimpleDriverDataSource"</span><span class="nt">&gt;</span>
 
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"org.postgresql.Driver"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:postgresql://192.168.6.30:5432/postgres"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="err">/</span></code></pre>

<p>In Spring Security configuration file,add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;authentication-manager&gt;</span>
	   <span class="nt">&lt;authentication-provider&gt;</span>
		<span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
		   <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">		      select username,password, enabled </span>
<span class="s">		      from users where username=?"</span> 
 
		   <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">		      select u.username, ur.authority from users u, user_roles ur </span>
<span class="s">		      where u.user_id = ur.user_id and u.username =?  "</span> 
 
		<span class="nt">/&gt;</span>
	   <span class="nt">&lt;/authentication-provider&gt;</span>
	<span class="nt">&lt;/authentication-manager&gt;</span></code></pre>

<p>To load this file as part of configuration add @ImportResource({ â€œclasspath:spring-security.xmlâ€}). in ComponentConfig class.</p>

<p>create custom login.jsp with two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>

<pre><code>  Now we have successfully created expensereport application.we can run the application in locally to test it.STS has Fabric tc server,select and add your project to server now click finish. ![STS Fabric Server.png](/images/spring_tutorial/localhost_login.png)
</code></pre>

<p>Once server starts completed,STS will open the home page for the project which dispalys login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="spring-expensereport-login.png"></p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="spring-expensereport-create_expense.png"></p>

<p><img src="/images/spring_tutorial/my_expense.png" alt="spring-expensereport-user_expense.png"></p>

<h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
<img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
<img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
<img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
<img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
<img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
<img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"â›This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.


Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Spring Tool Suiteâ„¢ (STS)](http://www.springsource.org/spring-tool-suite-download) installation

+  A Cloud Foundry plugin for STS.


## Introduction

In this tutorial, we take the following user case.

Create and Deploy an Expense Reporting App on Cloud Foundry.

## Subtopics

+ [Create Spring MVC Template Project](#create-spring-mvc-template-project)
+ [ExpenseReport App](#expensereport-app)
+ [Add Spring Security to ExpenseReport App](#add-spring-security-to-expensereport-app)
+ [Build and Run the App Locally](#build-and-run-the-app-locally)
+ [Deploy the App on Cloud Foundry Using VMC](#deploy-the-app-on-cloud-foundry-using-vmc)
+ [Deploy the App on Cloud Foundry Using STS](#deploy-the-app-on-cloud-foundry-using-sts)



## Create Spring MVC Template Project

This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -> Dashboard.

From the dashboard view select Spring Template Project.This will open like this.
![Spring MVC Template Project](/images/spring_tutorial/spring_template_project_mvc.png)


then choose `Spring MVC Project`.
The first time you do it, STS might ask you to download some extra elements from the Internet. 
![spring_template_project_mvc_download.png](/images/spring_tutorial/spring_template_project_mvc_download.png)

Youâ€™ll need to give your project a name and a top-level package:


Click on finish â€“ and STS will create the project.

Before run the project.Select `Run As -> Maven clean`
![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completed select` Run As -> Maven install`.It will download dependencies from pom.xml.
![maven_install.png](/images/spring_tutorial/maven_install.png)

Select `Run As -> Maven build`
![maven_build.png](/images/spring_tutorial/maven_build.png)

And give Maven goal as , `tomcat:run`
![maven_run.png](/images/spring_tutorial/maven_run.png)


Once server starts completed,STS will open the home page for the project which displays Hello world message with the current server time.
![Hello World Output](/images/spring_tutorial/hello_world.png)


## ExpenseReport App

ExpenseReport is used to create and manage expenses.

In our expensereport application,we are using two roles.

1.   Normal User - can create expense,view status of expense,edit expense,delete expense.

2.   Admin User -  approve expense,reject expense which are created by normal user.

     Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.

![spring-expensereport-usecase.png](/images/spring_tutorial/usecase_diagram.png)

![spring-expensereport-usecase_admin.png](/images/spring_tutorial/usecase_diagram_admin.png)

These expenses are created by the users and the data
is stored in underlying PostgreSQl database.

The class diagram for our application is :

![spring-expensereport-class_diagram.png](/images/spring_tutorial/class_diagram.png)

Before start,add the following dependencies in your pom.xml,

  + postgresql-9.1-901.jdbc4.jar
  + hibernate-envers-3.5.0-Final.jar
  + commons-fileupload-1.2.1.jar
  + commons-io-1.3.jar

##Add Entities

   For our application we need to add Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties
and annotate your business class with @Entity. By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property. Create a package for entities as com.springsource.html5expense.model and add all entities.

```java
package com.springsource.html5expense.model;

import java.io.Serializable;
import java.util.Date;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;
import javax.persistence.Table;
import org.hibernate.annotations.Cascade;
import org.hibernate.annotations.CascadeType;

@Entity
@Table(name = "EXPENSE")
public class Expense implements Serializable{

	@Id
	@GeneratedValue
	private Long id;

	private String description;

	private Double amount;

	private State state = State.NEW;

	private Date expenseDate;

	@OneToOne
	private User user;

	@OneToOne
	private ExpenseType expenseType;

	@OneToOne
	@Cascade(CascadeType.DELETE_ORPHAN)
	private Attachment attachment;

	public Expense(){

	}

	public Expense(String description,ExpenseType expenseType,Date expenseDate,
			Double amount,User user,Attachment attachment){
		this.description = description;
		this.expenseType = expenseType;
		this.expenseDate = expenseDate;
		this.amount = amount;
		this.user = user;
		this.attachment = attachment;
	}

	public String getDescription() {
		return description;
	}

	public void setDescription(String description) {
		this.description = description;
	}


	public State getState() {
		return state;
	}

	public void setState(State state) {
		this.state = state;
	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public ExpenseType getExpenseType() {
		return expenseType;
	}

	public void setExpenseType(ExpenseType expenseType) {
		this.expenseType = expenseType;
	}

	public Double getAmount() {
		return amount;
	}

	public void setAmount(Double amount) {
		this.amount = amount;
	}

	public Date getExpenseDate() {
		return expenseDate;
	}

	public void setExpenseDate(Date expenseDate) {
		this.expenseDate = expenseDate;
	}

	public User getUser() {
		return user;
	}

	public void setUser(User user) {
		this.user = user;
	}

	public Attachment getAttachment() {
		return attachment;
	}

	public void setAttachment(Attachment attachment) {
		this.attachment = attachment;
	}
}

```
```java
package com.springsource.html5expense.model;

import java.io.Serializable;
import java.sql.Blob;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Lob;

import org.hibernate.annotations.Type;

@Entity
public class Attachment implements Serializable{
	


	@Id
	@GeneratedValue
	private Long id;
	
	private String fileName;
	
	@Type(type="org.hibernate.type.BinaryType") 
	private byte[] content;
	
	private String contentType;
	
	public String getFileName() {
		return fileName;
	}

	public void setFileName(String fileName) {
		this.fileName = fileName;
	}

	public String getContentType() {
		return contentType;
	}

	public void setContentType(String contentType) {
		this.contentType = contentType;
	}
	
	
	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getFileNmae() {
		return fileName;
	}

	public void setFileNmae(String fileNmae) {
		this.fileName = fileNmae;
	}

	public byte[] getContent() {
		return content;
	}

	public void setContent(byte[] content) {
		this.content = content;
	}

	public Attachment(){
		
	}
	public Attachment(String fileName,String contentType,byte[] content){
		this.content = content;
		this.contentType = contentType;
		this.fileName = fileName;
	}

}

```
```java
package com.springsource.html5expense.model;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;

@Entity
public class ExpenseReport {
	
	@Id
	@GeneratedValue
	private Long expenseReportId;
	
	
	@OneToOne
	private Expense expense;
	
	public  ExpenseReport(){
		
	}
	
	public Long getExpenseReportId() {
		return expenseReportId;
	}

	public void setExpenseReportId(Long expenseReportId) {
		this.expenseReportId = expenseReportId;
	}


	public Expense getExpense() {
		return expense;
	}

	public void setExpense(Expense expense) {
		this.expense = expense;
	}

	public  ExpenseReport(Expense expense){
		this.expense = expense;
	}

}

```

```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class ExpenseType implements Serializable {

	@Id
	@GeneratedValue
	private Long id;

	private String name;
	

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
	
	
}


```

```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class Role implements Serializable {

	@Id
	@GeneratedValue
	private Long roleId;
	
	public Long getRoleId() {
		return roleId;
	}

	public void setRoleId(Long roleId) {
		this.roleId = roleId;
	}

	public String getRoleName() {
		return roleName;
	}

	public void setRoleName(String roleName) {
		this.roleName = roleName;
	}

	private String roleName;
}


```
```java
package com.springsource.html5expense.model;

public enum State {

	NEW,
	
	OPEN,
	
	IN_REVIEW,
	
	REJECTED,
	
	APPROVED
}

```
```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;
import javax.persistence.Table;

@Entity
@Table(name="USERS")
public class User implements Serializable{

	@Id
	@GeneratedValue
	private Long userId;

	private String userName;

	private String password;

	private String emailId;

	private boolean enabled;

	@OneToOne
	private Role role;

	public Role getRole() {
		return role;
	}

	public void setRole(Role role) {
		this.role = role;
	}

	public boolean isEnabled() {
		return enabled;
	}

	public void setEnabled(boolean enabled) {
		this.enabled = enabled;
	}

	public Long getUserId() {
		return userId;
	}

	public void setUserId(Long userId) {
		this.userId = userId;
	}

	public String getUserName() {
		return userName;
	}

	public void setUserName(String userName) {
		this.userName = userName;
	}

	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}

	public String getEmailId() {
		return emailId;
	}

	public void setEmailId(String emailId) {
		this.emailId = emailId;
	}

	public User(){

	}
	public User(String userName,String password,String mailId){
		this.userName = userName;
		this.password = password;
		this.emailId = mailId;
	}
}
```

##Create controller classes

   Controller is reponsible for mapping the request.create methods to map the URL request. Create a package for controllers as com.springsource.html5expense.controller and add the following controller classes.

```java
package com.springsource.html5expense.controller;

import java.security.Principal;
import java.sql.Blob;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.hibernate.Hibernate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.AttachmentService;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.service.ExpenseTypeService;
import com.springsource.html5expense.service.RoleService;
import com.springsource.html5expense.service.UserService;

@Controller
public class ExpenseController {


	@Autowired
	ExpenseService expenseService;

	@Autowired
	AttachmentService attachmentService;

	@Autowired
	ExpenseTypeService expenseTypeService;

	@Autowired 
	UserService userService;

	@Autowired
	RoleService roleService;

	public ExpenseService getExpenseService() {
		return expenseService;
	}

	public void setExpenseService(ExpenseService expenseService) {
		this.expenseService = expenseService;
	}

	public AttachmentService getAttachmentService() {
		return attachmentService;
	}

	public void setAttachmentService(AttachmentService attachmentService) {
		this.attachmentService = attachmentService;
	}

	public ExpenseTypeService getExpenseTypeService() {
		return expenseTypeService;
	}

	public void setExpenseTypeService(ExpenseTypeService expenseTypeService) {
		this.expenseTypeService = expenseTypeService;
	}

	public UserService getUserService() {
		return userService;
	}

	public void setUserService(UserService userService) {
		this.userService = userService;
	}

	public RoleService getRoleService() {
		return roleService;
	}

	public void setRoleService(RoleService roleService) {
		this.roleService = roleService;
	}


	@RequestMapping(value="/loadApprovalExpenses" ,method = RequestMethod.GET)
	public String loadApprovedExpenses(ModelMap model){
		List<Expense> approvedExpenseList = getExpenseService().getPendingExpensesList();
		model.addAttribute("approvedExpenseList", approvedExpenseList);
		return "expenseapproval";

	}

	@RequestMapping(value="/deleteExpense",method=RequestMethod.GET)
	public String deleteExpense(HttpServletRequest request){
		String expenseId = request.getParameter("expenseId");
		Expense expense = getExpenseService().getExpense(new Long(expenseId));
		getExpenseService().deleteExpense(new Long(expenseId));
		return "redirect:/";
	}

	@RequestMapping(value="/editExpense",method=RequestMethod.GET)
	public String editExpense(HttpServletRequest request){
		String expenseId = request.getParameter("expenseId");
		Expense expense = getExpenseService().getExpense(new Long(expenseId));
		request.setAttribute("expense",expense);
		List<ExpenseType> expenseTypeList = expenseTypeService.getAllExpenseType();
		request.setAttribute("expenseTypeList", expenseTypeList);
		request.setAttribute("isEdit", "true");
		return "newexpense";
	}

	@RequestMapping(value="/changeState",method=RequestMethod.POST)
	public String changeState(HttpServletRequest request){
		String expenseId = request.getParameter("expenseId");
		String action = request.getParameter("action");
		getExpenseService().changeExpenseStatus(new Long(expenseId), action);
		List<Expense> approvedExpenseList = getExpenseService().getPendingExpensesList();
		request.setAttribute("approvedExpenseList", approvedExpenseList);
		return "expenseapproval";
	}


	@RequestMapping(value="/updateExpense",method=RequestMethod.POST)
	public String updateExpense(HttpServletRequest request){
		String expenseId = request.getParameter("expenseId");
		Expense expense = getExpenseService().getExpense(new Long(expenseId));
		String description = request.getParameter("description");
		String amount = request.getParameter("amount");
		String expenseTypeVal = request.getParameter("expenseTypeId");
		System.out.println("expense Id "+expenseTypeVal);
		ExpenseType expenseType = getExpenseTypeService().getExpenseTypeById(new Long(expenseTypeVal));
		expense.setExpenseType(expenseType);
		getExpenseService().updateExpense(new Long(expenseId), description, new Double(amount),expenseType);
		User user = (User)request.getSession().getAttribute("user");
		List<Expense> pendingExpenseList = getExpenseService().getExpensesByUser(user);
		request.setAttribute("pendingExpenseList",pendingExpenseList);
		return "myexpense";
	}

	@RequestMapping(value="/createNewExpenseReport",method = RequestMethod.POST)
	public String createNewExpenseReport(@RequestParam("file") MultipartFile file,HttpServletRequest request){
		String description = request.getParameter("description");
		String expenseTypeVal =request.getParameter("expenseTypeId");
		ExpenseType expenseType = expenseTypeService.getExpenseTypeById(new Long(expenseTypeVal));
		String amount = request.getParameter("amount");
		Date expenseDate = new Date();
		Double amountVal = new Double(amount);
		User user = (User)request.getSession().getAttribute("user");
		String fileName = "";
		String contentType = "";
		if(file!=null){
			try{
                            fileName =file.getOriginalFilename();
                            contentType = file.getContentType();
                            Attachment attachment = new Attachment(fileName, contentType,  file.getBytes());
                            attachmentService.save(attachment);
                            Long id = expenseService.createExpense(description,expenseType,expenseDate,
    				amountVal,user,attachment);
			}catch(Exception e){

			}
		}
		return "redirect:/";
	}

	@RequestMapping(value="/createNewExpense")
	public String createNewExpense(ModelMap model){

		List<ExpenseType> expenseTypeList = expenseTypeService.getAllExpenseType();
		model.addAttribute("expenseTypeList", expenseTypeList);
		return "newexpense";
	}

}
```
```java
package com.springsource.html5expense.controller;

import java.io.IOException;
import java.io.OutputStream;
import java.sql.Blob;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.hibernate.Hibernate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.util.FileCopyUtils;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.service.AttachmentService;
import com.springsource.html5expense.service.ExpenseService;



@Controller
public class FileAttachmentController {

	    @Autowired
	    private ExpenseService expenseService;

	    @Autowired
	    private AttachmentService attachmentService;

	    @RequestMapping(value = "/save", method = RequestMethod.POST)
	    public String save(@RequestParam("file") MultipartFile file) {
	        try {

	            String fileName =file.getOriginalFilename();
	            String contentType = file.getContentType();
	            Attachment attachment = new Attachment(fileName, contentType, file.getBytes());
	            attachmentService.save(attachment);
	        } catch (IOException e) {
	            e.printStackTrace();
	        }
	        return "redirect:/index.html";
	    }

	    @RequestMapping(value="/download")
	    public void download(HttpServletRequest request,HttpServletResponse response) throws Exception{
	    	String attachmentId = request.getParameter("attachmentId");
	    	         Attachment  attachment = this.attachmentService.getAttachment(new Long(attachmentId));
	    	         response.setContentType(attachment.getContentType());
	    	         response.setHeader("Content-Disposition","attachment; filename=\"" + attachment.getFileName() +"\"");
	    	         response.setHeader("cache-control", "must-revalidate");
	    	         OutputStream out = response.getOutputStream();
	    	         out.write(attachment.getContent());
	    	         out.flush();

	    }
}
```

```java

```

##Add Service Interfaces

   Add ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.

```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.Attachment;

public interface AttachmentService {
	public void save(Attachment attachment);

	public Attachment getAttachment(Long attachmentId);

	public List<Attachment> getAttachmentByExpenseId(Long expenseId);

	public void deleteAttachment(Long id);
}
```
```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseReport;

public interface ExpenseReportService {

	public Long createExpenseReport(Expense expense);

	public ExpenseReport getExpenseReportById(Long expensReportId);

	public List getAllExpenseReports();
}
```
```java
package com.springsource.html5expense.service;

import java.util.Date;
import java.util.List;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.User;

public interface ExpenseService {

	public Long createExpense(String description,ExpenseType expenseType,Date expenseDate,
			Double amount,User user,Attachment attachment);

	public Expense getExpense(Long expenseId);

	public List getAllExpenses();

	public List<Expense> getExpensesByUser(User user);

	public List<Expense> getPendingExpensesList();

	public List<Expense> getApprovedAndRejectedExpensesList();

	public Expense changeExpenseStatus(Long expenseId,String state);

	public void deleteExpense(Long expenseId);

	public void updateExpense(Long expenseId,String description,Double amount,ExpenseType expenseType);
}
```
```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.ExpenseType;

public interface ExpenseTypeService {

	public List<ExpenseType> getAllExpenseType();

	public ExpenseType getExpenseTypeById(Long id);
}
```
```java
package com.springsource.html5expense.service;

import com.springsource.html5expense.model.Role;

public interface RoleService {

	public Role getRole(Long id);

	public Role getRoleByName(String name);
}
```
```java
package com.springsource.html5expense.service;

import com.springsource.html5expense.model.Role;
import com.springsource.html5expense.model.User;

public interface UserService {

	public User getUserById(Long id);

	public User getUserByUserName(String userName);

	public User createUser(String userName,String password,String mailId,Role role);

}
```

   
##Configuring Spring application:

 To make our application ready we have to configure our application. Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation. To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the method's return value. By default, the bean name will be the same as the method name.

```java
package com.springsource.html5expense.config;

import java.util.HashMap;
import java.util.Map;

import javax.sql.DataSource;

import org.apache.commons.collections.map.HashedMap;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.ImportResource;
import org.springframework.context.annotation.PropertySource;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;
import org.springframework.orm.jpa.JpaTransactionManager;
import org.springframework.orm.jpa.JpaVendorAdapter;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
import org.springframework.orm.jpa.vendor.Database;
import org.springframework.orm.jpa.vendor.HibernateJpaDialect;
import org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import org.springframework.web.multipart.MultipartResolver;
import org.springframework.web.multipart.commons.CommonsMultipartResolver;

import com.springsource.html5expense.controller.FileAttachmentController;
import com.springsource.html5expense.controller.LoginController;
import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl;
import com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl;

@Configuration
@EnableTransactionManagement

public class ComponentConfig {


	@Bean
    public DataSource dataSource()  {
        SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
        dataSource.setUrl(String.format("jdbc:postgresql://%s:%s/%s", "localhost", "5432", "postgres"));
        dataSource.setDriverClass(org.postgresql.Driver.class);
        dataSource.setUsername("postgres");
        dataSource.setPassword("postgres");
        return dataSource;
    }

	@Bean
	public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
	    LocalContainerEntityManagerFactoryBean emfb = new LocalContainerEntityManagerFactoryBean();
	    emfb.setJpaVendorAdapter( jpaAdapter());
	    emfb.setDataSource(dataSource());
	    emfb.setJpaPropertyMap(createPropertyMap());
	    emfb.setJpaDialect(new HibernateJpaDialect());
	    emfb.setPersistenceUnitName("sample");
	    emfb.setPackagesToScan(new String[]{Expense.class.getPackage().getName()});
	    return emfb;
	}

	public Map<String,String> createPropertyMap()
	{
		Map<String,String> map= new HashedMap();
		map.put(org.hibernate.cfg.Environment.HBM2DDL_AUTO, "create");
		map.put(org.hibernate.cfg.Environment.HBM2DDL_IMPORT_FILES, "import.sql");
		map.put("hibernate.c3p0.min_size", "5");
		map.put("hibernate.c3p0.max_size", "20");
		map.put("hibernate.c3p0.timeout", "360000");
		map.put("hibernate.dialect", "org.hibernate.dialect.PostgreSQLDialect");
		return map;

	}

	@Bean
	public JpaVendorAdapter jpaAdapter() {
	    HibernateJpaVendorAdapter hibernateJpaVendorAdapter = new HibernateJpaVendorAdapter();
	    hibernateJpaVendorAdapter.setShowSql(true);
	    hibernateJpaVendorAdapter.setDatabase(Database.POSTGRESQL);
	    hibernateJpaVendorAdapter.setShowSql(true);
	    hibernateJpaVendorAdapter.setGenerateDdl(true);
	    return hibernateJpaVendorAdapter;
	}


	@Bean
	public PlatformTransactionManager transactionManager() {
	    final JpaTransactionManager transactionManager =
	        new JpaTransactionManager();

	    transactionManager.setEntityManagerFactory(entityManagerFactory().getObject());
	    Map<String,String> jpaProperties = new HashMap<String,String>();
	    jpaProperties.put("transactionTimeout","43200");
	    transactionManager.setJpaPropertyMap(jpaProperties);

	    return transactionManager;
	}

	@Bean
	public MultipartResolver multiPartResolver(){
		CommonsMultipartResolver multiPartResolver = new org.springframework.web.multipart.commons.CommonsMultipartResolver();
		multiPartResolver.setMaxUploadSize(10000000);
		return multiPartResolver;
	}

}
```
```java
package com.springsource.html5expense.config;

import java.util.List;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.MessageSource;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.PropertySource;
import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;
import org.springframework.context.support.ResourceBundleMessageSource;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.HandlerMethodReturnValueHandler;
import org.springframework.web.multipart.commons.CommonsMultipartResolver;
import org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;

import com.springsource.html5expense.controller.ExpenseController;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl;


@Configuration
@Import(ComponentConfig.class)
@PropertySource("/config.properties")
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter
 {
     @Override
     public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {

     }

    @Value("${debug}")
    private boolean debug;

    
    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

    @Bean
    public MessageSource messageSource() {
        String[] baseNames = "messages,errors".split(",");
        ResourceBundleMessageSource resourceBundleMessageSource = new ResourceBundleMessageSource();
        resourceBundleMessageSource.setBasenames(baseNames);
        return resourceBundleMessageSource;
    }

    @Bean
    public static PropertySourcesPlaceholderConfigurer placeholderConfigurer() {
        return new PropertySourcesPlaceholderConfigurer();
    }

    @Override
    public void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> returnValueHandlers) {

    }


}
```

 
To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Spring's annotation-driven transaction management capability, similar to the support found in Spring's <tx:*> XML namespace. 


Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XML's <context:component-scan> element and pass one of basePackageClasses(), basePackages() value.


Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.
```java
		AnnotationConfigWebApplicationContext applicationContext = new AnnotationConfigWebApplicationContext();
		applicationContext.setServletContext(sc);
		applicationContext.register(AppConfig.class);
		applicationContext.refresh();
```


##Add Spring Security to ExpenseReport App

This section provides how to get integrate ExpenseReport App with Spring Security.
Before start,add the following dependencies in your pom.xml,

  + spring-security-core.jar
  + spring-security-web.jar
  + spring-security-config.jar

## Enable Spring Security:

 To enable Spring security we need to add the following steps:

 1.      Add a DelegatingFilterProxy in the web.xml

 2.      Declare a custom XML config named spring-security.xml

 In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.
```xml
<filter>
    <filter-name>springSecurityFilterChain</filter-name>
    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
</filter>
<filter-mapping>
    <filter-name>springSecurityFilterChain</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

 In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.

```xml
<http auto-config="true" use-expressions="true">
		<intercept-url pattern="/index.jsp" access="hasAnyRole		('ROLE_USER','ROLE_MANAGER')" />
		<form-login login-page="/login" default-target-url="/welcome"
			authentication-failure-url="/loginfailed" />
		<logout logout-success-url="/logout" />
</http>

```

Create Logincontroller and add the mapping for login,logout,loginfailed.

 Define dataSource bean,to get database connection
```xml
<bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
 
			<property name="driverClass" value="org.postgresql.Driver" />
			<property name="url" value="jdbc:postgresql://192.168.6.30:5432/postgres" />
			<property name="username" value="postgres" />
		<property name="password" value="postgres" /
```


In Spring Security configuration file,add "jdbc-user service" tag and define the query to get the data from database.

```xml
<authentication-manager>
	   <authentication-provider>
		<jdbc-user-service data-source-ref="dataSource"
 
		   users-by-username-query="
		      select username,password, enabled 
		      from users where username=?" 
 
		   authorities-by-username-query="
		      select u.username, ur.authority from users u, user_roles ur 
		      where u.user_id = ur.user_id and u.username =?  " 
 
		/>
	   </authentication-provider>
	</authentication-manager>
```


To load this file as part of configuration add @ImportResource({ "classpath:spring-security.xml"}). in ComponentConfig class.

create custom login.jsp with two input elements for username and password as j_username and j_password.These are spring's placeholder for the username and password respectively.

when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.

Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.



##Build and Run the App Locally
 
      Now we have successfully created expensereport application.we can run the application in locally to test it.STS has Fabric tc server,select and add your project to server now click finish.
![STS Fabric Server.png](/images/spring_tutorial/localhost_login.png)


Once server starts completed,STS will open the home page for the project which dispalys login page.

![spring-expensereport-login.png](/images/spring_tutorial/localhost_login.png)

![spring-expensereport-create_expense.png](/images/spring_tutorial/create_new_expense.png)

![spring-expensereport-user_expense.png](/images/spring_tutorial/my_expense.png)


##Deploy the App on Cloud Foundry Using VMC
Deployment to Cloud Foundry can be done in two simple steps:

+  Create war file
+  Push the war file using `vmc push`

Commands below show the exact commands and output when the app is deployed:

Go to your project work space and issue the following commands.

``` bash
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
```

##Deploy the App on Cloud Foundry Using STS

1.     Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry.png)

2.     Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
![cloud foundry account information.png](/images/spring_tutorial/cloud_foundry_account.png)

3.     Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry_project_deploy.png) 
![spring-expensereport-project-deploy.png](/images/spring_tutorial/project_deploy_step2.png)


4.     Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
![spring-expensereport-project-deploy-step-2.png](/images/spring_tutorial/project_deploy_step3.png)

5.     Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
![service_selection.png](/images/spring_tutorial/service_selection.png)
![create_new_service.png](/images/spring_tutorial/create_new_service.png)

6.     Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
![spring-expensereport-login.png](/images/spring_tutorial/service_selection_1.png)



Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![deployed_application_in_cloud_foundry.png](/images/spring_tutorial/deployed_application_in_cloud_foundry.png);T;
I"*Í<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A Cloud Foundry plugin for STS.</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take the following user case.</p>

<p>Create and Deploy an Expense Reporting App on Cloud Foundry.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#create-spring-mvc-template-project">Create Spring MVC Template Project</a></li>
  <li><a href="#expensereport-app">ExpenseReport App</a></li>
  <li><a href="#add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</a></li>
  <li><a href="#build-and-run-the-app-locally">Build and Run the App Locally</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</a></li>
</ul><h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>

<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC.Please open your STS and select dashboard by clicking,
    Help -&gt; Dashboard.</p>

<p>From the dashboard view select Spring Template Project.This will open like this.
<img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS might ask you to download some extra elements from the Internet. 
<img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project a name and a top-level package:</p>

<p>Click on finish â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed,STS will open the home page for the project which displays Hello world message with the current server time.
<img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<h2 id="expensereport-app">ExpenseReport App</h2>

<p>ExpenseReport is used to create and manage expenses.</p>

<p>In our expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in underlying PostgreSQl database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>postgresql-9.1-901.jdbc4.jar</li>
  <li>hibernate-envers-3.5.0-Final.jar</li>
  <li>commons-fileupload-1.2.1.jar</li>
  <li>commons-io-1.3.jar</li>
</ul><h2 id="add-entities">Add Entities</h2>

<p>For our application we need to add Expense,User,UserRole,Attachment classes.Create the classes as a POJO with getters and setters for its properties
and annotate your business class with @Entity. By default JPA will take class name as table name.if you want to store in different table name then provide @Table annotation with name property. Create a package for entities as com.springsource.html5expense.model and add all entities.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Cascade</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.CascadeType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="nd">@Cascade</span><span class="o">(</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">DELETE_ORPHAN</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Expense</span><span class="o">(){</span>

	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Expense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="n">State</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">state</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseType</span><span class="o">(</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">getAmount</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">amount</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getExpenseDate</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseDate</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachment</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Attachment</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
	


	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
	
	<span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"org.hibernate.type.BinaryType"</span><span class="o">)</span> 
	<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">contentType</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">contentType</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentType</span><span class="o">(</span><span class="n">String</span> <span class="n">contentType</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
	<span class="o">}</span>
	
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileNmae</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileNmae</span><span class="o">(</span><span class="n">String</span> <span class="n">fileNmae</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileNmae</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(){</span>
		
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">contentType</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseReport</span> <span class="o">{</span>
	
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">;</span>
	
	
	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">Expense</span> <span class="n">expense</span><span class="o">;</span>
	
	<span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(){</span>
		
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getExpenseReportId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseReportId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseReportId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseReportId</span> <span class="o">=</span> <span class="n">expenseReportId</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpense</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseType</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	
	
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">roleId</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="n">Long</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoleName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleName</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleName</span> <span class="o">=</span> <span class="n">roleName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">roleName</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>

	<span class="n">NEW</span><span class="o">,</span>
	
	<span class="n">OPEN</span><span class="o">,</span>
	
	<span class="n">IN_REVIEW</span><span class="o">,</span>
	
	<span class="n">REJECTED</span><span class="o">,</span>
	
	<span class="n">APPROVED</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USERS"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">emailId</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">enabled</span><span class="o">;</span>

	<span class="nd">@OneToOne</span>
	<span class="kd">private</span> <span class="n">Role</span> <span class="n">role</span><span class="o">;</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">role</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRole</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">enabled</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserId</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">password</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmailId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">emailId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmailId</span><span class="o">(</span><span class="n">String</span> <span class="n">emailId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">emailId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

	<span class="o">}</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">mailId</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="create-controller-classes">Create controller classes</h2>

<p>Controller is reponsible for mapping the request.create methods to map the URL request. Create a package for controllers as com.springsource.html5expense.controller and add the following controller classes.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>


	<span class="nd">@Autowired</span>
	<span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

	<span class="nd">@Autowired</span> 
	<span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

	<span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/deleteExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">deleteExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/editExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">editExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expense"</span><span class="o">,</span><span class="n">expense</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"isEdit"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/changeState"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">changeState</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"action"</span><span class="o">);</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">changeExpenseStatus</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">action</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/updateExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
		<span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
		<span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"expense Id "</span><span class="o">+</span><span class="n">expenseTypeVal</span><span class="o">);</span>
		<span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">getExpenseTypeService</span><span class="o">().</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
		<span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
		<span class="n">getExpenseService</span><span class="o">().</span><span class="na">updateExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">description</span><span class="o">,</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">),</span><span class="n">expenseType</span><span class="o">);</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpenseReport"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpenseReport</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
		<span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
		<span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
		<span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
		<span class="n">Date</span> <span class="n">expenseDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
		<span class="n">Double</span> <span class="n">amountVal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
		<span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
			<span class="k">try</span><span class="o">{</span>
                            <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                            <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span>  <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
                            <span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">.</span><span class="na">createExpense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span>
    				<span class="n">amountVal</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
			<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>

			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpense"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpense</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>

		<span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.FileCopyUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>



<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileAttachmentController</span> <span class="o">{</span>

	    <span class="nd">@Autowired</span>
	    <span class="kd">private</span> <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

	    <span class="nd">@Autowired</span>
	    <span class="kd">private</span> <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

	    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	    <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
	        <span class="k">try</span> <span class="o">{</span>

	            <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
	            <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
	            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
	            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
	        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
	            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
	        <span class="o">}</span>
	        <span class="k">return</span> <span class="s">"redirect:/index.html"</span><span class="o">;</span>
	    <span class="o">}</span>

	    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/download"</span><span class="o">)</span>
	    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
	    	<span class="n">String</span> <span class="n">attachmentId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attachmentId"</span><span class="o">);</span>
	    	         <span class="n">Attachment</span>  <span class="n">attachment</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span><span class="o">.</span><span class="na">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">));</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">attachment</span><span class="o">.</span><span class="na">getFileName</span><span class="o">()</span> <span class="o">+</span><span class="s">"\""</span><span class="o">);</span>
	    	         <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"cache-control"</span><span class="o">,</span> <span class="s">"must-revalidate"</span><span class="o">);</span>
	    	         <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
	    	         <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
	    	         <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

	    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"></code></pre>

<h2 id="add-service-interfaces">Add Service Interfaces</h2>

<p>Add ExpenseService interface which is responsible to fetch pending expenses,approved expenses,create expense,fetch expenses based on user,update an expense.Create JpaExpenseServiceImpl Class that implements this ExpenseService interface and do your implementation to get the data from database and annotate this class as @Service and @Transactional. @Service is a special component that marks service layer.Since we are using JPA for persistence, autowire your EntityManager.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttachmentService</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseReportService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expensReportId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">();</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
			<span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseTypeService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">();</span>

	<span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RoleService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">);</span>

	<span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">);</span>

<span class="o">}</span></code></pre>

<h2 id="configuring-spring-application">Configuring Spring application:</h2>

<p>To make our application ready we have to configure our application. Create a class with @Configuration annotation to configure your beans.It is a alternative approach to bean definition instead of xml configuration.We can pass this class a argument to spring container as a source for bean creation. To declare a bean, simply annotate a method with the @Bean annotation in your config class. You use this method to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.map.HashedMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ImportResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.SimpleDriverDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaDialect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.FileAttachmentController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.LoginController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>


	<span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setPersistenceUnitName</span><span class="o">(</span><span class="s">"sample"</span><span class="o">);</span>
	    <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
	    <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
	<span class="o">{</span>
		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">map</span><span class="o">;</span>

	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaAdapter</span><span class="o">()</span> <span class="o">{</span>
	    <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">POSTGRESQL</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setGenerateDdl</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
	    <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
	    <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
	        <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>

	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
	    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">jpaProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
	    <span class="n">jpaProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"transactionTimeout"</span><span class="o">,</span><span class="s">"43200"</span><span class="o">);</span>
	    <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>

	    <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multiPartResolver</span><span class="o">(){</span>
		<span class="n">CommonsMultipartResolver</span> <span class="n">multiPartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
		<span class="n">multiPartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">multiPartResolver</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodReturnValueHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.ExpenseController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">ComponentConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"/config.properties"</span><span class="o">)</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span>
 <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${debug}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">debug</span><span class="o">;</span>

    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">baseNames</span> <span class="o">=</span> <span class="s">"messages,errors"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="n">ResourceBundleMessageSource</span> <span class="n">resourceBundleMessageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">resourceBundleMessageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="n">baseNames</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resourceBundleMessageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertySourcesPlaceholderConfigurer</span> <span class="nf">placeholderConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PropertySourcesPlaceholderConfigurer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addReturnValueHandlers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodReturnValueHandler</span><span class="o">&gt;</span> <span class="n">returnValueHandlers</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>


<span class="o">}</span></code></pre>

<p>To get Spring Transaction support,annotate your class with @EnableTransactionManagement which enables Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>Then modify your web.xml to load this Config class as part of your contextConfiglocation or create your custom class to initialize ApplicationContext by implementing WebApplicationInitializer interface.Override onStartUp() method of WebApplicationInitializer and create AnnotationConfigWebApplicationContext.</p>
<pre><code class="language-java">		<span class="n">AnnotationConfigWebApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigWebApplicationContext</span><span class="o">();</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">setServletContext</span><span class="o">(</span><span class="n">sc</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">applicationContext</span><span class="o">.</span><span class="na">refresh</span><span class="o">();</span></code></pre>

<h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>

<p>This section provides how to get integrate ExpenseReport App with Spring Security.
Before start,add the following dependencies in your pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>

<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in the web.xml</p>
  </li>
  <li>
    <p>Declare a custom XML config named spring-security.xml</p>
  </li>
</ol><p>In the web.xml we declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>
<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept.</p>

<pre><code class="language-xml"><span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/index.jsp"</span> <span class="na">access=</span><span class="s">"hasAnyRole		('ROLE_USER','ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/welcome"</span>
			<span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/http&gt;</span></code></pre>

<p>Create Logincontroller and add the mapping for login,logout,loginfailed.</p>

<p>Define dataSource bean,to get database connection</p>
<pre><code class="language-xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.SimpleDriverDataSource"</span><span class="nt">&gt;</span>
 
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span> <span class="na">value=</span><span class="s">"org.postgresql.Driver"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:postgresql://192.168.6.30:5432/postgres"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"postgres"</span> <span class="err">/</span></code></pre>

<p>In Spring Security configuration file,add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;authentication-manager&gt;</span>
	   <span class="nt">&lt;authentication-provider&gt;</span>
		<span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
		   <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">		      select username,password, enabled </span>
<span class="s">		      from users where username=?"</span> 
 
		   <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">		      select u.username, ur.authority from users u, user_roles ur </span>
<span class="s">		      where u.user_id = ur.user_id and u.username =?  "</span> 
 
		<span class="nt">/&gt;</span>
	   <span class="nt">&lt;/authentication-provider&gt;</span>
	<span class="nt">&lt;/authentication-manager&gt;</span></code></pre>

<p>To load this file as part of configuration add @ImportResource({ â€œclasspath:spring-security.xmlâ€}). in ComponentConfig class.</p>

<p>create custom login.jsp with two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.</p>

<p>when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>Add logout functionality:
   add j_spring_security_logout link in your application. once your clicked this link,spring invalidate user session.</p>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>

<pre><code>  Now we have successfully created expensereport application.we can run the application in locally to test it.STS has Fabric tc server,select and add your project to server now click finish. ![STS Fabric Server.png](/images/spring_tutorial/localhost_login.png)
</code></pre>

<p>Once server starts completed,STS will open the home page for the project which dispalys login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="spring-expensereport-login.png"></p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="spring-expensereport-create_expense.png"></p>

<p><img src="/images/spring_tutorial/my_expense.png" alt="spring-expensereport-user_expense.png"></p>

<h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>

<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
<img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
<img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
<img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
<img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
<img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
<img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>;T;@íI"./static/images/spring_tutorial/login.png/;T{;{ I"8/static/images/spring_tutorial/usecase_diagram.png/;T{;{ I">/static/images/spring_tutorial/usecase_diagram_admin.png/;T{;{ I"7/static/images/spring_tutorial/create_expense.png/;T{;{ I"3/static/images/spring_tutorial/my_expense.png/;T{;{ I"8/static/images/spring_tutorial/localhost_login.png/;T{;{ I"7/static/images/spring_tutorial/caldecott_info.png/;T{;{ I"6/static/images/spring_tutorial/cloud_foundry.png/;T{;{ I">/static/images/spring_tutorial/cloud_foundry_account.png/;T{;{ I"=/static/images/spring_tutorial/cloud_foundry_plugin.png/;T{;{ I"E/static/images/spring_tutorial/cloud_foundry_project_deploy.png/;T{;{ I";/static/images/spring_tutorial/create_new_expense.png/;T{;{ I";/static/images/spring_tutorial/create_new_service.png/;T{;{ I"N/static/images/spring_tutorial/deployed_application_in_cloud_foundry.png/;T{;{ I"Q/static/images/spring_tutorial/enter_cloud_foundry_service_auth_details.png/;T{;{ I"4/static/images/spring_tutorial/hello_world.png/;T{;{ I"@/static/images/spring_tutorial/my_expense_without_edit.png/;T{;{ I">/static/images/spring_tutorial/open_service_in_local.png/;T{;{ I"4/static/images/spring_tutorial/open_tunnel.png/;T{;{ I"5/static/images/spring_tutorial/ping_succeed.png/;T{;{ I"=/static/images/spring_tutorial/project_deploy_step2.png/;T{;{ I"=/static/images/spring_tutorial/project_deploy_step3.png/;T{;{ I":/static/images/spring_tutorial/run_local_server_.png/;T{;{ I"M/static/images/spring_tutorial/Screen shot 2012-09-17 at 4.47.47 PM.png/;T{;{ I"M/static/images/spring_tutorial/Screen shot 2012-09-17 at 5.11.53 PM.png/;T{;{ I"M/static/images/spring_tutorial/Screen shot 2012-09-17 at 5.21.05 PM.png/;T{;{ I":/static/images/spring_tutorial/service_selection.png/;T{;{ I"</static/images/spring_tutorial/service_selection_1.png/;T{;{ I"D/static/images/spring_tutorial/spring_template_project_mvc.png/;T{;{ I"M/static/images/spring_tutorial/spring_template_project_mvc_download.png/;T{;{ I"2/static/images/spring_tutorial/maven_run.png/;T{;{ I"4/static/images/spring_tutorial/maven_build.png/;T{;{ I"4/static/images/spring_tutorial/maven_clean.png/;T{;{ I"6/static/images/spring_tutorial/maven_install.png/;T{;{ I"2/frameworks/java/spring/spring_tutorial_psql/;T{;{	;I"˜æ<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring_tutorial_psql.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Application Development with Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Development with Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/redis" rel="tag">redis</a><a href="/tags/code-attached" rel="tag">code-attached</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-02
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A <a href="/tools/STS/configuring-STS.html">Cloud Foundry plugin for STS</a>.</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take the following use case.</p>

<p>Create and Deploy an Expense Reporting App on Cloud Foundry.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#create-spring-mvc-template-project">Create Spring MVC Template Project</a></li>
  <li><a href="#expensereport-app">Create an Expense Reporting app</a></li>
  <li><a href="#add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</a></li>
  <li><a href="#build-and-run-the-app-locally">Build and Run the App Locally</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</a></li>
</ul><h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>

<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC. Please open your STS and select dashboard by clicking,
    <code>Help -&gt; Dashboard</code></p>

<p>From the dashboard view select Spring Template Project.Window shown below opens up.
<img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS will ask you to download some extra elements from the Internet.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project name as <code>expensereport</code> and top-level package as <code>com.springsource.html5expense</code></p>

<p>Click on <code>Finish</code> â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completes, select <code>Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server start is completed, open your browser and go to our application url <code>http://localhost:8080/html5expense</code> it will open the home page for the project which displays 
Hello world message with the current server time.
<img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<h2 id="expensereport-app">ExpenseReport App</h2>

<p>ExpenseReport is used to create and manage expenses.</p>

<p>In expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in PostgreSQL database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before creating Entities,delete <code>HomeController.java</code> from your <code>com.springsource.html5config</code> package and replace your pom.xml with the one below,</p>
<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.springsource<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>html5expense<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;name&gt;</span>SpringMVC-ExpenseReport<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0-BUILD-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java-version&gt;</span>1.6<span class="nt">&lt;/java-version&gt;</span>
        <span class="nt">&lt;org.springframework-version&gt;</span>3.1.0.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
        <span class="nt">&lt;org.aspectj-version&gt;</span>1.6.9<span class="nt">&lt;/org.aspectj-version&gt;</span>
        <span class="nt">&lt;org.slf4j-version&gt;</span>1.5.10<span class="nt">&lt;/org.slf4j-version&gt;</span>
        <span class="nt">&lt;org.spring-data-mongo-version&gt;</span>1.0.0.RELEASE<span class="nt">&lt;/org.spring-data-mongo-version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- Spring --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="c">&lt;!-- Exclude Commons Logging in favor of SLF4j --&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
                 <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.8.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-orm<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring-Batch --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.batch<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-batch-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- AspectJ --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.aspectj-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>    
        
        <span class="c">&lt;!-- Logging --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.15<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.mail<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>mail<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.jms<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jms<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jdmk<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxtools<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jmx<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxri<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- @Inject --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.inject<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javax.inject<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- Servlet  --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>servlet-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.5<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
       
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        
        <span class="c">&lt;!-- CGLIB --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cglib<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.2.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.0.0.Final<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

      <span class="c">&lt;!-- POSTGRE SQL --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>postgresql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>9.1-901.jdbc4<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-dbcp<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-dbcp<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>20030825.184428<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-pool<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-pool<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-io<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-io<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    
        <span class="c">&lt;!-- Test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.7<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>        
        
                
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring Security   --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-web<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-security-taglibs<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span> 
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>taglibs<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>standard<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>     
        
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-eclipse-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.9<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;additionalProjectnatures&gt;</span>
                        <span class="nt">&lt;projectnature&gt;</span>org.springframework.ide.eclipse.core.springnature<span class="nt">&lt;/projectnature&gt;</span>
                    <span class="nt">&lt;/additionalProjectnatures&gt;</span>
                    <span class="nt">&lt;additionalBuildcommands&gt;</span>
                        <span class="nt">&lt;buildcommand&gt;</span>org.springframework.ide.eclipse.core.springbuilder<span class="nt">&lt;/buildcommand&gt;</span>
                    <span class="nt">&lt;/additionalBuildcommands&gt;</span>
                    <span class="nt">&lt;downloadSources&gt;</span>true<span class="nt">&lt;/downloadSources&gt;</span>
                    <span class="nt">&lt;downloadJavadocs&gt;</span>true<span class="nt">&lt;/downloadJavadocs&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.3.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                    <span class="nt">&lt;compilerArgument&gt;</span>-Xlint:all<span class="nt">&lt;/compilerArgument&gt;</span>
                    <span class="nt">&lt;showWarnings&gt;</span>true<span class="nt">&lt;/showWarnings&gt;</span>
                    <span class="nt">&lt;showDeprecation&gt;</span>true<span class="nt">&lt;/showDeprecation&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;mainClass&gt;</span>org.test.int1.Main<span class="nt">&lt;/mainClass&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>

<h2 id="add-entities">Add Entities</h2>
<p>An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.</p>

<p>The application requires the following entities to be added. <code>Expense</code>,<code>User</code>,<code>Role</code>,<code>Attachment</code>,<code>ExpenseReport</code>,<code>State</code> classes.These classes are POJO with getters and setters for its properties and annotated with <code>@Entity</code>. By default JPA will take class name as table name. If you want to store in different table name then provide <code>@Table</code> annotation with name property. Create a package for entities as <code>com.springsource.html5expense.model</code> and add all entities to it.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Cascade</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.CascadeType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(){</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">State</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseType</span><span class="o">(</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getAmount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getExpenseDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachment</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>The <code>@Id</code> annotation specifies the primary key of the entity and <code>@OneToOne</code> annotation defines a single-valued association to another entity that has one-to-one multiplicity.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Attachment</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
    


    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
    
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"org.hibernate.type.BinaryType"</span><span class="o">)</span> 
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">contentType</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentType</span><span class="o">(</span><span class="n">String</span> <span class="n">contentType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>
    
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileNmae</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileNmae</span><span class="o">(</span><span class="n">String</span> <span class="n">fileNmae</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileNmae</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(){</span>
        
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">contentType</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseReport</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">;</span>
    
    
    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Expense</span> <span class="n">expense</span><span class="o">;</span>
    
    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(){</span>
        
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getExpenseReportId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseReportId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseReportId</span> <span class="o">=</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpense</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseType</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    
    
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">roleId</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="n">Long</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoleName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleName</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleName</span> <span class="o">=</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">roleName</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>

    <span class="n">NEW</span><span class="o">,</span>
    
    <span class="n">OPEN</span><span class="o">,</span>
    
    <span class="n">IN_REVIEW</span><span class="o">,</span>
    
    <span class="n">REJECTED</span><span class="o">,</span>
    
    <span class="n">APPROVED</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USERS"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">emailId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">enabled</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Role</span> <span class="n">role</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRole</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserId</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmailId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmailId</span><span class="o">(</span><span class="n">String</span> <span class="n">emailId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">mailId</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="add-service-interfaces">Add Service Interfaces</h2>
<p>Create a package for service interfaces as <code>com.springsource.html5expense.service</code> and add <code>AttachmentService</code>,<code>ExpenseReportService</code>,<code>ExpenseService</code>,<code>ExpenseTypeService</code>,<code>UserService</code> interfaces which define the business methods.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttachmentService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseReportService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expensReportId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">();</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseTypeService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RoleService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">);</span>

<span class="o">}</span></code></pre>

<h2 id="add-service-implementation">Add Service Implementation</h2>
<p>Create a package <code>com.springsource.html5expense.serviceImpl</code> for service implementation and add the following JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl classes. Here we have autowired EntityManager bean which is responsible 
for persisting,removing,finding entities.@PersistenceContext which will use EntityManagerFactory to create EntityManager instance.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaAttachmentServiceImpl</span> <span class="kd">implements</span> <span class="n">AttachmentService</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">();</span>
        <span class="n">attachment</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="n">attachment</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Attachment</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Attachment a where a.expense.id =:expenseId"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">attachmentList</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">attachmentList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attchment</span> <span class="o">=</span> <span class="n">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">attchment</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseReportService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseReportServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseReportService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">expenseReport</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">.</span><span class="na">getExpenseReportId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">();</span>
        <span class="n">expenseReport</span><span class="o">.</span><span class="na">setExpenseReportId</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseReportId</span><span class="o">));</span>
        <span class="n">expenseReport</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseReport</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseReportId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from expensereport e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.criterion.DetachedCriteria</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.criterion.Restrictions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.State</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>



<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseService</span> <span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Expense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span><span class="n">amount</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
         
        
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.user.userId =:userId ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">OPEN</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">IN_REVIEW</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">REJECTED</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">APPROVED</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">state</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>


    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAttachment</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="n">description</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>


    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseTypeServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseTypeService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from ExpenseType"</span><span class="o">,</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaRoleServiceImpl</span> <span class="kd">implements</span> <span class="n">RoleService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
            <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select r from Role r where roleName =:roleName"</span><span class="o">,</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"roleName"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">Role</span><span class="o">)</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaUserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from User u where u.userName =:username"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">return</span>  <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">User</span><span class="o">)(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span><span class="n">password</span><span class="o">,</span><span class="n">mailId</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="k">new</span> <span class="n">Boolean</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>One you added service implementation classes,make sure you are not getting errors.</p>

<h2 id="add-controller-classes">Add controller classes</h2>
<p>Controller is reponsible for mapping requests.Use the <code>@RequestMapping</code> annotation to map web requests onto specific handler methods. Create a package for Controllers as <code>com.springsource.html5expense.controller</code> and add the following <code>ExpenseController</code>, <code>FileAttachmentController</code> classes.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>


    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/deleteExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">deleteExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/editExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expense"</span><span class="o">,</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"isEdit"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/changeState"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeState</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"action"</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">changeExpenseStatus</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">action</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/updateExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"expense Id "</span><span class="o">+</span><span class="n">expenseTypeVal</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">getExpenseTypeService</span><span class="o">().</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">updateExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">description</span><span class="o">,</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">),</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpenseReport"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpenseReport</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">Date</span> <span class="n">expenseDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
        <span class="n">Double</span> <span class="n">amountVal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">try</span><span class="o">{</span>
                            <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                            <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span>  <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
                            <span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">.</span><span class="na">createExpense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span>
                    <span class="n">amountVal</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>

            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpense"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpense</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.FileCopyUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>



<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileAttachmentController</span> <span class="o">{</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>

                <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">"redirect:/index.html"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/download"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">attachmentId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attachmentId"</span><span class="o">);</span>
                     <span class="n">Attachment</span>  <span class="n">attachment</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span><span class="o">.</span><span class="na">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">));</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">attachment</span><span class="o">.</span><span class="na">getFileName</span><span class="o">()</span> <span class="o">+</span><span class="s">"\""</span><span class="o">);</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"cache-control"</span><span class="o">,</span> <span class="s">"must-revalidate"</span><span class="o">);</span>
                     <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="configure-expensereport-application">Configure ExpenseReport application</h2>
<p>We have to configure our application in order to make it ready to deploy. Create a new package <code>com.springsource.html5expense.config</code> and add the following ComponentConfig,WebConfig classes.We have marked ComponentConfig class with @Configuration annotation to configure our beans.This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.map.HashedMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ImportResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.SimpleDriverDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaDialect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.FileAttachmentController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.LoginController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@ImportResource</span><span class="o">({</span> <span class="s">"classpath:spring-security.xml"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
        <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaAdapter</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">POSTGRESQL</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setGenerateDdl</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>

        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">jpaProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">jpaProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"transactionTimeout"</span><span class="o">,</span><span class="s">"43200"</span><span class="o">);</span>
        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
        <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>@EnableTransactionManagement annotation is responsible for Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodReturnValueHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.ExpenseController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">ComponentConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span>
 <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">baseNames</span> <span class="o">=</span> <span class="s">"messages,errors"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="n">ResourceBundleMessageSource</span> <span class="n">resourceBundleMessageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">resourceBundleMessageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="n">baseNames</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resourceBundleMessageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertySourcesPlaceholderConfigurer</span> <span class="nf">placeholderConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PropertySourcesPlaceholderConfigurer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addReturnValueHandlers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodReturnValueHandler</span><span class="o">&gt;</span> <span class="n">returnValueHandlers</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>


<span class="o">}</span></code></pre>

<ul>
<li>
    <p>Create a new file <code>import.sql</code> in <code>src/main/resources</code> and add the below content in it.</p>

    <p>insert into role(roleid,rolename) values(nextval( â€˜hibernate_sequenceâ€™),â€™ROLE_USERâ€™);
  insert into role(roleid,rolename) values(nextval( â€˜hibernate_sequenceâ€™),â€™ROLE_MANAGERâ€™);
  insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval(â€˜hibernate_sequenceâ€™),â€™admin@expense.comâ€™,true,â€™adminâ€™,â€™adminâ€™,2);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™MEDICALâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™TRAVELâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™TELEPHONEâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™GYMâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™EDUCATIONâ€™);</p>
  </li>
</ul><p>To execute these statements automatically while app starts we have set 
these two Jpa properties.       </p>
<pre><code class="language-java"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span></code></pre>

<ul>
<li>Then open your <code>src/main/webapp/WEB-INF/web.xml</code> and modify it to load this <code>ComponentConfig</code> class as part of contextConfiglocation as shown below,</li>
</ul><pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">"2.5"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>com.springsource.html5expense.config<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>  

    <span class="c">&lt;!-- Processes application requests  --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/appServlet/servlet-context.xml ,
            <span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>2<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span> 

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/css/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/images/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span></code></pre>

<h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>
<p>This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have added already into pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>
<p>To enable Spring security we need to add the following steps:
 1. Add a DelegatingFilterProxy in <code>src/main/webapp/WEB-INF/web.xml</code>
 2. Create a custom XML configuration named spring-security.xml in <code>src/main/resources</code></p>

<p>In the web.xml declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span> 
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/signUp**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/loadApprovalExpenses"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/sessionTimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"sas"</span> <span class="na">class=</span><span class="s">"org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
           <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">              select username,password,enabled  </span>
<span class="s">              from users where username=?"</span> 
 
           <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">              select u.username, r.rolename from users u, role r </span>
<span class="s">              where u.role_roleid = r.roleid and u.username =?  "</span> 
 
        <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>

<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<p>To load this file as part of configuration add <code>@ImportResource({ "classpath:spring-security.xml"})</code> in <code>ComponentConfig</code> class.</p>

<p>Create <code>Logincontroller</code> in <code>com.springsource.html5expense.contoller</code> package and add mapping for login,logout,loginfailed,signup.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printWelcome</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span> <span class="n">Principal</span> <span class="n">principal</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">)</span> <span class="o">{</span>
 
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUp"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"signUp"</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUpUser"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"userName"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">mailId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="n">getRoleService</span><span class="o">().</span><span class="na">getRoleByName</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">createUser</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">mailId</span><span class="o">,</span><span class="n">role</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/login"</span><span class="o">;</span>

        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"User registration fails already same user name exists please try "</span> <span class="o">+</span>
                    <span class="s">"with different user name"</span><span class="o">;</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/signUp?errorMsg="</span><span class="o">+</span><span class="n">errorMsg</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/login"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loginfailed"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginerror</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/logout"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/sessionTimeout"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sessionTimeout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"Session has expired .Please login"</span><span class="o">;</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre>

<h2 id="add-view-files">Add View Files</h2>
<p>Add the following <code>login.jsp</code>,<code>expenseapproval.jsp</code>,<code>myexpense.jsp</code>,<code>newexpense.jsp</code>,<code>usermain.jsp</code>,<code>signUp.jsp</code> files in your <code>webapp/WEB-INF/view</code> folders.The login.jsp has two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively. when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>add the below jsp file as <code>login.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/signUp"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty error}"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    Your login attempt was not successful, try again.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> Caused :
                    ${sessionScope["SPRING_SECURITY_LAST_EXCEPTION"].message}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
            ${errorMsg}
            <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">'f'</span> <span class="na">action=</span><span class="s">"&lt;c:url value='j_spring_security_check' /&gt;"</span> <span class="na">method=</span><span class="s">'POST'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Username"</span> <span class="na">name=</span><span class="s">"j_username"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">name=</span><span class="s">"j_password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>expenseapproval.jsp</code></p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://displaytag.sf.net"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"display"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
 
<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>4<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
          function changeState(contextPath,expenseId,rowCount){
              var actionVal =  document.getElementById('action_'+rowCount).value;
              var url = contextPath+"/changeState?action="+actionVal+"<span class="ni">&amp;expenseId="+expenseId;</span>
              if(actionVal == null || actionVal =="" ){
                  return false;
              }
              document.forms[0].action=url;
              document.forms[0].submit();
              
          }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b add-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"plus-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/plus-a.png"</span><span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Approvals Pending ${fn:length(approvedExpenseList)}
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(approvedExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table-a"</span>  <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-a"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date<span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-down-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-down-a.png"</span><span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span> <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense ID <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                 <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${approvedExpenseList}"</span>  <span class="na">varStatus=</span><span class="s">"rowCounter"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"rowcount"</span> <span class="na">value=</span><span class="s">"${rowCounter.count}"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate}<span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.id}<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span> 
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;&lt;form</span> <span class="na">name=</span><span class="s">"actionForm"</span> <span class="na">id=</span><span class="s">"actionForm"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-a label-5 green"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt; "</span><span class="o">&gt;</span>
                                     <span class="n">Approved</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-b label-6"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span> <span class="o">&gt;</span> <span class="n">Approved</span>
                                    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="n">class</span><span class="o">=</span><span class="s">"bg-cross-b"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"cross-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">cross</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                                <span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                                
                                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"action_${rowCounter.count}"</span> <span class="na">name=</span><span class="s">"${rowCounter.count}"</span> <span class="na">style=</span><span class="s">"font-size: 11px;"</span> <span class="na">onchange=</span><span class="s">"changeState('${pageContext.request.contextPath}','${expense.id}','${rowCounter.count}')"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"PENDING"</span><span class="nt">&gt;</span>     Pending    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"APPROVED"</span><span class="nt">&gt;</span>    Approve    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"REJECTED"</span><span class="nt">&gt;</span>    Reject     <span class="nt">&lt;/option&gt;</span>
                                <span class="nt">&lt;/select&gt;</span>
                                    <span class="nt">&lt;/form&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
                
            <span class="nt">&lt;/table&gt;</span> 
    
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;

            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;

            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>

            <span class="nt">&lt;/select&gt;</span>

        <span class="nt">&lt;/form&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    
    <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>myexpense.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
                         
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>newexpense.jsp</code></p>
<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
    
<span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>3<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expense<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                   <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;c:choose&gt;</span>
        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${isEdit eq 'true'}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Editing an expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/updateExpense"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span><span class="nt">&gt;</span>${expense.description}<span class="nt">&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"expenseId"</span> <span class="na">id=</span><span class="s">"expenseId"</span> <span class="na">value=</span><span class="s">"${expense.id}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">value=</span><span class="s">"${expense.amount}"</span><span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- &lt;div class="textbox-a dd-a flt-left"&gt;</span>
<span class="c">                Select Type &lt;img class="arrow-down-c-img" src="&lt;c:url value="/resources/images/arrow-down-c.png" /&gt;"&gt;  --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        
                          <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name eq expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                         <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name ne expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">"label-7 flt-right"</span> <span class="n">href</span><span class="o">=</span><span class="s">"#"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"clip-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">clip</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">class=</span><span class="s">"file"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Attach Receipt &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>SAVE EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:when&gt;</span>
        <span class="nt">&lt;c:otherwise&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Adding new expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/createNewExpenseReport"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="nt">&gt;&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="na">max=</span><span class="s">"100000"</span> <span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--     &lt;div class="textbox-a dd-a flt-left"&gt; --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span> <span class="na">style=</span><span class="s">"    border: 1px solid #b8b8b8;</span>
<span class="s">                box-shadow: 0px 2px 0px 0px #b8b8b8;padding: 12px;font-size: 11px;color: #a7a5a6;width:100px;    margin:10px;"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>                         <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>    ${expenseType.name}    <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt;</span>
<span class="c">                 &lt;a class="label-7 flt-right" href="#"&gt;&lt;img class="clip-a-img" src="&lt;c:url value="/resources/images/clip-a.png" /&gt;"&gt;  --&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">title=</span><span class="s">"Attachment"</span>  <span class="na">class=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
                <span class="c">&lt;!-- &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>ADD EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:otherwise&gt;</span>
        <span class="nt">&lt;/c:choose&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>usermain.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
   .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });

<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>signUp.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        
        function ValidateEmail() 
        {
         var email = document.getElementById("email");
         var errorblock = document.getElementById("errorblock");
         if(email!=null <span class="err">&amp;&amp;</span> email.value!=""){
         if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email.value))
          {
             alert("email1"+email.value);
            return true;
          }
             errorblock.innerHTML = "Please Enter valid Email Address";
            return false;
         }else{
             alert("please enter email address!");
             return false;
         }
        }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/login"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty param.errorMsg}"</span><span class="nt">&gt;</span>
            
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    ${param.errorMsg}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
             <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/signUpUser"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">required=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"UserName"</span> <span class="na">id=</span><span class="s">"userName"</span> <span class="na">name=</span><span class="s">"userName"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>Now we have successfully created expensereport application.we can run the application in locally to test it.
Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>

<p>Once server starts completed,STS will open the home page for the project which dispalys login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="spring-expensereport-login.png"></p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="spring-expensereport-create_expense.png"></p>

<p><img src="/images/spring_tutorial/my_expense.png" alt="spring-expensereport-user_expense.png"></p>

<h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>
<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
<img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
<img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
<img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
<img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
<img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
<img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"«This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.


Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Spring Tool Suiteâ„¢ (STS)](http://www.springsource.org/spring-tool-suite-download) installation

+  A [Cloud Foundry plugin for STS](/tools/STS/configuring-STS.html).


## Introduction

In this tutorial, we take the following use case.

Create and Deploy an Expense Reporting App on Cloud Foundry.

## Subtopics

+ [Create Spring MVC Template Project](#create-spring-mvc-template-project)
+ [Create an Expense Reporting app](#expensereport-app)
+ [Add Spring Security to ExpenseReport App](#add-spring-security-to-expensereport-app)
+ [Build and Run the App Locally](#build-and-run-the-app-locally)
+ [Deploy the App on Cloud Foundry Using VMC](#deploy-the-app-on-cloud-foundry-using-vmc)
+ [Deploy the App on Cloud Foundry Using STS](#deploy-the-app-on-cloud-foundry-using-sts)



## Create Spring MVC Template Project

This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC. Please open your STS and select dashboard by clicking,
    `Help -> Dashboard`

From the dashboard view select Spring Template Project.Window shown below opens up.
![Spring MVC Template Project](/images/spring_tutorial/spring_template_project_mvc.png)


then choose `Spring MVC Project`.
The first time you do it, STS will ask you to download some extra elements from the Internet.

![spring_template_project_mvc_download.png](/images/spring_tutorial/spring_template_project_mvc_download.png)

Youâ€™ll need to give your project name as `expensereport` and top-level package as `com.springsource.html5expense`


Click on `Finish` â€“ and STS will create the project.

Before run the project.Select `Run As -> Maven clean`
![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completes, select `Run As -> Maven install`.It will download dependencies from pom.xml.
![maven_install.png](/images/spring_tutorial/maven_install.png)

Select `Run As -> Maven build`
![maven_build.png](/images/spring_tutorial/maven_build.png)

And give Maven goal as , `tomcat:run`

![maven_run.png](/images/spring_tutorial/maven_run.png)


Once server start is completed, open your browser and go to our application url `http://localhost:8080/html5expense` it will open the home page for the project which displays 
Hello world message with the current server time.
![Hello World Output](/images/spring_tutorial/hello_world.png)


## ExpenseReport App

ExpenseReport is used to create and manage expenses.

In expensereport application,we are using two roles.

1.   Normal User - can create expense,view status of expense,edit expense,delete expense.

2.   Admin User -  approve expense,reject expense which are created by normal user.

     Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.

![spring-expensereport-usecase.png](/images/spring_tutorial/usecase_diagram.png)

![spring-expensereport-usecase_admin.png](/images/spring_tutorial/usecase_diagram_admin.png)

These expenses are created by the users and the data
is stored in PostgreSQL database.

The class diagram for our application is :

![spring-expensereport-class_diagram.png](/images/spring_tutorial/class_diagram.png)

Before creating Entities,delete `HomeController.java` from your `com.springsource.html5config` package and replace your pom.xml with the one below,
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.springsource</groupId>
    <artifactId>html5expense</artifactId>
    <name>SpringMVC-ExpenseReport</name>
    <packaging>war</packaging>
    <version>1.0.0-BUILD-SNAPSHOT</version>
    <properties>
        <java-version>1.6</java-version>
        <org.springframework-version>3.1.0.RELEASE</org.springframework-version>
        <org.aspectj-version>1.6.9</org.aspectj-version>
        <org.slf4j-version>1.5.10</org.slf4j-version>
        <org.spring-data-mongo-version>1.0.0.RELEASE</org.spring-data-mongo-version>
    </properties>
    <dependencies>
        <!-- Spring -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-context</artifactId>
            <version>${org.springframework-version}</version>
            <exclusions>
                <!-- Exclude Commons Logging in favor of SLF4j -->
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                 </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
         <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
         <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.8.1</version>
        </dependency>
        
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-aop</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-tx</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-orm</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
        <!-- Spring-Batch -->
        <dependency>
            <groupId>org.springframework.batch</groupId>
            <artifactId>spring-batch-core</artifactId>
            <version>2.1.6.RELEASE</version>
        </dependency>
                
        <!-- AspectJ -->
        <dependency>
            <groupId>org.aspectj</groupId>
            <artifactId>aspectjrt</artifactId>
            <version>${org.aspectj-version}</version>
        </dependency>    
        
        <!-- Logging -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>${org.slf4j-version}</version>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>jcl-over-slf4j</artifactId>
            <version>${org.slf4j-version}</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-log4j12</artifactId>
            <version>${org.slf4j-version}</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.15</version>
            <exclusions>
                <exclusion>
                    <groupId>javax.mail</groupId>
                    <artifactId>mail</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>javax.jms</groupId>
                    <artifactId>jms</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.sun.jdmk</groupId>
                    <artifactId>jmxtools</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>com.sun.jmx</groupId>
                    <artifactId>jmxri</artifactId>
                </exclusion>
            </exclusions>
            <scope>runtime</scope>
        </dependency>

        <!-- @Inject -->
        <dependency>
            <groupId>javax.inject</groupId>
            <artifactId>javax.inject</artifactId>
            <version>1</version>
        </dependency>
                
        <!-- Servlet  -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.5</version>
            <scope>provided</scope>
        </dependency>
       
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>jsp-api</artifactId>
            <version>2.1</version>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jstl</artifactId>
            <version>1.2</version>
        </dependency>
        
        
        <!-- CGLIB -->
        <dependency>
            <groupId>cglib</groupId>
            <artifactId>cglib</artifactId>
            <version>2.2.2</version>
        </dependency>

        <dependency>
            <groupId>org.hibernate</groupId>
            <artifactId>hibernate-entitymanager</artifactId>
            <version>4.0.0.Final</version>
        </dependency>

      <!-- POSTGRE SQL -->
        <dependency>
            <groupId>postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <version>9.1-901.jdbc4</version>
        </dependency>
        
        <dependency>
      <groupId>commons-dbcp</groupId>
      <artifactId>commons-dbcp</artifactId>
      <version>20030825.184428</version>
    </dependency>
    <dependency>
      <groupId>commons-pool</groupId>
      <artifactId>commons-pool</artifactId>
      <version>1.5.4</version>
    </dependency>
    <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>1.2.1</version>
    </dependency>
    <dependency>
      <groupId>commons-io</groupId>
      <artifactId>commons-io</artifactId>
      <version>1.3</version>
    </dependency>
    
        <!-- Test -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.7</version>
            <scope>test</scope>
        </dependency>        
        
                
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
        
        <!-- Spring Security   -->
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-core</artifactId>
            <version>3.0.5.RELEASE</version>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-web</artifactId>
            <version>3.0.5.RELEASE</version>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-config</artifactId>
            <version>3.0.5.RELEASE</version>
        </dependency>
        
        <dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-taglibs</artifactId>
    <version>3.0.5.RELEASE</version> 
</dependency>

<dependency>
      <groupId>taglibs</groupId>
      <artifactId>standard</artifactId>
      <version>1.1.2</version>
    </dependency>     
        
    </dependencies>
    <build>
        <plugins>
            <plugin>
                <artifactId>maven-eclipse-plugin</artifactId>
                <version>2.9</version>
                <configuration>
                    <additionalProjectnatures>
                        <projectnature>org.springframework.ide.eclipse.core.springnature</projectnature>
                    </additionalProjectnatures>
                    <additionalBuildcommands>
                        <buildcommand>org.springframework.ide.eclipse.core.springbuilder</buildcommand>
                    </additionalBuildcommands>
                    <downloadSources>true</downloadSources>
                    <downloadJavadocs>true</downloadJavadocs>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>2.3.2</version>
                <configuration>
                    <source>1.6</source>
                    <target>1.6</target>
                    <compilerArgument>-Xlint:all</compilerArgument>
                    <showWarnings>true</showWarnings>
                    <showDeprecation>true</showDeprecation>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <version>1.2.1</version>
                <configuration>
                    <mainClass>org.test.int1.Main</mainClass>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

```

## Add Entities
An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.

The application requires the following entities to be added. `Expense`,`User`,`Role`,`Attachment`,`ExpenseReport`,`State` classes.These classes are POJO with getters and setters for its properties and annotated with `@Entity`. By default JPA will take class name as table name. If you want to store in different table name then provide `@Table` annotation with name property. Create a package for entities as `com.springsource.html5expense.model` and add all entities to it.

```java
package com.springsource.html5expense.model;

import java.io.Serializable;
import java.util.Date;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;
import javax.persistence.Table;
import org.hibernate.annotations.Cascade;
import org.hibernate.annotations.CascadeType;

@Entity
@Table(name = "EXPENSE")
public class Expense implements Serializable{

    @Id
    @GeneratedValue
    private Long id;

    private String description;

    private Double amount;

    private State state = State.NEW;

    private Date expenseDate;

    @OneToOne
    private User user;

    @OneToOne
    private ExpenseType expenseType;

    @OneToOne
    private Attachment attachment;

    public Expense(){

    }

    public Expense(String description,ExpenseType expenseType,Date expenseDate,
            Double amount,User user,Attachment attachment){
        this.description = description;
        this.expenseType = expenseType;
        this.expenseDate = expenseDate;
        this.amount = amount;
        this.user = user;
        this.attachment = attachment;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }


    public State getState() {
        return state;
    }

    public void setState(State state) {
        this.state = state;
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public ExpenseType getExpenseType() {
        return expenseType;
    }

    public void setExpenseType(ExpenseType expenseType) {
        this.expenseType = expenseType;
    }

    public Double getAmount() {
        return amount;
    }

    public void setAmount(Double amount) {
        this.amount = amount;
    }

    public Date getExpenseDate() {
        return expenseDate;
    }

    public void setExpenseDate(Date expenseDate) {
        this.expenseDate = expenseDate;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    public Attachment getAttachment() {
        return attachment;
    }

    public void setAttachment(Attachment attachment) {
        this.attachment = attachment;
    }
}

```
The `@Id` annotation specifies the primary key of the entity and `@OneToOne` annotation defines a single-valued association to another entity that has one-to-one multiplicity.

```java
package com.springsource.html5expense.model;

import java.io.Serializable;
import java.sql.Blob;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Lob;

import org.hibernate.annotations.Type;

@Entity
public class Attachment implements Serializable{
    


    @Id
    @GeneratedValue
    private Long id;
    
    private String fileName;
    
    @Type(type="org.hibernate.type.BinaryType") 
    private byte[] content;
    
    private String contentType;
    
    public String getFileName() {
        return fileName;
    }

    public void setFileName(String fileName) {
        this.fileName = fileName;
    }

    public String getContentType() {
        return contentType;
    }

    public void setContentType(String contentType) {
        this.contentType = contentType;
    }
    
    
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getFileNmae() {
        return fileName;
    }

    public void setFileNmae(String fileNmae) {
        this.fileName = fileNmae;
    }

    public byte[] getContent() {
        return content;
    }

    public void setContent(byte[] content) {
        this.content = content;
    }

    public Attachment(){
        
    }
    public Attachment(String fileName,String contentType,byte[] content){
        this.content = content;
        this.contentType = contentType;
        this.fileName = fileName;
    }

}

```
```java
package com.springsource.html5expense.model;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;

@Entity
public class ExpenseReport {
    
    @Id
    @GeneratedValue
    private Long expenseReportId;
    
    
    @OneToOne
    private Expense expense;
    
    public  ExpenseReport(){
        
    }
    
    public Long getExpenseReportId() {
        return expenseReportId;
    }

    public void setExpenseReportId(Long expenseReportId) {
        this.expenseReportId = expenseReportId;
    }


    public Expense getExpense() {
        return expense;
    }

    public void setExpense(Expense expense) {
        this.expense = expense;
    }

    public  ExpenseReport(Expense expense){
        this.expense = expense;
    }

}

```

```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class ExpenseType implements Serializable {

    @Id
    @GeneratedValue
    private Long id;

    private String name;
    

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
    
    
}


```

```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class Role implements Serializable {

    @Id
    @GeneratedValue
    private Long roleId;
    
    public Long getRoleId() {
        return roleId;
    }

    public void setRoleId(Long roleId) {
        this.roleId = roleId;
    }

    public String getRoleName() {
        return roleName;
    }

    public void setRoleName(String roleName) {
        this.roleName = roleName;
    }

    private String roleName;
}


```
```java
package com.springsource.html5expense.model;

public enum State {

    NEW,
    
    OPEN,
    
    IN_REVIEW,
    
    REJECTED,
    
    APPROVED
}

```
```java
package com.springsource.html5expense.model;

import java.io.Serializable;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.OneToOne;
import javax.persistence.Table;

@Entity
@Table(name="USERS")
public class User implements Serializable{

    @Id
    @GeneratedValue
    private Long userId;

    private String userName;

    private String password;

    private String emailId;

    private boolean enabled;

    @OneToOne
    private Role role;

    public Role getRole() {
        return role;
    }

    public void setRole(Role role) {
        this.role = role;
    }

    public boolean isEnabled() {
        return enabled;
    }

    public void setEnabled(boolean enabled) {
        this.enabled = enabled;
    }

    public Long getUserId() {
        return userId;
    }

    public void setUserId(Long userId) {
        this.userId = userId;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getEmailId() {
        return emailId;
    }

    public void setEmailId(String emailId) {
        this.emailId = emailId;
    }

    public User(){

    }
    public User(String userName,String password,String mailId){
        this.userName = userName;
        this.password = password;
        this.emailId = mailId;
    }
}
```

## Add Service Interfaces
Create a package for service interfaces as `com.springsource.html5expense.service` and add `AttachmentService`,`ExpenseReportService`,`ExpenseService`,`ExpenseTypeService`,`UserService` interfaces which define the business methods.

```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.Attachment;

public interface AttachmentService {
    public void save(Attachment attachment);

    public Attachment getAttachment(Long attachmentId);

    public List<Attachment> getAttachmentByExpenseId(Long expenseId);

    public void deleteAttachment(Long id);
}
```
```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseReport;

public interface ExpenseReportService {

    public Long createExpenseReport(Expense expense);

    public ExpenseReport getExpenseReportById(Long expensReportId);

    public List getAllExpenseReports();
}
```
```java
package com.springsource.html5expense.service;

import java.util.Date;
import java.util.List;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.User;

public interface ExpenseService {

    public Long createExpense(String description,ExpenseType expenseType,Date expenseDate,
            Double amount,User user,Attachment attachment);

    public Expense getExpense(Long expenseId);

    public List getAllExpenses();

    public List<Expense> getExpensesByUser(User user);

    public List<Expense> getPendingExpensesList();

    public List<Expense> getApprovedAndRejectedExpensesList();

    public Expense changeExpenseStatus(Long expenseId,String state);

    public void deleteExpense(Long expenseId);

    public void updateExpense(Long expenseId,String description,Double amount,ExpenseType expenseType);
}
```
```java
package com.springsource.html5expense.service;

import java.util.List;

import com.springsource.html5expense.model.ExpenseType;

public interface ExpenseTypeService {

    public List<ExpenseType> getAllExpenseType();

    public ExpenseType getExpenseTypeById(Long id);
}
```
```java
package com.springsource.html5expense.service;

import com.springsource.html5expense.model.Role;

public interface RoleService {

    public Role getRole(Long id);

    public Role getRoleByName(String name);
}
```
```java
package com.springsource.html5expense.service;

import com.springsource.html5expense.model.Role;
import com.springsource.html5expense.model.User;

public interface UserService {

    public User getUserById(Long id);

    public User getUserByUserName(String userName);

    public User createUser(String userName,String password,String mailId,Role role);

}
```
## Add Service Implementation
Create a package `com.springsource.html5expense.serviceImpl` for service implementation and add the following JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl classes. Here we have autowired EntityManager bean which is responsible 
for persisting,removing,finding entities.@PersistenceContext which will use EntityManagerFactory to create EntityManager instance.

```java
package com.springsource.html5expense.serviceImpl;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.service.AttachmentService;

@Service
public class JpaAttachmentServiceImpl implements AttachmentService{

    private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    @Transactional
    public Attachment getAttachment(Long attachmentId){
        Attachment attachment = new Attachment();
        attachment.setId(attachmentId);
        attachment = entityManager.find(Attachment.class,attachmentId);
        return attachment;
    }

    @Transactional
    public void save(Attachment attachment){
        entityManager.persist(attachment);

    }

    @Transactional
    public List<Attachment> getAttachmentByExpenseId(Long expenseId){
        Query query = entityManager.createQuery("select a from Attachment a where a.expense.id =:expenseId");
        query.setParameter("expenseId", expenseId);

        List<Attachment> attachmentList = query.getResultList();
        return attachmentList;
    }

    @Transactional
    public void deleteAttachment(Long id){
        Attachment attchment = getAttachment(new Long(id));
        getEntityManager().remove(attchment);
    }


}
```
```java
package com.springsource.html5expense.serviceImpl;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.springframework.transaction.annotation.Transactional;

import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseReport;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.ExpenseReportService;

public class JpaExpenseReportServiceImpl implements ExpenseReportService {

private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    @Override
    @Transactional
    public Long createExpenseReport(Expense expense){
        ExpenseReport expenseReport = new ExpenseReport(expense);
        getEntityManager().persist(expenseReport);
        return expenseReport.getExpenseReportId();
    }

    @Override
    @Transactional
    public ExpenseReport getExpenseReportById(Long expenseReportId){
        ExpenseReport expenseReport = new ExpenseReport();
        expenseReport.setExpenseReportId(new Long(expenseReportId));
        expenseReport = getEntityManager().find(ExpenseReport.class, expenseReportId);
        return expenseReport;
    }

    @Override
    @Transactional
    public List getAllExpenseReports(){
        Query query = getEntityManager().createQuery("select e from expensereport e");
        return query.getResultList();
    }
}
```
```java
package com.springsource.html5expense.serviceImpl;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.hibernate.criterion.DetachedCriteria;
import org.hibernate.criterion.Restrictions;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseReport;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.State;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.service.UserService;



@Service
public class JpaExpenseServiceImpl implements ExpenseService {


    private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }


    private UserService userService;


    public UserService getUserService() {
        return userService;
    }

    @Autowired
    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    @Transactional
    public Long createExpense(String description,ExpenseType expenseType,Date expenseDate,
            Double amount,User user,Attachment attachment) {
        // TODO Auto-generated method stub
        Expense expense = new Expense(description,expenseType,expenseDate,amount,user,attachment);
        entityManager.persist(expense);
        return expense.getId();
    }


    @Transactional
    public Expense getExpense(Long expenseId){
        return entityManager.find(Expense.class, expenseId);
    }


    @Transactional
    public void remove(Integer id) {
         
        
    }

    @Override
    @Transactional
    public List getAllExpenses(){
        Query query = getEntityManager().createQuery("select e from Expense e");
        return query.getResultList();
    }

    @Override
    @Transactional
    public List<Expense> getExpensesByUser(User user){
        Query query = getEntityManager().createQuery("select e from Expense e where e.user.userId =:userId ORDER BY e.expenseDate DESC",Expense.class);
        query.setParameter("userId", user.getUserId());
        return query.getResultList();
    }

    @Override
    @Transactional
    public List<Expense> getPendingExpensesList(){
        List<Enum> state = new ArrayList<Enum>();
        state.add(State.NEW);
        state.add(State.OPEN);
        state.add(State.IN_REVIEW);
        Query query = entityManager.createQuery("select e from Expense e where e.state IN (:state) ORDER BY e.expenseDate DESC",Expense.class);
        query.setParameter("state", state);
        return query.getResultList();
    }

    @Override
    @Transactional
    public List<Expense> getApprovedAndRejectedExpensesList(){
        List<Enum> state = new ArrayList<Enum>();
        state.add(State.REJECTED);
        state.add(State.APPROVED);
        Query query = entityManager.createQuery("select e from Expense e where e.state IN (:state) e.expenseDate DESC",Expense.class);
        query.setParameter("state", state);
        return query.getResultList();
    }

    @Override
    @Transactional
    public Expense changeExpenseStatus(Long expenseId,String state){
        Expense expense = getExpense(expenseId);
        expense.setState(State.valueOf(state));
        getEntityManager().merge(expense);
        return expense;


    }

    @Override
    @Transactional
    public void deleteExpense(Long expenseId){
        Expense expense = getExpense(expenseId);
        expense.setAttachment(null);
        getEntityManager().remove(expense);

    }

    @Override
    @Transactional
    public void updateExpense(Long expenseId,String description,Double amount,ExpenseType expenseType){
        Expense expense = getExpense(expenseId);
        expense.setDescription(description);
        expense.setAmount(amount);
        expense.setExpenseType(expenseType);
        getEntityManager().merge(expense);


    }


}
```

```java
package com.springsource.html5expense.serviceImpl;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.springframework.stereotype.Service;

import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.service.ExpenseTypeService;

@Service
public class JpaExpenseTypeServiceImpl implements ExpenseTypeService {

private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    public List<ExpenseType> getAllExpenseType(){
        return getEntityManager().createQuery("from ExpenseType",ExpenseType.class).getResultList();
    }

    public ExpenseType getExpenseTypeById(Long id){
        return getEntityManager().find(ExpenseType.class, id);
    }

}
```

```java
package com.springsource.html5expense.serviceImpl;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.springsource.html5expense.model.Role;
import com.springsource.html5expense.service.RoleService;

@Service
public class JpaRoleServiceImpl implements RoleService{


    private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    @Transactional
    public Role getRole(Long id){
        return getEntityManager().find(Role.class, id);
    }

    @Transactional
    public Role getRoleByName(String name){
            Query query = getEntityManager().createQuery("select r from Role r where roleName =:roleName",Role.class);
            query.setParameter("roleName", name);
            return (query.getResultList()!=null && query.getResultList().size()>0)?(Role)query.getResultList().get(0):null;
    }
}
```

```java
package com.springsource.html5expense.serviceImpl;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.springsource.html5expense.model.Role;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.RoleService;
import com.springsource.html5expense.service.UserService;

@Service
public class JpaUserServiceImpl implements UserService{


    private EntityManager entityManager;

    public EntityManager getEntityManager() {
        return entityManager;
    }


    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this.entityManager = entityManager;
    }

    @Override
    public User getUserById(Long userId){
        return getEntityManager().find(User.class, userId);
    }

    @Override
    @Transactional
    public User getUserByUserName(String userName){
        Query query = getEntityManager().createQuery("from User u where u.userName =:username");
        query.setParameter("username",userName);
        return  (query.getResultList()!=null && query.getResultList().size()>0)?(User)(query.getResultList().get(0)):null;
    }

    @Override
    @Transactional
    public User createUser(String userName,String password,String mailId,Role role){
        User user = new User(userName,password,mailId);
        user.setEnabled(new Boolean(true));
        user.setRole(role);
        getEntityManager().persist(user);
        return user;

    }

}
```
One you added service implementation classes,make sure you are not getting errors.

## Add controller classes
Controller is reponsible for mapping requests.Use the `@RequestMapping` annotation to map web requests onto specific handler methods. Create a package for Controllers as `com.springsource.html5expense.controller` and add the following `ExpenseController`, `FileAttachmentController` classes.

```java
package com.springsource.html5expense.controller;

import java.security.Principal;
import java.sql.Blob;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.hibernate.Hibernate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.AttachmentService;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.service.ExpenseTypeService;
import com.springsource.html5expense.service.RoleService;
import com.springsource.html5expense.service.UserService;

@Controller
public class ExpenseController {


    @Autowired
    ExpenseService expenseService;

    @Autowired
    AttachmentService attachmentService;

    @Autowired
    ExpenseTypeService expenseTypeService;

    @Autowired 
    UserService userService;

    @Autowired
    RoleService roleService;

    public ExpenseService getExpenseService() {
        return expenseService;
    }

    public void setExpenseService(ExpenseService expenseService) {
        this.expenseService = expenseService;
    }

    public AttachmentService getAttachmentService() {
        return attachmentService;
    }

    public void setAttachmentService(AttachmentService attachmentService) {
        this.attachmentService = attachmentService;
    }

    public ExpenseTypeService getExpenseTypeService() {
        return expenseTypeService;
    }

    public void setExpenseTypeService(ExpenseTypeService expenseTypeService) {
        this.expenseTypeService = expenseTypeService;
    }

    public UserService getUserService() {
        return userService;
    }

    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    public RoleService getRoleService() {
        return roleService;
    }

    public void setRoleService(RoleService roleService) {
        this.roleService = roleService;
    }


    @RequestMapping(value="/loadApprovalExpenses" ,method = RequestMethod.GET)
    public String loadApprovedExpenses(ModelMap model){
        List<Expense> approvedExpenseList = getExpenseService().getPendingExpensesList();
        model.addAttribute("approvedExpenseList", approvedExpenseList);
        return "expenseapproval";

    }

    @RequestMapping(value="/deleteExpense",method=RequestMethod.GET)
    public String deleteExpense(HttpServletRequest request){
        String expenseId = request.getParameter("expenseId");
        Expense expense = getExpenseService().getExpense(new Long(expenseId));
        getExpenseService().deleteExpense(new Long(expenseId));
        return "redirect:/";
    }

    @RequestMapping(value="/editExpense",method=RequestMethod.GET)
    public String editExpense(HttpServletRequest request){
        String expenseId = request.getParameter("expenseId");
        Expense expense = getExpenseService().getExpense(new Long(expenseId));
        request.setAttribute("expense",expense);
        List<ExpenseType> expenseTypeList = expenseTypeService.getAllExpenseType();
        request.setAttribute("expenseTypeList", expenseTypeList);
        request.setAttribute("isEdit", "true");
        return "newexpense";
    }

    @RequestMapping(value="/changeState",method=RequestMethod.POST)
    public String changeState(HttpServletRequest request){
        String expenseId = request.getParameter("expenseId");
        String action = request.getParameter("action");
        getExpenseService().changeExpenseStatus(new Long(expenseId), action);
        List<Expense> approvedExpenseList = getExpenseService().getPendingExpensesList();
        request.setAttribute("approvedExpenseList", approvedExpenseList);
        return "expenseapproval";
    }


    @RequestMapping(value="/updateExpense",method=RequestMethod.POST)
    public String updateExpense(HttpServletRequest request){
        String expenseId = request.getParameter("expenseId");
        Expense expense = getExpenseService().getExpense(new Long(expenseId));
        String description = request.getParameter("description");
        String amount = request.getParameter("amount");
        String expenseTypeVal = request.getParameter("expenseTypeId");
        System.out.println("expense Id "+expenseTypeVal);
        ExpenseType expenseType = getExpenseTypeService().getExpenseTypeById(new Long(expenseTypeVal));
        expense.setExpenseType(expenseType);
        getExpenseService().updateExpense(new Long(expenseId), description, new Double(amount),expenseType);
        User user = (User)request.getSession().getAttribute("user");
        List<Expense> pendingExpenseList = getExpenseService().getExpensesByUser(user);
        request.setAttribute("pendingExpenseList",pendingExpenseList);
        return "myexpense";
    }

    @RequestMapping(value="/createNewExpenseReport",method = RequestMethod.POST)
    public String createNewExpenseReport(@RequestParam("file") MultipartFile file,HttpServletRequest request){
        String description = request.getParameter("description");
        String expenseTypeVal =request.getParameter("expenseTypeId");
        ExpenseType expenseType = expenseTypeService.getExpenseTypeById(new Long(expenseTypeVal));
        String amount = request.getParameter("amount");
        Date expenseDate = new Date();
        Double amountVal = new Double(amount);
        User user = (User)request.getSession().getAttribute("user");
        String fileName = "";
        String contentType = "";
        if(file!=null){
            try{
                            fileName =file.getOriginalFilename();
                            contentType = file.getContentType();
                            Attachment attachment = new Attachment(fileName, contentType,  file.getBytes());
                            attachmentService.save(attachment);
                            Long id = expenseService.createExpense(description,expenseType,expenseDate,
                    amountVal,user,attachment);
            }catch(Exception e){

            }
        }
        return "redirect:/";
    }

    @RequestMapping(value="/createNewExpense")
    public String createNewExpense(ModelMap model){

        List<ExpenseType> expenseTypeList = expenseTypeService.getAllExpenseType();
        model.addAttribute("expenseTypeList", expenseTypeList);
        return "newexpense";
    }

}
```
```java
package com.springsource.html5expense.controller;

import java.io.IOException;
import java.io.OutputStream;
import java.sql.Blob;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.hibernate.Hibernate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.util.FileCopyUtils;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.service.AttachmentService;
import com.springsource.html5expense.service.ExpenseService;



@Controller
public class FileAttachmentController {

        @Autowired
        private ExpenseService expenseService;

        @Autowired
        private AttachmentService attachmentService;

        @RequestMapping(value = "/save", method = RequestMethod.POST)
        public String save(@RequestParam("file") MultipartFile file) {
            try {

                String fileName =file.getOriginalFilename();
                String contentType = file.getContentType();
                Attachment attachment = new Attachment(fileName, contentType, file.getBytes());
                attachmentService.save(attachment);
            } catch (IOException e) {
                e.printStackTrace();
            }
            return "redirect:/index.html";
        }

        @RequestMapping(value="/download")
        public void download(HttpServletRequest request,HttpServletResponse response) throws Exception{
            String attachmentId = request.getParameter("attachmentId");
                     Attachment  attachment = this.attachmentService.getAttachment(new Long(attachmentId));
                     response.setContentType(attachment.getContentType());
                     response.setHeader("Content-Disposition","attachment; filename=\"" + attachment.getFileName() +"\"");
                     response.setHeader("cache-control", "must-revalidate");
                     OutputStream out = response.getOutputStream();
                     out.write(attachment.getContent());
                     out.flush();

        }
}
```

## Configure ExpenseReport application
We have to configure our application in order to make it ready to deploy. Create a new package `com.springsource.html5expense.config` and add the following ComponentConfig,WebConfig classes.We have marked ComponentConfig class with @Configuration annotation to configure our beans.This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the method's return value. By default, the bean name will be the same as the method name.

```java
package com.springsource.html5expense.config;

import java.util.HashMap;
import java.util.Map;

import javax.sql.DataSource;

import org.apache.commons.collections.map.HashedMap;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.ImportResource;
import org.springframework.context.annotation.PropertySource;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;
import org.springframework.orm.jpa.JpaTransactionManager;
import org.springframework.orm.jpa.JpaVendorAdapter;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
import org.springframework.orm.jpa.vendor.Database;
import org.springframework.orm.jpa.vendor.HibernateJpaDialect;
import org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import org.springframework.web.multipart.MultipartResolver;
import org.springframework.web.multipart.commons.CommonsMultipartResolver;

import com.springsource.html5expense.controller.FileAttachmentController;
import com.springsource.html5expense.controller.LoginController;
import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl;
import com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl;

@Configuration
@EnableTransactionManagement
@ImportResource({ "classpath:spring-security.xml"})
public class ComponentConfig {


    @Bean
    public DataSource dataSource()  {
        SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
        dataSource.setUrl(String.format("jdbc:postgresql://%s:%s/%s", "localhost", "5432", "postgres"));
        dataSource.setDriverClass(org.postgresql.Driver.class);
        dataSource.setUsername("postgres");
        dataSource.setPassword("postgres");
        return dataSource;
    }

    @Bean
    public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
        LocalContainerEntityManagerFactoryBean emfb = new LocalContainerEntityManagerFactoryBean();
        emfb.setJpaVendorAdapter( jpaAdapter());
        emfb.setDataSource(dataSource());
        emfb.setJpaPropertyMap(createPropertyMap());
        emfb.setJpaDialect(new HibernateJpaDialect());
        emfb.setPackagesToScan(new String[]{Expense.class.getPackage().getName()});
        return emfb;
    }

    public Map<String,String> createPropertyMap()
    {
        Map<String,String> map= new HashedMap();
        map.put(org.hibernate.cfg.Environment.HBM2DDL_AUTO, "create");
        map.put(org.hibernate.cfg.Environment.HBM2DDL_IMPORT_FILES, "import.sql");
        map.put("hibernate.c3p0.min_size", "5");
        map.put("hibernate.c3p0.max_size", "20");
        map.put("hibernate.c3p0.timeout", "360000");
        map.put("hibernate.dialect", "org.hibernate.dialect.PostgreSQLDialect");
        return map;

    }

    @Bean
    public JpaVendorAdapter jpaAdapter() {
        HibernateJpaVendorAdapter hibernateJpaVendorAdapter = new HibernateJpaVendorAdapter();
        hibernateJpaVendorAdapter.setShowSql(true);
        hibernateJpaVendorAdapter.setDatabase(Database.POSTGRESQL);
        hibernateJpaVendorAdapter.setShowSql(true);
        hibernateJpaVendorAdapter.setGenerateDdl(true);
        return hibernateJpaVendorAdapter;
    }


    @Bean
    public PlatformTransactionManager transactionManager() {
        final JpaTransactionManager transactionManager =
            new JpaTransactionManager();

        transactionManager.setEntityManagerFactory(entityManagerFactory().getObject());
        Map<String,String> jpaProperties = new HashMap<String,String>();
        jpaProperties.put("transactionTimeout","43200");
        transactionManager.setJpaPropertyMap(jpaProperties);

        return transactionManager;
    }

    @Bean
    public MultipartResolver multipartResolver(){
        CommonsMultipartResolver multipartResolver = new org.springframework.web.multipart.commons.CommonsMultipartResolver();
        multipartResolver.setMaxUploadSize(10000000);
        return multipartResolver;
    }

}
```
  @EnableTransactionManagement annotation is responsible for Spring's annotation-driven transaction management capability, similar to the support found in Spring's <tx:*> XML namespace. 

```java
package com.springsource.html5expense.config;

import java.util.List;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.MessageSource;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.PropertySource;
import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;
import org.springframework.context.support.ResourceBundleMessageSource;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.HandlerMethodReturnValueHandler;
import org.springframework.web.multipart.commons.CommonsMultipartResolver;
import org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;

import com.springsource.html5expense.controller.ExpenseController;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl;


@Configuration
@Import(ComponentConfig.class)
@EnableWebMvc
public class WebConfig extends WebMvcConfigurerAdapter
 {
     @Override
     public void addArgumentResolvers(List<HandlerMethodArgumentResolver> argumentResolvers) {

     }
    
    @Override
    public void configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

    @Bean
    public MessageSource messageSource() {
        String[] baseNames = "messages,errors".split(",");
        ResourceBundleMessageSource resourceBundleMessageSource = new ResourceBundleMessageSource();
        resourceBundleMessageSource.setBasenames(baseNames);
        return resourceBundleMessageSource;
    }

    @Bean
    public static PropertySourcesPlaceholderConfigurer placeholderConfigurer() {
        return new PropertySourcesPlaceholderConfigurer();
    }

    @Override
    public void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> returnValueHandlers) {

    }


}
```
* Create a new file `import.sql` in `src/main/resources` and add the below content in it.

	insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_USER');
	insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_MANAGER');
	insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval('hibernate_sequence'),'admin@expense.com',true,'admin','admin',2);
    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'MEDICAL');
    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TRAVEL');
    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TELEPHONE');
    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'GYM');
    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'EDUCATION');
	
To execute these statements automatically while app starts we have set 
these two Jpa properties.       
```java
map.put(org.hibernate.cfg.Environment.HBM2DDL_AUTO, "create");
map.put(org.hibernate.cfg.Environment.HBM2DDL_IMPORT_FILES, "import.sql");
```

* Then open your `src/main/webapp/WEB-INF/web.xml` and modify it to load this `ComponentConfig` class as part of contextConfiglocation as shown below,
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">

        <context-param>
            <param-name>contextClass</param-name>
            <param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext</param-value>
        </context-param>
        <context-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>com.springsource.html5expense.config</param-value>
        </context-param>
    <!-- Creates the Spring Container shared by all Servlets and Filters -->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>  

    <!-- Processes application requests  -->
    <servlet>
        <servlet-name>appServlet</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/spring/appServlet/servlet-context.xml ,
            </param-value>
        </init-param>
        <load-on-startup>2</load-on-startup>
    </servlet>

    <servlet-mapping>
        <servlet-name>appServlet</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping> 

    <servlet-mapping>
        <servlet-name>default</servlet-name>
        <url-pattern>/css/*</url-pattern>
    </servlet-mapping>
    <servlet-mapping>
        <servlet-name>default</servlet-name>
        <url-pattern>/images/*</url-pattern>
    </servlet-mapping>
</web-app>
```

## Add Spring Security to ExpenseReport App
This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have added already into pom.xml,

  + spring-security-core.jar
  + spring-security-web.jar
  + spring-security-config.jar

## Enable Spring Security:
To enable Spring security we need to add the following steps:
 1. Add a DelegatingFilterProxy in `src/main/webapp/WEB-INF/web.xml`
 2. Create a custom XML configuration named spring-security.xml in `src/main/resources`

In the web.xml declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.

```xml
<filter>
    <filter-name>springSecurityFilterChain</filter-name>
    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
</filter>
<filter-mapping>
    <filter-name>springSecurityFilterChain</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add "jdbc-user service" tag and define the query to get the data from database.

```xml
<beans:beans xmlns="http://www.springframework.org/schema/security"
    xmlns:beans="http://www.springframework.org/schema/beans" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/security
    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd">


    <http auto-config="true" use-expressions="true">
        <intercept-url pattern="/login" filters="none" />
        <intercept-url pattern="/logout" filters="none" />
        <intercept-url pattern="/signUp**" filters="none" />
        <intercept-url pattern="/resources/**" filters="none" />
        <intercept-url pattern="/loadApprovalExpenses" access="hasRole('ROLE_MANAGER')"/>
        <intercept-url pattern="/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/>
        <intercept-url pattern="/**" access="isAuthenticated()" />
        <form-login login-page="/login" default-target-url="/"
            authentication-failure-url="/loginfailed" />
        <logout logout-success-url="/logout" />
        <session-management invalid-session-url="/sessionTimeout" >
            <concurrency-control max-sessions="1" />
        </session-management>
    </http>
    <beans:bean id="sas" class="org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy" />

    <authentication-manager>
        <authentication-provider>
            <jdbc-user-service data-source-ref="dataSource"
 
           users-by-username-query="
              select username,password,enabled  
              from users where username=?" 
 
           authorities-by-username-query="
              select u.username, r.rolename from users u, role r 
              where u.role_roleid = r.roleid and u.username =?  " 
 
        />
        </authentication-provider>
    </authentication-manager>

</beans:beans>

```

To load this file as part of configuration add `@ImportResource({ "classpath:spring-security.xml"})` in `ComponentConfig` class.

Create `Logincontroller` in `com.springsource.html5expense.contoller` package and add mapping for login,logout,loginfailed,signup.

```java
package com.springsource.html5expense.controller;

import java.security.Principal;
import java.sql.Blob;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.hibernate.Hibernate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;

import com.springsource.html5expense.model.Attachment;
import com.springsource.html5expense.model.Expense;
import com.springsource.html5expense.model.ExpenseType;
import com.springsource.html5expense.model.Role;
import com.springsource.html5expense.model.User;
import com.springsource.html5expense.service.AttachmentService;
import com.springsource.html5expense.service.ExpenseService;
import com.springsource.html5expense.service.ExpenseTypeService;
import com.springsource.html5expense.service.RoleService;
import com.springsource.html5expense.service.UserService;

@Controller
public class LoginController {

    @Autowired
    ExpenseService expenseService;

    @Autowired
    AttachmentService attachmentService;

    @Autowired
    ExpenseTypeService expenseTypeService;

    @Autowired 
    UserService userService;

    @Autowired
    RoleService roleService;

    @RequestMapping(value="/", method = RequestMethod.GET)
    public String printWelcome(ModelMap model, Principal principal,HttpServletRequest request ) {
 
        String name = principal.getName();
        model.addAttribute("username", name);
        User user = getUserService().getUserByUserName(name);
        List<Expense> pendingExpenseList = getExpenseService().getExpensesByUser(user);
        model.addAttribute("pendingExpenseList",pendingExpenseList);
        request.getSession().setAttribute("user", user);
        return "myexpense";
 
    }

    @RequestMapping(value="/signUp",method=RequestMethod.GET)
    public String signUp(){
        String name="signUp";
        return name;

    } 

    @RequestMapping(value="/signUpUser",method=RequestMethod.POST)
    public String signUp(ModelMap model,HttpServletRequest request){
        String userName = request.getParameter("userName");
        String password = request.getParameter("password");
        String mailId = request.getParameter("email");

        User user = getUserService().getUserByUserName(userName);
        if(user == null){
            Role role = getRoleService().getRoleByName("ROLE_USER");
            user = getUserService().createUser(userName, password, mailId,role);
            return "redirect:/login";

        }else{
            String errorMsg = "User registration fails already same user name exists please try " +
                    "with different user name";
            request.setAttribute("errorMsg",errorMsg);
            return "redirect:/signUp?errorMsg="+errorMsg;
        }
    } 

    @RequestMapping(value="/login", method = RequestMethod.GET)
    public String login(ModelMap model) {
 
        return "login";
 
    }
 
    @RequestMapping(value="/loginfailed", method = RequestMethod.GET)
    public String loginerror(ModelMap model) {
 
        model.addAttribute("error", "true");
        return "login";
 
    }
 
    @RequestMapping(value="/logout", method = RequestMethod.GET)
    public String logout(ModelMap model) {
 
        return "login";
 
    }

    @RequestMapping(value="/sessionTimeout",method = RequestMethod.GET)
    public String sessionTimeout(ModelMap model){
        String errorMsg = "Session has expired .Please login";
        model.addAttribute("errorMsg",errorMsg);
        return "login";
    }


    public ExpenseService getExpenseService() {
        return expenseService;
    }

    public void setExpenseService(ExpenseService expenseService) {
        this.expenseService = expenseService;
    }

    public AttachmentService getAttachmentService() {
        return attachmentService;
    }

    public void setAttachmentService(AttachmentService attachmentService) {
        this.attachmentService = attachmentService;
    }

    public ExpenseTypeService getExpenseTypeService() {
        return expenseTypeService;
    }

    public void setExpenseTypeService(ExpenseTypeService expenseTypeService) {
        this.expenseTypeService = expenseTypeService;
    }

    public UserService getUserService() {
        return userService;
    }

    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    public RoleService getRoleService() {
        return roleService;
    }

    public void setRoleService(RoleService roleService) {
        this.roleService = roleService;
    }
 
}
```

## Add View Files
Add the following `login.jsp`,`expenseapproval.jsp`,`myexpense.jsp`,`newexpense.jsp`,`usermain.jsp`,`signUp.jsp` files in your `webapp/WEB-INF/view` folders.The login.jsp has two input elements for username and password as j_username and j_password.These are spring's placeholder for the username and password respectively. when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.

add the below jsp file as `login.jsp`

```jsp
<!DOCTYPE HTML>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
    <head>
        <title>1</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="blue-a">
            <div class="login-nav">
                
                <ul class="ul-a">
                    <li>
                        <i class="bg-logo-a"><img src="<c:url value="/resources/images/logo-a.png" /> "></i>
                    </li>
                    <li>
                        <a class="label-1" href="#">Login</a>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png"/>" ></i>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/signUp">Register</a>
                        
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-a">
            <c:if test="${not empty error}">
                <div class="errorblock">
                    Your login attempt was not successful, try again.<br /> Caused :
                    ${sessionScope["SPRING_SECURITY_LAST_EXCEPTION"].message}
                </div>
            </c:if>
            ${errorMsg}
            <form name='f' action="<c:url value='j_spring_security_check' />" method='POST'>
                <input class="textbox-a text-email" type="text" placeholder="Username" name="j_username" required="required">
                <input class="textbox-a" type="password" placeholder="Password" name="j_password" required="required">
                <button class="btn-a">Login</button>
            </form>
        </div>
        
        
    </body>
</html>
```
add the below jsp file as `expenseapproval.jsp`

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
 <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 <%@ taglib uri="http://displaytag.sf.net" prefix="display" %>
 <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>  
 
<!DOCTYPE HTML>
<html>
    <head>
        <title>4</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="<c:url value="resources/javascript/jquery-1.8.1.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.min.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.pager.js"/>" ></script>
        <script type="text/javascript">
          function changeState(contextPath,expenseId,rowCount){
              var actionVal =  document.getElementById('action_'+rowCount).value;
              var url = contextPath+"/changeState?action="+actionVal+"&expenseId="+expenseId;
              if(actionVal == null || actionVal =="" ){
                  return false;
              }
              document.forms[0].action=url;
              document.forms[0].submit();
              
          }
        </script>
    </head>
    <body>
        <div class="blue-b">
            <div class="inside-nav">
                <div class="topper">
                    <img class="bg-logo-b" src="<c:url value="/resources/images/logo-b.png" />" />
                    <ul class="nav-a">
                        <li>
                            <a href="#">Hi ${sessionScope.user.userName}</a> 
                        </li>
                        <li>
                            |
                        </li>
                        <li>
                            <a href="<c:url value="/j_spring_security_logout" />">Logout</a>
                        </li>
                    </ul>
                    
                </div>
                <ul class="ul-b">
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/">My Expenses</a>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png" />"></i>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/createNewExpense">New Expenses</a>
                        
                    </li>
                    <c:if test="${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}">
                        <li>
                            <a class="label-1" href="#">Approvals</a>
                        
                        </li>
                    </c:if>
                </ul>
            </div>
        </div>
        
        <div class="mc-a">
            <button class="btn-b add-expenses-btn"><img class="plus-a-img" src="<c:url value="/resources/images/plus-a.png"/> ">My Expenses
            </button>
            <h2 class="header label-2">
                Approvals Pending ${fn:length(approvedExpenseList)}
            </h2>
            
        <c:if test="${fn:length(approvedExpenseList) gt 0 }">
            <table class="table-a"  class="table-a">
                <thead>
                    <tr>
                        <td class="td-a">
                            <h5 class="label-3">Date<i class="bg-arrow-down-a"><img src="<c:url value="/resources/images/arrow-down-a.png"/>"></i> </h5>
                        </td>
                        <td  class="td-b">
                            <h5 class="label-3">Expense ID </h5>
                        </td>
                        <td  class="td-c">
                            <h5 class="label-3">Description </h5>
                        </td>
                        <td  class="td-d">
                            <h5 class="label-3">Status </h5>
                        </td>
                    </tr>
                </thead>
                 <tbody>
                <c:forEach var="expense" items="${approvedExpenseList}"  varStatus="rowCounter">
                    <input type="hidden" name="rowcount" value="${rowCounter.count}"/>
                    <tr class="tr-odd">
                        <td>
                            <h5 class="label-4">${expense.expenseDate}</h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.id}<img class="clip-b-img" src="<c:url value="/resources/images/clip-b.png" />" > </h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.description} </h5>
                        </td>
                        <td>
                            <h5 class="label-4"> 
                                <c:if test="${expense.state eq 'NEW' }"><form name="actionForm" id="actionForm" method="post">
                                <%-- <i class="alt-a label-5 green">
                                    <img class="right-a-img" src="<c:url value="/resources/images/right-a.png" /> ">
                                     Approved</i>
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/right-b.png" />" > Approved
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />"> </a>
                                </i> --%>
                                
                                <select id="action_${rowCounter.count}" name="${rowCounter.count}" style="font-size: 11px;" onchange="changeState('${pageContext.request.contextPath}','${expense.id}','${rowCounter.count}')">
                                    <option value="PENDING">     Pending    </option>
                                    <option value="APPROVED">    Approve    </option>
                                    <option value="REJECTED">    Reject     </option>
                                </select>
                                    </form>
                                </c:if>
                                
                                <c:if test="${expense.state eq 'REJECTED' }">
                                 <i class="alt-a label-5 red"><img class="cross-a-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected</i> 
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />" > </a>
                                </i>
                                </c:if>
                                
                                
                            </h5>
                        </td>
                    </tr>
                    
                    </c:forEach>
                </tbody>
                
            </table> 
    
    <div id="pager"  class="pagination pagination-1" >

        <form >
            <img src="<c:url value="/resources/images/first.png"/>"  class="first"/>

            <img src="<c:url value="/resources/images/prev.png"/>"  class="prev"/>

            <input type="text"  class="pagedisplay"/>

            <img src="<c:url value="/resources/images/next1.png" />"  class="next"/>

            <img src="<c:url value="/resources/images/last.png" />"  class="last"/>

            <select  class="pagesize">

                <option selected="selected"  value="10">10</option>

                <option value="20">20</option>

                <option value="30">30</option>

                <option  value="40">40</option>

            </select>

        </form>

    </div>
    
    </c:if>
            
        </div>
<script>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
</script>
    </body>
    
</html>
```
add the below jsp file as `myexpense.jsp`

```jsp
<!DOCTYPE HTML>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>  
<html>
    <head>
        <title>2</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="<c:url value="resources/javascript/jquery-1.8.1.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.min.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.pager.js"/>" ></script>

        
    </head>
    <body>
        <div class="blue-b">
            <div class="inside-nav">
                <div class="topper">
                    <img class="bg-logo-b" src="<c:url value="/resources/images/logo-b.png" />" />
                    <ul class="nav-a">
                        <li>
                            <a href="#">Hi ${sessionScope.user.userName} </a> 
                        </li>
                        <li>
                            |
                        </li>
                        <li>
                            <a href="<c:url value="/j_spring_security_logout" />">Logout</a> 
                        </li>
                    </ul>
                    
                </div>
                <ul class="ul-b">
                    <li>
                        <a class="label-1" href="#">My Expenses</a>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png" />" /></i>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/createNewExpense">New Expenses</a>
                        
                    </li>
                    <c:if test="${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}">
                        <li>
                            <a class="label-1" href="${pageContext.request.contextPath}/loadApprovalExpenses">Approvals</a>
                        
                        </li>
                    </c:if>
                </ul>
            </div>
        </div>
        
        <div class="mc-a">
            <h2 class="header label-2">
                Expenses
            </h2>
            
        <c:if test="${fn:length(pendingExpenseList) gt 0 }">
            <table  id="table-a" class="table-a">
                <thead>
                    <tr>
                    <td class="td-b">
                        <h5 class="label-3">Attachment <img class="clip-b-img" src="<c:url value="/resources/images/clip-b.png" />"></h5>
                    </td>
                        <td class="td-b">
                            <h5 class="label-3">Date </h5>
                        </td>
                        <td  class="td-b">
                            <h5 class="label-3">Expense Type </h5>
                        </td>
                        <td  class="td-c">
                            <h5 class="label-3">Description </h5>
                        </td>
                        <td  class="td-d">
                            <h5 class="label-3">Status </h5>
                        </td>
                    </tr>
                </thead>
                <tbody>
                <c:forEach var="expense" items="${pendingExpenseList}">
                    <tr class="tr-odd">
                        <td>
                            <c:if test="${not empty expense.attachment.fileName}">
                             <a href="${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"><img class="clip-b-img" src="<c:url value="/resources/images/clip-b.png" />"></a>
                            </c:if>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.expenseDate} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.expenseType.name} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.description} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">
                                <c:if test="${expense.state eq 'NEW' }">
                                <i class="alt-a label-5 blue">
                                    <img class="right-a-img" src="<c:url value="/resources/images/question-a.png" /> ">
                                     Pending</i>
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/right-b.png" />" > Pending
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />"> </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                
                                </c:if>
                                <c:if test="${expense.state eq 'APPROVED' }">
                                <i class="alt-a label-5 green">
                                    <img class="right-a-img" src="<c:url value="/resources/images/right-a.png" /> ">
                                     Approved</i>
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/right-b.png" />" > Approved
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />"> </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                </c:if>
                                <c:if test="${expense.state eq 'REJECTED' }">
                                 <i class="alt-a label-5 red"><img class="cross-a-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected</i> 
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />" > </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                </c:if>
                            </h5>
                        </td>
                    </tr>    
                </c:forEach>
                </tbody>
            </table>
                         
        <div id="pager"  class="pagination pagination-1" >
        <form>
            <img src="<c:url value="/resources/images/first.png"/>"  class="first"/>
            <img src="<c:url value="/resources/images/prev.png"/>"  class="prev"/>
            <input type="text"  class="pagedisplay"/>
            <img src="<c:url value="/resources/images/next1.png" />"  class="next"/>
            <img src="<c:url value="/resources/images/last.png" />"  class="last"/>
            <select  class="pagesize">
                <option selected="selected"  value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option  value="40">40</option>
            </select>
        </form>
    </div>
        </c:if>
            
        </div>
<script>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
</script>
    </body>
</html>
```
add the below jsp file as `newexpense.jsp`
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
 <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
    
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>3</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="blue-b">
            <div class="inside-nav">
                <div class="topper">
                    <img class="bg-logo-b" src="<c:url value="/resources/images/logo-b.png" />" />
                    <ul class="nav-a">
                        <li>
                            <a href="#">Hi ${sessionScope.user.userName}</a> 
                        </li>
                        <li>
                            |
                        </li>
                        <li>
                            <a href="<c:url value="/j_spring_security_logout" />">Logout</a>
                        </li>
                    </ul>
                </div>
                <ul class="ul-b">
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/">My Expenses</a>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/createNewExpense">New Expense</a>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png" />"></i>
                    </li>
                    <c:if test="${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}">
                        <li>
                            <a class="label-1" href="${pageContext.request.contextPath}/loadApprovalExpenses">Approvals</a>
                        </li>
                   </c:if>
                </ul>
            </div>
        </div>
        <c:choose>
        <c:when test="${isEdit eq 'true'}">
            <div class="mc-a">
            <button class="btn-b my-expenses-btn"><img class="arrow-left-a-img" src="<c:url value="/resources/images/arrow-left-a.png" /> ">My Expenses
            </button>
            <h2 class="header label-2"> Editing an expense </h2>
            <form action="${pageContext.request.contextPath}/updateExpense" method="post" enctype="multipart/form-data">
            <textarea class="textbox-a" id="description" name="description" placeholder="description">${expense.description}</textarea><br>
            <input type="hidden" name="expenseId" id="expenseId" value="${expense.id}" />
            <input class="textbox-a" type="text" placeholder="Amount" name="amount" value="${expense.amount}"></input>
            <div class="action-a">
                <!-- <div class="textbox-a dd-a flt-left">
                Select Type <img class="arrow-down-c-img" src="<c:url value="/resources/images/arrow-down-c.png" />">  -->
                <select id="expenseTypeId" name="expenseTypeId">
                    <c:forEach var="expenseType" items="${expenseTypeList}">
                        
                          <c:if test="${expense.expenseType.name eq expenseType.name }">
                            <option value="${expenseType.id}" selected="selected">${expenseType.name}</option>
                        </c:if>
                         <c:if test="${expense.expenseType.name ne expenseType.name }">
                            <option value="${expenseType.id}">${expenseType.name}</option>
                        </c:if>
                    </c:forEach>
                </select>
                <!-- </div> -->
                <%-- <a class="label-7 flt-right" href="#"><img class="clip-a-img" src="<c:url value="/resources/images/clip-a.png" />"> --%>
                 <input type="file" name="file" id="file" class="file" /> <!-- Attach Receipt </a> -->
            </div>
            <button class="btn-a add-expense-btn">SAVE EXPENSE</button>
            </form>
        </div>
        </c:when>
        <c:otherwise>
        <div class="mc-a">
            <button class="btn-b my-expenses-btn"><img class="arrow-left-a-img" src="<c:url value="/resources/images/arrow-left-a.png" /> ">My Expenses
            </button>
            <h2 class="header label-2"> Adding new expense </h2>
            <form action="${pageContext.request.contextPath}/createNewExpenseReport" method="post" enctype="multipart/form-data">
            <textarea class="textbox-a" id="description" name="description" placeholder="description" required="required"  ></textarea><br>
            <input class="textbox-a" type="number" placeholder="Amount" name="amount" required="required"  max="100000" ></input>
            <div class="action-a">
            <!--     <div class="textbox-a dd-a flt-left"> -->
                <select id="expenseTypeId" name="expenseTypeId" style="    border: 1px solid #b8b8b8;
                box-shadow: 0px 2px 0px 0px #b8b8b8;padding: 12px;font-size: 11px;color: #a7a5a6;width:100px;    margin:10px;">
                    <option value="">                         </option>
                    <c:forEach var="expenseType" items="${expenseTypeList}">
                        <option value="${expenseType.id}">    ${expenseType.name}    </option>
                    </c:forEach>
                </select>
                <!-- </div>
                 <a class="label-7 flt-right" href="#"><img class="clip-a-img" src="<c:url value="/resources/images/clip-a.png" />">  -->
                 <input type="file" name="file" id="file" title="Attachment"  class="file"/>
                <!-- </a> -->
            </div>
            <button class="btn-a add-expense-btn">ADD EXPENSE</button>
            </form>
        </div>
        </c:otherwise>
        </c:choose>
    </body>
</html>
```
add the below jsp file as `usermain.jsp`
```jsp
<!DOCTYPE HTML>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
 <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>  
<html>
    <head>
        <title>2</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="<c:url value="resources/javascript/jquery-1.8.1.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.min.js"/>" ></script>
        <script src="<c:url value="resources/javascript/jquery.tablesorter.pager.js"/>" ></script>

        
    </head>
    <body>
        <div class="blue-b">
            <div class="inside-nav">
                <div class="topper">
                    <img class="bg-logo-b" src="<c:url value="/resources/images/logo-b.png" />" />
                    <ul class="nav-a">
                        <li>
                            <a href="#">Hi ${sessionScope.user.userName} </a> 
                        </li>
                        <li>
                            |
                        </li>
                        <li>
                            <a href="<c:url value="/j_spring_security_logout" />">Logout</a> 
                        </li>
                    </ul>
                    
                </div>
                <ul class="ul-b">
                    <li>
                        <a class="label-1" href="#">My Expenses</a>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png" />" /></i>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/createNewExpense">New Expenses</a>
                        
                    </li>
                    <c:if test="${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}">
                        <li>
                            <a class="label-1" href="${pageContext.request.contextPath}/loadApprovalExpenses">Approvals</a>
                        
                        </li>
                    </c:if>
                </ul>
            </div>
        </div>
        
        <div class="mc-a">
            <h2 class="header label-2">
                Expenses
            </h2>
            
        <c:if test="${fn:length(pendingExpenseList) gt 0 }">
            <table  id="table-a" class="table-a">
                <thead>
                    <tr>
                    <td class="td-b">
                        <h5 class="label-3">Attachment <img class="clip-b-img" src="<c:url value="/resources/images/clip-b.png" />"></h5>
                    </td>
                        <td class="td-b">
                            <h5 class="label-3">Date </h5>
                        </td>
                        <td  class="td-b">
                            <h5 class="label-3">Expense Type </h5>
                        </td>
                        <td  class="td-c">
                            <h5 class="label-3">Description </h5>
                        </td>
                        <td  class="td-d">
                            <h5 class="label-3">Status </h5>
                        </td>
                    </tr>
                </thead>
                <tbody>
                <c:forEach var="expense" items="${pendingExpenseList}">
                    <tr class="tr-odd">
                        <td>
                            <c:if test="${not empty expense.attachment.fileName}">
                             <a href="${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"><img class="clip-b-img" src="<c:url value="/resources/images/clip-b.png" />"></a>
                            </c:if>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.expenseDate} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.expenseType.name} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">${expense.description} </h5>
                        </td>
                        <td>
                            <h5 class="label-4">
                                <c:if test="${expense.state eq 'NEW' }">
                                <i class="alt-a label-5 blue">
                                    <img class="right-a-img" src="<c:url value="/resources/images/question-a.png" /> ">
                                     Pending</i>
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/right-b.png" />" > Pending
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />"> </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                
                                </c:if>
                                <c:if test="${expense.state eq 'APPROVED' }">
                                <i class="alt-a label-5 green">
                                    <img class="right-a-img" src="<c:url value="/resources/images/right-a.png" /> ">
                                     Approved</i>
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/right-b.png" />" > Approved
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />"> </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                </c:if>
                                <c:if test="${expense.state eq 'REJECTED' }">
                                 <i class="alt-a label-5 red"><img class="cross-a-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected</i> 
                                <i class="alt-b label-6">
                                    <img class="right-b-img" src="<c:url value="/resources/images/cross-a.png" />" > Rejected
                                    <a href="${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}" class="bg-cross-b"><img class="cross-b-img" src="<c:url value="/resources/images/cross-b.png" />" > </a>
                                    <a href="${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}" class="bg-cross-c"><img class="cross-b-img" src="<c:url value="/resources/images/edit1.jpg" />"> </a>
                                </i>
                                </c:if>
                            </h5>
                        </td>
                    </tr>    
                </c:forEach>
                </tbody>
            </table>
        <div id="pager"  class="pagination pagination-1" >

        <form>
            <img src="<c:url value="/resources/images/first.png"/>"  class="first"/>
            <img src="<c:url value="/resources/images/prev.png"/>"  class="prev"/>
            <input type="text"  class="pagedisplay"/>
            <img src="<c:url value="/resources/images/next1.png" />"  class="next"/>
            <img src="<c:url value="/resources/images/last.png" />"  class="last"/>
            <select  class="pagesize">
                <option selected="selected"  value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option  value="40">40</option>
            </select>
        </form>
    </div>
        </c:if>
</div>
<script>
    jQuery(document).ready(function() {
    jQuery("#table-a")
   .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });

</script>
    </body>
</html>
```
add the below jsp file as `signUp.jsp`
```jsp
<!DOCTYPE HTML>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
    <head>
        <title>1</title>
        <link rel="stylesheet" href="<c:url value="/resources/css/style.css" />" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript">
        
        function ValidateEmail() 
        {
         var email = document.getElementById("email");
         var errorblock = document.getElementById("errorblock");
         if(email!=null && email.value!=""){
         if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email.value))
          {
             alert("email1"+email.value);
            return true;
          }
             errorblock.innerHTML = "Please Enter valid Email Address";
            return false;
         }else{
             alert("please enter email address!");
             return false;
         }
        }
        </script>
    </head>
    <body>
        <div class="blue-a">
            <div class="login-nav">
                
                <ul class="ul-a">
                    <li>
                        <i class="bg-logo-a"><img src="<c:url value="/resources/images/logo-a.png" /> "></i>
                    </li>
                    <li>
                        <a class="label-1" href="${pageContext.request.contextPath}/login">Login</a>
                    </li>
                    <li>
                        <i class="bg-arrow-right-a"><img class="arrow-right-a-img" src="<c:url value="/resources/images/arrow-right-a.png" /> "></i>
                        <a class="label-1" href="#">Register</a>
                        
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="main-a">
            <c:if test="${not empty param.errorMsg}">
            
                <div class="errorblock">
                    ${param.errorMsg}
                </div>
            </c:if>
        <br><br><br>
             <form action="${pageContext.request.contextPath}/signUpUser" method="post">
                    <input class="textbox-a text-email" type="email" placeholder="Email" id="email" name="email" required="required" >
                    <input class="textbox-a" type="text" placeholder="UserName" id="userName" name="userName" required="required">
                    <input class="textbox-a" type="password" placeholder="Password" id="password" name="password" required="required">
                    <button class="btn-a">Submit</button>
            </form>
        </div>
        
        
    </body>
</html>
```

## Build and Run the App Locally
Now we have successfully created expensereport application.we can run the application in locally to test it.
Select `Run As -> Maven clean`
![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completed select` Run As -> Maven install`.It will download dependencies from pom.xml.
![maven_install.png](/images/spring_tutorial/maven_install.png)

Select `Run As -> Maven build`
![maven_build.png](/images/spring_tutorial/maven_build.png)

And give Maven goal as , `tomcat:run`
![maven_run.png](/images/spring_tutorial/maven_run.png)

![STS Fabric Server.png](/images/spring_tutorial/localhost_login.png)


Once server starts completed,STS will open the home page for the project which dispalys login page.

![spring-expensereport-login.png](/images/spring_tutorial/localhost_login.png)

![spring-expensereport-create_expense.png](/images/spring_tutorial/create_new_expense.png)

![spring-expensereport-user_expense.png](/images/spring_tutorial/my_expense.png)


## Deploy the App on Cloud Foundry Using VMC
Deployment to Cloud Foundry can be done in two simple steps:

+  Create war file
+  Push the war file using `vmc push`

Commands below show the exact commands and output when the app is deployed:

Go to your project work space and issue the following commands.

``` bash
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
```

## Deploy the App on Cloud Foundry Using STS
1.     Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry.png)

2.     Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
![cloud foundry account information.png](/images/spring_tutorial/cloud_foundry_account.png)

3.     Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry_project_deploy.png) 
![spring-expensereport-project-deploy.png](/images/spring_tutorial/project_deploy_step2.png)

4.     Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
![spring-expensereport-project-deploy-step-2.png](/images/spring_tutorial/project_deploy_step3.png)

5.     Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
![service_selection.png](/images/spring_tutorial/service_selection.png)
![create_new_service.png](/images/spring_tutorial/create_new_service.png)

6.     Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
![spring-expensereport-login.png](/images/spring_tutorial/service_selection_1.png)


Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![deployed_application_in_cloud_foundry.png](/images/spring_tutorial/deployed_application_in_cloud_foundry.png);T;
I"†²<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A <a href="/tools/STS/configuring-STS.html">Cloud Foundry plugin for STS</a>.</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take the following use case.</p>

<p>Create and Deploy an Expense Reporting App on Cloud Foundry.</p>

<h2 id="subtopics">Subtopics</h2>

<ul>
<li><a href="#create-spring-mvc-template-project">Create Spring MVC Template Project</a></li>
  <li><a href="#expensereport-app">Create an Expense Reporting app</a></li>
  <li><a href="#add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</a></li>
  <li><a href="#build-and-run-the-app-locally">Build and Run the App Locally</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</a></li>
  <li><a href="#deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</a></li>
</ul><h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>

<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC. Please open your STS and select dashboard by clicking,
    <code>Help -&gt; Dashboard</code></p>

<p>From the dashboard view select Spring Template Project.Window shown below opens up.
<img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS will ask you to download some extra elements from the Internet.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project name as <code>expensereport</code> and top-level package as <code>com.springsource.html5expense</code></p>

<p>Click on <code>Finish</code> â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completes, select <code>Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server start is completed, open your browser and go to our application url <code>http://localhost:8080/html5expense</code> it will open the home page for the project which displays 
Hello world message with the current server time.
<img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<h2 id="expensereport-app">ExpenseReport App</h2>

<p>ExpenseReport is used to create and manage expenses.</p>

<p>In expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in PostgreSQL database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before creating Entities,delete <code>HomeController.java</code> from your <code>com.springsource.html5config</code> package and replace your pom.xml with the one below,</p>
<pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.springsource<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>html5expense<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;name&gt;</span>SpringMVC-ExpenseReport<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0-BUILD-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java-version&gt;</span>1.6<span class="nt">&lt;/java-version&gt;</span>
        <span class="nt">&lt;org.springframework-version&gt;</span>3.1.0.RELEASE<span class="nt">&lt;/org.springframework-version&gt;</span>
        <span class="nt">&lt;org.aspectj-version&gt;</span>1.6.9<span class="nt">&lt;/org.aspectj-version&gt;</span>
        <span class="nt">&lt;org.slf4j-version&gt;</span>1.5.10<span class="nt">&lt;/org.slf4j-version&gt;</span>
        <span class="nt">&lt;org.spring-data-mongo-version&gt;</span>1.0.0.RELEASE<span class="nt">&lt;/org.spring-data-mongo-version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- Spring --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="c">&lt;!-- Exclude Commons Logging in favor of SLF4j --&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
                 <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
         <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.8.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-orm<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring-Batch --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.batch<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-batch-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.6.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- AspectJ --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.aspectj-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>    
        
        <span class="c">&lt;!-- Logging --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.slf4j-version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2.15<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.mail<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>mail<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>javax.jms<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jms<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jdmk<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxtools<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>com.sun.jmx<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>jmxri<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- @Inject --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.inject<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javax.inject<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
                
        <span class="c">&lt;!-- Servlet  --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>servlet-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.5<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
       
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet.jsp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        
        <span class="c">&lt;!-- CGLIB --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cglib<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cglib<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.2.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.0.0.Final<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

      <span class="c">&lt;!-- POSTGRE SQL --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>postgresql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>9.1-901.jdbc4<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-dbcp<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-dbcp<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>20030825.184428<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-pool<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-pool<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.5.4<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-fileupload<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-fileupload<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>commons-io<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>commons-io<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    
        <span class="c">&lt;!-- Test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.7<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>        
        
                
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${org.springframework-version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="c">&lt;!-- Spring Security   --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-web<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-security-taglibs<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span> 
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>taglibs<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>standard<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>     
        
    <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-eclipse-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.9<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;additionalProjectnatures&gt;</span>
                        <span class="nt">&lt;projectnature&gt;</span>org.springframework.ide.eclipse.core.springnature<span class="nt">&lt;/projectnature&gt;</span>
                    <span class="nt">&lt;/additionalProjectnatures&gt;</span>
                    <span class="nt">&lt;additionalBuildcommands&gt;</span>
                        <span class="nt">&lt;buildcommand&gt;</span>org.springframework.ide.eclipse.core.springbuilder<span class="nt">&lt;/buildcommand&gt;</span>
                    <span class="nt">&lt;/additionalBuildcommands&gt;</span>
                    <span class="nt">&lt;downloadSources&gt;</span>true<span class="nt">&lt;/downloadSources&gt;</span>
                    <span class="nt">&lt;downloadJavadocs&gt;</span>true<span class="nt">&lt;/downloadJavadocs&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.3.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                    <span class="nt">&lt;compilerArgument&gt;</span>-Xlint:all<span class="nt">&lt;/compilerArgument&gt;</span>
                    <span class="nt">&lt;showWarnings&gt;</span>true<span class="nt">&lt;/showWarnings&gt;</span>
                    <span class="nt">&lt;showDeprecation&gt;</span>true<span class="nt">&lt;/showDeprecation&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.2.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;mainClass&gt;</span>org.test.int1.Main<span class="nt">&lt;/mainClass&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>

<h2 id="add-entities">Add Entities</h2>
<p>An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.</p>

<p>The application requires the following entities to be added. <code>Expense</code>,<code>User</code>,<code>Role</code>,<code>Attachment</code>,<code>ExpenseReport</code>,<code>State</code> classes.These classes are POJO with getters and setters for its properties and annotated with <code>@Entity</code>. By default JPA will take class name as table name. If you want to store in different table name then provide <code>@Table</code> annotation with name property. Create a package for entities as <code>com.springsource.html5expense.model</code> and add all entities to it.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Cascade</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.annotations.CascadeType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(){</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Expense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">State</span> <span class="nf">getState</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setState</span><span class="o">(</span><span class="n">State</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseType</span><span class="o">(</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseType</span> <span class="o">=</span> <span class="n">expenseType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getAmount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getExpenseDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseDate</span> <span class="o">=</span> <span class="n">expenseDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachment</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachment</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>The <code>@Id</code> annotation specifies the primary key of the entity and <code>@OneToOne</code> annotation defines a single-valued association to another entity that has one-to-one multiplicity.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Lob</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.annotations.Type</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Attachment</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
    


    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
    
    <span class="nd">@Type</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="s">"org.hibernate.type.BinaryType"</span><span class="o">)</span> 
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">contentType</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContentType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContentType</span><span class="o">(</span><span class="n">String</span> <span class="n">contentType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
    <span class="o">}</span>
    
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileNmae</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileNmae</span><span class="o">(</span><span class="n">String</span> <span class="n">fileNmae</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileNmae</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(){</span>
        
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Attachment</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">contentType</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseReport</span> <span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">;</span>
    
    
    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Expense</span> <span class="n">expense</span><span class="o">;</span>
    
    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(){</span>
        
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getExpenseReportId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseReportId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseReportId</span> <span class="o">=</span> <span class="n">expenseReportId</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpense</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span>  <span class="nf">ExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expense</span> <span class="o">=</span> <span class="n">expense</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseType</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    
    
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">roleId</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="n">Long</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoleName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleName</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleName</span> <span class="o">=</span> <span class="n">roleName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">roleName</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>

    <span class="n">NEW</span><span class="o">,</span>
    
    <span class="n">OPEN</span><span class="o">,</span>
    
    <span class="n">IN_REVIEW</span><span class="o">,</span>
    
    <span class="n">REJECTED</span><span class="o">,</span>
    
    <span class="n">APPROVED</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"USERS"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">emailId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">enabled</span><span class="o">;</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Role</span> <span class="n">role</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRole</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">role</span> <span class="o">=</span> <span class="n">role</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEnabled</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnabled</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">enabled</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="n">enabled</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserId</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmailId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmailId</span><span class="o">(</span><span class="n">String</span> <span class="n">emailId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">emailId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(){</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">emailId</span> <span class="o">=</span> <span class="n">mailId</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="add-service-interfaces">Add Service Interfaces</h2>
<p>Create a package for service interfaces as <code>com.springsource.html5expense.service</code> and add <code>AttachmentService</code>,<code>ExpenseReportService</code>,<code>ExpenseService</code>,<code>ExpenseTypeService</code>,<code>UserService</code> interfaces which define the business methods.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AttachmentService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseReportService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expensReportId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">();</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseTypeService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RoleService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">);</span>

<span class="o">}</span></code></pre>

<h2 id="add-service-implementation">Add Service Implementation</h2>
<p>Create a package <code>com.springsource.html5expense.serviceImpl</code> for service implementation and add the following JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl classes. Here we have autowired EntityManager bean which is responsible 
for persisting,removing,finding entities.@PersistenceContext which will use EntityManagerFactory to create EntityManager instance.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaAttachmentServiceImpl</span> <span class="kd">implements</span> <span class="n">AttachmentService</span><span class="o">{</span>

    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Attachment</span> <span class="nf">getAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">attachmentId</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">();</span>
        <span class="n">attachment</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="n">attachment</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Attachment</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">attachmentId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">){</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">getAttachmentByExpenseId</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select a from Attachment a where a.expense.id =:expenseId"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Attachment</span><span class="o">&gt;</span> <span class="n">attachmentList</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">attachmentList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="n">Attachment</span> <span class="n">attchment</span> <span class="o">=</span> <span class="n">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">attchment</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseReportService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseReportServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseReportService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpenseReport</span><span class="o">(</span><span class="n">Expense</span> <span class="n">expense</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">expenseReport</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">.</span><span class="na">getExpenseReportId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">ExpenseReport</span> <span class="nf">getExpenseReportById</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseReportId</span><span class="o">){</span>
        <span class="n">ExpenseReport</span> <span class="n">expenseReport</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExpenseReport</span><span class="o">();</span>
        <span class="n">expenseReport</span><span class="o">.</span><span class="na">setExpenseReportId</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseReportId</span><span class="o">));</span>
        <span class="n">expenseReport</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseReport</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseReportId</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expenseReport</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenseReports</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from expensereport e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.criterion.DetachedCriteria</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.criterion.Restrictions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseReport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.State</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>



<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseService</span> <span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Expense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span><span class="n">amount</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
        <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
         
        
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">(){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.user.userId =:userId ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getUserId</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">OPEN</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">IN_REVIEW</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) ORDER BY e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">(){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Enum</span><span class="o">&gt;();</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">REJECTED</span><span class="o">);</span>
        <span class="n">state</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">APPROVED</span><span class="o">);</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select e from Expense e where e.state IN (:state) e.expenseDate DESC"</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setState</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">state</span><span class="o">));</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">expense</span><span class="o">;</span>


    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAttachment</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">){</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpense</span><span class="o">(</span><span class="n">expenseId</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="n">description</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setAmount</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">merge</span><span class="o">(</span><span class="n">expense</span><span class="o">);</span>


    <span class="o">}</span>


<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaExpenseTypeServiceImpl</span> <span class="kd">implements</span> <span class="n">ExpenseTypeService</span> <span class="o">{</span>

<span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">getAllExpenseType</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from ExpenseType"</span><span class="o">,</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getResultList</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseType</span> <span class="nf">getExpenseTypeById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">ExpenseType</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaRoleServiceImpl</span> <span class="kd">implements</span> <span class="n">RoleService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRole</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">Role</span> <span class="nf">getRoleByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
            <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select r from Role r where roleName =:roleName"</span><span class="o">,</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"roleName"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">Role</span><span class="o">)</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">serviceImpl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PersistenceContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Query</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaUserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>


    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">EntityManager</span> <span class="nf">getEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@PersistenceContext</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEntityManager</span><span class="o">(</span><span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">entityManager</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="n">Long</span> <span class="n">userId</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">getEntityManager</span><span class="o">().</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">userId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUserByUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">){</span>
        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">getEntityManager</span><span class="o">().</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from User u where u.userName =:username"</span><span class="o">);</span>
        <span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">return</span>  <span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">size</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)?(</span><span class="n">User</span><span class="o">)(</span><span class="n">query</span><span class="o">.</span><span class="na">getResultList</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">,</span><span class="n">String</span> <span class="n">mailId</span><span class="o">,</span><span class="n">Role</span> <span class="n">role</span><span class="o">){</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span><span class="n">password</span><span class="o">,</span><span class="n">mailId</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="k">new</span> <span class="n">Boolean</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="n">getEntityManager</span><span class="o">().</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>One you added service implementation classes,make sure you are not getting errors.</p>

<h2 id="add-controller-classes">Add controller classes</h2>
<p>Controller is reponsible for mapping requests.Use the <code>@RequestMapping</code> annotation to map web requests onto specific handler methods. Create a package for Controllers as <code>com.springsource.html5expense.controller</code> and add the following <code>ExpenseController</code>, <code>FileAttachmentController</code> classes.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpenseController</span> <span class="o">{</span>


    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loadApprovalExpenses"</span> <span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loadApprovedExpenses</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/deleteExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">deleteExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/editExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">editExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expense"</span><span class="o">,</span><span class="n">expense</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"isEdit"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/changeState"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">changeState</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"action"</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">changeExpenseStatus</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">action</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">approvedExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getPendingExpensesList</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"approvedExpenseList"</span><span class="o">,</span> <span class="n">approvedExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"expenseapproval"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/updateExpense"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">expenseId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseId"</span><span class="o">);</span>
        <span class="n">Expense</span> <span class="n">expense</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"expense Id "</span><span class="o">+</span><span class="n">expenseTypeVal</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">getExpenseTypeService</span><span class="o">().</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">expense</span><span class="o">.</span><span class="na">setExpenseType</span><span class="o">(</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">getExpenseService</span><span class="o">().</span><span class="na">updateExpense</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseId</span><span class="o">),</span> <span class="n">description</span><span class="o">,</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">),</span><span class="n">expenseType</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpenseReport"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpenseReport</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">expenseTypeVal</span> <span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"expenseTypeId"</span><span class="o">);</span>
        <span class="n">ExpenseType</span> <span class="n">expenseType</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getExpenseTypeById</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">expenseTypeVal</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"amount"</span><span class="o">);</span>
        <span class="n">Date</span> <span class="n">expenseDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
        <span class="n">Double</span> <span class="n">amountVal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Double</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">file</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">try</span><span class="o">{</span>
                            <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                            <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                            <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span>  <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                            <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
                            <span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">.</span><span class="na">createExpense</span><span class="o">(</span><span class="n">description</span><span class="o">,</span><span class="n">expenseType</span><span class="o">,</span><span class="n">expenseDate</span><span class="o">,</span>
                    <span class="n">amountVal</span><span class="o">,</span><span class="n">user</span><span class="o">,</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>

            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/createNewExpense"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">createNewExpense</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">ExpenseType</span><span class="o">&gt;</span> <span class="n">expenseTypeList</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">.</span><span class="na">getAllExpenseType</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"expenseTypeList"</span><span class="o">,</span> <span class="n">expenseTypeList</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"newexpense"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.FileCopyUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>



<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileAttachmentController</span> <span class="o">{</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

        <span class="nd">@Autowired</span>
        <span class="kd">private</span> <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>

                <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">"redirect:/index.html"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/download"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">attachmentId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"attachmentId"</span><span class="o">);</span>
                     <span class="n">Attachment</span>  <span class="n">attachment</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span><span class="o">.</span><span class="na">getAttachment</span><span class="o">(</span><span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">attachmentId</span><span class="o">));</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContentType</span><span class="o">());</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span><span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">attachment</span><span class="o">.</span><span class="na">getFileName</span><span class="o">()</span> <span class="o">+</span><span class="s">"\""</span><span class="o">);</span>
                     <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"cache-control"</span><span class="o">,</span> <span class="s">"must-revalidate"</span><span class="o">);</span>
                     <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">attachment</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>

        <span class="o">}</span>
<span class="o">}</span></code></pre>

<h2 id="configure-expensereport-application">Configure ExpenseReport application</h2>
<p>We have to configure our application in order to make it ready to deploy. Create a new package <code>com.springsource.html5expense.config</code> and add the following ComponentConfig,WebConfig classes.We have marked ComponentConfig class with @Configuration annotation to configure our beans.This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.collections.map.HashedMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ImportResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.SimpleDriverDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.JpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaDialect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.FileAttachmentController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.LoginController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaRoleServiceImpl</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@ImportResource</span><span class="o">({</span> <span class="s">"classpath:spring-security.xml"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
        <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"localhost"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
        <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
        <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaAdapter</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">HibernateJpaVendorAdapter</span> <span class="n">hibernateJpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">POSTGRESQL</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setShowSql</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">hibernateJpaVendorAdapter</span><span class="o">.</span><span class="na">setGenerateDdl</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">hibernateJpaVendorAdapter</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span>
            <span class="k">new</span> <span class="nf">JpaTransactionManager</span><span class="o">();</span>

        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">entityManagerFactory</span><span class="o">().</span><span class="na">getObject</span><span class="o">());</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">jpaProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">jpaProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"transactionTimeout"</span><span class="o">,</span><span class="s">"43200"</span><span class="o">);</span>
        <span class="n">transactionManager</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">jpaProperties</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
        <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre>

<p>@EnableTransactionManagement annotation is responsible for Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ResourceBundleMessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodArgumentResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.method.support.HandlerMethodReturnValueHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.commons.CommonsMultipartResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.controller.ExpenseController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.serviceImpl.JpaExpenseServiceImpl</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">(</span><span class="n">ComponentConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span>
 <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>

     <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">baseNames</span> <span class="o">=</span> <span class="s">"messages,errors"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="n">ResourceBundleMessageSource</span> <span class="n">resourceBundleMessageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResourceBundleMessageSource</span><span class="o">();</span>
        <span class="n">resourceBundleMessageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="n">baseNames</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resourceBundleMessageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">PropertySourcesPlaceholderConfigurer</span> <span class="nf">placeholderConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PropertySourcesPlaceholderConfigurer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addReturnValueHandlers</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMethodReturnValueHandler</span><span class="o">&gt;</span> <span class="n">returnValueHandlers</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>


<span class="o">}</span></code></pre>

<ul>
<li>
    <p>Create a new file <code>import.sql</code> in <code>src/main/resources</code> and add the below content in it.</p>

    <p>insert into role(roleid,rolename) values(nextval( â€˜hibernate_sequenceâ€™),â€™ROLE_USERâ€™);
  insert into role(roleid,rolename) values(nextval( â€˜hibernate_sequenceâ€™),â€™ROLE_MANAGERâ€™);
  insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval(â€˜hibernate_sequenceâ€™),â€™admin@expense.comâ€™,true,â€™adminâ€™,â€™adminâ€™,2);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™MEDICALâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™TRAVELâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™TELEPHONEâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™GYMâ€™);
  insert into expenseType(id,name) values(nextval( â€˜hibernate_sequenceâ€™),â€™EDUCATIONâ€™);</p>
  </li>
</ul><p>To execute these statements automatically while app starts we have set 
these two Jpa properties.       </p>
<pre><code class="language-java"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span></code></pre>

<ul>
<li>Then open your <code>src/main/webapp/WEB-INF/web.xml</code> and modify it to load this <code>ComponentConfig</code> class as part of contextConfiglocation as shown below,</li>
</ul><pre><code class="language-xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">"2.5"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
        <span class="nt">&lt;context-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>com.springsource.html5expense.config<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span>
    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>  

    <span class="c">&lt;!-- Processes application requests  --&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/appServlet/servlet-context.xml ,
            <span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>2<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span> 

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/css/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/images/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span></code></pre>

<h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>
<p>This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have added already into pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>
<p>To enable Spring security we need to add the following steps:
 1. Add a DelegatingFilterProxy in <code>src/main/webapp/WEB-INF/web.xml</code>
 2. Create a custom XML configuration named spring-security.xml in <code>src/main/resources</code></p>

<p>In the web.xml declare an instance of a DelegatingFilterProxy.This will filter the requests based on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span> 
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/signUp**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/loadApprovalExpenses"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/sessionTimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"sas"</span> <span class="na">class=</span><span class="s">"org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
           <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">              select username,password,enabled  </span>
<span class="s">              from users where username=?"</span> 
 
           <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">              select u.username, r.rolename from users u, role r </span>
<span class="s">              where u.role_roleid = r.roleid and u.username =?  "</span> 
 
        <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>

<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<p>To load this file as part of configuration add <code>@ImportResource({ "classpath:spring-security.xml"})</code> in <code>ComponentConfig</code> class.</p>

<p>Create <code>Logincontroller</code> in <code>com.springsource.html5expense.contoller</code> package and add mapping for login,logout,loginfailed,signup.</p>

<pre><code class="language-java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">springsource</span><span class="o">.</span><span class="na">html5expense</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.Principal</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Blob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Hibernate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Attachment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Expense</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.ExpenseType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.model.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.AttachmentService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.ExpenseTypeService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.RoleService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.springsource.html5expense.service.UserService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> 
    <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">RoleService</span> <span class="n">roleService</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printWelcome</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span> <span class="n">Principal</span> <span class="n">principal</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">)</span> <span class="o">{</span>
 
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUp"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"signUp"</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>

    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/signUpUser"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">signUp</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"userName"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">mailId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="n">getRoleService</span><span class="o">().</span><span class="na">getRoleByName</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">createUser</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">mailId</span><span class="o">,</span><span class="n">role</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/login"</span><span class="o">;</span>

        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"User registration fails already same user name exists please try "</span> <span class="o">+</span>
                    <span class="s">"with different user name"</span><span class="o">;</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/signUp?errorMsg="</span><span class="o">+</span><span class="n">errorMsg</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/login"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/loginfailed"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">loginerror</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>
 
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/logout"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">logout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
 
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
 
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/sessionTimeout"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sessionTimeout</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">errorMsg</span> <span class="o">=</span> <span class="s">"Session has expired .Please login"</span><span class="o">;</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"errorMsg"</span><span class="o">,</span><span class="n">errorMsg</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="n">ExpenseService</span> <span class="nf">getExpenseService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseService</span><span class="o">(</span><span class="n">ExpenseService</span> <span class="n">expenseService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseService</span> <span class="o">=</span> <span class="n">expenseService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AttachmentService</span> <span class="nf">getAttachmentService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAttachmentService</span><span class="o">(</span><span class="n">AttachmentService</span> <span class="n">attachmentService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">attachmentService</span> <span class="o">=</span> <span class="n">attachmentService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ExpenseTypeService</span> <span class="nf">getExpenseTypeService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpenseTypeService</span><span class="o">(</span><span class="n">ExpenseTypeService</span> <span class="n">expenseTypeService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expenseTypeService</span> <span class="o">=</span> <span class="n">expenseTypeService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">getUserService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserService</span><span class="o">(</span><span class="n">UserService</span> <span class="n">userService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userService</span> <span class="o">=</span> <span class="n">userService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">RoleService</span> <span class="nf">getRoleService</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleService</span><span class="o">(</span><span class="n">RoleService</span> <span class="n">roleService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roleService</span> <span class="o">=</span> <span class="n">roleService</span><span class="o">;</span>
    <span class="o">}</span>
 
<span class="o">}</span></code></pre>

<h2 id="add-view-files">Add View Files</h2>
<p>Add the following <code>login.jsp</code>,<code>expenseapproval.jsp</code>,<code>myexpense.jsp</code>,<code>newexpense.jsp</code>,<code>usermain.jsp</code>,<code>signUp.jsp</code> files in your <code>webapp/WEB-INF/view</code> folders.The login.jsp has two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively. when the form is submitted ,it will be sent to the following action URL:
j_spring_security_check.</p>

<p>add the below jsp file as <code>login.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/signUp"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty error}"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    Your login attempt was not successful, try again.<span class="nt">&lt;br</span> <span class="nt">/&gt;</span> Caused :
                    ${sessionScope["SPRING_SECURITY_LAST_EXCEPTION"].message}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
            ${errorMsg}
            <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">'f'</span> <span class="na">action=</span><span class="s">"&lt;c:url value='j_spring_security_check' /&gt;"</span> <span class="na">method=</span><span class="s">'POST'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Username"</span> <span class="na">name=</span><span class="s">"j_username"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">name=</span><span class="s">"j_password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>expenseapproval.jsp</code></p>

<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://displaytag.sf.net"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"display"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
 
<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>4<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
          function changeState(contextPath,expenseId,rowCount){
              var actionVal =  document.getElementById('action_'+rowCount).value;
              var url = contextPath+"/changeState?action="+actionVal+"<span class="ni">&amp;expenseId="+expenseId;</span>
              if(actionVal == null || actionVal =="" ){
                  return false;
              }
              document.forms[0].action=url;
              document.forms[0].submit();
              
          }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b add-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"plus-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/plus-a.png"</span><span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Approvals Pending ${fn:length(approvedExpenseList)}
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(approvedExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table-a"</span>  <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-a"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date<span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-down-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-down-a.png"</span><span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span> <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense ID <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                 <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${approvedExpenseList}"</span>  <span class="na">varStatus=</span><span class="s">"rowCounter"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"rowcount"</span> <span class="na">value=</span><span class="s">"${rowCounter.count}"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate}<span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.id}<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span> 
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;&lt;form</span> <span class="na">name=</span><span class="s">"actionForm"</span> <span class="na">id=</span><span class="s">"actionForm"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-a label-5 green"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt; "</span><span class="o">&gt;</span>
                                     <span class="n">Approved</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">i</span> <span class="n">class</span><span class="o">=</span><span class="s">"alt-b label-6"</span><span class="o">&gt;</span>
                                    <span class="o">&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"right-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">right</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span> <span class="o">&gt;</span> <span class="n">Approved</span>
                                    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="n">class</span><span class="o">=</span><span class="s">"bg-cross-b"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"cross-b-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">cross</span><span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                                <span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                                
                                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"action_${rowCounter.count}"</span> <span class="na">name=</span><span class="s">"${rowCounter.count}"</span> <span class="na">style=</span><span class="s">"font-size: 11px;"</span> <span class="na">onchange=</span><span class="s">"changeState('${pageContext.request.contextPath}','${expense.id}','${rowCounter.count}')"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"PENDING"</span><span class="nt">&gt;</span>     Pending    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"APPROVED"</span><span class="nt">&gt;</span>    Approve    <span class="nt">&lt;/option&gt;</span>
                                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"REJECTED"</span><span class="nt">&gt;</span>    Reject     <span class="nt">&lt;/option&gt;</span>
                                <span class="nt">&lt;/select&gt;</span>
                                    <span class="nt">&lt;/form&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                
                                
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
                
            <span class="nt">&lt;/table&gt;</span> 
    
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;

            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;

            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;

            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>

                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>

            <span class="nt">&lt;/select&gt;</span>

        <span class="nt">&lt;/form&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    
    <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>myexpense.jsp</code></p>

<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
                         
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
            
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
    .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });
<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>newexpense.jsp</code></p>
<pre><code class="language-jsp"><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=UTF-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
    
<span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>3<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName}<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expense<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                   <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;c:choose&gt;</span>
        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${isEdit eq 'true'}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Editing an expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/updateExpense"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span><span class="nt">&gt;</span>${expense.description}<span class="nt">&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"expenseId"</span> <span class="na">id=</span><span class="s">"expenseId"</span> <span class="na">value=</span><span class="s">"${expense.id}"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">value=</span><span class="s">"${expense.amount}"</span><span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- &lt;div class="textbox-a dd-a flt-left"&gt;</span>
<span class="c">                Select Type &lt;img class="arrow-down-c-img" src="&lt;c:url value="/resources/images/arrow-down-c.png" /&gt;"&gt;  --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        
                          <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name eq expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span> <span class="na">selected=</span><span class="s">"selected"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                         <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.expenseType.name ne expenseType.name }"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>${expenseType.name}<span class="nt">&lt;/option&gt;</span>
                        <span class="nt">&lt;/c:if&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt; --&gt;</span>
                <span class="k">&lt;%-</span><span class="o">-</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s">"label-7 flt-right"</span> <span class="n">href</span><span class="o">=</span><span class="s">"#"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">class</span><span class="o">=</span><span class="s">"clip-a-img"</span> <span class="n">src</span><span class="o">=</span><span class="s">"&lt;c:url value="</span><span class="o">/</span><span class="n">resources</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">clip</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="na">png</span><span class="s">" /&gt;"</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">%&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">class=</span><span class="s">"file"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- Attach Receipt &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>SAVE EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:when&gt;</span>
        <span class="nt">&lt;c:otherwise&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-b my-expenses-btn"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-left-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-left-a.png"</span> <span class="nt">/&gt;</span> "&gt;My Expenses
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span> Adding new expense <span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/createNewExpenseReport"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">id=</span><span class="s">"description"</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"description"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="nt">&gt;&lt;/textarea&gt;&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">placeholder=</span><span class="s">"Amount"</span> <span class="na">name=</span><span class="s">"amount"</span> <span class="na">required=</span><span class="s">"required"</span>  <span class="na">max=</span><span class="s">"100000"</span> <span class="nt">&gt;&lt;/input&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"action-a"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--     &lt;div class="textbox-a dd-a flt-left"&gt; --&gt;</span>
                <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"expenseTypeId"</span> <span class="na">name=</span><span class="s">"expenseTypeId"</span> <span class="na">style=</span><span class="s">"    border: 1px solid #b8b8b8;</span>
<span class="s">                box-shadow: 0px 2px 0px 0px #b8b8b8;padding: 12px;font-size: 11px;color: #a7a5a6;width:100px;    margin:10px;"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>                         <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expenseType"</span> <span class="na">items=</span><span class="s">"${expenseTypeList}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${expenseType.id}"</span><span class="nt">&gt;</span>    ${expenseType.name}    <span class="nt">&lt;/option&gt;</span>
                    <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/select&gt;</span>
                <span class="c">&lt;!-- &lt;/div&gt;</span>
<span class="c">                 &lt;a class="label-7 flt-right" href="#"&gt;&lt;img class="clip-a-img" src="&lt;c:url value="/resources/images/clip-a.png" /&gt;"&gt;  --&gt;</span>
                 <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">id=</span><span class="s">"file"</span> <span class="na">title=</span><span class="s">"Attachment"</span>  <span class="na">class=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
                <span class="c">&lt;!-- &lt;/a&gt; --&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a add-expense-btn"</span><span class="nt">&gt;</span>ADD EXPENSE<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:otherwise&gt;</span>
        <span class="nt">&lt;/c:choose&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>usermain.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
 <span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/functions"</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"fn"</span> <span class="k">%&gt;</span>  
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>2<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery-1.8.1.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.min.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">resources/javascript/jquery.tablesorter.pager.js"</span><span class="nt">/&gt;</span>" &gt;<span class="nt">&lt;/script&gt;</span>

        
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-b"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"inside-nav"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"topper"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"bg-logo-b"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-b.png"</span> <span class="nt">/&gt;</span>" /&gt;
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav-a"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Hi ${sessionScope.user.userName} <span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            |
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/j_spring_security_logout"</span> <span class="nt">/&gt;</span>"&gt;Logout<span class="nt">&lt;/a&gt;</span> 
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                    
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-b"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>My Expenses<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span>" /&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/createNewExpense"</span><span class="nt">&gt;</span>New Expenses<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${sessionScope.user.role.roleName eq 'ROLE_MANAGER'}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/loadApprovalExpenses"</span><span class="nt">&gt;</span>Approvals<span class="nt">&lt;/a&gt;</span>
                        
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/c:if&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mc-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"header label-2"</span><span class="nt">&gt;</span>
                Expenses
            <span class="nt">&lt;/h2&gt;</span>
            
        <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${fn:length(pendingExpenseList) gt 0 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;table</span>  <span class="na">id=</span><span class="s">"table-a"</span> <span class="na">class=</span><span class="s">"table-a"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;thead&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Attachment <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Date <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-b"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Expense Type <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-c"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Description <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span>  <span class="na">class=</span><span class="s">"td-d"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-3"</span><span class="nt">&gt;</span>Status <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;/thead&gt;</span>
                <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"expense"</span> <span class="na">items=</span><span class="s">"${pendingExpenseList}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"tr-odd"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty expense.attachment.fileName}"</span><span class="nt">&gt;</span>
                             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/download?attachmentId=${expense.attachment.id}"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"clip-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/clip-b.png"</span> <span class="nt">/&gt;</span>"&gt;<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/c:if&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseDate} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.expenseType.name} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>${expense.description} <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"label-4"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'NEW' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 blue"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/question-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Pending<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Pending
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'APPROVED' }"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 green"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-a.png"</span> <span class="nt">/&gt;</span> "&gt;
                                     Approved<span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/right-b.png"</span> <span class="nt">/&gt;</span>" &gt; Approved
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${expense.state eq 'REJECTED' }"</span><span class="nt">&gt;</span>
                                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-a label-5 red"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected<span class="nt">&lt;/i&gt;</span> 
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"alt-b label-6"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"right-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-a.png"</span> <span class="nt">/&gt;</span>" &gt; Rejected
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/deleteExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-b"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/cross-b.png"</span> <span class="nt">/&gt;</span>" &gt; <span class="nt">&lt;/a&gt;</span>
                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/editExpense?expenseId=${expense.id}"</span> <span class="na">class=</span><span class="s">"bg-cross-c"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"cross-b-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/edit1.jpg"</span> <span class="nt">/&gt;</span>"&gt; <span class="nt">&lt;/a&gt;</span>
                                <span class="nt">&lt;/i&gt;</span>
                                <span class="nt">&lt;/c:if&gt;</span>
                            <span class="nt">&lt;/h5&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>    
                <span class="nt">&lt;/c:forEach&gt;</span>
                <span class="nt">&lt;/tbody&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"pager"</span>  <span class="na">class=</span><span class="s">"pagination pagination-1"</span> <span class="nt">&gt;</span>

        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/first.png"</span><span class="nt">/&gt;</span>"  class="first"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/prev.png"</span><span class="nt">/&gt;</span>"  class="prev"/&gt;
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span>  <span class="na">class=</span><span class="s">"pagedisplay"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/next1.png"</span> <span class="nt">/&gt;</span>"  class="next"/&gt;
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/last.png"</span> <span class="nt">/&gt;</span>"  class="last"/&gt;
            <span class="nt">&lt;select</span>  <span class="na">class=</span><span class="s">"pagesize"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">selected=</span><span class="s">"selected"</span>  <span class="na">value=</span><span class="s">"10"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"20"</span><span class="nt">&gt;</span>20<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"30"</span><span class="nt">&gt;</span>30<span class="nt">&lt;/option&gt;</span>
                <span class="nt">&lt;option</span>  <span class="na">value=</span><span class="s">"40"</span><span class="nt">&gt;</span>40<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;/select&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    jQuery(document).ready(function() {
    jQuery("#table-a")
   .tablesorter({widthFixed: true, widgets: ['zebra']})
    .tablesorterPager({container: $("#pager")}); 
    });

<span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<p>add the below jsp file as <code>signUp.jsp</code></p>
<pre><code class="language-jsp"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="k">&lt;%@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"c"</span> <span class="n">uri</span><span class="o">=</span><span class="s">"http://java.sun.com/jsp/jstl/core"</span> <span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>1<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/css/style.css"</span> <span class="nt">/&gt;</span>" /&gt;
        <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        
        function ValidateEmail() 
        {
         var email = document.getElementById("email");
         var errorblock = document.getElementById("errorblock");
         if(email!=null <span class="err">&amp;&amp;</span> email.value!=""){
         if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email.value))
          {
             alert("email1"+email.value);
            return true;
          }
             errorblock.innerHTML = "Please Enter valid Email Address";
            return false;
         }else{
             alert("please enter email address!");
             return false;
         }
        }
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"blue-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"login-nav"</span><span class="nt">&gt;</span>
                
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"ul-a"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-logo-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/logo-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"${pageContext.request.contextPath}/login"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"bg-arrow-right-a"</span><span class="nt">&gt;&lt;img</span> <span class="na">class=</span><span class="s">"arrow-right-a-img"</span> <span class="na">src=</span><span class="s">"&lt;c:url value="</span><span class="err">/resources/images/arrow-right-a.png"</span> <span class="nt">/&gt;</span> "&gt;<span class="nt">&lt;/i&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"label-1"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;</span>
                        
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main-a"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${not empty param.errorMsg}"</span><span class="nt">&gt;</span>
            
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"errorblock"</span><span class="nt">&gt;</span>
                    ${param.errorMsg}
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/c:if&gt;</span>
        <span class="nt">&lt;br&gt;&lt;br&gt;&lt;br&gt;</span>
             <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"${pageContext.request.contextPath}/signUpUser"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a text-email"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">required=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"UserName"</span> <span class="na">id=</span><span class="s">"userName"</span> <span class="na">name=</span><span class="s">"userName"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"textbox-a"</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">required=</span><span class="s">"required"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn-a"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        
        
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>Now we have successfully created expensereport application.we can run the application in locally to test it.
Select <code>Run As -&gt; Maven clean</code>
<img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.
<img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code>
<img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>

<p>Once server starts completed,STS will open the home page for the project which dispalys login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="spring-expensereport-login.png"></p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="spring-expensereport-create_expense.png"></p>

<p><img src="/images/spring_tutorial/my_expense.png" alt="spring-expensereport-user_expense.png"></p>

<h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>
<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.
<img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.
<img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.
<img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required..
<img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 
<img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.
<img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>;T;@YI"=/frameworks/java/spring/spring-getting-started-with-STS/;T{;{	;I"=<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring-getting-started-with-STS.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring' property='og:title'>
<meta content='Spring Getting Started with STS' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Getting Started with STS</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/STS" rel="tag">STS</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A <a href="/tools/STS/configuring-STS.html">Cloud Foundry plugin for STS</a>.</p>
  </li>
  <li>
    <p>A <a href="http://www.postgresql.org/download/">PostgreSQL Database</a> installation.</p>
  </li>
</ul><h2 id="overview">Overview</h2>
<p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="http://www.springsource.org/spring-framework">for more details visit</a>.</p>

<ul>
<li>
    <p>Chapter1 :<a href="/frameworks/java/spring/springmvc-template-project.html">Create Hello world Spring MVC Project</a></p>
  </li>
  <li>
    <p>Chapter2 :<a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">Create an Expense Reporting App</a></p>
  </li>
  <li>
    <p>Chapter3 :<a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">Add Spring Security to ExpenseReport App</a></p>
  </li>
  <li>
    <p>Chapter4 :<a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">Deploy the App on Cloud Foundry Using STS</a></p>
  </li>
  <li>
    <p>Chapter5 :<a href="/frameworks/java/spring/spring-app-deployment-using-VMC.html">Deploy the App on Cloud Foundry Using VMC</a></p>
  </li>
</ul><p><a href="/frameworks/java/spring/springmvc-template-project.html">                                                                         Next==&gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"¤## Introduction
This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.

## Prerequisites
Before you get started, you need the following:

+  A [Cloud Foundry account](http://cloudfoundry.com/signup)

+  The [vmc](/tools/vmc/installing-vmc.html) Cloud Foundry command line tool

+  A [Spring Tool Suiteâ„¢ (STS)](http://www.springsource.org/spring-tool-suite-download) installation

+  A [Cloud Foundry plugin for STS](/tools/STS/configuring-STS.html).

+  A [PostgreSQL Database](http://www.postgresql.org/download/) installation.


## Overview
The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the "plumbing" of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.[for more details visit](http://www.springsource.org/spring-framework).

+ Chapter1 :[Create Hello world Spring MVC Project](/frameworks/java/spring/springmvc-template-project.html)
   
+ Chapter2 :[Create an Expense Reporting App](/frameworks/java/spring/spring-expensereport-app-tutorial.html)

+ Chapter3 :[Add Spring Security to ExpenseReport App](/frameworks/java/spring/expensereport-app-with-spring-security.html)

+ Chapter4 :[Deploy the App on Cloud Foundry Using STS](/frameworks/java/spring/spring-app-deployment-using-STS.html)

+ Chapter5 :[Deploy the App on Cloud Foundry Using VMC](/frameworks/java/spring/spring-app-deployment-using-VMC.html)

 [                                                                         Next==>](/frameworks/java/spring/springmvc-template-project.html);T;
I"|	<h2 id="introduction">Introduction</h2>
<p>This is a guide for Java developers using the Spring framework and PostgreSQL database to build and deploy their apps on Cloud Foundry. It shows you how to set up and successfully deploy Spring Java PostgreSQL applications to Cloud Foundry.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you get started, you need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.springsource.org/spring-tool-suite-download">Spring Tool Suiteâ„¢ (STS)</a> installation</p>
  </li>
  <li>
    <p>A <a href="/tools/STS/configuring-STS.html">Cloud Foundry plugin for STS</a>.</p>
  </li>
  <li>
    <p>A <a href="http://www.postgresql.org/download/">PostgreSQL Database</a> installation.</p>
  </li>
</ul><h2 id="overview">Overview</h2>
<p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.<a href="http://www.springsource.org/spring-framework">for more details visit</a>.</p>

<ul>
<li>
    <p>Chapter1 :<a href="/frameworks/java/spring/springmvc-template-project.html">Create Hello world Spring MVC Project</a></p>
  </li>
  <li>
    <p>Chapter2 :<a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">Create an Expense Reporting App</a></p>
  </li>
  <li>
    <p>Chapter3 :<a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">Add Spring Security to ExpenseReport App</a></p>
  </li>
  <li>
    <p>Chapter4 :<a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">Deploy the App on Cloud Foundry Using STS</a></p>
  </li>
  <li>
    <p>Chapter5 :<a href="/frameworks/java/spring/spring-app-deployment-using-VMC.html">Deploy the App on Cloud Foundry Using VMC</a></p>
  </li>
</ul><p><a href="/frameworks/java/spring/springmvc-template-project.html">                                                                         Next==&gt;</a></p>;T;@_I"8/frameworks/java/spring/springmvc-template-project/;T{;{	;I"ÀB<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/springmvc-template-project.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Hello world Spring MVC Project' property='og:title'>
<meta content='Spring MVC Template Project' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Hello world Spring MVC Project</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Hello world Spring MVC Project</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring MVC Template Project</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring MVC" rel="tag">Spring MVC</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/tomcat" rel="tag">tomcat</a><a href="/tags/maven" rel="tag">maven</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC to create a Spring MVC application to display Hello world message.</p>

<h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>
<p>Please open your STS and select dashboard by clicking,
    <code>Help -&gt; Dashboard</code></p>

<p>From the dashboard view select Spring Template Project.Window shown below opens up.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS will ask you to download some extra elements from the Internet.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project name as <code>expensereport</code> and top-level package as <code>com.springsource.html5expense</code></p>

<p>Click on <code>Finish</code> â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completes, select <code>Run As -&gt; Maven install</code>. It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<h2 id="troubleshoot">Troubleshoot</h2>
<p>After this step if you have any errors,
1.  Check whether you are behind proxy server. If then change your maven <code>settings.xml</code> to point your proxy server,</p>

<pre><code class="language-xml"><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;proxies&gt;</span>
   <span class="nt">&lt;proxy&gt;</span>
      <span class="nt">&lt;active&gt;</span>true<span class="nt">&lt;/active&gt;</span>
      <span class="nt">&lt;protocol&gt;</span>http<span class="nt">&lt;/protocol&gt;</span>
      <span class="nt">&lt;host&gt;</span>proxy.somewhere.com<span class="nt">&lt;/host&gt;</span>
      <span class="nt">&lt;port&gt;</span>8080<span class="nt">&lt;/port&gt;</span>
      <span class="nt">&lt;username&gt;</span>proxyuser<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>somepassword<span class="nt">&lt;/password&gt;</span>
      <span class="nt">&lt;nonProxyHosts&gt;</span>www.google.com|*.somewhere.com<span class="nt">&lt;/nonProxyHosts&gt;</span>
    <span class="nt">&lt;/proxy&gt;</span>
  <span class="nt">&lt;/proxies&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre>

<ol>
<li>If you are not behind any proxy server but your maven <code>setting.xml</code> points to any proxy then remove the proxy configuration from maven <code>settings.xml</code>.</li>
</ol><p>Now Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<h2 id="check-point">Check Point</h2>
<p>Once server start is completed, open your browser and go to our application url <code>http://localhost:8080/html5expense</code> it will open the home page for the project which displays 
Hello world message with the current server time.</p>

<p><img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<p><a href="/frameworks/java/spring/spring-getting-started-with-STS.html">&lt;==Prev       </a>                         <a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">                 Next==&gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"ü	## Introduction
This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC to create a Spring MVC application to display Hello world message.

## Create Spring MVC Template Project
Please open your STS and select dashboard by clicking,
    `Help -> Dashboard`

From the dashboard view select Spring Template Project.Window shown below opens up.

![Spring MVC Template Project](/images/spring_tutorial/spring_template_project_mvc.png)


then choose `Spring MVC Project`.
The first time you do it, STS will ask you to download some extra elements from the Internet.

![spring_template_project_mvc_download.png](/images/spring_tutorial/spring_template_project_mvc_download.png)

Youâ€™ll need to give your project name as `expensereport` and top-level package as `com.springsource.html5expense`


Click on `Finish` â€“ and STS will create the project.

Before run the project.Select `Run As -> Maven clean`

![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completes, select `Run As -> Maven install`. It will download dependencies from pom.xml.

![maven_install.png](/images/spring_tutorial/maven_install.png)

## Troubleshoot
  After this step if you have any errors,
1.  Check whether you are behind proxy server. If then change your maven `settings.xml` to point your proxy server,

```xml
<settings>
  <proxies>
   <proxy>
      <active>true</active>
      <protocol>http</protocol>
      <host>proxy.somewhere.com</host>
      <port>8080</port>
      <username>proxyuser</username>
      <password>somepassword</password>
      <nonProxyHosts>www.google.com|*.somewhere.com</nonProxyHosts>
    </proxy>
  </proxies>
</settings>
```

2.  If you are not behind any proxy server but your maven `setting.xml` points to any proxy then remove the proxy configuration from maven `settings.xml`.

Now Select `Run As -> Maven build`

![maven_build.png](/images/spring_tutorial/maven_build.png)

And give Maven goal as , `tomcat:run`

![maven_run.png](/images/spring_tutorial/maven_run.png)

## Check Point
Once server start is completed, open your browser and go to our application url `http://localhost:8080/html5expense` it will open the home page for the project which displays 
Hello world message with the current server time.

![Hello World Output](/images/spring_tutorial/hello_world.png)

[<==Prev       ](/frameworks/java/spring/spring-getting-started-with-STS.html)                         [                 Next==>](/frameworks/java/spring/spring-expensereport-app-tutorial.html);T;
I"š<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to get started with STS (SpringSource Tool Suite) and Spring MVC to create a Spring MVC application to display Hello world message.</p>

<h2 id="create-spring-mvc-template-project">Create Spring MVC Template Project</h2>
<p>Please open your STS and select dashboard by clicking,
    <code>Help -&gt; Dashboard</code></p>

<p>From the dashboard view select Spring Template Project.Window shown below opens up.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc.png" alt="Spring MVC Template Project"></p>

<p>then choose <code>Spring MVC Project</code>.
The first time you do it, STS will ask you to download some extra elements from the Internet.</p>

<p><img src="/images/spring_tutorial/spring_template_project_mvc_download.png" alt="spring_template_project_mvc_download.png"></p>

<p>Youâ€™ll need to give your project name as <code>expensereport</code> and top-level package as <code>com.springsource.html5expense</code></p>

<p>Click on <code>Finish</code> â€“ and STS will create the project.</p>

<p>Before run the project.Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completes, select <code>Run As -&gt; Maven install</code>. It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<h2 id="troubleshoot">Troubleshoot</h2>
<p>After this step if you have any errors,
1.  Check whether you are behind proxy server. If then change your maven <code>settings.xml</code> to point your proxy server,</p>

<pre><code class="language-xml"><span class="nt">&lt;settings&gt;</span>
  <span class="nt">&lt;proxies&gt;</span>
   <span class="nt">&lt;proxy&gt;</span>
      <span class="nt">&lt;active&gt;</span>true<span class="nt">&lt;/active&gt;</span>
      <span class="nt">&lt;protocol&gt;</span>http<span class="nt">&lt;/protocol&gt;</span>
      <span class="nt">&lt;host&gt;</span>proxy.somewhere.com<span class="nt">&lt;/host&gt;</span>
      <span class="nt">&lt;port&gt;</span>8080<span class="nt">&lt;/port&gt;</span>
      <span class="nt">&lt;username&gt;</span>proxyuser<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;password&gt;</span>somepassword<span class="nt">&lt;/password&gt;</span>
      <span class="nt">&lt;nonProxyHosts&gt;</span>www.google.com|*.somewhere.com<span class="nt">&lt;/nonProxyHosts&gt;</span>
    <span class="nt">&lt;/proxy&gt;</span>
  <span class="nt">&lt;/proxies&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre>

<ol>
<li>If you are not behind any proxy server but your maven <code>setting.xml</code> points to any proxy then remove the proxy configuration from maven <code>settings.xml</code>.</li>
</ol><p>Now Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<h2 id="check-point">Check Point</h2>
<p>Once server start is completed, open your browser and go to our application url <code>http://localhost:8080/html5expense</code> it will open the home page for the project which displays 
Hello world message with the current server time.</p>

<p><img src="/images/spring_tutorial/hello_world.png" alt="Hello World Output"></p>

<p><a href="/frameworks/java/spring/spring-getting-started-with-STS.html">&lt;==Prev       </a>                         <a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">                 Next==&gt;</a></p>;T;@eI"?/frameworks/java/spring/spring-expensereport-app-tutorial/;T{;{	;I"ª<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring-expensereport-app-tutorial.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | ExpenseReport Application Development using Spring MVC' property='og:title'>
<meta content='ExpenseReport Application' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | ExpenseReport Application Development using Spring MVC</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>ExpenseReport Application Development using Spring MVC</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>ExpenseReport Application</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring" rel="tag">Spring</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/tomcat" rel="tag">tomcat</a><a href="/tags/maven" rel="tag">maven</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>In this tutorial, we take the following use case.
Create and Deploy an Expense Reporting App on local tomcat server.
ExpenseReport is used to create and manage expenses.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Working with STS or Eclipse IDE.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><p>In expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in PostgreSQL database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before creating Entities,delete <code>HomeController.java</code> from your <code>com.springsource.html5config</code> package and replace your pom.xml with the one below,</p>

<dl>
<dt><em>Notes:</em></dt>
  <dd>Before going to test the application you have to add Entities,Services,Controllers,Application Configuration classes and Views.</dd>
</dl><h2 id="adding-entities">Adding Entities</h2>
<p>An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.
The application requires the following entities to be added. <code>Expense</code>,<code>User</code>,<code>Role</code>,<code>Attachment</code>,<code>ExpenseReport</code>,<code>State</code> classes.These classes are POJO with getters and setters for its properties and annotated with <code>@Entity</code>. By default JPA will take class name as table name. If you want to store in different table name then provide <code>@Table</code> annotation with name property. Create a package for entities as <code>com.springsource.html5expense.model</code> and add all entities to it.</p>
<pre><code class="language-java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>
    
    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<p>The <code>@Id</code> annotation specifies the primary key of the entity <code>@GeneratedValue</code> annotations which tell JPA that the value in that field should map to the primary key and that the primary key should use an auto-incrementing value strategy. <code>@OneToOne</code> annotation defines a single-valued association 
to another entity that has one-to-one multiplicity.  </p>

<h2 id="adding-service">Adding Service</h2>
<pre><code class="language-java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>
    
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<p>This are the business methods to,</p>

<ul>
<li>
    <p>creating,updating,deleting expenses.</p>
  </li>
  <li>
    <p>getting all expenses and pending expenses based on user.</p>
  </li>
  <li>
    <p>updating expense status.</p>
  </li>
  <li>
    <p>Create a package for service interfaces as <code>com.springsource.html5expense.service</code> and add <code>AttachmentService</code>,<code>ExpenseReportService</code>,<code>ExpenseService</code>,<code>ExpenseTypeService</code>,<code>UserService</code> interfaces which define the business methods.</p>
  </li>
  <li>
    <p>Create a package <code>com.springsource.html5expense.serviceImpl</code> for service implementation and add the following classes 
JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl. The EntityManager has been autowired. It handles transaction and also responsible 
for persisting,removing,finding entities that are mapped by JPA to database. @PersistenceContext which will use EntityManagerFactory to create EntityManager instance.</p>
  </li>
</ul><p>One you have added service implementation classes,ensure you arenâ€™t getting errors.</p>

<h2 id="adding-controller">Adding controller</h2>
<p>Controller is reponsible for mapping requests. We used <code>@RequestMapping</code> annotation to map web requests onto specific handler methods. Create a package for Controllers as <code>com.springsource.html5expense.controller</code> and add the following classes <code>ExpenseController</code>, <code>FileAttachmentController</code>.
To support uploading attachments of expenses we have added save function in FileAttachmentController this calls for a file upload mechanism. To automatically detect the presence of the fileupload simply add a <code>@RequestParam</code> argument of type MultipartFile.</p>
<pre><code class="language-java">        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
        <span class="o">}</span></code></pre>

<p>The below method we have used ModelMap. It is a place for you to store key/value pairs for use by the view in rendering a response. It is through this context that you communicate request specific information in the response. 
In our handler, we have gathered some data about the pending expenses and made them available in the ModelMap using the injected ExpenseService reference. We can use HTTP request also to store key/values pair of datas, to use HttpServletRequest simply add another argument of type HttpServletRequest.</p>

<pre><code class="language-java">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printWelcome</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span> <span class="n">Principal</span> <span class="n">principal</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">)</span> <span class="o">{</span>
 
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
 
    <span class="o">}</span></code></pre>

<h2 id="configuring-expensereport-application">Configuring ExpenseReport application</h2>
<p>The application needs to be configured in order to make it ready to deploy. Create a new package <code>com.springsource.html5expense.config</code> and add the following classes ComponentConfig,WebConfig. The ComponentConfig class has been marked with @Configuration annotation to configure beans. This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>
<pre><code class="language-java"><span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="o">{</span><span class="n">JpaExpenseServiceImpl</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">ExpenseController</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
 <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"192.168.6.30"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
 <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
 <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
 <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setPersistenceUnitName</span><span class="o">(</span><span class="s">"sample"</span><span class="o">);</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
 <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
<span class="o">{</span>
 <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
 <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>To identify multipart request we have configured multipartResolver bean.</p>
<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
        <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
    <span class="o">}</span></code></pre>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>@EnableTransactionManagement annotation is responsible for Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<ul>
<li>
    <p>Create a new file <code>import.sql</code> in <code>src/main/resources</code> and add the below content in it.</p>

    <pre><code>  insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_USER');
  insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_MANAGER');
  insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval('hibernate_sequence'),'admin@expense.com',true,'admin','admin',2);
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'MEDICAL');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TRAVEL');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TELEPHONE');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'GYM');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'EDUCATION');
</code></pre>
  </li>
</ul><p>To execute these statements automatically in database while app starts we have set 
these two Jpa properties in entityManagerFactory bean.  </p>
<pre><code class="language-java"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span></code></pre>

<ul>
<li>To load this <code>ComponentConfig</code> class as part of contextConfiglocation add contextClass as AnnotationConfigWebApplicationContext and contextConfigLocation as
<code>com.springsource.html5expense.config</code>.</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
<span class="nt">&lt;context-param&gt;</span>
   <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
   <span class="nt">&lt;param-value&gt;</span>com.springsource.html5expense.config<span class="nt">&lt;/param-value&gt;</span>
 <span class="nt">&lt;/context-param&gt;</span></code></pre>

<h2 id="adding-view-files">Adding View Files</h2>
<p>Now the ExpenseReport app service is ready. To interact it with users we need to create some user interface.To resolve the Controllers return <code>view</code> value we have defined 
InternalViewResolver</p>

<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">InternalResourceViewResolver</span> <span class="nf">internalResourceViewResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">InternalResourceViewResolver</span> <span class="n">internalResourceViewResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceViewResolver</span><span class="o">();</span>
        <span class="n">internalResourceViewResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span><span class="o">);</span>
        <span class="n">internalResourceViewResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">".jsp"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">internalResourceViewResolver</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<p>The application requires the following files to be added,<code>login.jsp</code>,<code>expenseapproval.jsp</code>,<code>myexpense.jsp</code>,<code>newexpense.jsp</code>,<code>usermain.jsp</code>,<code>signUp.jsp</code> in <code>webapp/WEB-INF/view</code> folder.</p>

<h2 id="application-code">Application Code:</h2>
<p>You can get the application code from :</p>

<h2 id="check-point">Check Point</h2>
<p>Now build the app and test it locally.
Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed. Open your browser and enter application url : <code>http://localhost:8080/html5expense/createNewExpense</code>. It will open a form to create new expense.</p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="STS Fabric Server.png"></p>

<p><a href="/frameworks/java/spring/springmvc-template-project.html">&lt;==Prev</a>                                                         <a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">Next==&gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Ò4## Introduction
In this tutorial, we take the following use case.
Create and Deploy an Expense Reporting App on local tomcat server.
ExpenseReport is used to create and manage expenses.

## Prerequisites
Before you begin this tutorial, you should be familiar with:

1.  Working with STS or Eclipse IDE.

2.  Assuming previous exercise get completed.

In expensereport application,we are using two roles.

1.   Normal User - can create expense,view status of expense,edit expense,delete expense.

2.   Admin User -  approve expense,reject expense which are created by normal user.

     Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.

![spring-expensereport-usecase.png](/images/spring_tutorial/usecase_diagram.png)

![spring-expensereport-usecase_admin.png](/images/spring_tutorial/usecase_diagram_admin.png)

These expenses are created by the users and the data
is stored in PostgreSQL database.

The class diagram for our application is :

![spring-expensereport-class_diagram.png](/images/spring_tutorial/class_diagram.png)

Before creating Entities,delete `HomeController.java` from your `com.springsource.html5config` package and replace your pom.xml with the one below,

*Notes:*
: Before going to test the application you have to add Entities,Services,Controllers,Application Configuration classes and Views.

## Adding Entities
An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.
The application requires the following entities to be added. `Expense`,`User`,`Role`,`Attachment`,`ExpenseReport`,`State` classes.These classes are POJO with getters and setters for its properties and annotated with `@Entity`. By default JPA will take class name as table name. If you want to store in different table name then provide `@Table` annotation with name property. Create a package for entities as `com.springsource.html5expense.model` and add all entities to it.
```java
@Entity
@Table(name = "EXPENSE")
public class Expense implements Serializable{
    @Id
    @GeneratedValue
    private Long id;
    private String description;
    private Double amount;
    private State state = State.NEW;
    private Date expenseDate;
    
    @OneToOne
    private Attachment attachment;
}
```

The `@Id` annotation specifies the primary key of the entity `@GeneratedValue` annotations which tell JPA that the value in that field should map to the primary key and that the primary key should use an auto-incrementing value strategy. `@OneToOne` annotation defines a single-valued association 
to another entity that has one-to-one multiplicity.  

## Adding Service
```java
public interface ExpenseService {

    public Long createExpense(String description,ExpenseType expenseType,Date expenseDate,
            Double amount,User user,Attachment attachment);
    
    public Expense getExpense(Long expenseId);
    public List getAllExpenses();
    public List<Expense> getExpensesByUser(User user);
    public List<Expense> getPendingExpensesList();
    public List<Expense> getApprovedAndRejectedExpensesList();
    public Expense changeExpenseStatus(Long expenseId,String state);
    public void deleteExpense(Long expenseId);
    public void updateExpense(Long expenseId,String description,Double amount,ExpenseType expenseType);
}
```
This are the business methods to,

+ creating,updating,deleting expenses.

+ getting all expenses and pending expenses based on user.

+ updating expense status.

* Create a package for service interfaces as `com.springsource.html5expense.service` and add `AttachmentService`,`ExpenseReportService`,`ExpenseService`,`ExpenseTypeService`,`UserService` interfaces which define the business methods.

* Create a package `com.springsource.html5expense.serviceImpl` for service implementation and add the following classes 
JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl. The EntityManager has been autowired. It handles transaction and also responsible 
for persisting,removing,finding entities that are mapped by JPA to database. @PersistenceContext which will use EntityManagerFactory to create EntityManager instance.

One you have added service implementation classes,ensure you aren't getting errors.

## Adding controller
Controller is reponsible for mapping requests. We used `@RequestMapping` annotation to map web requests onto specific handler methods. Create a package for Controllers as `com.springsource.html5expense.controller` and add the following classes `ExpenseController`, `FileAttachmentController`.
To support uploading attachments of expenses we have added save function in FileAttachmentController this calls for a file upload mechanism. To automatically detect the presence of the fileupload simply add a `@RequestParam` argument of type MultipartFile.
```java
        @RequestMapping(value = "/save", method = RequestMethod.POST)
        public String save(@RequestParam("file") MultipartFile file) {
            try {
                String fileName =file.getOriginalFilename();
                String contentType = file.getContentType();
                Attachment attachment = new Attachment(fileName, contentType, file.getBytes());
                attachmentService.save(attachment);
            } catch (IOException e) {
                e.printStackTrace();
            }
            return "redirect:/";
        }
```
The below method we have used ModelMap. It is a place for you to store key/value pairs for use by the view in rendering a response. It is through this context that you communicate request specific information in the response. 
In our handler, we have gathered some data about the pending expenses and made them available in the ModelMap using the injected ExpenseService reference. We can use HTTP request also to store key/values pair of datas, to use HttpServletRequest simply add another argument of type HttpServletRequest.

```java
    @RequestMapping(value="/", method = RequestMethod.GET)
    public String printWelcome(ModelMap model, Principal principal,HttpServletRequest request ) {
 
        String name = principal.getName();
        model.addAttribute("username", name);
        User user = getUserService().getUserByUserName(name);
        List<Expense> pendingExpenseList = getExpenseService().getExpensesByUser(user);
        model.addAttribute("pendingExpenseList",pendingExpenseList);
        request.getSession().setAttribute("user", user);
        return "myexpense";
 
    }
```


## Configuring ExpenseReport application
The application needs to be configured in order to make it ready to deploy. Create a new package `com.springsource.html5expense.config` and add the following classes ComponentConfig,WebConfig. The ComponentConfig class has been marked with @Configuration annotation to configure beans. This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the method's return value. By default, the bean name will be the same as the method name.
```java
@Configuration
@EnableTransactionManagement
@ComponentScan(basePackageClasses = {JpaExpenseServiceImpl.class,ExpenseController.class,Expense.class})

public class ComponentConfig {

@Bean
public DataSource dataSource()  {
 SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
 dataSource.setUrl(String.format("jdbc:postgresql://%s:%s/%s", "192.168.6.30", "5432", "postgres"));
 dataSource.setDriverClass(org.postgresql.Driver.class);
 dataSource.setUsername("postgres");
 dataSource.setPassword("postgres");
 return dataSource;
 }

@Bean
public LocalContainerEntityManagerFactoryBean entityManagerFactory() {
 LocalContainerEntityManagerFactoryBean emfb = new LocalContainerEntityManagerFactoryBean();
 emfb.setJpaVendorAdapter( jpaAdapter());
 emfb.setDataSource(dataSource());
 emfb.setJpaPropertyMap(createPropertyMap());
 emfb.setJpaDialect(new HibernateJpaDialect());
 emfb.setPersistenceUnitName("sample");
 emfb.setPackagesToScan(new String[]{Expense.class.getPackage().getName()});
 return emfb;
}

public Map<String,String> createPropertyMap()
{
 Map<String,String> map= new HashedMap();
 map.put(org.hibernate.cfg.Environment.HBM2DDL_AUTO, "create");
 map.put(org.hibernate.cfg.Environment.HBM2DDL_IMPORT_FILES, "import.sql");
 map.put("hibernate.c3p0.min_size", "5");
 map.put("hibernate.c3p0.max_size", "20");
 map.put("hibernate.c3p0.timeout", "360000");
 map.put("hibernate.dialect", "org.hibernate.dialect.PostgreSQLDialect");
 return map;
 }
}

```

To identify multipart request we have configured multipartResolver bean.
```java
    @Bean
    public MultipartResolver multipartResolver(){
        CommonsMultipartResolver multipartResolver = new org.springframework.web.multipart.commons.CommonsMultipartResolver();
        multipartResolver.setMaxUploadSize(10000000);
        return multipartResolver;
    }
```

Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XML's <context:component-scan> element and pass one of basePackageClasses(), basePackages() value.

  @EnableTransactionManagement annotation is responsible for Spring's annotation-driven transaction management capability, similar to the support found in Spring's <tx:*> XML namespace. 

* Create a new file `import.sql` in `src/main/resources` and add the below content in it.

	    insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_USER');
	    insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_MANAGER');
	    insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval('hibernate_sequence'),'admin@expense.com',true,'admin','admin',2);
	    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'MEDICAL');
	    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TRAVEL');
	    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TELEPHONE');
	    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'GYM');
	    insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'EDUCATION');
    
To execute these statements automatically in database while app starts we have set 
these two Jpa properties in entityManagerFactory bean.  
```java
map.put(org.hibernate.cfg.Environment.HBM2DDL_AUTO, "create");
map.put(org.hibernate.cfg.Environment.HBM2DDL_IMPORT_FILES, "import.sql");
```

* To load this `ComponentConfig` class as part of contextConfiglocation add contextClass as AnnotationConfigWebApplicationContext and contextConfigLocation as
`com.springsource.html5expense.config`.
```xml
<context-param>
    <param-name>contextClass</param-name>
    <param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext</param-value>
</context-param>
<context-param>
   <param-name>contextConfigLocation</param-name>
   <param-value>com.springsource.html5expense.config</param-value>
 </context-param>
```

## Adding View Files
Now the ExpenseReport app service is ready. To interact it with users we need to create some user interface.To resolve the Controllers return `view` value we have defined 
InternalViewResolver

```java
    @Bean
    public InternalResourceViewResolver internalResourceViewResolver() {
        InternalResourceViewResolver internalResourceViewResolver = new InternalResourceViewResolver();
        internalResourceViewResolver.setPrefix("/WEB-INF/views/");
        internalResourceViewResolver.setSuffix(".jsp");
        return internalResourceViewResolver;
}
```

The application requires the following files to be added,`login.jsp`,`expenseapproval.jsp`,`myexpense.jsp`,`newexpense.jsp`,`usermain.jsp`,`signUp.jsp` in `webapp/WEB-INF/view` folder.

## Application Code:
You can get the application code from :

## Check Point
Now build the app and test it locally.
Select `Run As -> Maven clean`

![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completed select` Run As -> Maven install`.It will download dependencies from pom.xml.

![maven_install.png](/images/spring_tutorial/maven_install.png)

Select `Run As -> Maven build`

![maven_build.png](/images/spring_tutorial/maven_build.png)


And give Maven goal as , `tomcat:run`
![maven_run.png](/images/spring_tutorial/maven_run.png)

Once server starts completed. Open your browser and enter application url : `http://localhost:8080/html5expense/createNewExpense`. It will open a form to create new expense.

![STS Fabric Server.png](/images/spring_tutorial/create_new_expense.png)

[<==Prev](/frameworks/java/spring/springmvc-template-project.html)                                                         [Next==>](/frameworks/java/spring/expensereport-app-with-spring-security.html);T;
I"£u<h2 id="introduction">Introduction</h2>
<p>In this tutorial, we take the following use case.
Create and Deploy an Expense Reporting App on local tomcat server.
ExpenseReport is used to create and manage expenses.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Working with STS or Eclipse IDE.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><p>In expensereport application,we are using two roles.</p>

<ol>
<li>
    <p>Normal User - can create expense,view status of expense,edit expense,delete expense.</p>
  </li>
  <li>
    <p>Admin User -  approve expense,reject expense which are created by normal user.</p>

    <p>Once Normal User submits his expense it will go to admin work items.Admin can approve or reject the expense.</p>
  </li>
</ol><p><img src="/images/spring_tutorial/usecase_diagram.png" alt="spring-expensereport-usecase.png"></p>

<p><img src="/images/spring_tutorial/usecase_diagram_admin.png" alt="spring-expensereport-usecase_admin.png"></p>

<p>These expenses are created by the users and the data
is stored in PostgreSQL database.</p>

<p>The class diagram for our application is :</p>

<p><img src="/images/spring_tutorial/class_diagram.png" alt="spring-expensereport-class_diagram.png"></p>

<p>Before creating Entities,delete <code>HomeController.java</code> from your <code>com.springsource.html5config</code> package and replace your pom.xml with the one below,</p>

<dl>
<dt><em>Notes:</em></dt>
  <dd>Before going to test the application you have to add Entities,Services,Controllers,Application Configuration classes and Views.</dd>
</dl><h2 id="adding-entities">Adding Entities</h2>
<p>An entity is a lightweight persistence domain object. Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.The persistent state of an entity is represented through either persistent fields or persistent properties. These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.
The application requires the following entities to be added. <code>Expense</code>,<code>User</code>,<code>Role</code>,<code>Attachment</code>,<code>ExpenseReport</code>,<code>State</code> classes.These classes are POJO with getters and setters for its properties and annotated with <code>@Entity</code>. By default JPA will take class name as table name. If you want to store in different table name then provide <code>@Table</code> annotation with name property. Create a package for entities as <code>com.springsource.html5expense.model</code> and add all entities to it.</p>
<pre><code class="language-java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"EXPENSE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Expense</span> <span class="kd">implements</span> <span class="n">Serializable</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Double</span> <span class="n">amount</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">NEW</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">expenseDate</span><span class="o">;</span>
    
    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="n">Attachment</span> <span class="n">attachment</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<p>The <code>@Id</code> annotation specifies the primary key of the entity <code>@GeneratedValue</code> annotations which tell JPA that the value in that field should map to the primary key and that the primary key should use an auto-incrementing value strategy. <code>@OneToOne</code> annotation defines a single-valued association 
to another entity that has one-to-one multiplicity.  </p>

<h2 id="adding-service">Adding Service</h2>
<pre><code class="language-java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExpenseService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">createExpense</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">,</span><span class="n">Date</span> <span class="n">expenseDate</span><span class="o">,</span>
            <span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span><span class="n">Attachment</span> <span class="n">attachment</span><span class="o">);</span>
    
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">getExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getAllExpenses</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getExpensesByUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getPendingExpensesList</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">getApprovedAndRejectedExpensesList</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">Expense</span> <span class="nf">changeExpenseStatus</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">state</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateExpense</span><span class="o">(</span><span class="n">Long</span> <span class="n">expenseId</span><span class="o">,</span><span class="n">String</span> <span class="n">description</span><span class="o">,</span><span class="n">Double</span> <span class="n">amount</span><span class="o">,</span><span class="n">ExpenseType</span> <span class="n">expenseType</span><span class="o">);</span>
<span class="o">}</span></code></pre>

<p>This are the business methods to,</p>

<ul>
<li>
    <p>creating,updating,deleting expenses.</p>
  </li>
  <li>
    <p>getting all expenses and pending expenses based on user.</p>
  </li>
  <li>
    <p>updating expense status.</p>
  </li>
  <li>
    <p>Create a package for service interfaces as <code>com.springsource.html5expense.service</code> and add <code>AttachmentService</code>,<code>ExpenseReportService</code>,<code>ExpenseService</code>,<code>ExpenseTypeService</code>,<code>UserService</code> interfaces which define the business methods.</p>
  </li>
  <li>
    <p>Create a package <code>com.springsource.html5expense.serviceImpl</code> for service implementation and add the following classes 
JpaAttachmentServiceImpl,JpaExpenseReportServiceImpl,JpaExpenseServiceImpl,JpaExpenseTypeServiceImpl,
JpaRoleServiceImpl,JpaUserServiceImpl. The EntityManager has been autowired. It handles transaction and also responsible 
for persisting,removing,finding entities that are mapped by JPA to database. @PersistenceContext which will use EntityManagerFactory to create EntityManager instance.</p>
  </li>
</ul><p>One you have added service implementation classes,ensure you arenâ€™t getting errors.</p>

<h2 id="adding-controller">Adding controller</h2>
<p>Controller is reponsible for mapping requests. We used <code>@RequestMapping</code> annotation to map web requests onto specific handler methods. Create a package for Controllers as <code>com.springsource.html5expense.controller</code> and add the following classes <code>ExpenseController</code>, <code>FileAttachmentController</code>.
To support uploading attachments of expenses we have added save function in FileAttachmentController this calls for a file upload mechanism. To automatically detect the presence of the fileupload simply add a <code>@RequestParam</code> argument of type MultipartFile.</p>
<pre><code class="language-java">        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/save"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">contentType</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getContentType</span><span class="o">();</span>
                <span class="n">Attachment</span> <span class="n">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Attachment</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">contentType</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">attachmentService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">attachment</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
        <span class="o">}</span></code></pre>

<p>The below method we have used ModelMap. It is a place for you to store key/value pairs for use by the view in rendering a response. It is through this context that you communicate request specific information in the response. 
In our handler, we have gathered some data about the pending expenses and made them available in the ModelMap using the injected ExpenseService reference. We can use HTTP request also to store key/values pair of datas, to use HttpServletRequest simply add another argument of type HttpServletRequest.</p>

<pre><code class="language-java">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">printWelcome</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">model</span><span class="o">,</span> <span class="n">Principal</span> <span class="n">principal</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">)</span> <span class="o">{</span>
 
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">principal</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">().</span><span class="na">getUserByUserName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Expense</span><span class="o">&gt;</span> <span class="n">pendingExpenseList</span> <span class="o">=</span> <span class="n">getExpenseService</span><span class="o">().</span><span class="na">getExpensesByUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pendingExpenseList"</span><span class="o">,</span><span class="n">pendingExpenseList</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"myexpense"</span><span class="o">;</span>
 
    <span class="o">}</span></code></pre>

<h2 id="configuring-expensereport-application">Configuring ExpenseReport application</h2>
<p>The application needs to be configured in order to make it ready to deploy. Create a new package <code>com.springsource.html5expense.config</code> and add the following classes ComponentConfig,WebConfig. The ComponentConfig class has been marked with @Configuration annotation to configure beans. This is an alternative to XML configuration for bean definition.We can pass this class a argument to spring container as a source for bean creation. 
To declare a bean, simply annotate a method with the @Bean annotation in your config class.This method is used to register a bean definition within an ApplicationContext of the type specified as the methodâ€™s return value. By default, the bean name will be the same as the method name.</p>
<pre><code class="language-java"><span class="nd">@Configuration</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="o">{</span><span class="n">JpaExpenseServiceImpl</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">ExpenseController</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComponentConfig</span> <span class="o">{</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span>  <span class="o">{</span>
 <span class="n">SimpleDriverDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDriverDataSource</span><span class="o">();</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"jdbc:postgresql://%s:%s/%s"</span><span class="o">,</span> <span class="s">"192.168.6.30"</span><span class="o">,</span> <span class="s">"5432"</span><span class="o">,</span> <span class="s">"postgres"</span><span class="o">));</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">postgresql</span><span class="o">.</span><span class="na">Driver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
 <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"postgres"</span><span class="o">);</span>
 <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
 <span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
 <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">emfb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span> <span class="n">jpaAdapter</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaPropertyMap</span><span class="o">(</span><span class="n">createPropertyMap</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setJpaDialect</span><span class="o">(</span><span class="k">new</span> <span class="n">HibernateJpaDialect</span><span class="o">());</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setPersistenceUnitName</span><span class="o">(</span><span class="s">"sample"</span><span class="o">);</span>
 <span class="n">emfb</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">Expense</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getName</span><span class="o">()});</span>
 <span class="k">return</span> <span class="n">emfb</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">createPropertyMap</span><span class="o">()</span>
<span class="o">{</span>
 <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashedMap</span><span class="o">();</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.min_size"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.max_size"</span><span class="o">,</span> <span class="s">"20"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.c3p0.timeout"</span><span class="o">,</span> <span class="s">"360000"</span><span class="o">);</span>
 <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"hibernate.dialect"</span><span class="o">,</span> <span class="s">"org.hibernate.dialect.PostgreSQLDialect"</span><span class="o">);</span>
 <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span></code></pre>

<p>To identify multipart request we have configured multipartResolver bean.</p>
<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">(){</span>
        <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">multipart</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">CommonsMultipartResolver</span><span class="o">();</span>
        <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
    <span class="o">}</span></code></pre>

<p>Then configure the components using @ComponentScan which Configures component scanning directives for use with @Configuration classes. Provides support parallel with Spring XMLâ€™s <component-scan> element and pass one of basePackageClasses(), basePackages() value.</component-scan></p>

<p>@EnableTransactionManagement annotation is responsible for Springâ€™s annotation-driven transaction management capability, similar to the support found in Springâ€™s &lt;tx:*&gt; XML namespace. </p>

<ul>
<li>
    <p>Create a new file <code>import.sql</code> in <code>src/main/resources</code> and add the below content in it.</p>

    <pre><code>  insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_USER');
  insert into role(roleid,rolename) values(nextval( 'hibernate_sequence'),'ROLE_MANAGER');
  insert into users(userid,emailid,enabled,password,username,role_roleid) values(nextval('hibernate_sequence'),'admin@expense.com',true,'admin','admin',2);
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'MEDICAL');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TRAVEL');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'TELEPHONE');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'GYM');
  insert into expenseType(id,name) values(nextval( 'hibernate_sequence'),'EDUCATION');
</code></pre>
  </li>
</ul><p>To execute these statements automatically in database while app starts we have set 
these two Jpa properties in entityManagerFactory bean.  </p>
<pre><code class="language-java"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_AUTO</span><span class="o">,</span> <span class="s">"create"</span><span class="o">);</span>
<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">cfg</span><span class="o">.</span><span class="na">Environment</span><span class="o">.</span><span class="na">HBM2DDL_IMPORT_FILES</span><span class="o">,</span> <span class="s">"import.sql"</span><span class="o">);</span></code></pre>

<ul>
<li>To load this <code>ComponentConfig</code> class as part of contextConfiglocation add contextClass as AnnotationConfigWebApplicationContext and contextConfigLocation as
<code>com.springsource.html5expense.config</code>.</li>
</ul><pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
<span class="nt">&lt;context-param&gt;</span>
   <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
   <span class="nt">&lt;param-value&gt;</span>com.springsource.html5expense.config<span class="nt">&lt;/param-value&gt;</span>
 <span class="nt">&lt;/context-param&gt;</span></code></pre>

<h2 id="adding-view-files">Adding View Files</h2>
<p>Now the ExpenseReport app service is ready. To interact it with users we need to create some user interface.To resolve the Controllers return <code>view</code> value we have defined 
InternalViewResolver</p>

<pre><code class="language-java">    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">InternalResourceViewResolver</span> <span class="nf">internalResourceViewResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">InternalResourceViewResolver</span> <span class="n">internalResourceViewResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceViewResolver</span><span class="o">();</span>
        <span class="n">internalResourceViewResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span><span class="o">);</span>
        <span class="n">internalResourceViewResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">".jsp"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">internalResourceViewResolver</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<p>The application requires the following files to be added,<code>login.jsp</code>,<code>expenseapproval.jsp</code>,<code>myexpense.jsp</code>,<code>newexpense.jsp</code>,<code>usermain.jsp</code>,<code>signUp.jsp</code> in <code>webapp/WEB-INF/view</code> folder.</p>

<h2 id="application-code">Application Code:</h2>
<p>You can get the application code from :</p>

<h2 id="check-point">Check Point</h2>
<p>Now build the app and test it locally.
Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code>
<img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed. Open your browser and enter application url : <code>http://localhost:8080/html5expense/createNewExpense</code>. It will open a form to create new expense.</p>

<p><img src="/images/spring_tutorial/create_new_expense.png" alt="STS Fabric Server.png"></p>

<p><a href="/frameworks/java/spring/springmvc-template-project.html">&lt;==Prev</a>                                                         <a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">Next==&gt;</a></p>;T;@kI"D/frameworks/java/spring/expensereport-app-with-spring-security/;T{;{	;I"–X<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/expensereport-app-with-spring-security.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring MVC App with Spring Security' property='og:title'>
<meta content='Spring security added to ExpenseReport App.' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring MVC App with Spring Security</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring MVC App with Spring Security</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring security added to ExpenseReport App.</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/Spring" rel="tag">Spring</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/tomcat" rel="tag">tomcat</a><a href="/tags/maven" rel="tag">maven</a><a href="/tags/Spring-Security" rel="tag">Spring-Security</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>Spring Security provides authentication and access services for J2EE-based enterprise software applications.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Working with STS or Eclipse IDE.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>
<p>This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have to add in pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>
<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in <code>src/main/webapp/WEB-INF/web.xml</code></p>
  </li>
  <li>
    <p>Create a custom XML configuration named spring-security.xml in <code>src/main/resources</code></p>
  </li>
</ol><p>In the web.xml declare an instance of a DelegatingFilterProxy. This will filter the requests based on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span> 
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/signUp**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/loadApprovalExpenses"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/sessionTimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"sas"</span> <span class="na">class=</span><span class="s">"org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
           <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">              select username,password,enabled  </span>
<span class="s">              from users where username=?"</span> 
 
           <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">              select u.username, r.rolename from users u, role r </span>
<span class="s">              where u.role_roleid = r.roleid and u.username =?  "</span> 
 
        <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>

<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<ol>
<li>
    <p>To access the application, the user must have either <code>ROLE_USER</code>,<code>ROLE_MANAGER</code> access so to validate this we have added <code>&lt;intercept-url pattern="/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/&gt;</code>.</p>
  </li>
  <li>
    <p>Manager only can approve the expenses so we have restricted that access to only Manager by giving  <code>&lt;intercept-url pattern="/loadApprovalExpenses" access="hasRole('ROLE_MANAGER')"/&gt;</code>.</p>
  </li>
</ol><p>To load this file as part of configuration add <code>@ImportResource({ "classpath:spring-security.xml"})</code> in <code>ComponentConfig</code> class.</p>

<p>Create <code>Logincontroller</code> in <code>com.springsource.html5expense.contoller</code> package and add mapping for login,logout,loginfailed,signup.The login.jsp has two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.
when the form is submitted ,it will be sent to the following action URL:j_spring_security_check.</p>

<h2 id="check-point">Check point</h2>
<p>Now build the app and test it locally.
Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed. Open your browser and enter application url : <code>http://localhost:8080/html5expense/createNewExpense</code> ,this time browser will not open a form to create new expense. It will automatically redirect to login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>

<p><a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">&lt;==Prev</a>                                                         <a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">Next==&gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"## Introduction
Spring Security provides authentication and access services for J2EE-based enterprise software applications.

## Prerequisites
Before you begin this tutorial, you should be familiar with:

1.  Working with STS or Eclipse IDE.

2.  Assuming previous exercise get completed.

## Add Spring Security to ExpenseReport App
This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have to add in pom.xml,

  + spring-security-core.jar
  + spring-security-web.jar
  + spring-security-config.jar

## Enable Spring Security:
To enable Spring security we need to add the following steps:

1.     Add a DelegatingFilterProxy in `src/main/webapp/WEB-INF/web.xml`

2.     Create a custom XML configuration named spring-security.xml in `src/main/resources`

In the web.xml declare an instance of a DelegatingFilterProxy. This will filter the requests based on the declared url-pattern.

```xml
<filter>
    <filter-name>springSecurityFilterChain</filter-name>
    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
</filter>
<filter-mapping>
    <filter-name>springSecurityFilterChain</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add "jdbc-user service" tag and define the query to get the data from database.

```xml
<beans:beans xmlns="http://www.springframework.org/schema/security"
    xmlns:beans="http://www.springframework.org/schema/beans" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/security
    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd">


    <http auto-config="true" use-expressions="true">
        <intercept-url pattern="/login" filters="none" />
        <intercept-url pattern="/logout" filters="none" />
        <intercept-url pattern="/signUp**" filters="none" />
        <intercept-url pattern="/resources/**" filters="none" />
        <intercept-url pattern="/loadApprovalExpenses" access="hasRole('ROLE_MANAGER')"/>
        <intercept-url pattern="/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/>
        <intercept-url pattern="/**" access="isAuthenticated()" />
        <form-login login-page="/login" default-target-url="/"
            authentication-failure-url="/loginfailed" />
        <logout logout-success-url="/logout" />
        <session-management invalid-session-url="/sessionTimeout" >
            <concurrency-control max-sessions="1" />
        </session-management>
    </http>
    <beans:bean id="sas" class="org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy" />

    <authentication-manager>
        <authentication-provider>
            <jdbc-user-service data-source-ref="dataSource"
 
           users-by-username-query="
              select username,password,enabled  
              from users where username=?" 
 
           authorities-by-username-query="
              select u.username, r.rolename from users u, role r 
              where u.role_roleid = r.roleid and u.username =?  " 
 
        />
        </authentication-provider>
    </authentication-manager>

</beans:beans>

```

1.  To access the application, the user must have either `ROLE_USER`,`ROLE_MANAGER` access so to validate this we have added `<intercept-url pattern="/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/>`.

2.  Manager only can approve the expenses so we have restricted that access to only Manager by giving  `<intercept-url pattern="/loadApprovalExpenses" access="hasRole('ROLE_MANAGER')"/>`.

To load this file as part of configuration add `@ImportResource({ "classpath:spring-security.xml"})` in `ComponentConfig` class.

Create `Logincontroller` in `com.springsource.html5expense.contoller` package and add mapping for login,logout,loginfailed,signup.The login.jsp has two input elements for username and password as j_username and j_password.These are spring's placeholder for the username and password respectively.
when the form is submitted ,it will be sent to the following action URL:j_spring_security_check.

## Check point
Now build the app and test it locally.
Select `Run As -> Maven clean`

![maven_clean.png](/images/spring_tutorial/maven_clean.png)

Once Maven clean completed select` Run As -> Maven install`.It will download dependencies from pom.xml.

![maven_install.png](/images/spring_tutorial/maven_install.png)

Select `Run As -> Maven build`

![maven_build.png](/images/spring_tutorial/maven_build.png)

And give Maven goal as , `tomcat:run`

![maven_run.png](/images/spring_tutorial/maven_run.png)

Once server starts completed. Open your browser and enter application url : `http://localhost:8080/html5expense/createNewExpense` ,this time browser will not open a form to create new expense. It will automatically redirect to login page.

![STS Fabric Server.png](/images/spring_tutorial/localhost_login.png)


[<==Prev](/frameworks/java/spring/spring-expensereport-app-tutorial.html)                                                         [Next==>](/frameworks/java/spring/spring-app-deployment-using-STS.html);T;
I" $<h2 id="introduction">Introduction</h2>
<p>Spring Security provides authentication and access services for J2EE-based enterprise software applications.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Working with STS or Eclipse IDE.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="add-spring-security-to-expensereport-app">Add Spring Security to ExpenseReport App</h2>
<p>This section provides details on how to get integrate ExpenseReport App with Spring Security.
These are the required jars that we have to add in pom.xml,</p>

<ul>
<li>spring-security-core.jar</li>
  <li>spring-security-web.jar</li>
  <li>spring-security-config.jar</li>
</ul><h2 id="enable-spring-security">Enable Spring Security:</h2>
<p>To enable Spring security we need to add the following steps:</p>

<ol>
<li>
    <p>Add a DelegatingFilterProxy in <code>src/main/webapp/WEB-INF/web.xml</code></p>
  </li>
  <li>
    <p>Create a custom XML configuration named spring-security.xml in <code>src/main/resources</code></p>
  </li>
</ol><p>In the web.xml declare an instance of a DelegatingFilterProxy. This will filter the requests based on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In the spring-security.xml,define HTTP security configuration by adding http tag.And define which url pattern to intecept. Add â€œjdbc-user serviceâ€ tag and define the query to get the data from database.</p>

<pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span> 
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/signUp**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/loadApprovalExpenses"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/login"</span> <span class="na">default-target-url=</span><span class="s">"/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/sessionTimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;beans:bean</span> <span class="na">id=</span><span class="s">"sas"</span> <span class="na">class=</span><span class="s">"org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
 
           <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">              select username,password,enabled  </span>
<span class="s">              from users where username=?"</span> 
 
           <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">              select u.username, r.rolename from users u, role r </span>
<span class="s">              where u.role_roleid = r.roleid and u.username =?  "</span> 
 
        <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>

<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<ol>
<li>
    <p>To access the application, the user must have either <code>ROLE_USER</code>,<code>ROLE_MANAGER</code> access so to validate this we have added <code>&lt;intercept-url pattern="/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/&gt;</code>.</p>
  </li>
  <li>
    <p>Manager only can approve the expenses so we have restricted that access to only Manager by giving  <code>&lt;intercept-url pattern="/loadApprovalExpenses" access="hasRole('ROLE_MANAGER')"/&gt;</code>.</p>
  </li>
</ol><p>To load this file as part of configuration add <code>@ImportResource({ "classpath:spring-security.xml"})</code> in <code>ComponentConfig</code> class.</p>

<p>Create <code>Logincontroller</code> in <code>com.springsource.html5expense.contoller</code> package and add mapping for login,logout,loginfailed,signup.The login.jsp has two input elements for username and password as j_username and j_password.These are springâ€™s placeholder for the username and password respectively.
when the form is submitted ,it will be sent to the following action URL:j_spring_security_check.</p>

<h2 id="check-point">Check point</h2>
<p>Now build the app and test it locally.
Select <code>Run As -&gt; Maven clean</code></p>

<p><img src="/images/spring_tutorial/maven_clean.png" alt="maven_clean.png"></p>

<p>Once Maven clean completed select<code> Run As -&gt; Maven install</code>.It will download dependencies from pom.xml.</p>

<p><img src="/images/spring_tutorial/maven_install.png" alt="maven_install.png"></p>

<p>Select <code>Run As -&gt; Maven build</code></p>

<p><img src="/images/spring_tutorial/maven_build.png" alt="maven_build.png"></p>

<p>And give Maven goal as , <code>tomcat:run</code></p>

<p><img src="/images/spring_tutorial/maven_run.png" alt="maven_run.png"></p>

<p>Once server starts completed. Open your browser and enter application url : <code>http://localhost:8080/html5expense/createNewExpense</code> ,this time browser will not open a form to create new expense. It will automatically redirect to login page.</p>

<p><img src="/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>

<p><a href="/frameworks/java/spring/spring-expensereport-app-tutorial.html">&lt;==Prev</a>                                                         <a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">Next==&gt;</a></p>;T;@qI"=/frameworks/java/spring/spring-app-deployment-using-STS/;T{;{	;I"9A<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring-app-deployment-using-STS.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | STS to deploy Spring Application' property='og:title'>
<meta content='Spring Application Deployment to Cloud Foundry using STS' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | STS to deploy Spring Application</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>STS to deploy Spring Application</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Deployment to Cloud Foundry using STS</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/tomcat" rel="tag">tomcat</a><a href="/tags/maven" rel="tag">maven</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to push Spring Application into Cloud Foundry using STS.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Cloud Foundry plugin for STS installed.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>
<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"></p>

    <p><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required.</p>

    <p><img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click </p>

    <p><img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"></p>

    <p><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>

    <p><img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><h2 id="check-point">Check Point</h2>
<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>

<p><a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">&lt;==Prev      </a>              <a href="/frameworks/java/spring/spring-app-deployment-using-VMC.html">        Next==&gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Š
## Introduction
This section provides details on how to push Spring Application into Cloud Foundry using STS.

## Prerequisites
Before you begin this tutorial, you should be familiar with:

1.  Cloud Foundry plugin for STS installed.

2.  Assuming previous exercise get completed.

## Deploy the App on Cloud Foundry Using STS
1.  Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.

	![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry.png)

2.  Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.

	![cloud foundry account information.png](/images/spring_tutorial/cloud_foundry_account.png)

3.  Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.

	![spring-expensereport-login.png](/images/spring_tutorial/cloud_foundry_project_deploy.png) 

	![spring-expensereport-project-deploy.png](/images/spring_tutorial/project_deploy_step2.png)

4.  Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required.

	![spring-expensereport-project-deploy-step-2.png](/images/spring_tutorial/project_deploy_step3.png)

5.  Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click 

	![service_selection.png](/images/spring_tutorial/service_selection.png)

	![create_new_service.png](/images/spring_tutorial/create_new_service.png)

6.  Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.

	![spring-expensereport-login.png](/images/spring_tutorial/service_selection_1.png)

## Check Point
Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![deployed_application_in_cloud_foundry.png](/images/spring_tutorial/deployed_application_in_cloud_foundry.png)

[<==Prev      ](/frameworks/java/spring/expensereport-app-with-spring-security.html)              [        Next==>](/frameworks/java/spring/spring-app-deployment-using-VMC.html);T;
I"Ö<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to push Spring Application into Cloud Foundry using STS.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should be familiar with:</p>

<ol>
<li>
    <p>Cloud Foundry plugin for STS installed.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="deploy-the-app-on-cloud-foundry-using-sts">Deploy the App on Cloud Foundry Using STS</h2>
<ol>
<li>
    <p>Go to servers view,right click add New Server.Now you can see Cloud Foundry under VMware.Select Cloud Foundry,then click next.It will ask your account information and Choose VMware Cloud Foundry - http://api.cloudfoundry.com from the URL.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry.png" alt="spring-expensereport-login.png"></p>
  </li>
  <li>
    <p>Now give your Cloud Foundry account information.Click validate and make sure you have entered  valid credentials.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry_account.png" alt="cloud foundry account information.png"></p>
  </li>
  <li>
    <p>Click next it will show you add and remove view.Now you can select our spring application.Once you added your application it will open new window with application name and application type.You can enter your application name.</p>

    <p><img src="/images/spring_tutorial/cloud_foundry_project_deploy.png" alt="spring-expensereport-login.png"></p>

    <p><img src="/images/spring_tutorial/project_deploy_step2.png" alt="spring-expensereport-project-deploy.png"></p>
  </li>
  <li>
    <p>Click next you can see deployed URL(your application name+cloudfoundry.com) and memory reservation.by default memory reservation selected to 512M.You can increase memory if required.</p>

    <p><img src="/images/spring_tutorial/project_deploy_step3.png" alt="spring-expensereport-project-deploy-step-2.png"></p>
  </li>
  <li>
    <p>Click next now it will ask for services selection.Since we are using postgresql in our application we need to add postgresql service.Click add services to server it will open service configuration window.select type as Postgre SQL database service(VFabric) and give name to this service then click </p>

    <p><img src="/images/spring_tutorial/service_selection.png" alt="service_selection.png"></p>

    <p><img src="/images/spring_tutorial/create_new_service.png" alt="create_new_service.png"></p>
  </li>
  <li>
    <p>Now you can see your services in services selection window.Select postgresql service and click finish.Now server starts to deploy our application into Cloud Foundry.</p>

    <p><img src="/images/spring_tutorial/service_selection_1.png" alt="spring-expensereport-login.png"></p>
  </li>
</ol><h2 id="check-point">Check Point</h2>
<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>

<p><a href="/frameworks/java/spring/expensereport-app-with-spring-security.html">&lt;==Prev      </a>              <a href="/frameworks/java/spring/spring-app-deployment-using-VMC.html">        Next==&gt;</a></p>;T;@wI"=/frameworks/java/spring/spring-app-deployment-using-VMC/;T{;{	;I"¸D<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/spring-app-deployment-using-VMC.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | VMC to deploy Spring Application' property='og:title'>
<meta content='Spring Application Deployment to Cloud Foundry using VMC' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | VMC to deploy Spring Application</title>
<link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/js/documentation.js' type='text/javascript'></script>
<script src='/js/jquery.easing.js' type='text/javascript'></script>
<script src='/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>VMC to deploy Spring Application</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/frameworks/ruby/rails-3-1.html'>Rails 3.1</a>
</li>
<li>
<a href='/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tutorial</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/frameworks/java/spring/spring-getting-started-with-STS.html'>Spring Tutorial</a>
</li>
<li class='js-subtopic'>
<a href='#'>Ruby on Rails Tutorial</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
</div>
<div class='span-11 last'>
<h2>Spring Application Deployment to Cloud Foundry using VMC</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/spring" rel="tag">spring</a><a href="/tags/STS" rel="tag">STS</a><a href="/tags/tomcat" rel="tag">tomcat</a><a href="/tags/maven" rel="tag">maven</a><a href="/tags/VMC" rel="tag">VMC</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-03
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to create Spring Application war and push into Cloud Foundry using VMC tool.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should done with:</p>

<ol>
<li>
    <p>VMC tool installed.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------
</pre>

<ul>
<li>Now point vmc target to <code>http://api.cloudfoundry.cpm</code> and login to cloudfoundry using your credentials.</li>
</ul><pre class="terminal">
$ vmc target http://api.cloudfoundry.com
Successfully targeted to [http://api.cloudfoundry.com]

$ vmc login
Attempting login to [http://api.cloudfoundry.com]
Email: senthil.s@imaginea.com
Password: **********
Successfully logged into [http://api.cloudfoundry.com]

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="check-point">Check Point</h2>
<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>

<p><a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">&lt;==Prev</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
;T;	I"Á## Introduction
This section provides details on how to create Spring Application war and push into Cloud Foundry using VMC tool.

## Prerequisites
Before you begin this tutorial, you should done with:

1.  VMC tool installed.

2.  Assuming previous exercise get completed.

## Deploy the App on Cloud Foundry Using VMC
Deployment to Cloud Foundry can be done in two simple steps:

+  Create war file
+  Push the war file using `vmc`

Commands below show the exact commands and output when the app is deployed:

Go to your project work space and issue the following commands.

``` bash
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------
```
* Now point vmc target to `http://api.cloudfoundry.cpm` and login to cloudfoundry using your credentials.

```bash
$ vmc target http://api.cloudfoundry.com
Successfully targeted to [http://api.cloudfoundry.com]

$ vmc login
Attempting login to [http://api.cloudfoundry.com]
Email: senthil.s@imaginea.com
Password: **********
Successfully logged into [http://api.cloudfoundry.com]

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
```

## Check Point
Upon completion of deployment, we can go and visit the actual app at the URL `[app-name].cloudfoundry.com]`

![deployed_application_in_cloud_foundry.png](/images/spring_tutorial/deployed_application_in_cloud_foundry.png)


[<==Prev](/frameworks/java/spring/spring-app-deployment-using-STS.html);T;
I"0<h2 id="introduction">Introduction</h2>
<p>This section provides details on how to create Spring Application war and push into Cloud Foundry using VMC tool.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should done with:</p>

<ol>
<li>
    <p>VMC tool installed.</p>
  </li>
  <li>
    <p>Assuming previous exercise get completed.</p>
  </li>
</ol><h2 id="deploy-the-app-on-cloud-foundry-using-vmc">Deploy the App on Cloud Foundry Using VMC</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create war file</li>
  <li>Push the war file using <code>vmc</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed:</p>

<p>Go to your project work space and issue the following commands.</p>

<pre class="terminal">
$ mvn war:war
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building SpringMVC-ExpenseReport 1.0.0-BUILD-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-war-plugin:2.1.1:war (default-cli) @ html5expense ---
[INFO] Packaging webapp
[INFO] Assembling webapp [html5expense] in [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT]
[INFO] Processing war project
[INFO] Copying webapp resources [/home/senthils/Code/From Home/SpringMVC-ExpenseReport/src/main/webapp]
[INFO] Webapp assembled in [380 msecs]
[INFO] Building war: /home/senthils/Code/From Home/SpringMVC-ExpenseReport/target/html5expense-1.0.0-BUILD-SNAPSHOT.war
[INFO] WEB-INF/web.xml already added, skipping
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.443s
[INFO] Finished at: Mon Sep 17 15:57:50 IST 2012
[INFO] Final Memory: 6M/124M
[INFO] ------------------------------------------------------------------------
</pre>

<ul>
<li>Now point vmc target to <code>http://api.cloudfoundry.cpm</code> and login to cloudfoundry using your credentials.</li>
</ul><pre class="terminal">
$ vmc target http://api.cloudfoundry.com
Successfully targeted to [http://api.cloudfoundry.com]

$ vmc login
Attempting login to [http://api.cloudfoundry.com]
Email: senthil.s@imaginea.com
Password: **********
Successfully logged into [http://api.cloudfoundry.com]

$ vmc push
Would you like to deploy from the current directory? [Yn]: /home/senthils/.rvm/gems/ruby-1.9.2-head/gems/interact-0.4.8/lib/interact/interactive.rb:569: warning: Insecure world writable dir /home/senthils/Downloads/springsource in PATH, mode 040777

Application Name: html5expense
Detected a Java SpringSource Spring Application, is this correct? [Yn]: Y
Application Deployed URL [html5expense.cloudfoundry.com]: 
Memory reservation (128M, 256M, 512M, 1G, 2G) [512M]: 128M
How many instances? [1]: 
Bind existing services to 'html5expense'? [yN]: 
Create services to bind to 'html5expense'? [yN]: Y
1: mongodb
2: mysql
3: postgresql
4: rabbitmq
5: redis
What kind of service?: 3
Specify the name of the service [postgresql-94876]: 
Create another? [yN]: 
Would you like to save this configuration? [yN]: 
Creating Application: OK
Creating Service [postgresql-94876]: OK
Binding Service [postgresql-94876]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (10K): OK   
Push Status: OK
Staging Application 'html5expense': OK                                          
Starting Application 'html5expense': OK
</pre>

<h2 id="check-point">Check Point</h2>
<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/spring_tutorial/deployed_application_in_cloud_foundry.png" alt="deployed_application_in_cloud_foundry.png"></p>

<p><a href="/frameworks/java/spring/spring-app-deployment-using-STS.html">&lt;==Prev</a></p>;T;@}I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/customers.jsp/;T{;{ I"Z/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/3.jsp/;T{;{ I"c/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/newexpense.jsp/;T{;{ I"i/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/createNewExpense.jsp/;T{;{ I"Z/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/4.jsp/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/loginOld.jsp/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/indexOld.jsp/;T{;{ I"^/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/login.jsp/;T{;{ I"]/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/home.jsp/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/documents.jsp/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/myexpense.jsp/;T{;{ I"_/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/signUp.jsp/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/success.jsp/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/usermain.jsp/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/expenseapproval.jsp/;T{;{ I"^/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/views/hello.jsp/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/spring-security.xml/;T{;{ I"V/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/web.xml/;T{;{ I"t/static/code/Spring App/springmvc-expense-report/src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/edit.jpg/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-down-c.png/;T{;{ I"^/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/bg.gif/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/snext.png/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/clip-a.png/;T{;{ I"d/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/previous.png/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-down-b.png/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/logo-a.png/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/prev.png/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/plus-a.png/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-down-a.png/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/desc.gif/;T{;{ I"f/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/question-a.png/;T{;{ I"e/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/sprevious.png/;T{;{ I"c/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/right-b.png/;T{;{ I"_/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/asc.gif/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-left-a.png/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/clip-b.png/;T{;{ I"c/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/right-a.png/;T{;{ I"c/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/cross-a.png/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/next.png/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/edit1.jpg/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/logo-b.png/;T{;{ I"`/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/last.png/;T{;{ I"i/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-right-a.png/;T{;{ I"f/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/arrow-up-a.png/;T{;{ I"c/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/cross-b.png/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/first.png/;T{;{ I"a/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/images/next1.png/;T{;{ I"o/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/angular-1.0.0rc6.js/;T{;{ I"f/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/expense.js/;T{;{ I"w/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/jquery.tablesorter.pager.js/;T{;{ I"q/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/jquery.tablesorter.js/;T{;{ I"k/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/jquery-1.8.1.js/;T{;{ I"u/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/javascript/jquery.tablesorter.min.js/;T{;{ I"^/static/code/Spring App/springmvc-expense-report/src/main/webapp/resources/css/style.css/;T{;{ I"‡/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaAttachmentServiceImpl.java/;T{;{ I"Š/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaExpenseReportServiceImpl.java/;T{;{ I"„/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaExpenseServiceImpl.java/;T{;{ I"ˆ/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaExpenseTypeServiceImpl.java/;T{;{ I"/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaRoleServiceImpl.java/;T{;{ I"/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/serviceImpl/JpaUserServiceImpl.java/;T{;{ I"†/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/controller/FileAttachmentController.java/;T{;{ I"}/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/controller/LoginController.java/;T{;{ I"/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/controller/ExpenseController.java/;T{;{ I"u/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/Expense.java/;T{;{ I"y/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/ExpenseType.java/;T{;{ I"r/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/User.java/;T{;{ I"r/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/Role.java/;T{;{ I"s/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/State.java/;T{;{ I"x/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/Attachment.java/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/model/ExpenseReport.java/;T{;{ I"/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/ExpenseReportService.java/;T{;{ I"~/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/ExpenseService.java/;T{;{ I"}/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/ExpenseTypeService.java/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/UserService.java/;T{;{ I"|/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/AttachmentService.java/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/service/RoleService.java/;T{;{ I"x/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/config/WebConfig.java/;T{;{ I"~/static/code/Spring App/springmvc-expense-report/src/main/java/com/springsource/html5expense/config/ComponentConfig.java/;T{;{ I"]/static/code/Spring App/springmvc-expense-report/src/main/resources/spring-security.xml/;T{;{ I"b/static/code/Spring App/springmvc-expense-report/src/main/resources/META-INF/persistence.xml/;T{;{ I"S/static/code/Spring App/springmvc-expense-report/src/main/resources/log4j.xml/;T{;{ I"[/static/code/Spring App/springmvc-expense-report/src/main/resources/config.properties/;T{;{ I"T/static/code/Spring App/springmvc-expense-report/src/main/resources/import.sql/;T{;{ I"S/static/code/Spring App/springmvc-expense-report/src/test/resources/log4j.xml/;T{;{ I"ƒ/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaUserServiceImpl.class/;T{;{ I"ƒ/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaRoleServiceImpl.class/;T{;{ I"Š/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaExpenseTypeServiceImpl.class/;T{;{ I"†/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaExpenseServiceImpl.class/;T{;{ I"Œ/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaExpenseReportServiceImpl.class/;T{;{ I"‰/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/serviceImpl/JpaAttachmentServiceImpl.class/;T{;{ I"}/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/UserService.class/;T{;{ I"}/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/RoleService.class/;T{;{ I"/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/ExpenseTypeService.class/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/ExpenseService.class/;T{;{ I"/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/ExpenseReportService.class/;T{;{ I"~/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/service/AttachmentService.class/;T{;{ I"t/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/User.class/;T{;{ I"u/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/State.class/;T{;{ I"t/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/Role.class/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/ExpenseType.class/;T{;{ I"}/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/ExpenseReport.class/;T{;{ I"w/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/Expense.class/;T{;{ I"z/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/model/Attachment.class/;T{;{ I"/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/controller/LoginController.class/;T{;{ I"ˆ/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/controller/FileAttachmentController.class/;T{;{ I"/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/controller/ExpenseController.class/;T{;{ I"z/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/config/WebConfig.class/;T{;{ I"{/static/code/Spring App/springmvc-expense-report/target/classes/com/springsource/html5expense/config/ComponentConfig.class/;T{;{ I"^/static/code/Spring App/springmvc-expense-report/target/classes/META-INF/persistence.xml/;T{;{ I"Y/static/code/Spring App/springmvc-expense-report/target/classes/spring-security.xml/;T{;{ I"O/static/code/Spring App/springmvc-expense-report/target/classes/log4j.xml/;T{;{ I"P/static/code/Spring App/springmvc-expense-report/target/classes/import.sql/;T{;{ I"W/static/code/Spring App/springmvc-expense-report/target/classes/config.properties/;T{;{ I"T/static/code/Spring App/springmvc-expense-report/target/test-classes/log4j.xml/;T{;{ I"h/static/code/Spring App/springmvc-expense-report/target/m2e-wtp/web-resources/META-INF/MANIFEST.MF/;T{;{ I"Š/static/code/Spring App/springmvc-expense-report/target/m2e-wtp/web-resources/META-INF/maven/com.springsource/html5expense/pom.properties/;T{;{ I"ƒ/static/code/Spring App/springmvc-expense-report/target/m2e-wtp/web-resources/META-INF/maven/com.springsource/html5expense/pom.xml/;T{;{ I"Z/static/code/Spring App/springmvc-expense-report/target/tomcat/conf/tomcat-users.xml/;T{;{ I"Q/static/code/Spring App/springmvc-expense-report/target/tomcat/conf/web.xml/;T{;{ I"—/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/login_jsp.java/;T{;{ I"›/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/myexpense_jsp.java/;T{;{ I"˜/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/login_jsp.class/;T{;{ I"œ/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/newexpense_jsp.java/;T{;{ I"œ/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/myexpense_jsp.class/;T{;{ I"/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/newexpense_jsp.class/;T{;{ I"›/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/customers_jsp.java/;T{;{ I"œ/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/org/apache/jsp/WEB_002dINF/views/customers_jsp.class/;T{;{ I"y/static/code/Spring App/springmvc-expense-report/target/tomcat/work/localEngine/localhost/html5expense/SESSIONS.ser/;T{;{ I">/static/code/Spring App/springmvc-expense-report/queries/;T{;{ I">/static/code/Spring App/springmvc-expense-report/pom.xml/;T{;{ :versioni